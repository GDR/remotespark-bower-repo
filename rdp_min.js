var svManager={getInstance:function(){var y=window.$rdp;if(y&&y.running&&y.running())return y;return null}};svGlobal.getInstance=svManager.getInstance;
function connvertServer(y){var ja=new Object;ja.id=y.id;ja.server=y.id;ja.displayName=y.displayName||y.id;var da=y.rdp;if(da){for(var Ya in da)ja[Ya]=da[Ya];ja.user=da.username||"";ja.pwd=da.password||"";ja.useConsole=da.console||false;ja.legacyMode=da.leagacyMode||da.legacyMode||false;ja.server_bpp=da.color||16;ja.exe=da.remoteProgram||"";ja.args=da.remoteArgs||"";if(ja.exe.length>0)ja.startProgram="app";else if(ja.command&&ja.command.length>0)ja.startProgram="shell";else ja.startProgram="noapp"}return ja}
function Rdp2(y){if(!y){var ja=window.opener;try{if(ja&&ja.__sparkUser&&ja.__sparkUser.server)y=ja.__sparkUser.server;if(!y&&ja.sparkServer)y=ja.sparkServer}catch(Za){}if(!y)y=hi5.browser.cookie2Obj();if(!y||!y.gateway){hi5.notifications.notify({"msg":__svi18n.noauth});return null}}var da="";var Ya=y.gateway||"";var rb=window.innerWidth;var qa=window.innerHeight;var gb=16;var za=null;if(y.width)rb=parseInt(y.width,10);if(y.height)qa=parseInt(y.height,10);if(y.color)gb=parseInt(y.color,10);if(y.server_bpp)gb=
parseInt(y.server_bpp,10);for(var Ca in y){svGlobal.logger.debug("** p:"+Ca+" v="+y[Ca]);var La=y[Ca];if("useSSL"==Ca){za=La=="true"||La==true;continue}if(typeof La=="boolean")if(La)La="on";else continue;if(""!=da)da+="&";da+=Ca+"="+encodeURIComponent(La)}if(za===null)za="https:"==location.protocol;Ca=za?"wss://":"ws://";da=Ca+Ya+"/RDP?"+da;return new Rdp(da,rb,qa,gb)}if(!svGlobal.Rdp2)svGlobal.Rdp2=Rdp2;
function Rdp(y,ja,da,Ya){function rb(){var a=0;var e=0;var d=0;var f=0;var g=0;var c=0;this.on=false;this.verify=function(c){if(c.x==a&&c.y==e&&(c.width==0||c.width==d)&&c.height==f)if(this.on)c.width=0;else{g++;if(g>3)this.on=true}else{g=0;this.on=false;a=c.x;e=c.y;d=c.width;f=c.height}}}function qa(a){return a=="on"||a=="true"}function gb(a){return a=="off"||a=="false"}function za(){var a=m.gateway;if(m.ongetgatewayaddress)a=m.ongetgatewayaddress(a);return a}function Ca(a){if(hi5.browser.isiOS){var e=
a-hi5.browser.innerHeight;if(e>10&&e<22)a=hi5.browser.innerHeight}return a}function La(){var a=hi5.storage.get("SV_CONN_SHARE_ID");if(!a){a=hi5.tool.uuid();hi5.storage.set("SV_CONN_SHARE_ID",a)}return a}function Za(){return x.displayName||x.server||x.symlink||x.id||"undefined"}function zb(a,e){if(m.setTitle){e=e||window;if(m.ontitlechange)a=m.ontitlechange(a);e.document.title=a}}function Rb(){function a(a,d,f,g,h,Ma,A,H){var w=0;var t="Int32Array"in window?new Int32Array(160):Array(160);if(!t.buffer)Ha(t,
0,160,0);var m="Int32Array"in window?new Int32Array(40):Array(40);if(!m.buffer)Ha(m,0,40,0);var E=120;for(var ka=0;ka<=3;ka++,w+=13){e(h[ka],f[ka],w,Ma,m);c(d[ka],g[ka],m,E);Na(D,E,t,ka*40,39)}var R=new Int32Array(8);var B=C[J];var ea=C[J^=1];b(a,B);k(ea,B,R);r(R);n(R,13,t,A,0,H);v(ea,B,R);r(R);n(R,14,t,A,13,H);p(ea,B,R);r(R);n(R,13,t,A,27,H);l(B,R);r(R);n(R,120,t,A,40,H);var I=0;var x=H;for(var z=H+160;z-- >H;x++){I=q(u,28180);u=A[x]+I;if(u<-32768)u=-32768;else if(u>32767)u=32767;I=u<<1;if(I<-32768)I=
-32768;else if(I>32767)I=32767;A[x]=I}}function e(a,e,c,b,h){var Ma=new Int32Array(13);if(!Ma.buffer)Ha(Ma,0,13,0);var n;n=d(a);f(b,Ma,c,n[0],n[1]);g(e,Ma,h)}function d(a){var e=0;var d=0;if(a>15)e=(a>>3)-1;d=a-(e<<3);if(d==0){e=-4;d=7}else{for(;d<=7;){d=d<<1|1;e--}d-=8}var f=new Array(2);f[0]=e;f[1]=d;return f}function f(a,e,d,f,g){var c;var b;var h;var n;b=t[g];h=w(6,f);n=m(1,w(h,1));var k=0;for(var r=0;r<13;r++){c=(a[d++]<<1)-7;c<<=12;c=q(b,c);c=c+n;if(c<-32768)c=-32768;else if(c>32767)c=32767;
e[k++]=I(c,h)}}function g(a,e,d){var f=13;var g=0;var c=0;switch(a){case 3:d[c++]=0;case 2:d[c++]=0;case 1:d[c++]=0;case 0:d[c++]=e[g++];f--}do{d[c++]=0;d[c++]=0;d[c++]=e[g++]}while(--f>0);for(;++a<4;)d[c++]=0}function c(a,e,d,f){var g;var c;var b;b=a<40||a>120?ka:a;ka=b;g=B[e];for(var h=0;h<=39;h++){c=q(g,D[h-b+f]);c=c+d[h];if(c<-32768)c=-32768;else if(c>32767)c=32767;D[h+f]=c}Na(D,f-80,D,f-120,120)}function b(a,e){var d=0;var f=0;h(a,e,f++,d,0,-32,13107);h(a,e,f++,d,0,-32,13107);h(a,e,f++,d,2048,
-16,13107);h(a,e,f++,d,-2560,-16,13107);h(a,e,f++,d,94,-8,19223);h(a,e,f++,d,-1792,-8,17476);h(a,e,f++,d,-341,-4,31454);h(a,e,f++,d,-1144,-4,29708)}function h(a,e,d,f,g,c,b){f=a[d]+c;if(f<-32768)f=-32768;else if(f>32767)f=32767;f<<=10;f=w(f,g<<1);f=q(b,f);f=f+f;if(f<-32768)f=-32768;else if(f>32767)f=32767;e[d]=f}function k(a,e,d){var f=0;for(var g=0;g<8;g++){f=(a[g]>>2)+(e[g]>>2);if(f<-32768)f=-32768;else if(f>32767)f=32767;f=f+(a[g]>>1);if(f<-32768)f=-32768;else if(f>32767)f=32767;d[g]=f}}function v(a,
e,f){var d=0;for(var g=0;g<8;g++){d=(a[g]>>1)+(e[g]>>1);if(d<-32768)d=-32768;else if(d>32767)d=32767;f[g]=d}}function p(a,e,f){var d=0;for(var g=0;g<8;g++){d=(a[g]>>2)+(e[g]>>2);if(d<-32768)d=-32768;else if(d>32767)d=32767;d=d+(e[g]>>1);if(d<-32768)d=-32768;else if(d>32767)d=32767;f[g]=d}}function l(a,e){for(var d=0;d<8;d++)e[d]=a[d]}function r(a){var e=0;for(var d=0;d<8;d++)if(a[d]<0){e=a[d]==-32768?32767:-a[d];a[d]=-(e<11059?e<<1:e<20070?e+11059:A(e>>2,26112))}else{e=a[d];a[d]=e<11059?e<<1:e<20070?
e+11059:A(e>>2,26112)}}function n(a,e,d,f,g,c){var b=0;var h=0;for(var n=0;e!=0;){e--;b=d[g];for(var k=7;k>=0;k--){h=a[k];n=E[k];n=((h==-32768&&n==-32768?32767:65535&h*n+16384>>15)&65535)<<16>>16;b=w(b,n);h=((h==-32768&&b==-32768?32767:65535&h*b+16384>>15)&65535)<<16>>16;h=E[k]+h;if(h<-32768)h=-32768;else if(h>32767)h=32767;E[k+1]=h}f[c+g++]=E[0]=b}}function q(a,e){if(a==-32768&&e==-32768)return 32767;else{var d=a*e+16384;d=(d>>15&65535)<<16>>16;return d}}function A(a,e){var d=a+e;return d<-32768?
-32768:d>32767?32767:d}function w(a,e){var d=a-e;return d<-32768?-32768:d>32767?32767:d}function m(a,e){if(e>=16)return 0;if(e<=-16)if(a<0)return-1;else return-0;if(e<0)return I(a,-e);return a<<e}function I(a,e){if(e>=16)if(a<0)return-1;else return 0;if(e<=-16)return 0;if(e<0)return a<<-e;return a>>e}var t=[18431,20479,22527,24575,26623,28671,30719,32767];var B=[3277,11469,21299,32767];var D=new Int32Array(280);var C=[new Int32Array(8),new Int32Array(8)];var J=0;var ka=40;var E=new Int32Array(9);
var u=0;var H=new Int32Array(320);H[0]=0;var ea=[.1];this.decode=function(e,d,f){var g=0;var c=0;var b=0;var h=new Int32Array(8);var n=new Int32Array(4);var k=new Int32Array(4);var r=new Int32Array(4);var p=new Int32Array(4);var l=new Int32Array(52);if(K)K.begin("audioDec");for(;d<f;){b=0;b=e[d++]&255;h[0]=b&63;b=b>>>6;b|=e[d++]<<2&1023;h[1]=b&63;b=b>>>6;b|=e[d++]<<4&4095;h[2]=b&31;b=b>>>5;h[3]=b&31;b=b>>>5;b|=e[d++]<<2&1023;h[4]=b&15;b=b>>>4;h[5]=b&15;b=b>>>4;b|=e[d++]<<2&1023;h[6]=b&7;b=b>>>3;h[7]=
b&7;b=b>>>3;b|=e[d++]<<4&4095;n[0]=b&127;b=b>>>7;r[0]=b&3;b=b>>>2;k[0]=b&3;b=b>>>2;b|=e[d++]<<1&511;p[0]=b&63;b=b>>>6;l[0]=b&7;b=b>>>3;b=e[d++]&255;l[1]=b&7;b=b>>>3;l[2]=b&7;b=b>>>3;b|=e[d++]<<2&1023;l[3]=b&7;b=b>>>3;l[4]=b&7;b=b>>>3;l[5]=b&7;b=b>>>3;b|=e[d++]<<1&511;l[6]=b&7;b=b>>>3;l[7]=b&7;b=b>>>3;l[8]=b&7;b=b>>>3;b=e[d++]&255;l[9]=b&7;b=b>>>3;l[10]=b&7;b=b>>>3;b|=e[d++]<<2&1023;l[11]=b&7;b=b>>>3;l[12]=b&7;b=b>>>3;b|=e[d++]<<4&4095;n[1]=b&127;b=b>>>7;r[1]=b&3;b=b>>>2;k[1]=b&3;b=b>>>2;b|=e[d++]<<
1&511;p[1]=b&63;b=b>>>6;l[13]=b&7;b=b>>>3;b=e[d++]&255;l[14]=b&7;b=b>>>3;l[15]=b&7;b=b>>>3;b|=e[d++]<<2&1023;l[16]=b&7;b=b>>>3;l[17]=b&7;b=b>>>3;l[18]=b&7;b=b>>>3;b|=e[d++]<<1&511;l[19]=b&7;b=b>>>3;l[20]=b&7;b=b>>>3;l[21]=b&7;b=b>>>3;b=e[d++]&255;l[22]=b&7;b=b>>>3;l[23]=b&7;b=b>>>3;b|=e[d++]<<2&1023;l[24]=b&7;b=b>>>3;l[25]=b&7;b=b>>>3;b|=e[d++]<<4&4095;n[2]=b&127;b=b>>>7;r[2]=b&3;b=b>>>2;k[2]=b&3;b=b>>>2;b|=e[d++]<<1&511;p[2]=b&63;b=b>>>6;l[26]=b&7;b=b>>>3;b=e[d++]&255;l[27]=b&7;b=b>>>3;l[28]=b&7;
b=b>>>3;b|=e[d++]<<2&1023;l[29]=b&7;b=b>>>3;l[30]=b&7;b=b>>>3;l[31]=b&7;b=b>>>3;b|=e[d++]<<1&511;l[32]=b&7;b=b>>>3;l[33]=b&7;b=b>>>3;l[34]=b&7;b=b>>>3;b=e[d++]&255;l[35]=b&7;b=b>>>3;l[36]=b&7;b=b>>>3;b|=e[d++]<<2&1023;l[37]=b&7;b=b>>>3;l[38]=b&7;b=b>>>3;b|=e[d++]<<4&4095;n[3]=b&127;b=b>>>7;r[3]=b&3;b=b>>>2;k[3]=b&3;b=b>>>2;b|=e[d++]<<1&511;p[3]=b&63;b=b>>>6;l[39]=b&7;b=b>>>3;b=e[d++]&255;l[40]=b&7;b=b>>>3;l[41]=b&7;b=b>>>3;b|=e[d++]<<2&1023;l[42]=b&7;b=b>>>3;l[43]=b&7;b=b>>>3;l[44]=b&7;b=b>>>3;b|=
e[d++]<<1&511;l[45]=b&7;b=b>>>3;l[46]=b&7;b=b>>>3;l[47]=b&7;b=b>>>3;b=e[d++]&255;l[48]=b&7;b=b>>>3;l[49]=b&7;b=b>>>3;b|=e[d++]<<2&1023;l[50]=b&7;b=b>>>3;l[51]=b&7;b=b>>>3;a(h,n,k,r,p,l,H,0);b=b&15;b|=e[d++]<<4&4095;h[0]=b&63;b=b>>>6;h[1]=b&63;b=b>>>6;b=e[d++]&255;h[2]=b&31;b=b>>>5;b|=e[d++]<<3&2047;h[3]=b&31;b=b>>>5;h[4]=b&15;b=b>>>4;b|=e[d++]<<2&1023;h[5]=b&15;b=b>>>4;h[6]=b&7;b=b>>>3;h[7]=b&7;b=b>>>3;b=e[d++]&255;n[0]=b&127;b=b>>>7;b|=e[d++]<<1&511;r[0]=b&3;b=b>>>2;k[0]=b&3;b=b>>>2;b|=e[d++]<<5&
8191;p[0]=b&63;b=b>>>6;l[0]=b&7;b=b>>>3;l[1]=b&7;b=b>>>3;b|=e[d++]<<1&511;l[2]=b&7;b=b>>>3;l[3]=b&7;b=b>>>3;l[4]=b&7;b=b>>>3;b=e[d++]&255;l[5]=b&7;b=b>>>3;l[6]=b&7;b=b>>>3;b|=e[d++]<<2&1023;l[7]=b&7;b=b>>>3;l[8]=b&7;b=b>>>3;l[9]=b&7;b=b>>>3;b|=e[d++]<<1&511;l[10]=b&7;b=b>>>3;l[11]=b&7;b=b>>>3;l[12]=b&7;b=b>>>3;b=e[d++]&255;n[1]=b&127;b=b>>>7;b|=e[d++]<<1&511;r[1]=b&3;b=b>>>2;k[1]=b&3;b=b>>>2;b|=e[d++]<<5&8191;p[1]=b&63;b=b>>>6;l[13]=b&7;b=b>>>3;l[14]=b&7;b=b>>>3;b|=e[d++]<<1&511;l[15]=b&7;b=b>>>3;
l[16]=b&7;b=b>>>3;l[17]=b&7;b=b>>>3;b=e[d++]&255;l[18]=b&7;b=b>>>3;l[19]=b&7;b=b>>>3;b|=e[d++]<<2&1023;l[20]=b&7;b=b>>>3;l[21]=b&7;b=b>>>3;l[22]=b&7;b=b>>>3;b|=e[d++]<<1&511;l[23]=b&7;b=b>>>3;l[24]=b&7;b=b>>>3;l[25]=b&7;b=b>>>3;b=e[d++]&255;n[2]=b&127;b=b>>>7;b|=e[d++]<<1&511;r[2]=b&3;b=b>>>2;k[2]=b&3;b=b>>>2;b|=e[d++]<<5&8191;p[2]=b&63;b=b>>>6;l[26]=b&7;b=b>>>3;l[27]=b&7;b=b>>>3;b|=e[d++]<<1&511;l[28]=b&7;b=b>>>3;l[29]=b&7;b=b>>>3;l[30]=b&7;b=b>>>3;b=e[d++]&255;l[31]=b&7;b=b>>>3;l[32]=b&7;b=b>>>
3;b|=e[d++]<<2&1023;l[33]=b&7;b=b>>>3;l[34]=b&7;b=b>>>3;l[35]=b&7;b=b>>>3;b|=e[d++]<<1&511;l[36]=b&7;b=b>>>3;l[37]=b&7;b=b>>>3;l[38]=b&7;b=b>>>3;b=e[d++]&255;n[3]=b&127;b=b>>>7;b|=e[d++]<<1&511;r[3]=b&3;b=b>>>2;k[3]=b&3;b=b>>>2;b|=e[d++]<<5&8191;p[3]=b&63;b=b>>>6;l[39]=b&7;b=b>>>3;l[40]=b&7;b=b>>>3;b|=e[d++]<<1&511;l[41]=b&7;b=b>>>3;l[42]=b&7;b=b>>>3;l[43]=b&7;b=b>>>3;b=e[d++]&255;l[44]=b&7;b=b>>>3;l[45]=b&7;b=b>>>3;b|=e[d++]<<2&1023;l[46]=b&7;b=b>>>3;l[47]=b&7;b=b>>>3;l[48]=b&7;b=b>>>3;b|=e[d++]<<
1&511;l[49]=b&7;b=b>>>3;l[50]=b&7;b=b>>>3;l[51]=b&7;b=b>>>3;a(h,n,k,r,p,l,H,160);c=g++*320;for(var v=0;v<320;v++)ea[c++]=H[v]/32768}ea.length=g*320;if(K)K.end("audioDec");return ea}}function Sb(a,e){function d(a,b,e,d,f,g){var c=a+f;var h=b+g;var n=0;var l=0;if(k[0].set)for(;l<d;l++)k[h+l].set(k[b+l].subarray(a,a+e),c);else for(;l<d;l++){var r=k[h+l];var p=k[b+l];for(n=0;n<e;n++)r[c+n]=p[a+n]}}function f(a,b,e,d,f,g){var c=a+f;var h=b+g;var n=0;var l=0;if(k[0].set)for(l=d-1;l>=0;l--)k[h+l].set(k[b+
l].subarray(a,a+e),c);else for(l=d-1;l>=0;l--){var r=k[h+l];var p=k[b+l];for(n=0;n<e;n++)r[c+n]=p[a+n]}}function g(a,b,e,d,f,g){var c=a+f;var h=b+g;var l=0;var n=0;var r=0;var p=0;for(l=e-1;l>=0;l--){r=c+l;p=a+l;for(n=0;n<d;n++)k[h+n][r]=k[b+n][p]}}function c(a,b,e,d,f,g){var c=a+f;var h=b+g;var l=0;var n=0;var r=0;for(var p=0;l<e;l++){r=c+l;p=a+l;for(n=0;n<d;n++)k[h+n][r]=k[b+n][p]}}function b(a,b,e,d,f){if(f.width>0)f.union(a,b,e,d);else{f.x=a;f.y=b;f.width=e;f.height=d}}function h(a,b,e,d){var f;
for(t=0;t<B;t++){f=m[t];if(a>=f[0]&&b>=f[1]&&e<=f[2]&&d<=f[3])return I[t]}return null}var k=[];var v=null;var p=new hb(0,0,0,0);var l="Uint8ClampedArray"in window;var r=0;var n=0;var q=0;var A=0;var w=null;var m;var I;var t=0;var B=0;this.width=a;this.height=e;var D=false;var C=this;var J={imgData:null,left:0,top:0,width:0,height:0};this.getDirtyArea=function(){return p};this.setImgRect=function(a,b,e,d){r=a;n=b;q=e;A=d};this.parseMonitorDef=function(a){var b=a.split(",");var e=b.length;var d=[];
if(e>1){var f=false;for(var g=0;g<e;g++){var c=b[g].split(":");if(c.length==4){d[g]=new Array(5);d[g][0]=parseInt(c[0]);d[g][1]=parseInt(c[1]);d[g][2]=parseInt(c[2]);d[g][3]=parseInt(c[3]);d[g][4]=d[g][0]==0&&d[g][1]==0?1:0}else{f=true;break}}if(f){svGlobal.logger.warn("invaiid monitorDef:"+a);d.length=0}}return d};this.setMonitorLayout=function(a){var b=a.length;var e=0;m=a;for(I=new Array(b);e<b;e++)I[e]=new hb(0,0,0,0);B=b};this.setMonitorCount=function(a){B=a};this.addImg=function(a){if(q){if(w)URL.revokeObjectURL(w.src);
w=a}};this.flushImgs=function(){if(w){URL.revokeObjectURL(w.src);w=null;q=0}};this.getData=function(){return k};this.pause=function(a){D=a};this.release=function(){p=null;hi5.Arrays.release(I);C.flushImgs();C=null;v=null;k=null;J.imgData=null;J=null};this.isPaused=function(){return D};this.setContext=function(b){if(b==v)return;if(!v&&b&&!b.createImageData(1,1).data.buffer)l=false;v=b;if(v!=null)J.imgData=v.createImageData(a,e)};this.getContext=function(){return v};this.resize=function(b,d){if(k.length==
d&&k[0].length==b)return;for(var f=0;f<d;f++)k[f]=new Uint32Array(b);C.width=a=b;C.height=e=d;if(v!=null)J.imgData=v.createImageData(a,e)};C.resize(a,e);this.getBuffer=function(){return k};this.setRGB=function(a,b,e){k[b][a]=e|4278190080};this.getRGB=function(a,b){return k[b][a]};this.setRGBs=function(a,b,d,f,g,c,h){var l=c;var n=0;var r=0;var p=a+d;var v=b+f;if(v>e)v=e;if(g.subarray)for(var q=b;q<v;q++,l+=h)k[q].set(g.subarray(l,l+d),a);else{var A;for(q=b;q<v;q++,l+=h){r=l;A=k[q];for(n=a;n<p;n++)A[n]=
g[r++]}}};this.moveArea=function(a,b,e,h,l,n){if(n>0)f(a,b,e,h,l,n);else if(n<0)d(a,b,e,h,l,n);else if(l>0)g(a,b,e,h,l,n);else c(a,b,e,h,l,n)};this.getRGBs=function(a,b,e,d){var f=e*d;var g=new Uint32Array(f);var c=a+e;var h=b+d;var l=0;var n=0;for(i=b;i<h;i++){g.set(k[i].subarray(a,c),l);l+=e}return g};this.repaint=function(b,d,f,g){var c=J.imgData.data;var h=0;var n=0;var r=0|0;var p=0;var v=0;var q=0|0;var A=0|0;if(K)K.begin("paint");if(b<0){f+=b;b=0}if(d<0){g+=d;d=0}if(b+f>a)f=a-b;if(d+g>e)g=
e-d;h=b+f;n=d+g;if(l){var w=new Uint32Array(c.buffer);for(v=d;v<n;v++){w.set(k[v].subarray(b,h),r);r+=a}}else{A=(a-f)*4|0;for(v=d;v<n;v++){for(p=b;p<h;p++){q=k[v][p];c[r++]=q&255;c[r++]=q>>8&255;c[r++]=q>>16&255;c[r++]=255}r+=A}}J.left=b;J.top=d;J.width=f;J.height=g;if(K)K.end("paint");return J};this.postPaint=function(a,e,d,f){if(!B)b(a,e,d,f,p);else{var g=h(a,e,a+d-1,e+f-1);if(g)b(a,e,d,f,g)}};this.draw=function(a,b,e,d){if(v&&!D){if(w&&w.complete){v.drawImage(w,r,n,q,A);URL.revokeObjectURL(w.src);
w=null}if(!B){if(p.width){C.repaint(p.x,p.y,p.width,p.height);p.width=0;return J}}else{var f=h(a,b,e,d);if(f.width){C.repaint(f.x,f.y,f.width,f.height);f.width=0;return J}}}return null};this.fillRect=function(a,b,e,d,f){var g=a+e;var c=b+d;if(k[0].fill){var h;for(var n=b;n<c;n++)k[n].fill(f,a,g)}else for(n=b;n<c;n++)for(h=a;h<g;h++)k[n][h]=f};this.drawLine=function(a,b,e,d,f){var g=0;var c=0;if(b==d){if(a>e){c=a;a=e;e=c}var h=k[b];e++;if(h.fill)h.fill(f,a,e);else for(g=a;g<e;g++)h[g]=f}else if(a==
e){if(b>d){c=b;b=d;d=c}d++;for(g=b;g<d;g++)k[g][a]=f}else{var n=Math.abs(e-a);var l=Math.abs(d-b);var r=a;var p=b;var v=0;var q=0;var A=0;var w=0;var t=0;var m=0;var R=0;var B=0;if(e>=a){v=1;q=1}else{v=-1;q=-1}if(d>=b){A=1;w=1}else{A=-1;w=-1}if(n>=l){v=0;w=0;m=n;t=n/2|0;R=l;B=n}else{q=0;A=0;m=l;t=l/2|0;R=n;B=l}if(B<1)return;B++;for(var C=0;C<B;C++){k[p][r]=f;t+=R;if(t>=m){t-=m;r+=v;p+=A}r+=q;p+=w}}}}function $a(a){return a&~3}function Tb(){if(T&&!hi5.browser.isiOS){P=(x.waWidth||screen.width)|0;Z=
(x.waHeight||screen.height)|0}else{P=$a(P);Z=$a(Z)}if(x.minWidth&&P<x.minWidth)P=x.minWidth|0;if(x.minHeight&&Z<x.minHeight)Z=x.minHeight|0;x.waWidth=x.waWidth||P;x.waHeight=x.waHeight||Z}function sb(a,e){if(z)z.resize(a,e);else z=new Sb(a,e);return z}function Ub(a){var e=a>>8&248|a>>13&7;var d=a>>3&252|a>>9&3;var f=a<<3&248|a>>2&7;return 4278190080|f<<16|d<<8|e}function Tc(a){return 4278190080|Y.paletteRdp[2][a]<<16|Y.paletteRdp[1][a]<<8|Y.paletteRdp[0][a]}function Uc(a){return 4278190080|a}function Vc(a){return 4278190080|
a}function Ab(a,e,d,f,g,c){var b=0;var h=0;var k=0;var v=0;var p=0;var l=0;var r=0;var n=0;var q=0;var A=0;var w=e;for(var m=c;h<f;){c=m+d*f*4-(h+1)*d*4;l=0;A=c;b=0;if(q==0)for(;b<d;){k=a[e++];p=k&15;v=k>>4&15;n=p<<4|v;if(n<=47&&n>=16){p=n;v=0}for(;v>0;){l=a[e++];g[c]=l;c+=4;b++;v--}for(;p>0;){g[c]=l;c+=4;b++;p--}}else for(;b<d;){k=a[e++];p=k&15;v=k>>4&15;n=p<<4|v;if(n<=47&&n>=16){p=n;v=0}for(;v>0;){r=a[e++];if((r&1)!=0){r=r>>1;r=r+1;l=-r}else{r=r>>1;l=r}r=g[q+b*4]+l;g[c]=r;c+=4;b++;v--}for(;p>0;){r=
g[q+b*4]+l;g[c]=r;c+=4;b++;p--}}h++;q=A}return e-w}function Wc(a,e,d,f,g,c){var b=0;var h=0;var k=0;var v=0;var p=0;var l=0;var r=0;var n=0;var q=e;for(var A=c;h<f;){c=A+d*f*4-(h+1)*d*4;n=c;b=0;if(r==0)for(;b<d;){k=a[e++];p=k&15;v=k>>4&15;l=p<<4|v;if(l<=47&&l>=16){p=l;v=0}for(;v>0;){e++;g[c]=255;c+=4;b++;v--}for(;p>0;){g[c]=255;c+=4;b++;p--}}else for(;b<d;){k=a[e++];p=k&15;v=k>>4&15;l=p<<4|v;if(l<=47&&l>=16){p=l;v=0}for(;v>0;){e++;g[c]=255;c+=4;b++;v--}for(;p>0;){g[c]=255;c+=4;b++;p--}}h++;r=n}return e-
q}function Bb(a,e,d){if(!e)e=a.length;if(!d)d=0;var f=Math.floor(e/4);var g=new Uint32Array(f);var c=0;for(var b=0;b<f;b++){c=(b<<2)+d;g[b]=(a[c+3]&255)<<24|a[c+2]&255|(a[c+1]&255)<<8|(a[c+0]&255)<<16}return g}function Cb(a,e,d,f,g,c){var b;var h;for(h=0;h<f;h++)for(b=0;b<d;b++)g[c+((f-h-1)*d+b)*4]=a[e+(h*d+b)]}function Xc(a,e,d,f,g){var c=f[g];var b=0;var h=g+1;var k=a*e;var v=new Uint32Array(k*4);var p=c&16;var l=c&32;if(K)K.begin("decodeInt32");if(l==0){b=Wc(f,h,a,e,v,3);h+=b}else{var r=0;for(var n=
0;n<k;n++){r=n<<2;v[r+3]=255}}if(p!=0){b=Ab(f,h,a,e,v,2);h+=b;b=Ab(f,h,a,e,v,1);h+=b;b=Ab(f,h,a,e,v,0)}else{b=Cb(f,h,a,e,v,2);h+=k;b=Cb(f,h,a,e,v,1);h+=k;b=Cb(f,h,a,e,v,0)}if(K)K.end("decodeInt32");return Bb(v)}function Yc(a,e,d,f,g){var c=-1;var b=-1;var h=g;var k=0;var v=h+d;var p=0;var l=0;var r=0;var n=a;var q=-1;var A=0;var w=0;var m=0;var I=0;var t=0;var B=0;var D=4294967295;var C=false;var J=false;var ka=false;for(var E=new Uint32Array(a*e);h<v;){A=0;w=f[h++];p=w>>4;switch(p){case 12:case 13:case 14:p-=
6;l=w&15;r=16;break;case 15:p=w&15;if(p<9){l=f[h++];l|=f[h++]<<8}else l=p<11?8:1;r=0;break;default:p>>=1;l=w&31;r=32}if(r!=0){ka=p==2||p==7;if(l==0)if(ka)l=f[h++]+1;else l=f[h++]+r;else if(ka)l<<=3}switch(p){case 0:if(q==p&&!(n==a&&c==-1))C=true;break;case 8:m=4278190080|f[h++]<<16|f[h++]<<8|f[h++];case 3:I=4278190080|f[h++]<<16|f[h++]<<8|f[h++];break;case 6:case 7:D=4278190080|f[h++]<<16|f[h++]<<8|f[h++];p-=5;break;case 9:B=3;p=2;A=3;break;case 10:B=5;p=2;A=5}q=p;for(t=0;l>0;){if(n>=a){n=0;e--;c=
b;b=k+e*a}switch(p){case 0:if(C){if(c==-1)E[b+n]=D;else E[b+n]=E[c+n]^D|4278190080;C=false;l--;n++}if(c==-1){for(;(l&~7)!=0&&n+8<a;)for(var u=0;u<8;u++){E[b+n]=4278190080;l--;n++}for(;l>0&&n<a;){E[b+n]=4278190080;l--;n++}}else{for(;(l&~7)!=0&&n+8<a;)for(u=0;u<8;u++){E[b+n]=E[c+n];l--;n++}for(;l>0&&n<a;){E[b+n]=E[c+n];l--;n++}}break;case 1:if(c==-1){for(;(l&~7)!=0&&n+8<a;)for(u=0;u<8;u++){E[b+n]=D;l--;n++}for(;l>0&&n<a;){E[b+n]=D;l--;n++}}else{for(;(l&~7)!=0&&n+8<a;)for(u=0;u<8;u++){E[b+n]=E[c+n]^
D|4278190080;l--;n++}for(;l>0&&n<a;){E[b+n]=E[c+n]^D|4278190080;l--;n++}}break;case 2:if(c==-1){for(;(l&~7)!=0&&n+8<a;)for(u=0;u<8;u++){t<<=1;t=t&255;if(t==0){B=A!=0?A&255:f[h++];t=1}if((B&t)!=0)E[b+n]=D;else E[b+n]=4278190080;l--;n++}for(;l>0&&n<a;){t<<=1;t=t&255;if(t==0){B=A!=0?A&255:f[h++];t=1}if((B&t)!=0)E[b+n]=D;else E[b+n]=4278190080;l--;n++}}else{for(;(l&~7)!=0&&n+8<a;)for(u=0;u<8;u++){t<<=1;t=t&255;if(t==0){B=A!=0?A&255:f[h++];t=1}if((B&t)!=0)E[b+n]=E[c+n]^D|4278190080;else E[b+n]=E[c+n];
l--;n++}for(;l>0&&n<a;){t<<=1;t=t&255;if(t==0){B=A!=0?A&255:f[h++];t=1}if((B&t)!=0)E[b+n]=E[c+n]^D|4278190080;else E[b+n]=E[c+n];l--;n++}}break;case 3:for(;(l&~7)!=0&&n+8<a;)for(u=0;u<8;u++){E[b+n]=I;l--;n++}for(;l>0&&n<a;){E[b+n]=I;l--;n++}break;case 4:for(;(l&~7)!=0&&n+8<a;)for(u=0;u<8;u++){E[b+n]=4278190080|f[h++]<<16|f[h++]<<8|f[h++];l--;n++}for(;l>0&&n<a;){E[b+n]=4278190080|f[h++]<<16|f[h++]<<8|f[h++];l--;n++}break;case 8:for(;(l&~7)!=0&&n+8<a;)for(u=0;u<8;u++){if(J){E[b+n]=I;J=false}else{E[b+
n]=m;J=true;l++}l--;n++}for(;l>0&&n<a;){if(J){E[b+n]=I;J=false}else{E[b+n]=m;J=true;l++}l--;n++}break;case 13:for(;(l&~7)!=0&&n+8<a;)for(u=0;u<8;u++){E[b+n]=4294967295;l--;n++}for(;l>0&&n<a;){E[b+n]=4294967295;l--;n++}break;case 14:for(;(l&~7)!=0&&n+8<a;)for(u=0;u<8;u++){E[b+n]=4278190080;l--;n++}for(;l>0&&n<a;){E[b+n]=4278190080;l--;n++}}}}return E}function Vb(a,e,d,f,g){var c=-1;var b=-1;var h=g;var k=0;var v=h+d;var p=0;var l=0;var r=0;var n=a;var q=-1;var A=0;var w=0;var m=0;var I=0;var t=0;var B=
0;var D=4294967295;var C=0;var J=false;var ka=false;var E=false;var u=new Uint32Array(a*e);if(K)K.begin("decodeInt16");for(;h<v;){A=0;w=f[h++];p=w>>4;switch(p){case 12:case 13:case 14:p-=6;l=w&15;r=16;break;case 15:p=w&15;if(p<9){l=f[h++];l|=f[h++]<<8}else l=p<11?8:1;r=0;break;default:p>>=1;l=w&31;r=32}if(r!=0){E=p==2||p==7;if(l==0)if(E)l=f[h++]+1;else l=f[h++]+r;else if(E)l<<=3}switch(p){case 0:if(q==p&&!(n==a&&c==-1))J=true;break;case 8:C=f[h++]|f[h++]<<8;m=4278190080|(C>>8&248|C>>13&7)|(C>>3&252|
C>>9&3)<<8|(C<<3&248|C>>2&7)<<16;case 3:C=f[h++]|f[h++]<<8;I=4278190080|(C>>8&248|C>>13&7)|(C>>3&252|C>>9&3)<<8|(C<<3&248|C>>2&7)<<16;break;case 6:case 7:C=f[h++]|f[h++]<<8;D=4278190080|(C>>8&248|C>>13&7)|(C>>3&252|C>>9&3)<<8|(C<<3&248|C>>2&7)<<16;p-=5;break;case 9:B=3;p=2;A=3;break;case 10:B=5;p=2;A=5}q=p;for(t=0;l>0;){if(n>=a){n=0;e--;c=b;b=k+e*a}switch(p){case 0:if(J){if(c==-1)u[b+n]=D;else u[b+n]=u[c+n]^D|4278190080;J=false;l--;n++}if(c==-1){for(;(l&~7)!=0&&n+8<a;)for(var H=0;H<8;H++){u[b+n]=
4278190080;l--;n++}for(;l>0&&n<a;){u[b+n]=4278190080;l--;n++}}else{for(;(l&~7)!=0&&n+8<a;)for(H=0;H<8;H++){u[b+n]=u[c+n];l--;n++}for(;l>0&&n<a;){u[b+n]=u[c+n];l--;n++}}break;case 1:if(c==-1){for(;(l&~7)!=0&&n+8<a;)for(H=0;H<8;H++){u[b+n]=D;l--;n++}for(;l>0&&n<a;){u[b+n]=D;l--;n++}}else{for(;(l&~7)!=0&&n+8<a;)for(H=0;H<8;H++){u[b+n]=u[c+n]^D|4278190080;l--;n++}for(;l>0&&n<a;){u[b+n]=u[c+n]^D|4278190080;l--;n++}}break;case 2:if(c==-1){for(;(l&~7)!=0&&n+8<a;)for(H=0;H<8;H++){t<<=1;t=t&255;if(t==0){B=
A!=0?A&255:f[h++];t=1}if((B&t)!=0)u[b+n]=D;else u[b+n]=4278190080;l--;n++}for(;l>0&&n<a;){t<<=1;t=t&255;if(t==0){B=A!=0?A&255:f[h++];t=1}if((B&t)!=0)u[b+n]=D;else u[b+n]=4278190080;l--;n++}}else{for(;(l&~7)!=0&&n+8<a;)for(H=0;H<8;H++){t<<=1;t=t&255;if(t==0){B=A!=0?A&255:f[h++];t=1}if((B&t)!=0)u[b+n]=u[c+n]^D|4278190080;else u[b+n]=u[c+n];l--;n++}for(;l>0&&n<a;){t<<=1;t=t&255;if(t==0){B=A!=0?A&255:f[h++];t=1}if((B&t)!=0)u[b+n]=u[c+n]^D|4278190080;else u[b+n]=u[c+n];l--;n++}}break;case 3:for(;(l&~7)!=
0&&n+8<a;)for(H=0;H<8;H++){u[b+n]=I;l--;n++}for(;l>0&&n<a;){u[b+n]=I;l--;n++}break;case 4:for(;(l&~7)!=0&&n+8<a;)for(H=0;H<8;H++){C=f[h++]|f[h++]<<8;u[b+n]=4278190080|(C>>8&248|C>>13&7)|(C>>3&252|C>>9&3)<<8|(C<<3&248|C>>2&7)<<16;l--;n++}for(;l>0&&n<a;){C=f[h++]|f[h++]<<8;u[b+n]=4278190080|(C>>8&248|C>>13&7)|(C>>3&252|C>>9&3)<<8|(C<<3&248|C>>2&7)<<16;l--;n++}break;case 8:for(;(l&~7)!=0&&n+8<a;)for(H=0;H<8;H++){if(ka){u[b+n]=I;ka=false}else{u[b+n]=m;ka=true;l++}l--;n++}for(;l>0&&n<a;){if(ka){u[b+n]=
I;ka=false}else{u[b+n]=m;ka=true;l++}l--;n++}break;case 13:for(;(l&~7)!=0&&n+8<a;)for(H=0;H<8;H++){u[b+n]=4294967295;l--;n++}for(;l>0&&n<a;){u[b+n]=4294967295;l--;n++}break;case 14:for(;(l&~7)!=0&&n+8<a;)for(H=0;H<8;H++){u[b+n]=4278190080;l--;n++}for(;l>0&&n<a;){u[b+n]=4278190080;l--;n++}break;default:l--;n++}}}if(K)K.end("decodeInt16");return u}function ib(a){switch(a){case 16:ta=Ub;ab=Vb;break;case 8:ta=Tc;break;case 24:ta=Vc;ab=Yc;break;case 32:ta=Uc;ab=Xc;break;case 15:if(!x.invitation)m.showMessage("15 bit color is not supported anymore.");
return false;default:return false}Ia=a;bb=(a+7)/8>>0;return true}function tb(a,e){P=a;Z=e;aa=0,X=0,U=P-1,W=Z-1;svGlobal.logger.warn("resolution changed, w:"+a+" h:"+e);if(m.onresolutionchange)m.onresolutionchange(a,e)}function M(a){Q.send(a)}function Zc(a){var e=a.substring(0,2);var d=a.substring(2);if(Ja&&(e=="80"||e=="81"||e=="82"||e=="83")){var f=d.split("\t");var g=new Uint8Array(7);var c=0;var b=0;var h=0;b=parseInt(f[0]);h=parseInt(f[1]);var k=parseInt(e,16);switch(k){case 128:c=("0"==f[2]?
4096:8192)|32768;break;case 129:c="0"==f[2]?4096:8192;break;case 130:c=2048;break;case 131:c="0"==f[2]?640|32768:896|32768}g[0]=1<<5;g[1]=c&255;g[2]=c>>8;g[3]=b&255;g[4]=b>>8;g[5]=h&255;g[6]=h>>8;Ja.add(new RecordingObj(g,0,7,60))}else;}function $c(a,e){if(e==1)return a;else if(e<1){console.error("rate must be smaller than the original rate");return}var d=Math.round(a.length/e);var f=new Float32Array(d);var g=0;for(var c=0;g<f.length;){var b=Math.round((g+1)*e);var h=0;var k=0;for(var v=c;v<b&&v<
a.length;v++){h+=a[v];k++}f[g]=h/k;g++;c=b}return f}function Ua(a,e,d,f,g,c){this.data=a;this.left=f;this.top=g;this.width=e;this.height=d;this.bitsperpixel=c;this.bytesperpixel=Math.floor((c+7)/8)}function Wb(){var a=new Array;this.putFont=function(e,d,f){if(!a[e])a[e]=new Array;a[e][d]=f};this.getFont=function(e,d){return a[e]?a[e][d]:null};this.toPDU=function(){var e;var d;var f=0;var g=4;var c=0;var b;var h;var k=4;for(f=0,len=a.length;f<len;f++){h=a[f];if(h&&h.length){size=h.length;for(c=0;c<
size;c++){b=h[c];if(b)k+=15+b.fontData.length}}}if(k<5)return null;e=new Uint8Array(k);d=new RdpBuffer(e,0,k);e[0]=29;e[2]=1;e[3]=5;d.skipPosition(4);for(f=0,len=a.length;f<len;f++){h=a[f];if(h&&h.length){size=h.length;for(c=0;c<size;c++){b=h[c];if(b){d.setByte(f);d.setLittleEndian16(c);d.setLittleEndian16(b.offset);d.setLittleEndian16(b.baseLine);d.setLittleEndian16(b.width);d.setLittleEndian16(b.height);d.setLittleEndian32(b.fontData.length);d.setBytes(b.fontData)}}}}return e};this.fromStream=function(a){for(;a.has(15);){var d=
a.getByte();var f=a.getLittleEndian16();var g=a.getLittleEndian16();var c=a.getLittleEndian16();var b=a.getLittleEndian16();var h=a.getLittleEndian16();var k=a.getLittleEndian32();var v=a.getBytes(k);this.putFont(d,f,new Xb(g,c,b,h,v))}}}function Yb(){var a=new Array;var e=new Array;this.putBitmap=function(d,f,g){if(f==32767){if(e[d]){e[d].data=null;e[d]=null}e[d]=g;return}var c=a[d];if(c){if(c[f]){c[f].data=null;c[f]=null}}else a[d]=c=new Array;c[f]=g};this.getBitmap=function(d,f){if(f==32767)return e[d];
return a[d]?a[d][f]:null};this.forEach=function(e){var f=a.length;for(var g=0;g<f;g++)e(a[g],g,a)}}function Zb(a){var e=__svi18n.errorCode[a];if(!e)e="error "+a;if(m.onerror)m.onerror({name:a,message:e});if(m.displayMsg)hi5.notifications.notify({"msg":e});if(svGlobal.log>0&&console.error)console.error(e)}function ad(a){var e=__svi18n.info[a];if(!e)return;if(m.displayMsg)hi5.notifications.notify({"msg":e});svGlobal.logger.info(e)}function bd(){this.xOrigin=0;this.yOrigin=0;this.style=0;this.pattern=
new Array(8);this.toStream=function(a){a.setByte(this.xOrigin);a.setByte(this.yOrigin);a.setByte(this.style);a.setBytes(this.pattern)};this.fromStream=function(a){this.xOrigin=a.getByte();this.yOrigin=a.getByte();this.style=a.getByte();this.pattern=a.getBytes(8)};this.byteLength=function(){return 11}}function cd(){this.left=0;this.right=0;this.top=0;this.bottom=0;this.toStream=function(a){a.setLittleEndian16(this.left);a.setLittleEndian16(this.right);a.setLittleEndian16(this.top);a.setLittleEndian16(this.bottom)};
this.fromStream=function(a){this.left=a.getLittleEndian16();this.right=a.getLittleEndian16();this.top=a.getLittleEndian16();this.bottom=a.getLittleEndian16()};this.byteLength=function(){return 8}}function dd(){this.left=0;this.right=0;this.top=0;this.bottom=0;this.offset=0;this.action=0;this.toStream=function(a){a.setLittleEndian16(this.left);a.setLittleEndian16(this.right);a.setLittleEndian16(this.top);a.setLittleEndian16(this.bottom);a.setLittleEndian32(this.offset);a.setByte(this.action)};this.fromStream=
function(a){this.left=a.getLittleEndian16();this.right=a.getLittleEndian16();this.top=a.getLittleEndian16();this.bottom=a.getLittleEndian16();this.offset=a.getLittleEndian32();this.action=a.getByte()};this.byteLength=function(){return 13}}function ed(){this.x=0;this.y=0;this.cx=0;this.cy=0;this.opcode=0;this.toStream=function(a){a.setLittleEndian16(this.x);a.setLittleEndian16(this.y);a.setLittleEndian16(this.cx);a.setLittleEndian16(this.cy);a.setByte(this.opcode)};this.fromStream=function(a){this.x=
a.getLittleEndian16();this.y=a.getLittleEndian16();this.cx=a.getLittleEndian16();this.cy=a.getLittleEndian16();this.opcode=a.getByte()};this.byteLength=function(){return 9}}function Xb(a,e,d,f,g){this.offset=a;this.baseLine=e;this.width=d;this.height=f;this.fontData=g}function fd(){this.mixmode=0;this.startX=0;this.startY=0;this.endX=0;this.endY=0;this.backgroundColor=0;this.opcode=0;this.pen=new gd;this.toStream=function(a){a.setLittleEndian16(this.mixmode);a.setLittleEndian16(this.startX);a.setLittleEndian16(this.startY);
a.setLittleEndian16(this.endX);a.setLittleEndian16(this.endY);a.setLittleEndian32(this.backgroundColor);a.setByte(this.opcode);this.pen.toStream(a)};this.fromStream=function(a){this.mixmode=a.getLittleEndian16();this.startX=a.getLittleEndian16();this.startY=a.getLittleEndian16();this.endX=a.getLittleEndian16();this.endY=a.getLittleEndian16();this.backgroundColor=a.getLittleEndian32();this.opcode=a.getByte();this.pen.fromStream(a)};this.byteLength=function(){return 15+this.pen.byteLength()}}function hd(){this.x=
0;this.y=0;this.cx=0;this.cy=0;this.opcode=0;this.srcX=0;this.srcY=0;this.colorTable=0;this.cacheID=0;this.cacheIDX=0;this.toStream=function(a){a.setLittleEndian16(this.x);a.setLittleEndian16(this.y);a.setLittleEndian16(this.cx);a.setLittleEndian16(this.cy);a.setByte(this.opcode);a.setLittleEndian16(this.srcX);a.setLittleEndian16(this.srcY);a.setByte(this.cacheID);a.setByte(this.colorTable);a.setLittleEndian16(this.cacheIDX)};this.fromStream=function(a){this.x=a.getLittleEndian16();this.y=a.getLittleEndian16();
this.cx=a.getLittleEndian16();this.cy=a.getLittleEndian16();this.opcode=a.getByte();this.srcX=a.getLittleEndian16();this.srcY=a.getLittleEndian16();this.cacheID=a.getByte();this.colorTable=a.getByte();this.cacheIDX=a.getLittleEndian16()};this.byteLength=function(){return 17}}function zf(a,e,d,f,g){this.bits=a;this.size=e;this.red=d;this.green=f;this.blue=g}function id(){this.x=0;this.y=0;this.cx=0;this.cy=0;this.opcode=0;this.backgroundColor=0;this.foregroundColor=0;this.brush=new bd;this.toStream=
function(a){a.setLittleEndian16(this.x);a.setLittleEndian16(this.y);a.setLittleEndian16(this.cx);a.setLittleEndian16(this.cy);a.setByte(this.opcode);a.setLittleEndian32(this.backgroundColor);a.setLittleEndian32(this.foregroundColor);this.brush.toStream(a)};this.fromStream=function(a){this.x=a.getLittleEndian16();this.y=a.getLittleEndian16();this.cx=a.getLittleEndian16();this.cy=a.getLittleEndian16();this.opcode=a.getByte();this.backgroundColor=a.getLittleEndian32();this.foregroundColor=a.getLittleEndian32();
this.brush.fromStream(a)};this.byteLength=function(){return 17+this.brush.byteLength()}}function gd(){this.style=0;this.width=0;this.color=0;this.toStream=function(a){a.setByte(this.style);a.setByte(this.width);a.setLittleEndian32(this.color)};this.fromStream=function(a){this.style=a.getByte();this.width=a.getByte();this.color=a.getLittleEndian32()};this.byteLength=function(){return 6}}function jd(){this.x=0;this.y=0;this.flags=0;this.foregroundColor=0;this.lines=0;this.opcode=0;this.dataSize=0;this.data=
[];this.toStream=function(a){a.setLittleEndian16(this.x);a.setLittleEndian16(this.y);a.setByte(this.opcode);a.setLittleEndian32(this.foregroundColor);a.setByte(this.lines);a.setByte(this.dataSize);if(this.dataSize)a.setBytes(this.data)};this.fromStream=function(a){this.x=a.getLittleEndian16();this.y=a.getLittleEndian16();this.opcode=a.getByte();this.foregroundColor=a.getLittleEndian32();this.lines=a.getByte();this.dataSize=a.getByte();if(this.dataSize)this.data=a.getBytes(this.dataSize)};this.byteLength=
function(){return 11+this.dataSize}}function kd(){this.x=0;this.y=0;this.cx=0;this.cy=0;this.color=0;this.toStream=function(a){a.setLittleEndian16(this.x);a.setLittleEndian16(this.y);a.setLittleEndian16(this.cx);a.setLittleEndian16(this.cy);a.setLittleEndian32(this.color)};this.fromStream=function(a){this.x=a.getLittleEndian16();this.y=a.getLittleEndian16();this.cx=a.getLittleEndian16();this.cy=a.getLittleEndian16();this.color=a.getLittleEndian32()};this.byteLength=function(){return 12}}function ld(){this.x=
0;this.y=0;this.cx=0;this.cy=0;this.opcode=0;this.srcX=0;this.srcY=0;this.toStream=function(a){a.setLittleEndian16(this.x);a.setLittleEndian16(this.y);a.setLittleEndian16(this.cx);a.setLittleEndian16(this.cy);a.setByte(this.opcode);a.setLittleEndian16(this.srcX);a.setLittleEndian16(this.srcY)};this.fromStream=function(a){this.x=a.getLittleEndian16();this.y=a.getLittleEndian16();this.cx=a.getLittleEndian16();this.cy=a.getLittleEndian16();this.opcode=a.getByte();this.srcX=a.getLittleEndian16();this.srcY=
a.getLittleEndian16()};this.byteLength=function(){return 13}}function md(){this.flags=0;this.mixmode=0;this.foregroundColor=0;this.backgroundColor=0;this.x=0;this.y=0;this.unknown=0;this.font=0;this.clipLeft=0;this.clipTop=0;this.clipRight=0;this.clipBottom=0;this.boxLeft=0;this.boxTop=0;this.boxRight=0;this.boxBottom=0;this.opcode=0;this.length=0;this.text=null;this.toStream=function(a){a.setByte(this.font);a.setByte(this.flags);a.setByte(this.opcode);a.setByte(this.mixmode);a.setLittleEndian32(this.foregroundColor);
a.setLittleEndian32(this.backgroundColor);a.setLittleEndian16(this.clipLeft);a.setLittleEndian16(this.clipTop);a.setLittleEndian16(this.clipRight);a.setLittleEndian16(this.clipBottom);a.setLittleEndian16(this.boxLeft);a.setLittleEndian16(this.boxTop);a.setLittleEndian16(this.boxRight);a.setLittleEndian16(this.boxBottom);a.setLittleEndian16(this.x);a.setLittleEndian16(this.y);a.setByte(this.length);if(this.length)a.setBytes(this.text)};this.fromStream=function(a){this.font=a.getByte();this.flags=a.getByte();
this.opcode=a.getByte();this.mixmode=a.getByte();this.foregroundColor=a.getLittleEndian32();this.backgroundColor=a.getLittleEndian32();this.clipLeft=a.getLittleEndian16();this.clipTop=a.getLittleEndian16();this.clipRight=a.getLittleEndian16();this.clipBottom=a.getLittleEndian16();this.boxLeft=a.getLittleEndian16();this.boxTop=a.getLittleEndian16();this.boxRight=a.getLittleEndian16();this.boxBottom=a.getLittleEndian16();this.x=a.getLittleEndian16();this.y=a.getLittleEndian16();this.length=a.getByte();
if(this.length)this.text=a.getBytes(this.length)};this.byteLength=function(){return 33+this.length}}function Db(){this.orderType=0;this.bounds=new cd;this.destBlt=new ed;this.patBlt=new id;this.screenBlt=new ld;this.line=new fd;this.rectangle=new kd;this.deskSave=new dd;this.memBlt=new hd;this.polyLine=new jd;this.text2=new md;this._line=new hi5.graphic.Line;this.paletteRdp=null;this.toPDU=function(){var a=4+this.bounds.byteLength()+this.destBlt.byteLength()+this.patBlt.byteLength()+this.screenBlt.byteLength()+
this.line.byteLength()+this.rectangle.byteLength()+this.deskSave.byteLength()+this.memBlt.byteLength()+this.polyLine.byteLength()+this.text2.byteLength()+14+10;var e=new Uint8Array(a);e[0]=29;e[2]=1;e[3]=3;var d=new RdpBuffer(e,0,a);d.skipPosition(4);this.bounds.toStream(d);this.destBlt.toStream(d);this.patBlt.toStream(d);this.screenBlt.toStream(d);this.line.toStream(d);this.rectangle.toStream(d);this.deskSave.toStream(d);this.memBlt.toStream(d);this.polyLine.toStream(d);this.text2.toStream(d);d.setLittleEndian16(aa);
d.setLittleEndian16(X);d.setLittleEndian16(U);d.setLittleEndian16(W);d.setLittleEndian32(Fa);d.setByte(this.orderType);d.setByte(Ia);ba.toStream(d);return e};this.fromStream=function(a){this.bounds.fromStream(a);this.destBlt.fromStream(a);this.patBlt.fromStream(a);this.screenBlt.fromStream(a);this.line.fromStream(a);this.rectangle.fromStream(a);this.deskSave.fromStream(a);this.memBlt.fromStream(a);this.polyLine.fromStream(a);this.text2.fromStream(a);aa=a.getLittleEndian16();X=a.getLittleEndian16();
U=a.getLittleEndian16();W=a.getLittleEndian16();Fa=a.getLittleEndian32();this.orderType=a.getByte();ib(a.getByte());ba.fromStream(a)}}function nd(){function a(a,e,g,c,b,h){this.x=a;this.y=e;this.cx=g;this.cy=c;this.offset=b;this.data=h}var e=[];this.save=function(d,f,g,c,b,h){var k=new a(d,f,g,c,b,h);var v=0;for(var p=e.length;v<p;v++)if(!e[v]){e[v]=k;return}e.push(k)};this.restore=function(a,f,g,c,b){var h;var k=0;for(var v=e.length;k<v;k++){h=e[k];if(h&&h.x==a&&h.y==f&&h.cx==g&&h.cy==c)if(h.offset==
b){var p=h.data;e[k]=null;return p}else svGlobal.logger.warn("TODO: offset")}return null};this.toPDU=function(){var a=0;var f=2;var g=0;var c=e.length;for(var b;g<c;g++)if(e[g]){a++;f+=e[g].data.length+6}if(!a||!f)return null;var h=new Uint32Array(f);var k=2;h[0]=151060509;h[1]=a;for(g=0;g<c;g++){b=e[g];if(b){h[k++]=b.x;h[k++]=b.y;h[k++]=b.cx;h[k++]=b.cy;h[k++]=b.offset;h[k++]=b.data.length;h.set(b.data,k);k+=b.data.length}}return h};this.fromStream=function(a){var e=new Uint32Array(a.getData().buffer,
a.getPosition());var g=1;var c=e[0];var b=0;var h=0;var k=0;var v=0;var p=0;var l=0;var r;for(var n=0;n<c;n++){b=e[g++];h=e[g++];k=e[g++];v=e[g++];p=e[g++];l=e[g++];r=new Uint32Array(l);l=g+l;r.set(e.subarray(g,l));g=l;this.save(b,h,k,v,p,r)}}}function $b(){fa=false;Oa=false;ac();Y=new Db;Fa=0;sa=new Array;Ga=new Yb;Va=new Wb;if(ua)ua.reset()}function od(){var a=F.getFocused();var e=a?a.getWindow():window;return"&waWidth="+x.waWidth+"&waHeight="+x.waHeight+"&dpWidth="+e.innerWidth+"&dpHeight="+e.innerHeight}
function pd(a,e){function d(a){e(false,a.target.responseText)}function f(a){e(true)}var g=e?true:false;var c=new XMLHttpRequest;if(g){c.addEventListener("load",d);c.addEventListener("error",f);c.addEventListener("abort",f)}c.open("GET",a,g);c.setRequestHeader("Content-Type","text/plain;charset=UTF-8");c.send(null);return g?"":c.responseText}function qd(a){if(!jb)return"";return pd(m.modifyURL(za()+"/CLIP?s="+jb+"&t="+Date.now()),a)}function rd(){function a(a){if(!e(a))return false;var d=a["ownerWinid"]<
1&&!b.mainWin;if(!d)return d;var f=a["style"];if((f&4194304)!=0)return true;if((f&2147483648)!=0&&((f&8388608)==0||(f&12582912)==0))return false;var g=(a.extStyle&128)!=0;d=d&&!g;if(d&&((f&2147483648)!=0&&(f&2156396544)==0))d=false;return d}function e(a){return a.winWidth&&a.winHeight&&a.showState&&a.winHeight>45&&a.winWidth>45}function d(a){for(;a.ownerWinid>0;){var e=b.getWinById(a.ownerWinid);if(e&&e.isVisible())a=e;else break}return a}function f(a){var e="";for(var d=a;d;){if(d.titleInfo)e=d.titleInfo;
d=b.getWinById(d.ownerWinid)}return e}var g=[];var c=0;var b=this;this.mainWin=null;this.appId="";this.onchange=function(e){if(!e.isVisible()&&e==b.mainWin)b.mainWin=null;else if(e.isVisible()&&!b.mainWin)if(a(e)){b.mainWin=e;if(m.windowState)e.exeCommand(61488)}};this.addWin=function(e){var d=g.length;var f=false;for(var p=0;p<d;p++)if(e.id==g[p].id){g[p]=e;f=true;break}if(!f)g.push(e);if(g.length==1)c=Date.now();if(m.windowState>0){var l=a(e);svGlobal.logger.info("is main win:"+l+" id:"+e.id);if(l&&
!b.mainWin){b.mainWin=e;if(m.windowState)b.getOtherApps(F.zOrders,function(a){if(a.length>0&&m.onexistingapp)m.onexistingapp(a)},5E3)}}};this.isMain=a;this.popWins=function(a){var e=b.getWinById(a);var d=[];if(e){a=e.ownerWinid>0?e.ownerWinid:e.id;var f=g.length;for(var c=f-1;c>=0;c--)if(g[c].ownerWinid==a||g[c].id==a){d.push(g[c]);g.splice(c,1)}}return d};this.hasApp=function(a){if(b.appId==a)return true;var e=0;for(var d=g.length;e<d;e++)if(g[e].appId==a)return true;return false};this.isNew=function(){return Date.now()-
c<3E4};this.getAll=function(){return g};this.hasWin=function(a){return g.indexOf(a)>=0};this.close=function(){var a=0;for(var b=g.length;a<b;a++)g[a].close()};this.clear=function(){g.length=0};this.delWin=function(a){var b=0;for(var e=g.length;b<e;b++)if(g[b].id==a){g.splice(b,1);return b}return-1};this.isRunning=function(){var a;var b=g.length;if(b<1)return false;var e=0;for(b=g.length;e<b;e++){a=g[e];if(a.isVisible())return true}return false};this.getWinById=function(a){var b;var e=g.length;if(e<
1)return null;for(var d=0;d<e;d++){b=g[d];if(b.id==a)return b}return null};this.getTopWin=function(a){var e=null;var d;var f=a.length;for(d=0;d<f;d++){e=b.getWinById(a[d]);if(e&&e.isVisible())break;else e=null}if(!e){svGlobal.logger.warn("No win found");f=g.length;for(d=f-1;d>=0;d--){e=g[d];if(e.isVisible())break;else e=null}}return e};this.getMain=function(a){var e=b.getTopWin(a);if(e)return d(e);return null};this.getOtherApps=function(a,e,c){var p=g.length;if(p==0||!g[p-1])return;var l=g[p-1].appId;
if(c||!l){setTimeout(function(){b.getOtherApps(a,e)},c||3E3);return}var r=[];var n=b.getTopWin(a);if(n){var q=n.ownerWinid>0?n.ownerWinid:n.id;var A=[];var m=0;for(p=g.length;m<p;m++){if(g[m].ownerWinid==q||g[m].id==q||!g[m].isVisible())continue;A.push(g[m])}for(m=0,p=A.length;m<p;m++){if(A[m].ownerWinid==q||A[m].id==q)continue;r.push({title:f(A[m]),win:d(A[m])});q=A[m].ownerWinid>0?A[m].ownerWinid:A[m].id}}e(r)}}function bc(a,e){Oa=false;svGlobal.logger.info("reconnecting...");M("8E0"+a+"\t"+e)}
function sd(a){var e={};var d=0;var f=a;this.enabled=false;hi5.EventControl(this);var g=this;var c=null;this.release=function(){g=null;a=null;f=null;e=null};this.read=function(b,f,c){function v(e){if(e.target.readyState==FileReader.DONE){var n=new Uint8Array(e.target.result);a.send(b,f,c,n,p.preferPaste);d+=c;g.fireEvent("progress",[d])}}var p=e[e[b]];if(typeof p=="undefined")return;var l=p.size;var r=p.name;if(l<1){m.showMessage(__svi18n.file.zero+r,null,3E3);return}var n=p.slice(f,f+c);var q=new FileReader;
q.onloadend=v;q.readAsArrayBuffer(n)};this.mkdirs=function(b){if(!g.enabled)return;if(b.charAt(b.length-1)!="/")b+="/";b=encodeURIComponent(b);a.start(b,0)};this.addFiles=function(b,d){var f=b.length;if(!f||!g.enabled)return;var c=d&&!!(va&65536);for(var p=0;p<f;p++){var l=b[p];if(d)l.preferPaste=true;var r=l.fullPath||l.name;if(m.beforeupload)if(m.beforeupload(l,r,c))return;g.fireEvent("beforeupload",[l,r,c]);r=encodeURIComponent(r);e[r]=l}a.start(b,d);g.fireEvent("uploadstarted",[c])};this.removeFile=
function(a){f.remove(a)};this.confirmId=function(a,f,g){e[a]=f;if(g)d+=parseInt(g)};this.close=function(a){var f=true;if(a){var c=e[a];if(c){f=e[c].preferPaste;delete e[a];delete e[c];var v=decodeURIComponent(c);if(m.onfileuploaded)m.onfileuploaded(v,f);g.fireEvent("fileuploaded",[v,f&&!!(va&65536)])}for(var p in e)return}else e={};d=0;g.fireEvent("uploaded",[f&&!!(va&65536)]);if(m.onuploaded)m.onuploaded(f&&!!(va&65536))};this.cancelAll=function(){f.cancelAll();if(m.onuploadingCancelled)m.onuploadingCancelled();
g.fireEvent("uploadingCancelled");g.close()};this.list=function(a,e){c=e;f.list(a)};this.notifyFiles=function(a){if(c)c(a);g.fireEvent("files")};this.download=function(){f.download()}}function td(){function a(a,d){var f=d.length;var g=new Uint8Array(2+f*2);g[0]=58;g[1]=a;var c=0;var b=2;for(var h=0;h<f;h++){c=d.charCodeAt(h);g[b++]=c&255;g[b++]=c>>8&255}M(g.buffer)}this.start=function(a,d){var f=a.length;var g=f*20+2;var c=0;var b=new Uint8Array(8);var h=2;var k="";var v=0;var p=0;var l=0;for(var r=
0;c<f;c++)g+=(encodeURIComponent(a[c].fullPath||a[c].name).length+1)*2;var n=new Uint8Array(g);n[0]=58;n[1]=0;if(d)n[1]|=128;for(c=0;c<f;c++){r=a[c].size;n[h++]=r&255;n[h++]=r>>8&255;n[h++]=r>>16&255;n[h++]=r>>24&255;h+=4;hi5.NumUtils.toBytes(a[c].lastModifiedDate.getTime(),b);n.set(b,h);h+=12;k=encodeURIComponent(a[c].fullPath||a[c].name);v=k.length;for(p=0;p<v;p++){l=k.charCodeAt(p);n[h++]=l&255;n[h++]=l>>8&255}h+=2}M(n.buffer)};this.send=function(a,d,f,g,c){var b=new Uint8Array(22+f);b[0]=58;b[1]=
3;if(c)b[1]|=128;var h=2;b[h++]=a&255;b[h++]=a>>8&255;b[h++]=a>>16&255;b[h++]=a>>24&255;b[h++]=d&255;b[h++]=d>>8&255;b[h++]=d>>16&255;b[h++]=d>>24&255;h+=4;b[h++]=f&255;b[h++]=f>>8&255;b[h++]=f>>16&255;b[h++]=f>>24&255;h+=4;b.set(g,h);M(b.buffer)};this.remove=function(e){a(6,e)};this.list=function(e){a(5,e)};this.cancelAll=function(){a(7,"")};this.download=function(){a(8|128,"")}}function cc(a){if(!ra)ra=new sd(new td);a.setFileHandler(ra)}function dc(a,e,d){var f=false;this.exe=a;this.args=e||"";
this._dir=d||"";var g=this;this.close=function(){if(!f&&fa){f=true;M("8C5"+g.exe+"\t"+g.args+"\t"+m.sessionInfo.appInfo.session)}}}function Eb(a){var e=this;if(!a)a=143;this.send=function(d){var f=!!d.buffer;var g=f?d:d.getData();var c=a==64;var b=f?g.length:d.getEnd()||g.length;if(b<g.length)if(f)g=g.subarray(0,b);else g=g.slice(0,b);var h=c?5:9;var k=h+b;var v=new Uint8Array(k);v[0]=a;if(c){v[1]=e.id;v[2]=e.id>>8;v[3]=e.id>>16;v[4]=e.id>>24}else{var p=e.name;var l=Math.min(p.length,8);for(var r=
0;r<l;r++)v[1+r]=p.charCodeAt(r)}v.set(g,h);M(v.buffer)};this.name="";this.flags=0;this.id=0;this.count=0}function ud(){var a=window.opener;if(a)try{if(a.__sparkUser&&a.__sparkUser.session)return a.__sparkUser;else if(a.opener&&a.opener.__sparkUser.session)return a.opener.__sparkUser}catch(e){}return null}function ec(){var a="";if(x&&qa(x.connectif)&&x.symlink&&"sessionStorage"in window){a="SV_"+x.symlink;if(x.domain)a+=x.domain;if(x.user)a+=x.user}return a}function vd(){var a=ec();var e="";if(a){e=
sessionStorage[a]||"";if(e)e="&preSymJoin="+e}return e}function wd(a,e){var d=0;var f=F.length;var g=new Array(f);var c=new Array(f);var b=0;var h=0;var k=0;var v=0;var p=0;var l=0;var r="";var n;if(a){c=z.parseMonitorDef(a);for(f=c.length;d<f;d++){n=c[d];if(n[0]<k)k=n[0];if(n[1]<v)v=n[1];if(n[2]>p)p=n[2];if(n[3]>l)l=n[3]}if(k<0)b=-k;if(v<0)h=-v;if(e<0)n=[k,v,p,l];else n=c[e];var q=F[0];q.setMonitor(n[0],n[1],n[2],n[3]);if(b||h){n=q.getMousePosition();n.left+=b;n.right+=b;n.top+=h;n.bottom+=h;for(d=
0;d<f;d++){n=c[d];n[0]+=b;n[1]+=h;n[2]+=b;n[3]+=h}}z.setMonitorLayout(c);if(e<0)z.setMonitorCount(0);m.reconnectOnResize=false;return"&monitorDef="+a}if(f>1&&!T){for(var A;d<f;d++){A=F[d];n=A.getMousePosition();if(n.left<k)k=n.left;if(n.top<v)v=n.top;g[d]=n;if(r)r+=",";r+=n.left+":"+n.top+":"+n.right+":"+n.bottom}if(k<0)b=-k;if(v<0)h=-v;for(d=0;d<f;d++){n=F[d].getMousePosition();if(b||h){n.left+=b;n.right+=b;n.top+=h;n.bottom+=h}c[d]=[n.left,n.top,n.right,n.bottom,n.left==b&&n.top==h?1:0]}z.setMonitorLayout(c);
m.reconnectOnResize=false}if(r){svGlobal.logger.warn("MonitorDef:"+r);r="&monitorDef="+r}return r}function fc(){function a(a){Ja=new RecordingManager;var b=a.user.length>0?a.server+"_"+a.user:a.server;var e={name:b,width:P,height:Z,color:Ia,namesuffix:".rdpv",filetag:"RDPV",duration:0};Ja.setHeader(e)}if(fa)return;Oa=false;if(cb){Q=cb;ia.init(false,true,false,0)}else{var e=y+"&width="+P+"&height="+Z+"&server_bpp="+Ia+"&audio="+na.available+vd()+wd(x.monitorDef,x.monitor);if(y.indexOf("waWidth")<0)e+=
od();var d=new Date;e+="&tzOffset="+d.getTimezoneOffset()+"&time="+d.getTime();var f="";var g="";var c="";for(c in Pa){var b=Pa[c];if("flags"in b){if(f){f+=",";g+=","}f+=b.name;g+=b.flags}}if(f){e+="&channelName="+f;e+="&channelFlags="+g}f="";for(c in Qa){b=Qa[c];if("flags"in b){if(f)f+=",";f+=b.name}}if(f)e+="&gwChannelName="+f;var h=ud();if(h){var k=h.account;var v=h.session;if(k)e+="&account="+k;if(v)e+="&session="+v}var p=hi5.browser.isTouch&&(window.innerWidth>=1024||window.innerHeight>=768);
x.audioRecord=qa(x.audioRecord)&&hi5.audio.recordable;ia.init(p,!!x.remotefx,x.audioRecord,x.soundPref);if(x.audioRecord)e+="&audioRecord=on";if(ia.count>0)e+="&dvcChannels="+ia.names.join(",");if(hi5.browser.binaryWS())e+="&binary=on";if(L.existingFile)e+="&existingFile="+L.existingFile;e+="&isTouch="+p+"&gatewayAddr="+encodeURIComponent(za());e=m.modifyURL(e);y=e;e=m.mode==0&&L.wsPost?y.substring(0,y.indexOf("?"))+"?_METHOD=post":y;if(m.oncreatewebsocket)Q=m.oncreatewebsocket(e);else Q=new WebSocket(e,
"rdp");if("binaryType"in Q)Q.binaryType="arraybuffer"}svGlobal.logger.info(y);Q.onopen=function(a){fa=true;if(m.onopen)m.onopen();M("87"+navigator.userAgent);if(L.joinCloseMode)m.setJoinCloseMode(L.joinCloseMode)};if(x["recording"]!=undefined&&x["recording"]=="on")a(x);Q.onmessage=xd;Q.onclose=Ra;Q.onerror=yd;var l=F[F.length-1];if(l)if(T){if(l)l.remoteApp=new dc(x["exe"],x["args"],"")}else zb(Za(),l.getWindow());if(x.invitation){var r=null;if(l)r=l.initChat(x.expert);kb=new m.GatewayChannel;kb.name=
"C_H_A_T";kb.process=function(a){var b=a.getUnicodeString(a.getEnd()-a.getPosition(),true);if(r)r.add(b,x.novice)};if(r)r.onchat=function(a){if(fa){var b=new Array(a.length*2);var e=new hi5.DataBuffer(b,0,b.length);e.setUnicodeString(a);e.markEnd();kb.send(e)}};m.addGatewayChannel(kb)}}function yd(a){svGlobal.logger.warn(a)}function lb(a){var e=zd(a);la.attach(e,0,e.length);return la}function xd(a){var e;var d=a.data;if(typeof d!="string"){var f=new Uint8Array(d);if(Ja!=null)Ja.add(new RecordingObj(f,
0,d.byteLength,-1));la.attach(f,0,d.byteLength);e=la.getLittleEndian16();switch(e){case 28:gc(la);break;case 29:Ad(la);break;case 48:hc(la);if(pa)pa.check();break;case 49:ic(la);if(pa)pa.check();break;case 55:Bd(la);if(pa)pa.check();break;case 60:jc(la);break;case 62:kc(la.getUnicodeString(la.getEnd()-la.getPosition(),false));break;case 63:lc(la);if(pa)pa.check();break;case 64:Cd(la);if(pa)pa.check();break;case 65:Dd(la);break;case 146:Ed(la);break;default:if(m.onunknownmessage)m.onunknownmessage(e,
la);else svGlobal.logger.warn("@TODO:"+e+"\n")}}else{e=parseInt(d.substring(0,2),16);var g=d.substring(2);switch(e){case 0:Fd();break;case 15:Gd(g);break;case 26:Hd(g);break;case 27:Id(g);break;case 28:gc(lb(g));break;case 48:hc(lb(g));break;case 49:ic(lb(g));break;case 50:Jd(g);break;case 51:Kd(g);break;case 54:Ld(g);break;case 55:Md(g);break;case 56:Nd(g);break;case 57:Od(g);break;case 58:Pd(g);break;case 59:Qd(g);break;case 60:jc(lb(g));break;case 61:Rd(g);break;case 62:kc(g);break;case 63:lc(lb(g));
break;default:if(m.onunknownmessage)m.onunknownmessage(e,g);else svGlobal.logger.warn("@TODO:"+d+"\n")}}}function Dd(a){var e=a.getPosition();var d=a.getByte();var f=a.getByte();seqNoLow=a.getByte();seqNoHigh=a.getByte();reqType=a.getLittleEndian16,out=null,payloadLen=0,payload=null,baseRTT=0,bandwidth=0,averageRTT=0;if(f!=0){svGlobal.logger.warn("invalid msg channel data");return}switch(reqType){case 1:case 4097:out=new Uint8Array(7);out[0]=65;out.set(a.getData().subarray(e,e+4),1);out[5]=0;out[6]=
0;M(out.buffer);break;case 20:case 276:case 4116:break;case 2:if(d==8){payloadLen=a.getLittleEndian16();payload=a.getByte(payloadLen)}else svGlobal.logger.warn("Invalid payload");break;case 43:if(d==8){payloadLen=a.getLittleEndian16();payload=a.getByte(payloadLen)}else svGlobal.logger.warn("Invalid payload");break;case 1065:case 1577:break;case 2112:baseRTT=a.getLittleEndian32();averageRTT=a.getLittleEndian32();break;case 2176:bandwidth=a.getLittleEndian32();averageRTT=a.getLittleEndian32();break;
case 2240:baseRTT=a.getLittleEndian32();bandwidth=a.getLittleEndian32();averageRTT=a.getLittleEndian32();break;default:svGlobal.logger.warn("Invalid msg channel type:"+reqType)}}function Af(a,e){var d=a.length+8;var f=new Uint8Array(d);var g=new RdpBuffer(f,0,d);f[0]=29;f[2]=1;f[3]=e;g.skipPosition(4);g.setLittleEndian32(a.length);g.setAscllString(a);return f}function mc(){wa=true;if(m){if(L.pingInterval)m.startPing(L.pingInterval);if(m.onready)m.onready()}}function Ad(a){var e=a.getByte();var d=
0;var f=0;var g=0;var c=0;var b;var h;if(e==0){svGlobal.logger.info("Send history...");h=new Uint8Array(4);h[0]=29;h[2]=1;h[3]=1;Q.send(h.buffer);if(K)K.begin("his_mppc");h=ua.toPDU();if(h)Q.send(h.buffer);if(K)K.end("his_mppc");if(K)K.begin("his_order");Q.send(Y.toPDU().buffer);if(K)K.end("his_order");if(K)K.begin("his_bitmap");Ga.forEach(function(a,e,n){if(!a)return;g=0,c=0;for(d=0,f=a.length;d<f;d++)if(a[d].data){g++;c+=a[d].data.length}if(!g||!c)return;h=new Uint32Array(c+g*8+2);h[0]=67174429;
h[1]=g;var l=2;for(d=0;d<f;d++){b=a[d];if(b.data){h[l++]=e;h[l++]=d;h[l++]=b.left;h[l++]=b.top;h[l++]=b.width;h[l++]=b.height;h[l++]=b.bitsperpixel;h[l++]=b.data.length;h.set(b.data,l);l+=b.data.length}}Q.send(h.buffer)});if(K)K.end("his_bitmap");if(K)K.begin("his_font");h=Va.toPDU();if(h)Q.send(h.buffer);if(K)K.end("his_font");h=db.toPDU();if(h)Q.send(h.buffer);c=4;for(d=0,f=sa.length;d<f;d++)if(sa[d])c+=sa[d].length+6;if(c>4){h=new Uint8Array(c);h[0]=29;h[2]=1;h[3]=7;offset=4;for(d=0,f=sa.length;d<
f;d++)if(sa[d]&&sa[d].length){h[offset++]=d;h[offset++]=d>>8;c=sa[d].length;h[offset++]=c;h[offset++]=c>>8;h[offset++]=c>>16;h[offset++]=c>>24;h.set(sa[d],offset);offset+=c}Q.send(h.buffer)}h=mb.toPDU();if(h)Q.send(h.buffer);h=new Uint8Array(5);h[0]=29;h[2]=1;h[3]=0;h[4]=1;Q.send(h.buffer)}else{e=a.getByte();switch(e){case 0:svGlobal.logger.info("Received history");if(a.has(1)&&a.getByte()==1)if(m.sessionInfo.suppressOutput){m.suppressOutput(true);m.suppressOutput(false)}else m.refreshOutput(0,0,
P-1,Z-1);mc();break;case 1:break;case 2:if(K)K.begin("his_mppc_dec");ua.fromStream(a);if(K)K.end("his_mppc_dec");break;case 3:if(K)K.begin("his_order_dec");Y.fromStream(a);if(K)K.end("his_order_dec");break;case 4:if(K)K.begin("his_bitmap_dec");g=a.getLittleEndian32();for(d=0;d<g;d++){var k=a.getLittleEndian32();var v=a.getLittleEndian32();var p=a.getLittleEndian32();var l=a.getLittleEndian32();var r=a.getLittleEndian32();var n=a.getLittleEndian32();var q=a.getLittleEndian32();f=a.getLittleEndian32();
h=new Uint32Array(a.getData().buffer,a.getPosition(),f);var A=new Uint32Array(f);A.set(h);a.skipPosition(f*4);Ga.putBitmap(k,v,new Ua(A,r,n,p,l,q))}if(K)K.end("his_bitmap_dec");break;case 5:Va.fromStream(a);break;case 6:db.fromStream(a);break;case 7:for(;a.has(6);){d=a.getLittleEndian16();f=a.getLittleEndian32();if(f){nc(d,a.getData().subarray(a.getPosition(),a.getPosition()+f));a.skipPosition(f)}}break;case 9:mb.fromStream(a)}}}function Ed(a){var e=a.getByte();switch(e){case 0:var d=new Uint8Array(2);
d[0]=146;d[1]=1;Q.send(d.buffer);break;case 1:break;case 5:var f=a.getByte();var g=a.getLittleEndian32();if(f==0)if(!(g&4)){va^=65536;F.execute("setFeature",[va])}}}function gc(a){var e=a.getAscllString(8);var d=Qa[e];if(d!=null)d.process(a);else svGlobal.logger.warn("Channel "+e+" not found")}function Fd(){var a=y.substring(y.indexOf("?")+1);M("00"+a);M("87"+navigator.userAgent)}function Od(a){var e=a.split("\t");svGlobal.logger.debug(a);var d=F.getWinById(parseInt(e[0]));if(d){if(!F.hasApp(e[1])){var f=
F.getOwnerSurface(d);if(f&&f.railWin)f.railWin.appId=e[1];if(m.onremoteappstart)m.onremoteappstart({"id":e[1]})}d.appId=e[1]}}function Sd(a,e){var d=0;var f=false;this.width=a;this.interval=e;var g=0;this.start=function(){if(f)return;f=true;d=setInterval(function(){var e=F.getFocused();if(e&&fa){var b=e.getThumbnail(a);if(b&&b.length!=g){M("8E7"+b);g=b.length}}},e)};this.stop=function(){clearInterval(d)}}function Td(a,e){if(Ba&&(Ba.width!=a||Ba.interval!=e)){Ba.stop();Ba=null}if(!Ba)Ba=new Sd(a,e);
Ba.start()}function oc(){if(Ba){Ba.stop();Ba=null}}function Gd(a){if(!m)return;Ka=false;Fb=false;eb=m.reconnectTimes;Y=new Db;if(m&&m.mode==0)mc();var e="";for(e in Pa){var d=Pa[e];if(d&&d.onopen)d.onopen()}for(e in Qa){d=Qa[e];if(d&&d.onopen)d.onopen()}if(a){var f=JSON.parse(a);if(f.capability&&m)m.sessionInfo.suppressOutput=f.capability.suppressOutput}}function lc(a){var e=a.getAscllString(8);var d=Pa[e];if(d&&d.process)d.process(a)}function Cd(a){var e=a.getByte();var d=a.getLittleEndian32();switch(e){case 1:var f=
a.getAscllString();if(ia[f]){ia[f].id=d;svGlobal.logger.info("DVC create, name:"+f+" id:"+d);ia[d]=ia[f];if(ia[d].onopen)ia[d].onopen()}break;case 3:if(ia[d])ia[d].process(a);break;case 4:if(ia[d]&&ia[d].onclose)ia[d].onclose();svGlobal.logger.info("close DVC, id:"+d)}}function kc(a){var e=parseInt(a.substring(0,1),16);var d;var f;var g=a.substring(1);var c=false;var b=m.sessionInfo.appInfo;switch(e){case 0:f=JSON.parse(g);$b();fa=true;var h=f.width;var k=f.height;if(h==P&&k==Z)break;tb(h,k);F.setSize(h,
k,T?"hidden":null);z=sb(h,k);break;case 1:f=JSON.parse(g);m.sessionInfo.joinedSessions.push(f.numericId);if(m.onsessionjoin)c=m.onsessionjoin(f);if(c)break;m.showMessage(__svi18n.info.joinsession.applyArgs([f.numericId,f.__ip,f.name]));break;case 2:f=JSON.parse(g);m.sessionInfo.joinedSessions.removeElm(f.numericId);if(m.onsessionexit)c=m.onsessionexit(f);if(c)break;m.showMessage(__svi18n.info.exitsession.applyArgs([f.numericId,f.__ip,f.name]));break;case 3:f=JSON.parse(g);if(b.joinMode!=f.mode){b.joinMode=
f.mode;var v=hi5.$("joinSelect");if(v)v.value=f.mode}if(b.hasControl)return;b.hasControl=true;F.setReadOnly(false);d=hi5.$("requestControl");if(d)d.disabled=true;if(m.ongivecontrol)c=m.ongivecontrol();if(c)break;m.showMessage(__svi18n.info.givecontrol,null,5E3);break;case 4:F.setReadOnly(true);b.hasControl=false;d=hi5.$("requestControl");if(d)d.disabled=false;if(m.ontakebackcontrol)c=m.ontakebackcontrol();if(c)break;m.showMessage(__svi18n.info.nocontrol,null,5E3);break;case 5:var p=function(){m.refuseControl(f.numericId);
this.destroy()};var l=function(){m.giveControl(f.numericId);this.destroy();if(z.isPaused())m.pauseSession(m.sessionInfo.appInfo.numericId,false)};f=JSON.parse(g);if(m.onrequirecontrol)c=m.onrequirecontrol(f);if(c)break;var r=__svi18n.info.title.applyArgs([f.name,f.numericId,f.__ip]);var n=__svi18n.info.recontrol;if(z.isPaused)n+="<br><br>"+(__svi18n.info.autoresume||"");hi5.notifications.notify({"title":r,"msg":n,"cbYes":l,"cbNo":p});break;case 6:F.execute("setTouchRemoting",[true]);break;case 7:f=
JSON.parse(g);if(f.width&&f.height){z=sb(f.width,f.height);tb(f.width,f.height);F.setSize(f.width,f.height)}if(f.color){ib(f.color);svGlobal.logger.warn("Color depth changed to:"+f.color)}break;case 8:f=JSON.parse(g);Fb=true;if(m.onrequestcredential&&m.onrequestcredential(f,Sa.reconnect))return;if(m.onautherror&&m.onautherror(f,Sa.reconnect))return;var q=F.getFocused();q.requestCredential(f,Sa.reconnect);break;case 9:f=JSON.parse(g);if(f.interval>0&&f.width>0)Td(f.width,f.interval);else oc();break;
case 11:var A=function(){m.allowJoin(f.numericId,false);this.destroy()};var w=function(){m.allowJoin(f.numericId,true);this.destroy()};f=JSON.parse(g);if(m.onrequirejoin)c=m.onrequirejoin(f);if(c)break;r=__svi18n.info.title.applyArgs([f.name,f.numericId,f.__ip]);hi5.notifications.notify({"title":r,"msg":__svi18n.info.reqjoin,"cbYes":w,"cbNo":A})}}function Rd(a){var e=JSON.parse(a);switch(e.type){case 0:tb(e.width,e.height);z=sb(P,Z);ib(e.color);var d=e.server;if(d&&m)m.server=e.server;pc=e.length;
var f=F.getFocused();T=e.isRail==true;if(f){f.setSize(P,Z,T?"hidden":null);f.setAutoScale(!T);if(d)zb(Za(),f.getWindow());d=e.keyboard;if(typeof d!="undefined"&&d==0)f.setUnicode(true);d=e.mapDisk;if(d){Gb=true;cc(f)}}if(m.onopened)m.onopened(e);break;case 1:var g=e.duration;if(m.onprogress)m.onprogress(g,pc);break;case 2:if(e.status==2){$b();fa=true}else{var c=e.status==0;if(c!=z.isPaused()){if(m.onsessionpause&&m.onsessionpause(c,e))break;z.pause(c);if(!c)F.repaint(0,0,z.width-1,z.height-1);if(e.warn)m.showMessage(c?
__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)}}}}function jc(a){var e=a.getByte();switch(e){case 32:Ud(a)}}function Ud(a){if(z.isPaused())return;var e=a.getLittleEndian16();var d=a.getLittleEndian16();var f=a.getLittleEndian16();var g=F.getFocused();g.moveCursor(d,f,true)}function Qd(a){var e=hi5.Base64.dec(a,0);var d=new RdpBuffer(e,0,e.length);va=d.getLittleEndian32();if(xa||!(va&16)&&!(va&65536)){Gb=false;ra=null}else if(va&128)ra=null;if(va&64)m.showMessage(__svi18n.info.recording);
F.execute("setFeature",[va])}function Nd(a){var e=JSON.parse(a);var d=e;jb=e.session;if(!d.server)d.server=Za();var f=hi5.$("joinSelect");if(f)f.value=d.joinMode;f=hi5.$("requestControl");if(f)f.disabled=d.hasControl;if(e.joined)F.execute("setAutoScale",[true]);else{m.mode=0;if(qa(x.connectif))F.setSize(P,Z);if(L.disableJoinedAppResize)m.windowState=0}var g=L.page&&L.page.join||"join.html";var c=za();g=c+"/"+g+"?id="+(e.joined||e.numericId);var b=e.webAddress;if(b&&b.length>0&&b.toLowerCase()!=c.toLowerCase()){var h=
b.indexOf("://");m.protocol=b.substring(0,h)=="http"?"ws":"wss";m.gateway=b;g+="&gateway="+encodeURIComponent(b)}g=m.modifyURL(g);d.joinLink=g;m.sessionInfo.appInfo=d;if("isApp"in d&&T!==d.isApp){T=d.isApp;Tb();F.setSize(P,Z,T?"hidden":null);z=sb(P,Z);if(!Oa)F.execute("setAutoScale",[true])}if(e.ver&&e.ver!=svGlobal.version)svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+e.ver);if(m.onsessionstart)m.onsessionstart(m.sessionInfo)}function Pd(a){if(!ra)return;var e=parseInt(a.charAt(0),10);
a=a.substring(1);if(e==5){ra.notifyFiles(JSON.parse(a));return}var d=a.split("\t");switch(e){case 1:ra.confirmId(d[0],d[1],d[2]);break;case 2:ra.read(d[0],parseInt(d[1],10),parseInt(d[2],10));break;case 4:ra.close(d[0]);break;case 9:var f='<a href="'+d[0]+'" download="'+d[1]+'" target="_blank">'+__svi18n.info.fileReady+"</a>";F.getFocused().showMessage({msg:f,title:__svi18n.info.download})}}function Md(a){var e=parseInt(a.substring(0,1),16);var d=a.substring(1);switch(e){case 0:Vd(d);break;case 1:Wd(d);
break;case 2:qc();case 3:}}function Bd(a){var e=a.getByte();switch(e){case 0:Xd(a);break;case 1:Yd(a);break;case 2:qc();case 3:}}function qc(){}function Wd(a){function e(a){var b=0;a=a*k;for(p=0;p<k;p++)b|=(c[a+p]&255)<<p*8;if(b>l){b-=n;b/=-r}else b/=l;return b}function d(a){return function(){M("8A"+a)}}if(!na.available||z.isPaused())return;var f=a.indexOf("\t");var g=a.substring(0,f);var c=hi5.Base64.dec(a,f+1);var b=ba.tag!=1;if(b){if(!fb)fb=new Rb;c=fb.decode(c,0,c.length)}var h=ba.bitsPerSample;
var k=h>>3;var v=Math.floor(c.length/k);var p=0;var l=Math.pow(2,h-1)-1;var r=-l-1;var n=Math.pow(2,h);var q=0;var A=ba.channels;var m=Math.floor(v/A);var R=na.getBuffer(m);var I=R.getChannelData(0);var t=R.getChannelData(1);for(q=0;q<m;){var B=q*2;var D=e(B);if(A==1){I[q]=D;t[q]=D}else{I[q]=D;t[q]=e(B+1)}q++}var C=na.playBuffer(R);setTimeout(d(g),(C-na.delay)*1E3)}function Yd(a){function e(a){return function(){M("8A"+a)}}var d=a.getByte();var f=a.getLittleEndian16();var g=Date.now();a.skipPosition(8);
var c=Hb(a,d,f,0);c=(c-na.delay)*1E3;if(!xa){f+=Date.now()-g+c;setTimeout(e(d+","+f),c)}}function Hb(a,e,d,f){if(!na.available||z.isPaused())return;var g=a.getPosition();var c=a.getData();var b=f||a.getEnd()-g;if(ba.tag==41222){var h=na.getContext();if(h)h.decodeAudioData(c.buffer.slice(g),function(a){var b=na.playBuffer(a);if(!xa)setTimeout(sendLater(ad),(b-na.delay)*1E3)},function(a){svGlobal.logger.warn(a)});return}var k=ba.tag!=1;if(k){if(!fb)fb=new Rb;c=fb.decode(c,g,b);g=0;b=c.length}var v=
ba.bitsPerSample;var p=v>>3;var l=Math.floor(b/p);var r=0;var n=0;var q=0;if(!k){r=Math.pow(2,v-1)-1;n=-r-1;q=Math.pow(2,v)}var A=g;var m=0;var R=0;var I=ba.channels;var t=Math.floor(l/I);var B=na.getBuffer(t);var D=B.getChannelData(0);var C=B.getChannelData(1);m=0;if(k)for(;m<t;){if(I==1)C[m]=D[m]=c[A++];else{D[m]=c[A++];C[m]=c[A++]}m++}else for(;m<t;){R=c[A++]|c[A++]<<8;if(R>r){R-=q;R/=-n}else R/=r;if(I==1){D[m]=R;C[m]=R}else{D[m]=R;R=c[A++]|c[A++]<<8;if(R>r){R-=q;R/=-n}else R/=r;C[m]=R}m++}var J=
na.playBuffer(B);return J}function Vd(a){var e=a.split("\t");ba.tag=parseInt(e[0],10);ba.channels=parseInt(e[1],10);ba.bitsPerSample=parseInt(e[2],10);ba.samplePerSec=parseInt(e[3],10);svGlobal.logger.debug("Audio Format, tag="+ba.tag+" channels="+ba.channels+" bitsPerSample="+ba.bitsPerSample+" samplePerSec="+ba.samplePerSec)}function Xd(a){ba.tag=a.getLittleEndian16();ba.channels=a.getLittleEndian16();ba.samplePerSec=a.getLittleEndian32();a.skipPosition(6);ba.bitsPerSample=a.getLittleEndian16();
svGlobal.logger.info("Audio Format, tag="+ba.tag+" channels="+ba.channels+" bitsPerSample="+ba.bitsPerSample+" samplePerSec="+ba.samplePerSec)}function Zd(a){var e=null;this.available=false;this.delay=a;this.supportWebAudio=false;if(x.playSound==0||m.mode>0){e=hi5.audio.getAudioContext();if(e){this.available=true;this.supportWebAudio=true}}this.getContext=function(){return e};this.getBuffer=function(a){return e.createBuffer(2,a,ba.samplePerSec)};var d=0;var f=null;var g=null;this.setVolume=function(a){if(a==
1)f=null;else{if(!f)f=e.createGain();f.gain.value=a}};this.playBuffer=function(c){g=e.createBufferSource();g.buffer=c;if(f){g.connect(f);f.connect(e.destination)}else g.connect(e.destination);var b=e.currentTime;var h=d>0?d:b+a;if(h<b)h=b;d=h+c.duration;if(g.start)g.start(h);else g.noteOn(h);return d-b};this.iOSFix=function(){if(e&&hi5.browser.isTouch&&hi5.browser.isSafari){var a=this.getBuffer(1024);var b=e.createBufferSource();b.buffer=a;b.connect(e.destination);if(b.start)b.start(0);else b.noteOn(0)}};
this.close=function(){if(e){if(f)f.disconnect();if(g)g.disconnect();hi5.audio.releaseAudioContext()}}}function Ld(a){var e=a.split("\t");a=za()+e[0];a=m.modifyURL(a);svGlobal.logger.info("Downloading file:"+a+" name:"+e[1]+" driver:"+e[2]);if(m.onprintingready)if(m.onprintingready({"link":a,"printerName":e[1],"pinterDriver":e[2]}))return;var d=F.getFocused();if(d)d.showPDF(a)}function Kd(a){F.setReadOnly(a=="1")}function Jd(a){var e=parseInt(a.substring(0,1),10);a=a.substring(1);switch(e){case 1:$d(a);
break;case 2:ae(a);break;case 5:be(a)}}function be(a){var e=F.getFocused();if(e&&a!="0")e.setIgnorePaste(true)}function ae(a){var e=F.getFocused();if(e)if(!e.processClipReq(a))if((L.clipWarnAlways||!rc)&&x&&!x["leagacyMode"]){m.showMessage(__svi18n.info.menucopy,null,5E3);rc=true}}function ce(a){if(!m.openLink||a.length>2E3)return false;var e=a.indexOf(";");if(e>0)a=a.substring(e+1);var d=a;a=a.toLowerCase();var f=a.indexOf("http://")==0||a.indexOf("https://")==0||a.indexOf("ftp://")==0||a.indexOf("mailto:")==
0||a.indexOf("tel:")==0||a.indexOf("callto:")==0;if(!f)if(a.indexOf("www.")==0){f=true;a="http://"+a}else if(a.indexOf("ftp.")==0){f=true;a="ftp://"+a}if(f){if(a.indexOf("\r")>0||a.indexOf("\n")>0)return false;if(m.onurlredirection&&m.onurlredirection(f))return true;var g=F.getFocused();if(!g)return false;g.processLink(d);return true}return false}function $d(a){if(m.onservercopy&&m.onservercopy(a))return;if(!ce(a))F.copyToClip(a);setTimeout(function(){M("883")},999)}function hc(a){var e=a.getLittleEndian16();
var d=a.getByte();var f=a.getByte();var g=a.getLittleEndian16();var c=null;if((f&32)!=0){g-=18;var b=ua.dec(a.getData(),a.getPosition(),g,f);c=ua.getData()}else c=a;switch(d){case 2:de(c);break;case 20:break;case 31:Ka=false;break;case 27:ee(c);break;case 34:break;case 38:fe(c);Ka=false;break;case 40:Sa.sendKeyboardSynchronize(qa(x.scrollLock),qa(x.numLock),qa(x.capsLock));Ka=false;break;case 47:ge(c);break;case 50:c.skipPosition(4);break;case 54:he(c);break;case 55:ie(c);break;default:svGlobal.logger.warn("Unimplemented Data PDU type "+
d)}}function ie(a){var e=a.getLittleEndian32();var d=0;var f=0;var g=0;var c=0;var b=0;var h=0;var k=0;var v=0;for(var p=0;p<e;p++){d=a.getLittleEndian32();f=a.getLittleEndian32();g=a.getLittleEndian32();c=a.getLittleEndian32();a.skipPosition(4);b=Math.min(d,b);h=Math.max(h,g);k=Math.min(f,k);v=Math.max(v,c)}d=h-b+1;f=v-k+1;svGlobal.logger.warn("monitor, count:"+e+" w:"+d+" h:"+f);tb(d,f)}function he(a){var e=a.getLittleEndian32().toString(16).toUpperCase();var d=__svi18n.serverStatus[e];if(m.displayMsg)svGlobal.logger.info(d)}
function ya(){var a=m.sessionInfo.appInfo;if(a&&!a.joined&&Oa){svGlobal.logger.info("Recovering");bc(P,Z)}}function de(a){var e=a.getLittleEndian16();switch(e){case 0:a.skipPosition(2);var d=a.getLittleEndian16();a.skipPosition(2);sc(a,d);break;case 1:tc(a);break;case 2:uc(a);break;case 3:break;default:svGlobal.logger.warn("Unimplemented Update type "+e);ya()}}function ee(a){var e=0;var d=0;var f=0;e=a.getLittleEndian16();a.skipPosition(2);switch(e){case 3:d=a.getLittleEndian16();f=a.getLittleEndian16();
if(z.isPaused())break;F.getFocused().moveCursor(d,f,true);break;case 6:vc(a);break;case 7:wc(a);break;case 1:je(a);break;case 8:xc(a);default:}}function je(a){var e=a.getLittleEndian16();switch(e){case 0:yc();break;default:svGlobal.logger.warn("XXX system pointer message "+e)}}function ke(a,e){var d;var f;var g=m.sessionInfo;switch(e){case 0:a.skipPosition(4);g.domain=a.getUnicodeString(52,true);a.skipPosition(4);g.userName=a.getUnicodeString(512,true);g.sessionId=a.getLittleEndian32();break;case 1:g.version=
a.getLittleEndian16();a.skipPosition(4);g.sessionId=a.getLittleEndian32();d=a.getLittleEndian32();f=a.getLittleEndian32();a.skipPosition(558);g.domain=a.getUnicodeString(d,true);g.userName=a.getUnicodeString(f,true);case 2:}return g}function zc(){if(!Oa){setTimeout(function(){if(fa)M("884")},999);if(m.onloggedin)m.onloggedin()}Oa=true;if(T)F.execute("setAutoScale",[false]);if(ra)ra.enabled=true;if(ub&&!T){z.setContext(F.getFocused().context);F.repaint(0,0,z.width-1,z.height-1)}}function fe(a){var e=
a.getLittleEndian32();if(e<3){ke(a,e);zc();return}if(e!=3)return;a.skipPosition(2);var d=a.getLittleEndian32();a.skipPosition(4);if(d==2)return;var f=a.getLittleEndian32();a.skipPosition(4);var g=new Object;g.logId=a.getLittleEndian32();g.time=Date.now();m.sessionInfo.sessionId=g.logId;zc();var c=a.getBytes(16);var b=new Array(16);for(var h=0;h<16;h++)b[h]=c[h]&255;g.random=b;var k="8D"+g.logId+"\t"+hi5.Base64.enc(b);if(m.sessionInfo.userName){k+="\t"+m.sessionInfo.userName;if(m.sessionInfo.domain)k+=
"\t"+m.sessionInfo.domain}if(!xa)M(k)}function ge(a){Ka=true;var e=a.getLittleEndian32();svGlobal.logger.info("Disconnect:"+e);var d=e==11&&T;if(d)F.close();var f=e<1||d;if(f)return;if(!xa&&fa)M("85"+e);Zb(e.toString(16).toUpperCase())}function le(){var a=0;var e=0;var d=[0];var f=new RdpBuffer(d,0,0);this.addFragement=function(f,c){Na(f.getData(),f.getPosition(),d,e,c);e+=c;a+=c};this.clearFragements=function(){f.setPosition(0);f.markEnd(a);a=0;e=0;return f}}function ic(a){var e=a.getByte();var d=
e&15;var f=e>>4&3;var g=e>>6&3;var c;var b=0;if(g==2)b=a.getByte();c=a.getLittleEndian16();var h=null;if((b&32)!=0){var k=ua.dec(a.getData(),a.getPosition(),c,b);h=ua.getData();c=ua.getDecompressedLength()}else h=a;if(f!=0)switch(f){case 2:case 3:vb.addFragement(h,c);return;case 1:vb.addFragement(h,c);h=vb.clearFragements()}if(K)K.begin("decodeFastPath");switch(d){case 0:var v=h.getLittleEndian16();sc(h,v);break;case 1:h.skipPosition(2);tc(h);break;case 2:h.skipPosition(2);uc(h);break;case 3:break;
case 4:me(h);break;case 5:yc(h);break;case 6:break;case 8:break;case 9:vc(h);break;case 10:wc(h);break;case 11:xc(h);break;default:svGlobal.logger.warn("XXX RDP5 opcode "+d);ya()}if(K)K.end("decodeFastPath")}function me(a){var e=a.getEnd();var d;var f;var g;for(var c;a.getPosition()<e;){var b=a.getLittleEndian16();switch(b){case 1:case 6:d=a.getLittleEndian16();f=a.getLittleEndian16();g=a.getLittleEndian16();c=a.getBigEndian16();ne(a,d,f,g,c);break;case 4:oe(a);break;default:svGlobal.logger.warn("Invalid surface cmd:"+
b)}}}function oe(a){var e=a.getLittleEndian16();var d=a.getLittleEndian32();if(e==1)M("91"+d)}function wb(a,e,d,f,g,c){var b;var h=f*c;for(var k=0;k<g;k++){b=e+(g-k-1)*h;Na(a,b,d,k*h,h)}}function pe(){var a=new Uint32Array(10240);var e=0;var d=new Uint8Array(10240);var f=0;var g=new Uint8Array(10240);var c=0;var b=new Uint8Array(10240);var h=0;var k=new Uint8Array(0);var v=0;this.getData=function(){return a};this.getDataSize=function(){return e};this.resetData=function(b){if(a.length<b)a=new Uint32Array(b);
e=b;return a};this.resetLumaPlane=function(a){if(d.length<a)d=new Uint8Array(a);f=a;return d};this.getLumaPlanceSize=function(){return f};this.resetOrangeChromaPlane=function(a){if(g.length<a)g=new Uint8Array(a);c=a;return g};this.getOrangeChromaPlane=function(){return c};this.resetGreenChromaPlane=function(a){if(b.length<a)b=new Uint8Array(a);h=a;return b};this.getGreenChromaPlane=function(){return h};this.resetAlphaPlane=function(a){if(k.length<a)k=new Uint8Array(a);v=a;return k};this.getAlphaPlane=
function(){return v}}function qe(){function a(a,e,b,d,k,v,p,l,r){var n=0;var q=0;var A=0;var m=0;var R=0;var I=0;var t=0;var B=0;var D=0;var C=0;var J=0;var x=0;var E=f(k,8);var u=p-1;for(q=0;q<v;q++){if(l>0){A=q*E;m=(q>>1)*(E>>1);R=(q>>1)*(E>>1)}else{A=q*k;m=q*k;R=q*k}for(n=0;n<k;n++){I=a[A]&255;t=(e[m]&255)<<u<<24>>24;B=b[R]<<u<<24>>24;D=I+t-B;C=I+B;J=I-t-B;J=J<0?0:J>255?255:J;C=C<0?0:C>255?255:C;D=D<0?0:D>255?255:D;r[x++]=4278190080|J<<16|C<<8|D;A++;m+=l>0?n%2:1;R+=l>0?n%2:1}}}function e(a,e,b,
f,k){if(b==0)Ha(f,0,k,255);else if(b<k)d(a,e,f,k);else Na(a,e,f,0,k)}function d(a,e,b,d){var f=0;var v=0;var p=0;v=d;for(var l=0;v>4;){p=a[e++];if(v==5){b[l++]=p;v--}else if(p==a[e]){e++;if((a[e]&255)<255){f=a[e++]&255;f+=2}else{e++;f=(a[e+3]&255)<<24|(a[e+2]&255)<<16|(a[e+1]&255)<<8|a[e]&255;e+=4}Ha(b,l,l+f,p);l+=f;v-=f}else{b[l++]=p;v--}}for(var r=0;r<4;r++)b[l++]=a[e++]}function f(a,e){return a+(~(a&e-1)+1&e-1)}this.process=function(d,c,b,h,k){var v=d.getLittleEndian32();var p=d.getLittleEndian32();
var l=d.getLittleEndian32();d.skipPosition(4);var r=d.getByte();var n=d.getByte();d.skipPosition(2);var q=d.getData();var A=d.getPosition();var m=b*h;var R=m*4;var I=k.resetData(m);var t=f(b,8);var B=f(h,2);R=t*B;var D=k.resetLumaPlane(R);var C=k.resetOrangeChromaPlane(R);var J=k.resetGreenChromaPlane(R);var x=b*h;var E=n>0?t*h:x;var u=n>0?(t>>1)*(B>>1):x;var H=n>0?u:x;e(q,A,v,D,E);A+=v;e(q,A,p,C,u);A+=p;e(q,A,l,J,H);A+=l;a(D,C,J,null,b,h,r,n,I);d.skipPosition(v+p+l)}}function Ac(a,e,d){var f=a;var g=
d;var c=0;var b=8;var h=e;this.attach=function(a,e,d){f=a;g=d;c=0;b=8;h=e};this.getBits=function(a){var e=a;var d=0;for(var l=0;c<g&&e>0;){d=e;if(d>b)d=b;if(l!=0)l<<=d;l|=f[c+h]>>b-d&(1<<d)-1;b-=d;e-=d;if(b==0){b=8;c++}}return l};this.putBits=function(a,e){var d=a;var l=e;for(var r=0;c<g&&l>0;){r=l;if(r>b)r=b;f[c+h]|=(d>>l-r&(1<<r)-1)<<b-r;b-=r;l-=r;if(b==0){b=8;c++}}};this.eos=function(){return c>g};this.left=function(){return c>=g?0:(g-c-1)*8+b};this.getProcessBytes=function(){return b<8?c+1:c}}
function Bc(){this.quantIdxY=0;this.quantIdxCb=0;this.quantIdxCr=0;this.YLen=0;this.CbLen=0;this.CrLen=0;this.x=0;this.y=0;this.data=new Uint32Array(4096);var a=this;this.readHeaderfromStream=function(e){e.skipPosition(6);a.quantIdxY=e.getByte();a.quantIdxCb=e.getByte();a.quantIdxCr=e.getByte();a.x=e.getLittleEndian16()*64;a.y=e.getLittleEndian16()*64;a.YLen=e.getLittleEndian16();a.CbLen=e.getLittleEndian16();a.CrLen=e.getLittleEndian16()}}function re(){function a(a,b,e,d){for(var f=0;f<4096;f++)d[f]=
4278190080|e[f]<<16|b[f]<<8|a[f]}function e(a,b,e){var d=0;var f=0;var g=0;var c=0;var h=0;var k=0;var m=0;for(m=0;m<4096;m++){d=a[m];f=b[m];g=e[m];d=d+4096<<16;c=d+g*91947;h=d-f*22544-g*46792;k=d+f*115998;c=c>>21;h=h>>21;k=k>>21;a[m]=c<0?0:c>255?255:c;b[m]=h<0?0:h>255?255:h;e[m]=k<0?0:k>255?255:k}}function d(a,b,e,d,g,q,A){k(a.et,d,g,q,A,4096,a.bitStream);h(A,4032,64);c(A,b);f(A,a.dwtBuffer)}function f(a,b){g(a,3840,b,8);g(a,3072,b,16);g(a,0,b,32)}function g(a,b,e,d){var f=0;var g=0;var c=0;var h=
0;var k=0;var m=0;var t=0;var B=0;var D=0;var C=0;var J=0;var x=0;var E=0;C=d<<1;D=b+d*d*3;m=b;h=0;t=b+d*d;B=b+d*d*2;k=d*d*2;for(x=0;x<d;x++){e[h]=a[D]-(a[m]+a[m]+1>>1)<<16>>16;e[k]=a[t]-(a[B]+a[B]+1>>1)<<16>>16;for(E=1;E<d;E++){J=E<<1;e[h+J]=a[D+E]-(a[m+E-1]+a[m+E]+1>>1)<<16>>16;e[k+J]=a[t+E]-(a[B+E-1]+a[B+E]+1>>1)<<16>>16}for(E=0;E<d-1;E++){J=E<<1;e[h+J+1]=(a[m+E]<<1)+(e[h+J]+e[h+J+2]>>1)<<16>>16;e[k+J+1]=(a[B+E]<<1)+(e[k+J]+e[k+J+2]>>1)<<16>>16}J=E<<1;e[h+J+1]=(a[m+E]<<1)+e[h+J]<<16>>16;e[k+J+
1]=(a[B+E]<<1)+e[k+J]<<16>>16;D+=d;m+=d;h+=C;t+=d;B+=d;k+=C}for(J=0;J<C;J++){for(E=0;E<d;E++){x=E<<1;f=b+x*C+J;g=E*C+J;c=g+d*C;a[f]=e[g]-((E>0?e[c-C]:e[c])+e[c]+1>>1)<<16>>16}for(E=0;E<d;E++){x=E<<1;f=b+x*C+J;g=E*C+J;c=g+d*C;a[f+C]=(e[c]<<1)+(a[f]+a[f+(E<d-1?2*C:0)]>>1)<<16>>16}}}function c(a,e){b(a,0,4096,5);b(a,0,1024,e[8]-6);b(a,1024,1024,e[7]-6);b(a,2048,1024,e[9]-6);b(a,3072,256,e[5]-6);b(a,3328,256,e[4]-6);b(a,3584,256,e[6]-6);b(a,3840,64,e[2]-6);b(a,3904,64,e[1]-6);b(a,3968,64,e[3]-6);b(a,
4032,64,e[0]-6)}function b(a,b,e,d){if(d==0)return;for(var f=b;e>0;f++,e--)a[f]<<=d}function h(a,b,e){var d;var f;for(d=b,f=b+1;e>1;d++,f++,e--)a[f]+=a[d]}function k(a,b,e,d,f,g,c){var h=1;var k=h<<3;var m=1;var t=m<<3;var B=0;var D=f;var C=0;var x=0;var z=0;if(c==null)c=new Ac(b,e,d);else c.attach(b,e,d);for(;!c.eos()&&g>0;){var E;if(h!=0){var u;for(var H;!c.eos();){B=c.getBits(1);if(B!=0)break;var ea=1<<h;var y=ea;if(y>g)y=g;if(y>0){Ha(D,C,C+y,0);C+=y}g-=ea;k+=4;if(k>80)k=80;if(k<0)k=0;h=k>>3}E=
c.getBits(h);ea=E;y=ea;if(y>g)y=g;if(y>0){Ha(D,C,C+y,0);C+=y}g-=ea;H=c.getBits(1);x=0;z=0;do{B=c.getBits(1);if(B==1)x++;else break}while(true);z=c.getBits(m);z|=x<<m;if(x==0){t+=-2;if(t>80)t=80;if(t<0)t=0;m=t>>3}else if(x!=1){t+=x;if(t>80)t=80;if(t<0)t=0;m=t>>3}u=z+1;if(g>0)D[C++]=H!=0?-u:u;g--;k+=-6;if(k>80)k=80;if(k<0)k=0;h=k>>3}else{var F;var K;var Da;x=0;z=0;do{B=c.getBits(1);if(B==1)x++;else break}while(true);z=c.getBits(m);z|=x<<m;if(x==0){t+=-2;if(t>80)t=80;if(t<0)t=0;m=t>>3}else if(x!=1){t+=
x;if(t>80)t=80;if(t<0)t=0;m=t>>3}u=z;if(a!=1){var Aa=u;for(F=0;Aa!=0;){Aa>>=1;F++}K=c.getBits(F);Da=u-K;if(K!=0&&Da!=0){k+=-2*3;if(k>80)k=80;if(k<0)k=0;h=k>>3}else if(K==0&&Da==0){k+=2*3;if(k>80)k=80;if(k<0)k=0;h=k>>3}if(g>0)D[C++]=(K&1)!=0?-1*(K+1>>1):K>>1;g--;if(g>0)D[C++]=(Da&1)!=0?-1*(Da+1>>1):Da>>1;g--}else if(u==0){if(g>0)D[C++]=0;g--;k+=3;if(k>80)k=80;if(k<0)k=0;h=k>>3}else{if(g>0)D[C++]=(u&1)!=0?-1*(u+1>>1):u>>1;g--;k+=-3;if(k>80)k=80;if(k<0)k=0;h=k>>3}}}return C}this.decodeRgb=function(b,
f,g,c,h,k,m,w,x,I){d(b,g,h,f.getData(),f.getPosition(),c,b.yrBuffer);f.skipPosition(c);d(b,g,m,f.getData(),f.getPosition(),k,b.cbgBuffer);f.skipPosition(k);d(b,g,x,f.getData(),f.getPosition(),w,b.crbBuffer);f.skipPosition(w);e(b.yrBuffer,b.cbgBuffer,b.crbBuffer);a(b.yrBuffer,b.cbgBuffer,b.crbBuffer,I)}}function se(){var a=[new hb];var e=[new Bc];var d=0;var f=0;this.resetRects=function(e){if(a.length<e){var f=a.length;a.length=e;for(var b=f;b<e;b++)a[b]=new hb}d=e;return a};this.resetTiles=function(a){if(e.length<
a){var d=e.length;e.length=a;for(var b=d;b<a;b++)e[b]=new Bc}f=a;return e};this.getRectSize=function(){return d};this.getTileSize=function(){return f};this.getRects=function(){return a};this.getTiles=function(){return e}}function te(){this.ctxId=0;this.tileSize=64;this.flags=0;this.cct=0;this.xft=0;this.et=0;this.qt=0;this.yrBuffer=new Int32Array(4096);this.cbgBuffer=new Int32Array(4096);this.crbBuffer=new Int32Array(4096);this.dwtBuffer=new Int32Array(32*32*2*2);var a=this;this.setProperties=function(e){a.flags=
e&7;a.cct=e>>3&3;a.xft=e>>5&15;a.et=e>>9&15};this.bitStream=new Ac}function ue(){function a(a,b){a.skipPosition(6);var e=a.getLittleEndian16();b.cct=e>>>4&3;b.xft=e>>>6&15;b.et=e>>>10&15;b.qt=e>>>14&3;var d=a.getByte();a.skipPosition(1);var f=a.getLittleEndian16();a.skipPosition(4);var g=new Array(d*10);var c=0;var h;var p;for(p=0;p<d;p++){h=a.getByte();g[c++]=h&15;g[c++]=h>>>4;h=a.getByte();g[c++]=h&15;g[c++]=h>>>4;h=a.getByte();g[c++]=h&15;g[c++]=h>>>4;h=a.getByte();g[c++]=h&15;g[c++]=h>>>4;h=a.getByte();
g[c++]=h&15;g[c++]=h>>>4}var v=k.resetTiles(f);for(p=0;p<f;p++){var m=v[p];m.readHeaderfromStream(a);l(b,a,g,m.YLen,m.quantIdxY*10,m.CbLen,m.quantIdxCb*10,m.CrLen,m.quantIdxCr*10,m.data)}}function e(a){a.skipPosition(2);a.skipPosition(1);var b=a.getLittleEndian16();var e=k.resetRects(b);for(var d=0;d<b;d++){var f=e[d];f.x=a.getLittleEndian16();f.y=a.getLittleEndian16();f.width=a.getLittleEndian16();f.height=a.getLittleEndian16()}a.skipPosition(4)}function d(a){a.skipPosition(2)}function f(a){a.skipPosition(10)}
function g(a){a.skipPosition(2);p.ctxId=a.getByte();p.tileSize=a.getLittleEndian16();p.setProperties(a.getLittleEndian16())}function c(a){var b=a.getByte();for(var e=0;e<b;e++){var d=a.getByte();var f=a.getLittleEndian16();var g=a.getLittleEndian16();svGlobal.logger.info("Channel, id:"+d+" width:"+f+" height:"+g)}}function b(a){a.skipPosition(4)}function h(a){var b=a.getLittleEndian32();var e=a.getLittleEndian16()}var k=new se;var v=new re;var p=new te;this.decode=function(l,n){var m=0;var v=0;var w=
0;for(var x=l.getPosition()+n;l.getPosition()<x;){m=l.getLittleEndian16();v=l.getLittleEndian32();if(v==0)break;w=l.getPosition()-6+v;switch(m){case 52416:h(l);break;case 52417:b(l);break;case 52418:c(l);break;case 52419:g(l);break;case 52420:f(l);break;case 52421:d(l);break;case 52422:e(l);break;case 52423:a(l,p);break;default:svGlobal.logger.warn("unknown blockType 0x%X"+m)}l.setPosition(w)}return k};var l=v.decodeRgb;this.getResult=function(){return k}}function ne(a,e,d,f,g){var c=a.getByte();
a.skipPosition(2);var b=a.getByte();var h=a.getLittleEndian16();var k=a.getLittleEndian16();var m=a.getLittleEndian32();var p;var l=a.getPosition()+m;switch(b){case 0:var r=Bb(a.getData(),m,a.getPosition());p=new Uint32Array(r.length);wb(r,0,p,h,k,1);z.setRGBs(e,d,h,k,p,0,h);z.postPaint(e,d,h,k);break;case 1:Ib(a,c,h,k,Wa);var n=Wa.getData();var q=Wa.getDataSize();p=new Uint32Array(q);wb(n,0,p,h,k,1);z.setRGBs(e,d,h,k,p,0,h);z.postPaint(e,d,h,k);break;case 3:var A=Cc.decode(a,m);var w=A.getRects();
var x=A.getTiles();var I=A.getTileSize();var t=A.getRectSize();var B=t?new hb(0,0,0,0):null;var D=0;for(var C=0;C<I;C++){var J=x[C];if(t)for(var y=0;y<t;y++){var E=w[y];E.intersection(J.x,J.y,64,64,B);if(B.isEmpty())continue;D=(B.y-J.y)*64+(B.x-J.x);B.x+=e;B.y+=d;z.setRGBs(B.x,B.y,B.width,B.height,J.data,D,64);z.postPaint(B.x,B.y,B.width,B.height)}else{z.setRGBs(J.x,J.y,64,64,J.data,0,64);z.postPaint(J.x,J.y,64,64)}}}a.setPosition(l)}function wc(a){Dc(a.getLittleEndian16())}function vc(a){Ec(a,24)}
function xc(a){var e=a.getLittleEndian16();Ec(a,e)}function ve(a,e,d,f,g,c,b,h){this.x=a;this.y=e;this.width=d;this.height=f;this.mask=g;this.pixel=c;this.bpp=b;this.cache_idx=h}function Ec(a,e){if(we)return;var d=0;var f=0;var g=0;var c=0;var b=0;var h=0;var k=0;b=a.getLittleEndian16();d=a.getLittleEndian16();f=a.getLittleEndian16();g=a.getLittleEndian16();c=a.getLittleEndian16();h=a.getLittleEndian16();k=a.getLittleEndian16();var m=a.getBytes(k);var p=a.getBytes(h);if(d<0||d>=g-1)d=0;if(f<0)f=0;
else if(f>=c)f=c-1;var l=true;for(var r=0;r<k;r++)if(m[r]!=0){l=false;break}xe(new ve(d,f,g,c,p,m,e,b),l);Dc(b)}function ye(a,e,d,f,g,c){if(g!=1)e=f-e-1;var b=(e*d+a)*g;var h=b/8>>0;var k=c[h]&255;switch(g){case 1:k=k&128>>b%8;return k==0?0:4294967295;case 8:return k==0?0:4294967295;case 15:k=(c[h+1]&255)<<8|k;var m=new Array(4);Fc(k,15,m,0);return m[0]<<16|m[1]<<8|m[2];case 16:k=(c[h+1]&255)<<8|k;m=new Array(4);Fc(k,16,m,0);return m[0]<<16|m[1]<<8|m[2];case 24:return(c[h+2]&255)<<16|(c[h+1]&255)<<
8|k;case 32:return(c[h+3]&255)<<24|(c[h+2]&255)<<16|(c[h+1]&255)<<8|k}svGlobal.logger.warn("invalid bpp value for Xor Mask.");return 0}function ze(a,e,d,f,g,c){if(g!=1)e=f-e-1;d=((d+7)/8|0)*8;var b=e*d+a;var h=b/8>>0;var k=c[h]&128>>b%8;return k==0?1:0}function Ae(a,e,d,f,g,c){var b=new Array(a*e);b[0]=0;var h=0;var k=true;var m=d.length;for(var p=0;p<m;p++)if(d[p]!=0){k=false;break}var l=0;var r;for(p=0;p<e;p++)for(r=0;r<a;r++){b[h]=ye(r,p,a,e,g,f);if(!k){l=ze(r,p,a,e,g,d);if(l==0&&b[h]!=0){b[h]=
~b[h];b[h]|=4278190080}else if(l==1||b[h]!=0)b[h]|=4278190080;if(g==32&&b[h]==-1&&l==0)b[h]=0}h++}return b}function Jb(a,e,d,f,g,c,b,h,k){function m(){var a=0|0;if(e){var b=0;for(var d=e.length;b<d;b++)if(e[b]!=0)a+=b%g+(b/g|0)}return a}function p(a){if(a==507)return"text";else return""}this.cache_idx=a;this.rawData=e;this.none=!e;this.hotX=d;this.hotY=f;this.width=g;this.height=c;this.xorSize=h;this.andSize=k;this.result="";this.distance=0;this.bpp=b;this.system="";this.init=function(){if(this.distance)this.distance=
m();if(!this.system)this.system=p(this.distance)};var l="";if(!this.system&&e){var r=40;var n=g*c*4;var q=22+r+n+h+k;var A=new Uint8Array(q);var w=new RdpBuffer(A,0,q);w.setLittleEndian16(0);w.setLittleEndian16(2);w.setLittleEndian16(1);w.setByte(g);w.setByte(c);w.setByte(0);w.setByte(0);w.setLittleEndian16(d);w.setLittleEndian16(f);w.setLittleEndian32(r+n+h+k);w.setLittleEndian32(22);w.setLittleEndian32(r);w.setLittleEndian32(g);w.setLittleEndian32(c*2);w.setLittleEndian16(1);w.setLittleEndian16(32);
w.setLittleEndian32(0);w.setLittleEndian32(h+k);w.setLittleEndian32(0);w.setLittleEndian32(0);w.setLittleEndian32(0);w.setLittleEndian32(0);var x;var I;for(x=c-1;x>=0;x--)for(I=0;I<g;I++){var t=e[g*x+I];w.setByte(t&255);w.setByte(t>>8&255);w.setByte(t>>16&255);w.setByte(t>>24&255)}if(hi5.browser.isIE);else l="data:image/x-icon;base64,"+hi5.Base64.enc(w.getData())}this.url=l}function xe(a,e){var d=a.x;var f=a.y;var g=a.width;var c=a.height;var b=a.mask;var h=a.pixel;var k=a.bpp;var m=a.cache_idx;if(e){db.set(m,
new Jb(m,null,0,0,0,0,0,0,0));return}var p=Ae(g,c,b,h,k,d);var l=new Jb(m,p,d,f,g,c,k,h.length,b.length);l.init();db.set(m,l)}function Dc(a){if(z.isPaused())return;var e=db.get(a);if(e)F.setCursor(e);else svGlobal.logger.warn("invalid cursor"+a)}function yc(){F.setCursor({"system":"default","none":false,"result":"default"})}function uc(a){var e=0;var d=null;var f=null;var g=null;var c=0;a.skipPosition(2);e=a.getLittleEndian16();a.skipPosition(2);d=new Array(e);f=new Array(e);g=new Array(e);var b=
a.getBytes(e*3);for(var h=0;h<e;h++){d[h]=b[c];f[h]=b[c+1];g[h]=b[c+2];c+=3}if(e!=256)return;Be(8,e,d,f,g)}function Be(a,e,d,f,g){if(!Y.paletteRdp)Y.paletteRdp=new Array(3);Y.paletteRdp[0]=d;Y.paletteRdp[1]=f;Y.paletteRdp[2]=g}function sc(a,e){var d=0;var f=0;for(var g=0;d<e;){f=a.getByte();g=f&3;switch(g){case 1:Ce(a,f);break;case 2:De(a,f);break;case 3:Ee(a);if(Ta)Ta.on=false;break;default:ya()}d++}if(Ta)Ta.verify(z.getDirtyArea())}function Fe(a,e,d){var f=0;var g=0;if((e&64)!=0)d--;if((e&128)!=
0)if(d<2)d=0;else d-=2;for(var c=0;c<d;c++){g=a.getByte();f|=g<<c*8}return f}function Ce(a,e){var d=0;var f=0;var g=false;if((e&8)!=0)Y.orderType=a.getByte();f=Ge[Y.orderType];d=Fe(a,e,f);if((e&4)!=0){if((e&32)==0)He(a,Y.bounds);Ie(Y.bounds)}g=(e&16)!=0;if(Ta&&Y.orderType!=13)Ta.on=false;switch(Y.orderType){case 0:Je(a,Y.destBlt,d,g);break;case 1:Ke(a,Y.patBlt,d,g);break;case 2:Le(a,Y.screenBlt,d,g);break;case 9:Me(a,Y.line,d,g);break;case 10:Ne(a,Y.rectangle,d,g);break;case 11:Oe(a,Y.deskSave,d,
g);break;case 13:Pe(a,Y.memBlt,d,g);break;case 22:Qe(a,Y.polyLine,d,g);break;case 27:Re(a,Y.text2,d,g);break;default:svGlobal.logger.warn("XXX Order type "+Y.orderType);ya()}if((e&4)!=0)ac()}function De(a,e){var d=e>>2;switch(d){case 11:Se(a);break;case 13:Te(a);break;default:svGlobal.logger.warn("Alt Sec order:"+d);ya()}}function Te(a){var e=a.getLittleEndian32()}function Se(a){var e=a.getLittleEndian16();var d=a.getLittleEndian32();var f=a.getPosition()+(e-7);if((d&16777216)!=0)Ue(d,a);else if((d&
33554432)!=0)svGlobal.logger.info("XXX Alt Sec window Notify="+d);else if((d&67108864)!=0)Ve(d,a);else{svGlobal.logger.info("XXX Alt Sec window order flgas="+d);ya()}a.setPosition(f)}function Ue(a,e){var d=e.getLittleEndian32();if((a&1073741824)!=0)We(d,e);else if((a&2147483648)!=0)svGlobal.logger.info("XXX rail cache icon, winId="+d);else if((a&536870912)!=0)Xe(d);else Ye(e,a,d)}function We(a,e){svGlobal.logger.info("XXX rail icon, winId="+a)}function Ze(a){this.id=a;this.appId="";var e=this;this.resizable=
function(){return(e.style&262144)!=0||(e.style&65536)!=0||(e.style&16777216)!=0||e.showState==3};this.setShowState=function(a){e.showState=a};this.parent=function(){return F.getWinById(e.ownerWinid)};this.resize=function(a,f,g,c){if(L.disableJoinedAppResize&&m.mode==2)return;M("8C1"+e.id+"\t"+a+"\t"+f+"\t"+g+"\t"+c)};this.exeCommand=function(e){M("8C4"+a+"\t"+e)};this.activate=function(e){M("8C3"+a+"\t"+e)};this.close=function(){e.exeCommand(61536)};this.getAppId=function(){M("8C0"+a)};this.isVisible=
function(){return e.winWidth&&e.winHeight&&e.showState&&e.winHeight>45&&e.winWidth>45};this.getAppId()}function Ve(a,e){svGlobal.logger.info("*** -- Alt Sec window Desktop="+a);if((a&1)!=0){svGlobal.logger.info("Desktop non monitored flags="+a);return}if((a&32)!=0){var d=e.getLittleEndian32();svGlobal.logger.info("Desktop monitored flags="+a+" winId="+d);F.setTitle(d);if(!z.getContext()){var f=F.getFocused();if(f)z.setContext(f.context)}}else return;if((a&16)!=0){var g=e.getByte();if(g>0){var c=F.zOrders;
c.length=g;for(var b=0;b<g;b++){c[b]=e.getLittleEndian32();svGlobal.logger.info("---zorders:"+c[b])}}}}function Xe(a){svGlobal.logger.info("***** delete winId="+a);F.delWin(a)}function Ye(a,e,d){if(!T)T=true;var f=(e&268435456)==0;svGlobal.logger.info("\n\n=========== winId="+d+" existed="+f);var g=F.getWinById(d);if(g)f=true;else g=new Ze(d);if(!g){svGlobal.logger.warn("XXX, No win with id:"+d);return}if((e&2)!=0){g["ownerWinid"]=a.getLittleEndian32();svGlobal.logger.info("***** ownerWinid="+g["ownerWinid"])}var c=
false;if((e&8)!=0){c=true;g["style"]=a.getLittleEndian32();g["extStyle"]=a.getLittleEndian32();svGlobal.logger.info("***** winId="+d+" style="+g["style"]+" extStyle="+g["extStyle"]);svGlobal.logger.info("*****--- WS_POPUP="+((g["style"]&2147483648)!=0));svGlobal.logger.info("*****--- WS_DLGFRAME="+((g["style"]&4194304)!=0));svGlobal.logger.info("*****--- DS_MODALFRAME="+((g["style"]&128)!=0));svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+((g["extStyle"]&1)!=0));svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+
((g["extStyle"]&128)!=0));svGlobal.logger.info("*****--- WS_BORDER="+((g["style"]&8388608)!=0));svGlobal.logger.info("*****--- WS_CAPTION="+((g["style"]&12582912)!=0));svGlobal.logger.info("*****--- WS_OVERLAPPED="+((g["style"]&0)!=0));svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+((g["style"]&13565952)!=0));svGlobal.logger.info("*****--- WS_POPUPWINDOW="+((g["style"]&2156396544)!=0));svGlobal.logger.info("*****--- WS_SIZEBOX="+((g["style"]&262144)!=0));svGlobal.logger.info("*****--- WS_CHILD="+
((g["style"]&1073741824)!=0));svGlobal.logger.info("*****--- WS_SIZEBOX="+((g["style"]&262144)!=0));svGlobal.logger.info("*****--- WS_EX_MDICHILD="+((g["extStyle"]&64)!=0));svGlobal.logger.info("*****--- WS_EX_LAYERED="+((g["extStyle"]&524288)!=0))}if((e&16)!=0){g.setShowState(a.getByte());svGlobal.logger.info("***** winId="+d+" showState="+g["showState"]);var b=g["showState"];if(b==2)if(!L.noMinimize)setTimeout(function(){g.exeCommand(61728)},50)}var h=(e&4)!=0;if(h){var k=a.getLittleEndian16();
g["titleInfo"]=a.getUnicodeString(k,false);svGlobal.logger.info("***** winId="+d+" title="+g["titleInfo"])}if((e&16384)!=0){g["clientOffsetX"]=a.getLittleEndian32();g["clientOffsetY"]=a.getLittleEndian32();svGlobal.logger.info("***** winId="+d+" coffX"+g["clientOffsetX"]+" coffY="+g["clientOffsetY"])}if((e&65536)!=0){g["clientAreaWidth"]=a.getLittleEndian32();g["clientAreaHeight"]=a.getLittleEndian32();svGlobal.logger.info("***** winId="+d+" cw"+g["clientAreaWidth"]+" ch="+g["clientAreaHeight"])}if((e&
131072)!=0)g["rpContent"]=a.getLittleEndian32();if((e&262144)!=0)g["rootParentHandle"]=a.getLittleEndian32();if((e&2048)!=0){var m=a.getLittleEndian32();var p=a.getLittleEndian32();g["winOffsetX"]=m;g["winOffsetY"]=p;svGlobal.logger.info("***** winId="+d+" offX"+g["winOffsetX"]+" offY="+g["winOffsetY"])}if((e&32768)!=0){g["winClientDeltaX"]=a.getLittleEndian32();g["winClientDeltaY"]=a.getLittleEndian32();svGlobal.logger.info("***** winId="+d+" dX"+g["winClientDeltaX"]+" dY="+g["winClientDeltaY"])}if((e&
1024)!=0){g["winWidth"]=a.getLittleEndian32();g["winHeight"]=a.getLittleEndian32();svGlobal.logger.info("***** winId="+d+" w"+g["winWidth"]+" h="+g["winHeight"])}if((e&256)!=0){var l=a.getLittleEndian16();if(l>0)a.skipPosition(l*8)}if((e&4096)!=0){g["visibleOffsetX"]=a.getLittleEndian32();g["visibleOffsetY"]=a.getLittleEndian32()}if((e&512)!=0){var r=a.getLittleEndian16();g["numVisibilityRects"]=r;if(r>0)a.skipPosition(r*8)}if(!f)F.addWin(g);else F.onWinChange(g);if(h)F.setTitle(d)}function Ee(a){var e;
var d;var f;var g;e=a.getLittleEndian16();f=a.getLittleEndian16();d=a.getByte();g=a.getPosition()+e+7;if(!a.has(e+7)){ya();return}switch(d){case 0:$e(a);break;case 1:svGlobal.logger.info("TODO: color cache");break;case 2:af(a,f);break;case 3:bf(a);break;case 4:Gc(a,f,false);break;case 5:Gc(a,f,true);break;case 7:svGlobal.logger.info("CacheBrush...=");break;case 8:cf(a,f);break;default:svGlobal.logger.warn("invalid second Order, type="+d);ya()}a.setPosition(g)}function cf(a,e){var d=e&7;e=(e&65408)>>
7;var f=a.getLittleEndian16();a.skipPosition(8);var g=a.getByte();a.skipPosition(2);var c=a.getByte();var b=a.getLittleEndian16();var h=a.getLittleEndian16();var k=a.getLittleEndian32();var m=null;if(c==1){Ib(a,g,b,h,Wa);var p=Wa.getData();var l=Wa.getDataSize();m=new Uint32Array(l);wb(p,0,m,b,h,1);Ga.putBitmap(d,f,new Ua(m,b,h,0,0,32))}else if(c==0){var r=Bb(a.getData(),k,a.getPosition());m=new Uint32Array(r.length);wb(r,0,m,b,h,1);Ga.putBitmap(d,f,new Ua(m,b,h,0,0,32))}else svGlobal.logger.warn("XXX invalid codec id:"+
c);a.skipPosition(k)}function $e(a){var e=a.getByte();a.skipPosition(1);var d=a.getByte();var f=a.getByte();var g=a.getByte();var c=Math.floor((g+7)/8);var b=a.getLittleEndian16();var h=a.getLittleEndian16();var k=a.getPosition();a.skipPosition(b);var m=new Array(d*f*c);m[0]=0;var p=0;var l=d*c;for(var r=0;r<f;r++){p=k+(f-r-1)*l;a.copyToByteArray(m,r*l,p,l)}Ga.putBitmap(e,h,new Ua(Kb(m,c),d,f,0,0,c*8))}function af(a,e){var d=a.getByte();var f=a.getByte();var g=a.getByte();var c=a.getByte();var b=
a.getByte();var h=Math.floor((b+7)/8);var k=a.getLittleEndian16();var m=a.getLittleEndian16();var p=0;if((e&1024)!=0)p=k;else{a.skipPosition(2);p=a.getLittleEndian16();a.skipPosition(2);a.skipPosition(2)}var l;if(h!=1)l=ab(g,c,p,a.getData(),a.getPosition());else l=Lb(g,c,p,a.getData(),a.getPosition());a.skipPosition(p);Ga.putBitmap(d,m,new Ua(l,g,c,0,0,b))}function Gc(a,e,d){var f;var g;var c;var b;var h;var k;var m;var p=0;c=e&7;k=((e&120)>>3)-2;e=(e&65408)>>7;if((e&2)!=0)a.skipPosition(8);if((e&
1)!=0){b=nb.readVar2Bytes(a);h=b}else{b=nb.readVar2Bytes(a);h=nb.readVar2Bytes(a)}p=nb.readVar4Bytes(a);m=nb.readVar2Bytes(a);var l=d&&(e&8)==0;if(l)a.skipPosition(8);if(d){var r;if(k!=1)r=ab(b,h,p,a.getData(),a.getPosition());else r=Lb(b,h,p,a.getData(),a.getPosition());a.skipPosition(p);if(!r){svGlobal.logger.warn("Failed to decompress bitmap data");return}f=new Ua(r,b,h,0,0,k*8)}else{var n=new Array(b*h*k);n[0]=0;var q=a.getPosition();var A=0;var x=b*k;for(g=0;g<h;g++){A=q+(h-g-1)*x;a.copyToByteArray(n,
g*x,A,x)}f=new Ua(Kb(n,k),b,h,0,0,k*8)}Ga.putBitmap(c,m,f);if((e&2)!=0)svGlobal.logger.warn("XXX:TODO, persistent")}function bf(a){var e=null;var d=0;var f=0;var g=0;var c=0;var b=0;var h=0;var k=0;var m=0;d=a.getByte();f=a.getByte();for(var p=0;p<f;p++){g=a.getLittleEndian16();c=a.getLittleEndian16();b=a.getLittleEndian16();h=a.getLittleEndian16();k=a.getLittleEndian16();m=k*Math.floor((h+7)/8)+3&~3;e=new Xb(c,b,h,k,a.getBytes(m));Va.putFont(d,g,e)}}function O(a,e,d){var f=0;if(d){f=a.getByte()<<
24>>24;e+=f;return e}else{e=a.getLittleEndian16()<<16>>16;return e}}function He(a,e){var d=a.getByte();if((d&1)!=0)e.left=O(a,e.left,false);else if((d&16)!=0)e.left=O(a,e.left,true);if((d&2)!=0)e.top=O(a,e.top,false);else if((d&32)!=0)e.top=O(a,e.top,true);if((d&4)!=0)e.right=O(a,e.right,false);else if((d&64)!=0)e.right=O(a,e.right,true);if((d&8)!=0)e.bottom=O(a,e.bottom,false);else if((d&128)!=0)e.bottom=O(a,e.bottom,true)}function Ke(a,e,d,f){if((d&1)!=0)e.x=O(a,e.x,f);if((d&2)!=0)e.y=O(a,e.y,f);
if((d&4)!=0)e.cx=O(a,e.cx,f);if((d&8)!=0)e.cy=O(a,e.cy,f);if((d&16)!=0){e.opcode=a.getByte();e.opcode=e.opcode&3|(e.opcode&48)>>2}if((d&32)!=0)e.backgroundColor=Xa(a);if((d&64)!=0)e.foregroundColor=Xa(a);df(a,e.brush,d>>7);var g=e.x;var c=e.y;if(g>U||c>W)return;var b=e.cx;var h=e.cy;var k=e.opcode;var m=e.backgroundColor;var p=e.foregroundColor;var l=e.brush.xOrigin;var r=e.brush.yOrigin;var n=e.brush.style;var q=e.brush.pattern;ef(k,g,c,b,h,p,m,l,r,n,q)}function Je(a,e,d,f){if((d&1)!=0)e.x=O(a,e.x,
f);if((d&2)!=0)e.y=O(a,e.y,f);if((d&4)!=0)e.cx=O(a,e.cx,f);if((d&8)!=0)e.cy=O(a,e.cy,f);if((d&16)!=0)e.opcode=a.getByte()&15;var g=e.x;var c=e.y;var b=e.cx;var h=e.cy;var k=e.opcode;if(g>P||c>Z)return;var m=g+b-1;if(m>U)m=U;if(g<aa)g=aa;b=m-g+1;var p=c+h-1;if(p>W)p=W;if(c<X)c=X;h=p-c+1;if(b<1||h<1)return;ob(k,z,P,g,c,b,h,null,0,0,0);z.postPaint(g,c,b,h)}function Le(a,e,d,f){if((d&1)!=0)e.x=O(a,e.x,f);if((d&2)!=0)e.y=O(a,e.y,f);if((d&4)!=0)e.cx=O(a,e.cx,f);if((d&8)!=0)e.cy=O(a,e.cy,f);if((d&16)!=0)e.opcode=
a.getByte()&15;if((d&32)!=0)e.srcX=O(a,e.srcX,f);if((d&64)!=0)e.srcY=O(a,e.srcY,f);var g=e.x;var c=e.y;if(g>U||c>W)return;var b=e.cx;var h=e.cy;var k=e.opcode;var m=e.srcX;var p=e.srcY;var l=g+b-1;if(l>U)l=U;if(g<aa)g=aa;b=l-g+1;var r=c+h-1;if(r>W)r=W;if(c<X)c=X;h=r-c+1;m+=g-e.x;p+=c-e.y;if(b<1||h<1)return;if(k==12)z.moveArea(m,p,b,h,g-m,c-p);else ob(k,z,b,g,c,b,h,null,b,m,p);z.postPaint(g,c,b,h)}function Xa(a){var e=0;var d=0;d=a.getByte();e=d;d=a.getByte();e|=d<<8;d=a.getByte();e|=d<<16;return e}
function ff(a,e,d){if((d&1)!=0)e.style=a.getByte();if((d&2)!=0)e.width=a.getByte();if((d&4)!=0)e.color=Xa(a);return true}function Me(a,e,d,f){if((d&1)!=0)e.mixmode=a.getLittleEndian16();if((d&2)!=0)e.startX=O(a,e.startX,f);if((d&4)!=0)e.startY=O(a,e.startY,f);if((d&8)!=0)e.endX=O(a,e.endX,f);if((d&16)!=0)e.endY=O(a,e.endY,f);if((d&32)!=0)e.backgroundColor=Xa(a);if((d&64)!=0)e.opcode=a.getByte();ff(a,e.pen,d>>7);var g=e.startX;var c=e.startY;var b=e.endX;var h=e.endY;var k=e.pen.color;var m=e.opcode-
1;if(c==h){if(g>b){var p=g;g=b;b=p}if(g<aa)g=aa;if(b>U)b=U}else if(g==b){if(c>h){p=c;c=h;h=p}if(c<X)c=X;if(c>W)c=W}Hc(g,c,b,h,k,m)}function Ne(a,e,d,f){if((d&1)!=0)e.x=O(a,e.x,f);if((d&2)!=0)e.y=O(a,e.y,f);if((d&4)!=0)e.cx=O(a,e.cx,f);if((d&8)!=0)e.cy=O(a,e.cy,f);if((d&16)!=0)Fa=Fa&4294967040|a.getByte();if((d&32)!=0)Fa=Fa&4294902015|a.getByte()<<8;if((d&64)!=0)Fa=Fa&4278255615|a.getByte()<<16;e.color=Fa;Mb(e.x,e.y,e.cx,e.cy,e.color,true)}function Oe(a,e,d,f){if((d&1)!=0)e.offset=a.getLittleEndian32();
if((d&2)!=0)e.left=O(a,e.left,f);if((d&4)!=0)e.top=O(a,e.top,f);if((d&8)!=0)e.right=O(a,e.right,f);if((d&16)!=0)e.bottom=O(a,e.bottom,f);if((d&32)!=0)e.action=a.getByte();gf(e)}function Pe(a,e,d,f){if((d&1)!=0){e.cacheID=a.getByte();e.colorTable=a.getByte()}if((d&2)!=0)e.x=O(a,e.x,f);if((d&4)!=0)e.y=O(a,e.y,f);if((d&8)!=0)e.cx=O(a,e.cx,f);if((d&16)!=0)e.cy=O(a,e.cy,f);if((d&32)!=0)e.opcode=a.getByte()&15;if((d&64)!=0)e.srcX=O(a,e.srcX,f);if((d&128)!=0)e.srcY=O(a,e.srcY,f);if((d&256)!=0)e.cacheIDX=
a.getLittleEndian16();if(Ta&&Ta.on)return;var g=e.x;var c=e.y;if(g>U||c>W)return;var b=e.cx;var h=e.cy;var k=e.srcX;var m=e.srcY;var p=g+b-1;if(p>U)p=U;if(g<aa)g=aa;b=p-g+1;var l=c+h-1;if(l>W)l=W;if(c<X)c=X;h=l-c+1;k+=g-e.x;m+=c-e.y;var r=Ga.getBitmap(e.cacheID,e.cacheIDX);if(!r){svGlobal.logger.warn("Failed to get bitmap from cache, id:"+e.cacheID+" idx="+e.cacheIDX);return}var n=r.width;var q=r.height;if(b>n)b=n;if(h>q)h=q;if(e.opcode==12){z.setRGBs(g,c,b,h,r.data,m*n+k,n);z.postPaint(g,c,b,h)}else{ob(e.opcode,
z,P,g,c,b,h,r.data,n,k,m);z.postPaint(g,c,b,h)}}function df(a,e,d){if((d&1)!=0)e.xOrigin=a.getByte();if((d&2)!=0)e.yOrigin=a.getByte();if((d&4)!=0)e.style=a.getByte();var f=e.pattern;if((d&8)!=0)f[0]=a.getByte();if((d&16)!=0)for(var g=1;g<8;g++)f[g]=a.getByte();e.pattern=f}function Qe(a,e,d,f){if((d&1)!=0)e.x=O(a,e.x,f);if((d&2)!=0)e.y=O(a,e.y,f);if((d&4)!=0)e.opcode=a.getByte();if((d&16)!=0)e.foregroundColor=Xa(a);if((d&32)!=0)e.lines=a.getByte();if((d&64)!=0){var g=a.getByte();e.dataSize=g;e.data=
a.getBytes(g)}hf(e)}function Re(a,e,d,f){if((d&1)!=0)e.font=a.getByte();if((d&2)!=0)e.flags=a.getByte();if((d&4)!=0)e.opcode=a.getByte();if((d&8)!=0)e.mixmode=a.getByte();if((d&16)!=0)e.foregroundColor=Xa(a);if((d&32)!=0)e.backgroundColor=Xa(a);if((d&64)!=0)e.clipLeft=a.getLittleEndian16();if((d&128)!=0)e.clipTop=a.getLittleEndian16();if((d&256)!=0)e.clipRight=a.getLittleEndian16();if((d&512)!=0)e.clipBottom=a.getLittleEndian16();if((d&1024)!=0)e.boxLeft=a.getLittleEndian16();if((d&2048)!=0)e.boxTop=
a.getLittleEndian16();if((d&4096)!=0)e.boxRight=a.getLittleEndian16();if((d&8192)!=0)e.boxBottom=a.getLittleEndian16();if((d&16384)!=0)a.skipPosition(1);if((d&32768)!=0)a.skipPosition(1);if((d&65536)!=0)a.skipPosition(1);if((d&131072)!=0)a.skipPosition(1);if((d&262144)!=0)a.skipPosition(7);if((d&524288)!=0)e.x=a.getLittleEndian16();if((d&1048576)!=0)e.y=a.getLittleEndian16();if((d&2097152)!=0){var g=a.getByte();e.length=g;e.text=a.getBytes(g)}var c=e.font;var b=e.flags;var h=e.mixmode;var k=e.foregroundColor;
var m=e.backgroundColor;var p=e.clipLeft;var l=e.clipTop;var r=e.clipRight;var n=e.clipBottom;var q=e.boxLeft;var A=e.boxTop;var x=e.boxRight;var R=e.boxBottom;var I=e.x;var t=e.y;var B=e.length;var D=e.text;var C=r-p;var J=n-l;var y=x-q;var E=R-A;var u=null;var H=0;var ea=0;if(q+y>P)y=P-q;if(y>1)Mb(q,A,y,E,m,false);else if(h==1)Mb(p,l,C,J,m,false);var F=B;for(var oa=0;oa<B;)switch(D[ea+oa]){case 255:var K=D[ea+oa+2];if(K>F-ea){oa=B=0;break}var Da=D.slice?D.slice(ea,ea+K):D.subarray(ea,ea+K);nc(D[ea+
oa+1],Da);oa+=3;B-=oa;ea=oa;oa=0;break;case 254:var Aa=jf(D[ea+oa+1]);if(Aa)if(Aa[1]==0&&(b&32)==0)if((b&4)!=0)t+=D[ea+oa+2];else I+=D[ea+oa+2];if(oa+2<B)oa+=3;else oa+=2;B-=oa;ea=oa;oa=0;if(!Aa)break;var Ma=Aa.length;for(var Ea=0;Ea<Ma;Ea++){u=Va.getFont(c,Aa[Ea]);if((b&32)==0){H=Aa[++Ea];if((H&128)!=0)if((b&4)!=0){t+=Aa[Ea+1]|Aa[Ea+2]<<8;Ea+=2}else{I+=Aa[Ea+1]|Aa[Ea+2]<<8;Ea+=2}else if((b&4)!=0)t+=H;else I+=H}if(u){Ic(h,I+u.offset&65535,t+u.baseLine&65535,u.width,u.height,u.fontData,m,k,bb,Ia);
if((b&32)!=0)I+=u.width}}break;default:u=Va.getFont(c,D[ea+oa]);if((b&32)==0){H=D[ea+ ++oa];if((H&128)!=0)if((b&4)!=0){t+=D[ea+oa+1]|D[ea+oa+2]<<8;oa+=2}else{I+=D[ea+oa+1]|D[ea+oa+2]<<8;oa+=2}else if((b&4)!=0)t+=H;else I+=H}if(u){Ic(h,I+u.offset&65535,t+u.baseLine&65535,u.width,u.height,u.fontData,m,k,bb,Ia);if((b&32)!=0)I+=u.width}oa++}if(y>1){if(E>0)z.postPaint(q,A,y,E)}else if(C>0&&J>0)z.postPaint(p,l,C,J)}function tc(a){var e=0;var d=0;var f=0;var g=0;var c=0;var b=0;var h=0;var k=0;var m=0;var p=
0;var l=0;var r=0;var n=a.getLittleEndian16();for(var q=0;q<n;q++){if(!a.has(18)){ya();return}e=a.getLittleEndian16();d=a.getLittleEndian16();f=a.getLittleEndian16();g=a.getLittleEndian16();c=a.getLittleEndian16();b=a.getLittleEndian16();m=a.getLittleEndian16();p=a.getLittleEndian16();l=a.getLittleEndian16();if(!a.has(l)){ya();return}h=f-e+1;k=g-d+1;if(Ia!=m){svGlobal.logger.warn("Server limited colour depth to "+m+" bits");if(!Nb)ib(m);else if(Nb>1){ya();return}Nb++}if(p==0){var A=c*bb;var x=b*A;
var y=new Uint8Array(x);var I=a.getPosition();for(var t=0;t<b;t++){Na(a.getData(),I,y,(b-t-1)*A,A);I+=A}a.skipPosition(x);Jc(y,e,d,c,b,h,k,bb);continue}if((p&1024)!=0)r=l;else{a.skipPosition(2);r=a.getLittleEndian16();a.skipPosition(4)}kf(a.getData(),r,a.getPosition(),c,b,e,d,h,k,bb);a.skipPosition(r)}}function Hd(a){var e=JSON.parse(a);if(m.onnotify)m.onnotify(e);if(!e.name){if(svGlobal.log>0)console.erro("No error code for message:"+a);return}svGlobal.logger.info("msg="+a);if(e.type&&m.onerror)m.onerror(e);
var d=__svi18n.errorCode["S"+e.name]||"";d+=e.message;m.showMessage(d,null);Ka=true}function Id(a){F.drawLicense(a)}function Bf(a){var e=a.split("\t");var d=parseInt(e[0],10);var f=parseInt(e[1],10);lf(d,f,false)}function lf(a,e,d){}function Ie(a){aa=a.left;if(aa<0)aa=0;X=a.top;if(X<0)X=0;U=a.right;if(U>=P)U=P-1;W=a.bottom;if(W>=Z)W=Z-1}function ac(){aa=0;U=P-1;X=0;W=Z-1}function mf(a,e,d,f,g,c){var b;var h;if(e==f)if(d>a){h=d-a;if(h<1)return;for(b=0;b<h;b++)pb(c,z,a+b,e,g);z.postPaint(a,e,h+1,1)}else{h=
a-d;if(h<1)return;for(b=0;b<h;b++)pb(c,z,d+b,e,g);z.postPaint(d,e,h+1,1)}else if(f>e){h=f-e;if(h<1)return;for(b=0;b<h;b++)pb(c,z,a,e+b,g);z.postPaint(a,e,1,h+1)}else{h=e-f;if(h<1)return;for(b=0;b<h;b++)pb(c,z,a,f+b,g);z.postPaint(a,f,1,h+1)}}function Hc(a,e,d,f,g,c){var b=Math.min(a,d);var h=Math.max(a,d);var k=Math.min(e,f);var m=Math.max(e,f);g=ta(g);var p=b>=aa&&h<=U&&k>=X&&m<=W;if(!p){if(b>U||h<aa||k>W||m<X)return;var l=0;if(a==d){if(e>f){l=e;e=f;f=l}if(e<X)e=X;if(f>W)f=W}else if(e==f){if(a>d){l=
a;a=d;d=l}if(a<aa)a=aa;if(d>U)d=U}else{var r=Y._line;r.set(a,e,d,f);var n=r.intersection(aa,X,U,X);var q=[];if(n.onLine1&&n.onLine2)q.push(n.x,n.y);n=r.intersection(U,X,U,W);if(n.onLine1&&n.onLine2)q.push(n.x,n.y);n=r.intersection(aa,W,U,W);if(n.onLine1&&n.onLine2)q.push(n.x,n.y);n=r.intersection(aa,X,aa,W);if(n.onLine1&&n.onLine2)q.push(n.x,n.y);if(q.length==2)if(a>=aa&&a<=U&&e>=X&&e<=W)q.push(a,e);else if(d>=aa&&d<=U&&f>=X&&f<=W)q.push(d,f);if(q.length!=4)return;a=q[0];e=q[1];d=q[2];f=q[3]}}if(c==
12)z.drawLine(a,e,d,f,g);else if(a==d||e==f)mf(a,e,d,f,g,c);else{var A=Math.abs(d-a);var x=Math.abs(f-e);var y=a;var I=e;var t;var B;var D;var C;var J;var F;var E;var u;if(d>=a){t=1;B=1}else{t=-1;B=-1}if(f>=e){D=1;C=1}else{D=-1;C=-1}if(A>=x){t=0;C=0;F=A;J=A/2>>0;E=x;u=A}else{B=0;D=0;F=x;J=x/2>>0;E=A;u=x}if(u<1)return;for(var H=0;H<=u;H++){pb(c,z,y,I,g);J+=E;if(J>=F){J-=F;y+=t;I+=D}y+=B;I+=C}}b=Math.min(a,d);h=Math.max(a,d);k=Math.min(e,f);m=Math.max(e,f);if(h-b<0)return;if(m-k<0)return;z.postPaint(b,
k,h-b+1,m-k+1)}function gf(a){var e=a.right-a.left+1;var d=a.bottom-a.top+1;if(a.action==0)nf(a.offset,a.left,a.top,e,d);else of(a.offset,e,d,a.left,a.top)}function nf(a,e,d,f,g){if(f<1||g<1)return;mb.save(e,d,f,g,a,z.getRGBs(e,d,f,g))}function of(a,e,d,f,g){var c=mb.restore(f,g,e,d,a);if(!c){svGlobal.logger.warn("XXX no matched desktop save.");return}z.setRGBs(f,g,e,d,c,0,e);z.postPaint(f,g,e,d)}function hf(a){var e=a.x;var d=a.y;var f=a.foregroundColor;var g=a.lines;var c=a.dataSize;var b=a.data;
var h=new Array(1);h[0]=Math.floor((g-1)/4)+1;var k=0;var m=0;var p=a.opcode-1;for(var l=0;l<g&&h[0]<c;l++){var r=e;var n=d;if(l%4==0)k=b[m++];if((k&192)==0)k|=192;if((k&64)!=0)e+=Kc(b,h);if((k&128)!=0)d+=Kc(b,h);Hc(r,n,e,d,f,p);k<<=2}}function Ic(a,e,d,f,g,c,b,h,k,m){var p=128;h=ta(h);b=ta(b);if(e>U||d>W)return;var l=e+f-1;if(l>U)l=U;var r=e<aa?aa:e;var n=l-e+1;var q=d+g-1;if(q>W)q=W;var A=d<X?X:d;var x=q-d+1;if(n<1||x<1)return;var y=A!=d||n!=f||x!=g||r!=e;var I=0;var t=0;var B=z.setRGB;if(!y)if(a==
0)for(var D=0;D<g;D++){I=d+D;for(var C=0;C<f;C++){if(p==0){t++;p=128}if((c[t]&p)!=0)B(e+C,I,h);p>>=1}t++;p=128;if(t==c.length)t=0}else for(D=0;D<g;D++){I=d+D;for(C=0;C<f;C++){if(p==0){t++;p=128}if((c[t]&p)!=0)B(e+C,I,h);else B(e+C,I,b);p>>=1}t++;p=128;if(t==c.length)t=0}else if(a==0)for(D=0;D<x;D++){I=d+D;for(C=0;C<n;C++){if(p==0){t++;p=128}if(e+C>=r&&I>=A)if((c[t]&p)!=0)B(e+C,I,h);p>>=1}t++;p=128;if(t==c.length)t=0}else for(D=0;D<x;D++){I=d+D;for(C=0;C<n;C++){if(p==0){t++;p=128}if(e+C>=r&&d+D>=A)if((c[t]&
p)!=0)B(e+C,I,h);else B(e+C,I,b);p>>=1}t++;p=128;if(t==c.length)t=0}}function ef(a,e,d,f,g,c,b,h,k,m,p){c=ta(c);b=ta(b);var l=e+f-1;if(l>U)l=U;if(e<aa)e=aa;f=l-e+1;var r=d+g-1;if(r>W)r=W;if(d<X)d=X;g=r-d+1;if(f<1||g<1)return;var n=null;switch(m){case 0:n=new Uint32Array(f*g);for(var q=0;q<n.length;q++)n[q]=c;ob(a,z,P,e,d,f,g,n,f,0,0);z.postPaint(e,d,f,g);if(f==1)F.execute("setCaretPos",[e,d]);break;case 2:svGlobal.logger.warn("hatch");break;case 3:var A=p;n=new Uint32Array(f*g);var x=0;for(q=0;q<
g;q++)for(var y=0;y<f;y++){if((A[(q+k)%8]&1<<(y+h)%8)==0)n[x]=c;else n[x]=b;x++}ob(a,z,P,e,d,f,g,n,f,0,0);z.postPaint(e,d,f,g);break;default:svGlobal.logger.warn("Unsupported brush style "+m)}}function Kc(a,e){var d=a[e[0]++]&255;var f=d&128;if((d&64)!=0)d|=~63;else d&=63;if(f!=0)d=d<<8|a[e[0]++]&255;return d}function Mb(a,e,d,f,g,c){if(a>U||e>W)return;var b=a+d-1;if(b>U)b=U;if(a<aa)a=aa;d=b-a+1;var h=e+f-1;if(h>W)h=W;if(e<X)e=X;f=h-e+1;if(d<1||f<1)return;z.fillRect(a,e,d,f,ta(g));z.postPaint(a,e,
d,f)}function Jc(a,e,d,f,g,c,b,h,k){if(!k)k=0;var m=Kb(a,h);z.setRGBs(e,d,c,b,m,k,f);z.postPaint(e,d,c,b)}function kf(a,e,d,f,g,c,b,h,k,m){if(h*k*f*g<1)return;if(m!=1){z.setRGBs(c,b,h,k,ab(f,g,e,a,d),0,f);z.postPaint(c,b,h,k)}else Jc(Lb(f,g,e,a,d),c,b,f,g,h,k,m)}function zd(a){return hi5.Base64.dec(a,0)}function Ra(a){if(!m)return;svGlobal.logger.warn("closed "+(m.sessionInfo.appInfo?m.sessionInfo.appInfo.numericId:0));var e=ec();if(e&&m.sessionInfo.appInfo&&m.mode==0)sessionStorage[e]=m.sessionInfo.appInfo.session;
if(m){var d=m.mode==0;if(!fa&&d)Zb("connection");var f=d&&(fa||eb<m.reconnectTimes)&&eb>0&&!Ka;fa=false;wa=false;if(f){eb--;m.showMessage(__svi18n.info.reconnecting+" "+(m.reconnectTimes-eb)+"/"+m.reconnectTimes,null,3E3);setTimeout(fc,5);svGlobal.logger.info("Reconnecting..."+eb);return}}if(Fb){svGlobal.logger.info("Req credential");return}Y=null;if(ra){ra.release();ra=null}mb=null;Ga=null;db=null;Va=null;sa=null;if(typeof rdp8bulkData!="undefined")rdp8bulkData.release();y=null;Cc=null;Wa=null;Ib=
null;Lc=null;ga=null;if(ia){ia.close();ia=null}if(Pa)hi5.Arrays.release(Pa);if(Qa)hi5.Arrays.release(Qa);oc();if(na){na.close();na=null}if(pa){pa.stop();pa=null}try{if(Ja!=null){Ja.exit();Ja=null}if(m.onclose)m.onclose(Ka);else svGlobal.logger.info("onclose: null");if(F){F.close();F=null}}catch(g){}la=null;if(Q){Q.onopen=null;Q.onmessage=null;Q.onclose=null;Q.onerror=null;Q=null}Sa=null;vb=null;F=null;if(z){z.release();z=null}if(ua){ua.release();ua=null}m=null;if(!hi5.browser.isChromeApp)window.removeEventListener("unload",
Ra,false);else chrome.runtime.onSuspend.removeListener(Ra);if(window&&window.$rdp)window.$rdp=null}function xb(a,e,d,f,g,c,b){var h=g*d+f;var k=a.setRGB;var m=a.getRGB;for(var p=0;p<b;p++){for(var l=0;l<c;l++){if(a){var r=m(f+l,g+p);k(f+l,g+p,~r&ca)}else e[h]=~e[h]&ca;h++}h+=d-c}}function pf(a,e,d,f,g,c){var b=a.setRGB;for(var h=d;h<d+g;h++)for(var k=f;k<f+c;k++)b(h,k,0)}function qf(a,e,d,f,g,c){var b=a.setRGB;for(var h=d;h<d+g;h++)for(var k=f;k<f+c;k++)b(h,k,ca)}function Mc(a,e,d,f,g,c,b,h,k){if(!c)a.moveArea(h,
k,f,g,e-h,d-k);else a.setRGBs(e,d,f,g,c,k*b+h,b)}function ob(a,e,d,f,g,c,b,h,k,m,p){if(c<0|b<0|d<0|k<0)return;switch(a){case 0:pf(e,d,f,g,c,b);break;case 1:rf(e,d,f,g,c,b,h,k,m,p);break;case 2:sf(e,d,f,g,c,b,h,k,m,p);break;case 3:xb(e,h,k,m,p,c,b);Mc(e,f,g,c,b,h,k,m,p);break;case 4:xb(e,null,d,f,g,c,b);Nc(e,d,f,g,c,b,h,k,m,p);break;case 5:xb(e,null,d,f,g,c,b);break;case 6:tf(e,d,f,g,c,b,h,k,m,p);break;case 7:uf(e,d,f,g,c,b,h,k,m,p);break;case 8:Nc(e,d,f,g,c,b,h,k,m,p);break;case 9:vf(e,d,f,g,c,b,
h,k,m,p);break;case 10:break;case 11:wf(e,d,f,g,c,b,h,k,m,p);break;case 12:Mc(e,f,g,c,b,h,k,m,p);break;case 13:xb(e,null,d,f,g,c,b);Oc(e,d,f,g,c,b,h,k,m,p);break;case 14:Oc(e,d,f,g,c,b,h,k,m,p);break;case 15:qf(e,d,f,g,c,b);break;default:svGlobal.logger.warn("unsupported opcode: "+a)}}function pb(a,e,d,f,g){if(!e)return;var c=e.getRGB(d,f);switch(a){case 0:e.setRGB(d,f,0);break;case 1:e.setRGB(d,f,~(c|g)&ca);break;case 2:e.setRGB(d,f,c&(~g&ca));break;case 3:e.setRGB(d,f,~g&ca);break;case 4:e.setRGB(d,
f,(~c&g)*ca);break;case 5:e.setRGB(d,f,~c&ca);break;case 6:e.setRGB(d,f,c^g&ca);break;case 7:e.setRGB(d,f,~c&g&ca);break;case 8:e.setRGB(d,f,c&(g&ca));break;case 9:e.setRGB(d,f,c^~g&ca);break;case 10:break;case 11:e.setRGB(d,f,c|~g&ca);break;case 12:e.setRGB(d,f,g);break;case 13:e.setRGB(d,f,(~c|g)&ca);break;case 14:e.setRGB(d,f,c|g&ca);break;case 15:e.setRGB(d,f,ca);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+a);e.setRGB(d,f,g)}}function rf(a,e,d,f,g,c,b,h,k,m){var p=m*h+k;var l=
a.setRGB;var r=a.getRGB;for(var n=0;n<c;n++){for(var q=0;q<g;q++)l(d+g,f+c,~(r(d+g,f+c)|b[p])&ca);p+=h-g}}function sf(a,e,d,f,g,c,b,h,k,m){var p=m*h+k;var l=a.setRGB;var r=a.getRGB;for(var n=0;n<c;n++){for(var q=0;q<g;q++){var A=r(d+g,f+c);l(d+g,f+c,A&(~b[p]&ca));p++}p+=h-g}}function tf(a,e,d,f,g,c,b,h,k,m){var p=m*h+k;var l=a.setRGB;var r=a.getRGB;for(var n=0;n<c;n++){for(var q=0;q<g;q++){var A=r(d+q,f+n);l(d+q,f+n,A^b[p]&ca);p++}p+=h-g}}function uf(a,e,d,f,g,c,b,h,k,m){var p=m*h+k;var l=a.setRGB;
var r=a.getRGB;for(var n=0;n<c;n++){for(var q=0;q<g;q++){var A=r(d+q,f+n);l(d+q,f+n,~(A&b[p])&ca);p++}p+=h-g}}function Nc(a,e,d,f,g,c,b,h,k,m){var p=m*h+k;var l=a.setRGB;var r=a.getRGB;for(var n=0;n<c;n++){for(var q=0;q<g;q++){var A=r(d+q,f+n);l(d+q,f+n,A&(b[p]&ca));p++}p+=h-g}}function vf(a,e,d,f,g,c,b,h,k,m){var p=m*h+k;var l=a.setRGB;var r=a.getRGB;for(var n=0;n<c;n++){for(var q=0;q<g;q++){var A=r(d+q,f+n);l(d+q,f+n,A^~b[p]&ca);p++}p+=h-g}}function wf(a,e,d,f,g,c,b,h,k,m){var p=m*h+k;var l=a.setRGB;
var r=a.getRGB;for(var n=0;n<c;n++){for(var q=0;q<g;q++){var A=r(d+q,f+n);l(d+q,f+n,A|~b[p]&ca);p++}p+=h-g}}function Oc(a,e,d,f,g,c,b,h,k,m){var p=m*h+k;var l=a.setRGB;var r=a.getRGB;for(var n=0;n<c;n++){for(var q=0;q<g;q++){var A=r(d+q,f+n);l(d+q,f+n,A|b[p]&ca);p++}p+=h-g}}function nc(a,e){var d=sa[a];if(d)d=null;sa[a]=e}function jf(a){var e=sa[a];if(e)return e;return null}function Fc(a,e,d,f){switch(e){case 16:xf(a,d,f);break;case 15:yf(a,d,f);break;case 8:d[f]=Y.paletteRdp[0][a];d[f+1]=Y.paletteRdp[1][a];
d[f+2]=Y.paletteRdp[2][a];d[f+3]=255;break;case 32:d[f]=a&255;d[f+1]=a>>8&255;d[f+2]=a>>16&255;d[f+3]=a>>24&255;default:d[f]=a&255;d[f+1]=a>>8&255;d[f+2]=a>>16&255;d[f+3]=255}}function yf(a,e,d){var f=a>>7&248;var g=a>>2&248;var c=a<<3&255;f|=f>>5;g|=g>>5;c|=c>>5;e[d]=f;e[d+1]=g;e[d+2]=c;e[d+3]=255}function xf(a,e,d){var f=a>>8&248;var g=a>>3&252;var c=a<<3&255;f|=f>>5;g|=g>>6;c|=c>>5;e[d]=f;e[d+1]=g;e[d+2]=c;e[d+3]=255}function Kb(a,e){var d=a.length/e>>0;var f=new Uint32Array(d);var g=ta;switch(e){case 1:for(var c=
0;c<d;c++)f[c]=g(a[c]);break;case 2:for(c=0;c<d;c++)f[c]=g(a[c*2+1]<<8|a[c*2]);break;default:for(c=0;c<d;c++)f[c]=g(a[c*e+2]<<16)|a[c*e+1]<<8|a[c*e]}return f}function Lb(a,e,d,f,g){var c=f;var b=-1;var h=0;var k=g;var m=0;var p=d+k;var l=0;var r=0;var n=0;var q=a;var A=-1;var x=0;var y=0;var I=0;var t=0;var B=0;var D=0;var C=4294967295;var z=false;var F=false;var E=false;var u=new Array(a*e);for(u[0]=0;k<p;){x=0;y=c[k++];l=y>>4;switch(l){case 12:case 13:case 14:l-=6;r=y&15;n=16;break;case 15:l=y&
15;if(l<9){r=c[k++];r|=c[k++]<<8}else r=l<11?8:1;n=0;break;default:l>>=1;r=y&31;n=32}if(n!=0){E=l==2||l==7;if(r==0)if(E)r=c[k++]+1;else r=c[k++]+n;else if(E)r<<=3}switch(l){case 0:if(A==l&&!(q==a&&b==-1))z=true;break;case 8:I=c[k++];case 3:t=c[k++];break;case 6:case 7:C=c[k++];l-=5;break;case 9:D=3;l=2;x=3;break;case 10:D=5;l=2;x=5}A=l;for(B=0;r>0;){if(q>=a){q=0;e--;b=h;h=m+e*a}switch(l){case 0:if(z){if(b==-1)u[h+q]=C;else u[h+q]=u[b+q]^C;z=false;r--;q++}if(b==-1){for(;(r&~7)!=0&&q+8<a;)for(var H=
0;H<8;H++){u[h+q]=0;r--;q++}for(;r>0&&q<a;){u[h+q]=0;r--;q++}}else{for(;(r&~7)!=0&&q+8<a;)for(H=0;H<8;H++){u[h+q]=u[b+q];r--;q++}for(;r>0&&q<a;){u[h+q]=u[b+q];r--;q++}}break;case 1:if(b==-1){for(;(r&~7)!=0&&q+8<a;)for(H=0;H<8;H++){u[h+q]=C;r--;q++}for(;r>0&&q<a;){u[h+q]=C;r--;q++}}else{for(;(r&~7)!=0&&q+8<a;)for(H=0;H<8;H++){u[h+q]=u[b+q]^C;r--;q++}for(;r>0&&q<a;){u[h+q]=u[b+q]^C;r--;q++}}break;case 2:if(b==-1){for(;(r&~7)!=0&&q+8<a;)for(H=0;H<8;H++){B<<=1;B=B&255;if(B==0){D=x!=0?x:c[k++];B=1}if((D&
B)!=0)u[h+q]=C;else u[h+q]=0;r--;q++}for(;r>0&&q<a;){B<<=1;B=B&255;if(B==0){D=x!=0?x:c[k++];B=1}if((D&B)!=0)u[h+q]=C;else u[h+q]=0;r--;q++}}else{for(;(r&~7)!=0&&q+8<a;)for(H=0;H<8;H++){B<<=1;B=B&255;if(B==0){D=x!=0?x:c[k++];B=1}if((D&B)!=0)u[h+q]=u[b+q]^C;else u[h+q]=u[b+q];r--;q++}for(;r>0&&q<a;){B<<=1;B=B&255;if(B==0){D=x!=0?x:c[k++];B=1}if((D&B)!=0)u[h+q]=u[b+q]^C;else u[h+q]=u[b+q];r--;q++}}break;case 3:for(;(r&~7)!=0&&q+8<a;)for(H=0;H<8;H++){u[h+q]=t;r--;q++}for(;r>0&&q<a;){u[h+q]=t;r--;q++}break;
case 4:for(;(r&~7)!=0&&q+8<a;)for(H=0;H<8;H++){u[h+q]=c[k++];r--;q++}for(;r>0&&q<a;){u[h+q]=c[k++];r--;q++}break;case 8:for(;(r&~7)!=0&&q+8<a;)for(H=0;H<8;H++){if(F){u[h+q]=t;F=false}else{u[h+q]=I;F=true;r++}r--;q++}for(;r>0&&q<a;){if(F){u[h+q]=t;F=false}else{u[h+q]=I;F=true;r++}r--;q++}break;case 13:for(;(r&~7)!=0&&q+8<a;)for(H=0;H<8;H++){u[h+q]=255;r--;q++}for(;r>0&&q<a;){u[h+q]=255;r--;q++}break;case 14:for(;(r&~7)!=0&&q+8<a;)for(H=0;H<8;H++){u[h+q]=0;r--;q++}for(;r>0&&q<a;){u[h+q]=0;r--;q++}break;
default:r--;q++}}}return u}this.reconnectOnResize=true;this.displayMsg=true;this.appTimeout=1600;this.reconnectTimes=0;this.windowState=3;this.openLink=true;this.setTitle=true;this.audioBuffer=0;this.sessionInfo={domain:"",userName:"",sessionId:0,joinedSessions:[],suppressOutput:false,appInfo:null};this.mode=0;this.remoteAppLogin=true;var ub=false;var Pa={};var Qa={};var kb=null;var m=this;var Ka=false;var Fb=false;var wa=false;var Nb=0;var va=0;var L=hi5.appcfg||{img:{},toolbar:{fadable:true}};this.setConfig=
function(a){L=a};var cb=typeof y=="object"?y:null;var x=cb?{}:hi5.tool.queryToObj(y.substring(y.indexOf("?")+1));var P=0|0;var Z=0|0;var Ia=(Ya||x.color||x.server_bpp||16)|0;var Na=hi5.Arrays.arraycopy;var Ha=hi5.Arrays.fill;var fb=null;var K=null;var pa=null;var Ta=L.updateFix?new rb:null;this.protocol=cb?"":y.substring(0,y.indexOf("://")).toLowerCase();this.setProfiler=function(a){K=a};this.getProfiler=function(){return K};this.gateway=function(){if(cb)return"";var a=y.lastIndexOf("/RDP?");if(a==
-1)a=y.lastIndexOf("/JOIN?");if(a==-1)a=y.lastIndexOf("/PLAY?");var e=y.substring(0,a);return e.replace(/wss\:\/\//ig,"https://").replace(/ws\:\/\//ig,"http://")}();svGlobal.logger.warn("Ver:"+svGlobal.version+" build:"+svGlobal.build);var xa=typeof y=="object"||y.indexOf("/PLAY?")>0;var Pc=!xa&&y.indexOf("invitation=")>0;if(Pc){var Ob=decodeURIComponent(y);var yb=Ob.indexOf(' USERNAME="');if(yb>0){yb+=11;var Qc=Ob.substring(yb,Ob.indexOf('"',yb));y+="&novice="+Qc+"&server="+Qc}y+="&mapClipboard=on"}if(xa){this.mode=
1;if(cb)y="";else{P=640|0;Z=480|0}y+="&touchpad=on";this.reconnectOnResize=false}else if(y.indexOf("/JOIN?")>0||Pc){this.mode=2;this.reconnectOnResize=false}if(ja==undefined)P=(x.width||window.innerWidth)|0;else P=ja|0;if(da==undefined)Z=(x.height||Ca(window.innerHeight))|0;else Z=da|0;if(P==-1)P=screen.width|0;else if(P==0)P=window.innerWidth|0;if(Z==-1)Z=screen.height|0;else if(Z==0)Z=window.innerHeight|0;if(x.symlink&&x.parameters)hi5.tool.queryToObj(x.parameters,x);if(!x.gateway)y+="&gateway="+
encodeURIComponent(m.gateway);if(!x.minWidth&&L.minWidth)rdArgs.minWidth=L.minWidth;if(!x.minHeight&&L.minHeight)rdArgs.minHeight=L.minHeight;if(x.minWidth)x.minWidth=parseInt(x.minWidth);if(x.minHeight)x.minHeight=parseInt(x.minHeight);if(x.waWidth)x.waWidth=parseInt(x.waWidth);if(x.waHeight)x.waHeight=parseInt(x.waHeight);if(!("useSSL"in x))y+="&useSSL="+(m.protocol=="wss");if(hi5.storage.isAvailable&&!gb(x.shareClipboard))if(qa(x.shareClipboard)||x.shareClipboardId||qa(x.mapClipboard)&&x.shareClipboard==
undefined)y+="&shareClipboardId="+(x.shareClipboardId||La());if(L){if(L.displayMsg!=undefined)this.displayMsg=L.displayMsg;else L.displayMsg=this.displayMsg;if(L.appTimeout)this.appTimeout=L.appTimeout;if(L.reconnectOnResize!=undefined)this.reconnectOnResize=L.reconnectOnResize;if(L.reconnectTimes)this.reconnectTimes=L.reconnectTimes;if(L.windowState!=undefined)this.windowState=L.windowState;if(L.openLink!=undefined)this.openLink=L.openLink;if(L.setTitle!=undefined)this.setTitle=L.setTitle;if(L.audioBuffer)this.audioBuffer=
L.audioBuffer;if(typeof L.useWSS=="boolean")y=(L.useWSS?"wss":"ws")+y.substring(y.indexOf("://"));if(typeof L.remoteAppLogin=="boolean"){this.remoteAppLogin=L.remoteAppLogin;ub=!L.remoteAppLogin;svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")}if(typeof L.hideLogin=="boolean")ub=L.hideLogin}var eb=this.reconnectTimes;this.server=Za();this.port=parseInt(x.port,10);this.loadbalanceToken=L.loadbalanceTokenName?L.loadbalanceTokenName+"="+hi5.tool.uuid():"";this.modifyURL=
function(a){if(m.loadbalanceToken)a+="&"+m.loadbalanceToken;return a};this.getURL=function(){return y};this.getColor=function(){return Ia};var hb=hi5.graphic.Rectangle;var ua=new function(){function a(a){return a&511^a>>>9^a>>>4^a>>>7}function e(a){return a&31^a>>>5^a>>>9}function d(a){var b;b=(a>>>8^a&255)>>>2&15;if(a>>>9!=0)b=~b;b=b&65535;return b%12}function f(a){var b;b=a>>>4&15;return(b^b>>>2^b>>>3)&3}function g(a){a=(a&1431655765)<<1|a>>>1&1431655765;a=(a&858993459)<<2|a>>>2&858993459;a=(a&
252645135)<<4|a>>>4&252645135;if(a>>>8==0)return a;a=(a&16711935)<<8|a>>>8&16711935;if(a>>>16==0)return a;a=(a&65535)<<16|a>>>16&65535;return a}function c(b){var e=y[a(b)];if((e^b)>>>9!=0)return e&511;else return y[I[d(b)]]}function b(a){var b=B[e(a)];if((b^a)>>>5!=0)return b&31;else return B[D[f(a)]]}function h(a,b){var e=a[2]|a[3]<<16;e<<=16;a[2]=e&65535;a[3]=e>>>16&65535;var d=a[0]|a[1]<<16;e|=d>>>16;a[2]=e&65535;a[3]=e>>>16&65535;d=d<<16|b;a[0]=d&65535;a[1]=d>>>16&65535}function k(a,b){var e=
a[0];a[0]=a[b];a[b]=e}function m(a,e,d,f){var p=r;var v=n;var u=l;var B=0|0;var D=0;var y=0;var I;var R=0;var M=e;var L=0|0;var O=0;var ma=0;var V=0;var P=0;var ha=0|0;if(K)K.begin("decData6");A=0;q=u;if((f&64)!=0){Na(p,u-32768,p,0,32768);u=32768;l=u;q=32768}if((f&128)!=0){u=0;Ha(p,0,65536,0);Ha(v,0,v.length,0);q=0}if((f&32)!=32){Na(a,0,p,u,d);u+=d;A=u-l;l=u;return 0}V=0;for(var Q=e+d;M<Q;){ha=a[M++];B|=ha<<V;O+=8;V+=8;if(V>=32)break}B=g(B);if(M<Q){L=g(a[M++])&255;ma=8}else ma=0;for(;O>=8;){D=0;for(P=
5;P<=13;P++){if(P==12)continue;ha=g(B&4294967295<<32-P);ha=c(ha);if(P==x[ha])break}B<<=P;O-=P;if(ha<256)p[u++]=ha&255;else if(ha>256&&ha<289){I=ha-257;V=C[I];D=z[I]-1;if(V!=0)D+=g(B&4294967295<<32-V);h(v,D);B<<=V;O-=V}else if(ha>288&&ha<293){I=ha-289;D=v[I];if(I!=0)k(v,I)}else if(ha==256)break;for(V=32-O;V>0;)if(ma<V){ha=L>>>8-ma;B|=ha<<32-O-ma;O+=ma;V-=ma;if(M<Q){L=g(a[M++])&255;ma=8}else{V=0;ma=0}}else if(ma>V){B|=L>>>8-V;L<<=V;L&=255;ma-=V;O=32;break}else{B|=L>>>8-V;O=32;if(M<Q){L=g(a[M++])&255;
ma=8}else ma=0;break}if(D==0)continue;for(P=2;P<=9;P++){ha=g(B&4294967295<<32-P);ha=b(ha);if(P==t[ha])break}B<<=P;O-=P;V=F[ha];y=E[ha];if(V!=0)y+=g(B&4294967295<<32-V);B<<=V;O-=V;R=u-D;V=y>D?D:y;for(ha=0;V>0;){p[u++]=p[R++];V--}for(;y>D;){ha=ha>=D?0:ha;p[u++]=p[R+ha++];y--}for(V=32-O;V>0;)if(ma<V){ha=L>>>8-ma;B|=ha<<32-O-ma;O+=ma;V-=ma;if(M<Q){L=g(a[M++])&255;ma=8}else{V=0;ma=0}}else if(ma>V){B|=L>>>8-V;L<<=V;L&=255;ma-=V;O=32;break}else{B|=L>>>8-V;O=32;if(M<Q){L=g(a[M++])&255;ma=8}else ma=0;break}}if((f&
128)!=0)A=u;else A=u-l;l=u;if(K)K.end("decData6");return 0}function p(a,b,e,d){var f;var g=0;var c;var h=0;var n;var k;var m;var p;var u;var t=(d&1)!=0;var v=r;if(K)K.begin("decData5");if((d&32)==0){q=0;A=e;return 0}if((d&64)!=0)l=0;if((d&128)!=0){for(var B=65536;--B>=0;)v[B]=0;l=0}q=0;A=0;c=l;n=c;p=n;q=p;if(e==0)return 0;e+=h;do{if(g==0){if(h>=e)break;c=a[b+h++]<<24;g=8}if(c>=0){if(g<8){if(h>=e){if(c!=0)return-1;break}c|=a[b+h++]<<24-g;g+=8}if(n>=65536)return-1;v[n++]=c>>>24&255;c<<=8;g-=8;continue}c<<=
1;if(--g==0){if(h>=e)return-1;c=a[b+h++]<<24;g=8}if(c>=0){if(g<8){if(h>=e)return-1;c|=a[b+h++]<<24-g;g+=8}if(n>=65536)return-1;v[n++]=(c>>>24|128)&255;c<<=8;g-=8;continue}c<<=1;if(--g<(t?3:2)){if(h>=e)return-1;c|=a[b+h++]<<24-g;g+=8}if(t)switch(c>>>29){case 7:for(;g<9;g+=8){if(h>=e)return-1;c|=a[b+h++]<<24-g}c<<=3;k=c>>>26;c<<=6;g-=9;break;case 6:for(;g<11;g+=8){if(h>=e)return-1;c|=a[b+h++]<<24-g}c<<=3;k=(c>>>24)+64;c<<=8;g-=11;break;case 5:case 4:for(;g<13;g+=8){if(h>=e)return-1;c|=a[b+h++]<<24-
g}c<<=2;k=(c>>>21)+320;c<<=11;g-=13;break;default:for(;g<17;g+=8){if(h>=e)return-1;c|=a[b+h++]<<24-g}c<<=1;k=(c>>>16)+2368;c<<=16;g-=17}else switch(c>>>30){case 3:if(g<8){if(h>=e)return-1;c|=a[b+h++]<<24-g;g+=8}c<<=2;k=c>>>26;c<<=6;g-=8;break;case 2:for(;g<10;g+=8){if(h>=e)return-1;c|=a[b+h++]<<24-g}c<<=2;k=(c>>>24)+64;c<<=8;g-=10;break;default:for(;g<14;g+=8){if(h>=e)return-1;c|=a[b+h++]<<24-g}k=(c>>>18)+320;c<<=14;g-=14}if(g==0){if(h>=e)return-1;c=a[b+h++]<<24;g=8}m=0;if(c>=0){m=3;c<<=1;g--}else{u=
t?14:11;do{c<<=1;if(--g==0){if(h>=e)return-1;c=a[b+h++]<<24;g=8}if(c>=0)break;if(--u==0)return-1}while(true);m=(t?16:13)-u;c<<=1;if(--g<m)for(;g<m;g+=8){if(h>=e)return-1;c|=a[b+h++]<<24-g}u=m;m=c>>>32-u&~(-1<<u)|1<<u;c<<=u;g-=u}if(n+m>=65536)return-1;f=n-k&(t?65535:8191);do v[n++]=v[f++];while(--m!=0)}while(true);l=n;q=p;A=n-p;if(K)K.end("decData5");return 0}var l=0;var r=new Uint8Array(65536);var n=new Int32Array(8);var q=0;var A=0;var x=[6,6,6,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,9,8,9,9,9,9,8,8,9,9,9,
9,9,9,8,9,9,10,9,9,9,9,9,9,9,10,9,10,10,10,9,9,10,9,10,9,10,9,9,9,10,10,9,10,9,9,8,9,9,9,9,10,10,10,9,9,10,10,10,10,10,10,9,9,10,10,10,10,10,10,10,9,10,10,10,10,10,10,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,10,10,10,10,10,10,9,10,10,10,10,10,10,9,7,9,9,10,9,10,10,10,9,10,10,10,10,10,10,10,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,13,10,10,10,10,10,10,11,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,10,10,10,10,9,10,10,10,10,10,9,10,10,10,9,10,10,10,
10,10,10,10,10,10,10,10,10,10,10,10,9,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,8,9,9,10,9,10,10,10,9,10,10,10,9,9,8,7,13,13,7,7,10,7,7,6,6,6,6,5,6,6,6,5,6,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,8,5,6,7,7];var y=[123,65311,65293,65063,65024,65285,65303,65128,197,65031,65299,65216,65288,65048,65307,65203,65027,162,65090,65296,65035,65026,65169,65305,65152,233,65082,65301,65042,87,65239,65309,65294,65077,65129,65314,65304,65146,65025,65315,65300,65268,65204,65033,65308,65220,65289,65120,65136,65298,65029,
65170,65185,65306,65039,65287,65110,65302,65282,65240,65256,65310,65053,59,65535,65286,65535,65137,65161,65535,65535,65068,65067,65056,65535,65211,65231,65032,65535,65248,65037,65535,65177,65535,65028,65194,65097,65535,65047,65121,65247,65535,65279,65270,65100,65535,65535,65159,65535,65316,65535,65084,65138,65535,65535,65230,65535,65278,65535,65059,65212,65034,65193,65535,65041,65535,65154,65535,65030,65178,65269,65535,65058,65101,65119,65535,65283,65249,65535,65226,65228,65535,65049,65535,65207,
65535,65535,65155,65065,65535,65535,65535,65132,65535,65261,65535,65535,65094,65116,65045,65535,65243,65190,65535,65535,65092,65535,65036,65535,65173,65276,65535,65535,65208,5833,65535,65264,65535,65080,65535,65535,65133,65150,65535,65535,65535,65535,65115,65244,65535,65535,65260,65095,65055,65535,65151,65174,65535,65535,65189,65535,65040,65088,65074,65215,65535,65535,65236,65265,65535,65535,65535,65141,65535,65535,65165,65073,65535,65125,65051,65535,65252,65275,65535,65535,65106,65535,65038,65535,
65181,65199,65535,65535,65105,65235,65535,65312,65535,65071,65535,65535,65217,65164,65535,65535,65535,65087,65535,65535,65142,65535,65274,65107,65061,65535,65124,65253,65535,65535,65198,65535,65043,65535,65160,65182,65535,65091,65535,65535,65188,65171,65535,65535,65535,65085,65535,65535,65259,65241,65535,65044,65114,65535,65064,65149,65535,65535,65130,65535,65535,65281,65222,65224,65535,65535,65205,65535,65535,65535,65172,65144,65535,65535,65535,65187,65535,65535,65242,65112,65535,65054,65093,65258,
65535,65131,65535,65535,65079,65535,65535,65535,65148,65206,65535,65535,65272,65535,65535,65535,65223,65179,65535,65535,65535,65104,65535,65535,65197,65250,65535,65050,65123,65102,65535,65535,65273,65535,65139,65535,65535,65535,65072,65163,65535,65535,65213,65070,256,65535,65262,65234,65535,65535,65535,65196,65535,65535,65180,65156,65535,65060,65103,65271,65535,65535,65251,65122,65535,65535,65535,65535,65162,65140,65535,65535,65086,65535,65535,65535,65233,65214,65535,65535,65069,65535,65098,65267,
65535,65535,65245,65118,65046,65535,65096,65192,65535,65195,65175,65535,65535,65232,65535,65535,65229,65209,65535,65535,65535,65066,65535,65535,65158,65134,65535,65535,65535,65246,65535,65535,65117,65099,65057,65535,65263,65176,65535,65535,65153,65535,65535,65535,65191,65535,65210,65277,65535,65535,65535,65227,65535,65535,65135,65081,65535,65535,65535,65157,65535,268,65254,65127,65052,65535,65108,65202,65535,65535,65183,65535,65535,65535,65113,65201,65535,65218,65535,65535,65078,65266,65535,65535,
65238,65143,65535,65535,65535,65075,65535,65535,65167,65109,65062,266,65284,65255,65535,289,65126,65535,65535,65535,65200,65184,65535,271,65168,65535,65535,65237,65535,65535,65219,65076,65535,65535,65535,65166,65535,273,65145,65089,267];var I=[511,0,508,448,494,347,486,482];var t=[4,2,3,4,3,4,4,5,4,5,5,6,6,7,7,8,7,8,8,9,9,8,9,9,9,9,9,9,9,9,9,9];var B=[4065,4064,4066,4072,14,4069,4068,4074,4081,4067,21,4071,4079,70,4080,4077,4095,4087,4091,25,4093,4084,300,4075,4094,4086,4090,137,4092,4083,4088,4082];
var D=[0,4,10,19];var C=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,14,14,15];var z=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,32769,49153,65537];var F=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,6,6,8,8,14,14];var E=[2,3,4,5,6,7,8,9,10,12,14,16,18,22,26,30,34,42,50,58,66,82,98,114,130,194,258,514,2,2];var u=new RdpBuffer(r,0,1);this.reset=function(){l=0;r=new Uint8Array(65536);q=0;A=0;u=new RdpBuffer(r,
0,1)};this.release=function(){n=null;u=null;r=null};this.getData=function(){u.setPosition(q);u.markEnd(q+A);return u};this.toPDU=function(){var a=new Uint8Array(65536+8+32);a[0]=29;a[2]=1;a[3]=2;a[4]=l;a[5]=l>>8;a[6]=l>>16;a[7]=l>>24;a.set(r,8);a.set(new Uint8Array(n.buffer),65536+8);return a};this.fromStream=function(a){l=a.getLittleEndian32();var b=a.getPosition();r.set(a.getData().subarray(b,b+65536));a.skipPosition(65536);for(var e=0;e<8;e++)n[e]=a.getLittleEndian32()};this.getDecompressedLength=
function(){return A};this.dec=function(a,b,e,d){if((d&15)==2)return m(a,b,e,d);else return p(a,b,e,d)}};var we=y.indexOf("nocurosr=on")>0;var T=y.indexOf("startProgram=app")>0;var Gb=y.indexOf("mapDisk=on")>0;var ra=null;if(T)this.reconnectOnResize=false;if(hi5.browser.isTouch)if(Math.max(P,Z)>Math.max(window.innerWidth,window.innerHeight))this.reconnectOnResize=false;this.isRemoteApp=function(){return T};Tb();var Q=null;var fa=false;var Oa=false;var na=new Zd(m.audioBuffer);var z=new Sb(P,Z);this.setVolume=
function(a){if(na)na.setVolume(a)};this.setAudioBuffer=function(a){m.audioBuffer=a;na.delay=a;if(Rc)Rc.delay=a};var Rc=null;var sa=new Array;var aa=0;var X=0;var U=P-1;var W=Z-1;var jb=null;var bb=0;window.$rdp=this;var Ja=null;var ta=Ub;var ab=Vb;ib(Ia);this.running=function(){return fa};this.setJoinMode=function(a){if(!fa)return;M("8E1"+a)};this.setJoinCloseMode=function(a){if(!fa)return;M("8EB3\t"+a)};this.refuseControl=function(a){if(!fa)return;M("8E3"+a)};this.giveControl=function(a){if(!fa)return;
M("8E4"+a)};this.pauseSession=function(a,e){if(!fa)return;M("8EB"+(e?1:0)+"\t"+a)};this.closeSession=function(a){if(!fa)return;M("8EB2"+"\t"+a)};this.requestControl=function(){if(!fa)return;M("8E2")};this.saveSession=function(a){if(!fa)return;M("8E9"+(a.save?1:0)+"\t"+(a.timeout||0)+"\t"+(a.id||0))};this.allowJoin=function(a,e){if(!fa)return;M("8EA"+a+"\t"+(e?1:0))};var Pb=new function(){function a(){if(d&&d.length>0){var e=d.shift();Pb.sendSingleKey(e.down,e.key);if(d.length>0)setTimeout(a,f);else d=
null}}var e={" ":57,"space":57,"pageup":201,"pagedown":209,"end":207,"home":199,"left":203,"up":200,"right":205,"down":208,"printscreen":183,"insert":210,"del":211,"delete":211,"altgr":184,"windows":219,"windowsright":220,"context":221,"esc":1,"backspace":14,"tab":15,"enter":28,"meta":29,"command":29,"ctrl":29,"shift":42,"alt":56,"capslock":58,"f1":59,"f2":60,"f3":61,"f4":62,"f5":63,"f6":64,"f7":65,"f8":66,"f9":67,"f10":68,"f11":87,"f12":88,"numlock":69,"scrolllock":70,"add":78};this.sendSingleKey=
function(a,d){var b=e[d.toLowerCase()];if(b)m.writeScancode(a,b);else{var f=d.length;if(f==0)return;if(f==1)m.writeKeyCode(a,d.toUpperCase().charCodeAt(0));else if(a)m.writeText(d)}};var d=null;var f=0;this.sendKeyComb=function(e,c){if(!wa)return;var b=e.split("+");var h=b.length;var k=0;if(h==0)return;var m=null;var p=new Array;for(k=0;k<h;k++){var l=b[k];if(l==""&&m=="")l="Add";if(l!="")p.push({"key":l,"down":true});m=l}h=p.length;for(k=h-1;k>=0;k--)p.push({"key":p[k].key,"down":false});if(!c)for(k=
0,h=p.length;k<h;k++)Pb.sendSingleKey(p[k].down,p[k].key);else{d=p;f=c;a()}}};this.writeKeyComb=function(a,e){if(wa)Pb.sendKeyComb(a,e)};this.writeText=function(a,e){if(wa)if(e){var d=0;var f=false;var g=0;for(var c=a.length;g<c;g++){d=a.charCodeAt(g);if(d>64&&d<91)f=true;else{f=false;if(d>96&&d<123)d-=32}if(f)this.writeScancode(true,42);this.writeKeyCode(true,d);this.writeKeyCode(false,d);if(f)this.writeScancode(false,42)}}else M("86"+a)};var Sa=new function e(){this.capsLock=this.numLock=false;
this.setJoinMode=m.setJoinMode;this.requestControl=m.requestControl;this.writeKeyComb=m.writeKeyComb;this.writeText=m.writeText;this.draw=z.draw;this.refresh=function(e,d,c,b){return z.repaint(e,d,c-e+1,b-d+1)};this.getAppMode=function(){return m.mode};this.send=function(e){if(!fa)return;M(e)};this.saveSession=function(e){m.saveSession(e)};this.sendInput=function(e){if(wa&&!z.isPaused()){Zc(e);M(e);if(m.onactivity)m.onactivity(e)}};var d=null;this.getAppInfo=function(){return m.sessionInfo.appInfo};
this.onresize=function(e){var g=e.target.svSurface;if(!g)return;var c=g.getFreeSpace();var b=c.width;var h=c.height;if(T){M("8C6"+61441+"\t"+b+"\t"+h);return}if(m.reconnectOnResize&&fa){var k=function(){svGlobal.logger.warn("w:"+b+" ww:"+P+" h:"+h+" hh:"+Z);m.reconnect(b,h,L.forceReconnect)};if(d){clearTimeout(d);d=0}d=setTimeout(k,333)}};this.onorientationchange=function(e){var d=Ca(e.innerHeight);if(m.reconnectOnResize)m.reconnect(e.innerWidth,d);else if(T){if(!e.svSurface)return;if(m.windowState)M("8C6"+
61441+"\t"+e.innerWidth+"\t"+d)}};this.getClipData=qd;this.onfocus=function(e){var d=e.target;if(T&&d.svSurface&&d.svSurface.railWin){var c=d.svSurface.railWin.getTopWin(F.zOrders);if(!c||!Q)return;var b=d.svSurface.context;if(b&&b!=z.getContext()){z.setContext(null);c.activate(1);svGlobal.logger.info("Activate win:"+c.id)}}};this.getShareFiles=function(e,d){if(Oa&&ra)ra.list(e,d)};this.getFile=function(e){m.reconnectOnResize=false;window.open(m.getFileUrl(e))};this.getFileLink=function(e){return m.modifyURL(za()+
"/DOWNLOAD?s="+jb+"&f="+e)};this.getGateway=function(){return y};this.reconnect=function(e,d,c){if(x.symlink){var b="user="+e+"&pwd="+d;if(c)b+="&domain="+c;y=hi5.tool.replaceQuery(y,"parameters",b)}else{y=hi5.tool.replaceQuery(y,"user",e);y=hi5.tool.replaceQuery(y,"pwd",d);y=hi5.tool.replaceQuery(y,"domain",c)}m.run()};this.sendKeyboardSynchronize=function(e,d,c){if(xa)return;var b=0;if(c)b=b|4;if(d)b=b|2;if(e)b=b|1;M("8E5"+b);Sa.capsLock=c;Sa.numLock=d};this.fromSyncedSurface=function(e){return F.fromSyncedSurface(e)}};
var F=function d(){var f=[];f.repaint=function(d,c,b,h){var k=0;for(var m=f.length;k<m;k++)f[k].repaint(d,c,b,h)};f.addSurface=function(d){f.push(d)};f.hasSurface=function(d){var c=f.length;for(var b=0;b<c;b++)if(f[b].equals(d))return true;return false};f.fromSyncedSurface=function(d){var c=f.length;var b=Date.now();for(var h=0;h<c;h++)if(f[h].isClipSynced(d))return true;return false};f.setSize=function(d,c,b){var h=0;for(var k=f.length;h<k;h++)f[h].setSize(d,c,b)};f.zOrders=new Array;f.drawLicense=
function(d){var c=0;for(var b=f.length;c<b;c++)f[c].drawLicense(d)};f.setReadOnly=function(d){var c=0;for(var b=f.length;c<b;c++)f[c].setReadOnly(d)};f.setVisible=function(d,f){svGlobal.logger.info("TODO: setVisible")};f.copyToClip=function(d){if(f.length<1)return;f[0].copyToClip(d)};f.setCursor=function(d){var c=0;for(var b=f.length;c<b;c++)f[c].setCursor(d)};f.hide=function(d){var c=0;for(var b=f.length;c<b;c++)if(T)f[c].getWindow().close();else f[c].hide()};f.execute=function(d,c){var b=0;for(var h=
f.length;b<h;b++)f[b][d].apply(f[b],c)};f.addWin=function(d){var c=f.getFocused();if(!c){svGlobal.logger.warn("Focused surface not found!");c=f[f.length-1]}if(!c){svGlobal.logger.warn("No surface available!");return}T=true;if(!c.railWin){c.railWin=new rd;c.onunload=function(){if(L.closeRemoteApp)if(c.railWin)c.railWin.close();if(c.remoteApp)c.remoteApp.close();if(c.railWin){c.railWin.clear();c.railWin=null}f.removeElm(c)}}if(c.context)z.setContext(c.context);c.railWin.addWin(d);if(m.windowState){var b=
c.railWin.mainWin==d;if(b)setTimeout(function(){var b=c.getFreeSpace();M("8C6"+61441+"\t"+b.width+"\t"+b.height);setTimeout(function(){d.exeCommand(61488)},50)},111)}if(hi5.browser.isIE)c.focus()};f.delWin=function(d){var c;for(var b=f.length-1;b>=0;b--){var h=f[b];c=h.railWin;var k=c.getWinById(d);var v=k&&k.appId&&k.appId.toLowerCase().indexOf("runonce")!=-1;if(c.delWin(d)>=0){if(k==c.mainWin)c.mainWin=null;if(!c.hasApp(k.appId)){var p=function(b){return function(){svGlobal.logger.info("Start del:"+
Date.now());if(!b.railWin||!b.railWin.isRunning()){if(b.remoteApp)b.remoteApp.close();f.delSurface(b)}}};var l=m.appTimeout;if(v||c.isNew())l*=10;svGlobal.logger.debug("Prepare del:"+Date.now());setTimeout(p(h),l)}}}};f.popWins=function(d){return f[0]&&f[0].railWin?f[0].railWin.popWins(d):[]};f.getWinById=function(d){var c;var b=0;for(var h=f.length;b<h;b++)if(f[b].railWin){c=f[b].railWin.getWinById(d);if(c)return c}return null};f.onWinChange=function(d){var c;var b=0;for(var h=f.length;b<h;b++)if(f[b].railWin){c=
f[b].railWin.getWinById(d.id);if(c)f[b].railWin.onchange(d)}};f.setTitle=function(d){var c;var b=0;for(var h=f.length;b<h;b++)if(f[b].railWin){c=f[b].railWin.getWinById(d);if(c&&c.titleInfo&&c.isVisible()){zb(c.titleInfo+" - "+Za(),f[b].getWindow());return}}};f.hasApp=function(d){var c=0;for(var b=f.length;c<b;c++)if(f[c].railWin.hasApp(d))return true;return false};f.delSurface=function(d){if(!d||d.railWin&&d.railWin.isRunning())return;svGlobal.logger.info("delete surface...");f.removeElm(d);d.close();
if(f.length==0)Ra()};f.getOwnerSurface=function(d){var c=0;for(var b=f.length;c<b;c++)if(f[c].railWin&&f[c].railWin.hasWin(d))return f[c];return null};f.getFocused=function(){var d=f.length;for(var c=0;c<d;c++)if(f[c].focused)return f[c];return f[d-1]};f.close=function(){var d=0;for(var c=f.length;d<c;d++)if(f[d]){if(f[d].remoteApp)f[d].remoteApp.close();f[d].close();f[d]=null}};return f}();this.getSurfaces=function(){return F};this.hide=function(){if(!F)return;F.hide()};var ga=null;var ia={count:0,
names:[],close:function(){var d=ia.names;var f=0;for(var g=d.length;f<g;f++)if(ia[d[f]].onclose){ia[d[f]].onclose();ia[d[f]]=null}d.length=0;d=null},init:function(d,f,g,c){function b(){this.WAVE_FORMAT_PCM=1;this.WAVE_FORMAT_ADPCM=2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=85;this.WAVE_FORMAT_AAC=41222;this.formatTag=0;this.nChannels=0;this.nSamplesPerSec=0;this.nAvgBytesPerSec=0;this.nBlockAlign=0;this.bitsPerSample=0;this.hasLocalSupport=
false;this.cbSize=0;this.extenstion=null;var b=this;this.fromBuffer=function(d){b.formatTag=d.getLittleEndian16();b.nChannels=d.getLittleEndian16();b.nSamplesPerSec=d.getLittleEndian32();b.nAvgBytesPerSec=d.getLittleEndian32();b.nBlockAlign=d.getLittleEndian16();b.bitsPerSample=d.getLittleEndian16();var f=d.getLittleEndian16();b.cbSize=f;if(f>0){b.extenstion=new Array(f);d.copyToByteArray(b.extenstion,0,d.getPosition(),f);d.skipPosition(f)}};this.toBuffer=function(d){d.setLittleEndian16(b.formatTag);
d.setLittleEndian16(b.nChannels);d.setLittleEndian32(b.nSamplesPerSec);d.setLittleEndian32(b.nAvgBytesPerSec);d.setLittleEndian16(b.nBlockAlign);d.setLittleEndian16(b.bitsPerSample);d.setLittleEndian16(b.cbSize);if(b.cbSize>0)d.setBytes(b.extenstion)};this.getSize=function(){return 18+b.cbSize};this.toString=function(){return"Audio Format, tag="+b.formatTag+" nChannels="+b.nChannels+" nSamplesPerSec="+b.nSamplesPerSec+" nAvgBytesPerSec"+b.nAvgBytesPerSec+" nBlockAlign"+b.nBlockAlign+" bitsPerSample"+
b.bitsPerSample+" cbSize="+b.cbSize}}function h(){var b=new m.DynamicChannel;b.name="TSMF";var d={type:"image/jpeg"};var f=new Array(1);b.process=function(c){var g=c.getPosition();var h;var l=0;var k=0;var m;var p=0;var v=0;var x=0;var y;var E=c.getLittleEndian32();var u=E&1073741823;var H=u>>>30;var F=c.getLittleEndian32();var K=c.getLittleEndian32();switch(u){case 2:if(K==256){var L=c.getLittleEndian32();h=new Uint8Array(16);y=new RdpBuffer(h,0,16);y.setLittleEndian32(2|0);y.setLittleEndian32(F);
y.setLittleEndian32(1);y.setLittleEndian32(0);b.send(h)}break;case 0:switch(K){case 257:m=c.getBytes(16);v=c.getLittleEndian32();break;case 256:g=c.getPosition();var M=c.getLittleEndian32();var Da=0;var O=0;for(x=0;x<M;x++){Da=c.getLittleEndian32();O=c.getLittleEndian32();k=c.getLittleEndian32();c.skipPosition(O-4)}l=c.getPosition()-g;k=l+8+4;h=new Uint8Array(k);y=new RdpBuffer(h,0,k);y.setLittleEndian32(0|2147483648);y.setLittleEndian32(F);h.set(c.getData().subarray(g,c.getPosition()),8);b.send(h);
break;case 261:m=c.getBytes(16);p=c.getLittleEndian32();break;case 264:p=c.getLittleEndian32();c.skipPosition(4);var P=c.getLittleEndian32();var Q;var U;var W=0;var Z=0;var Y=0;var aa;var X=0;Q=c.getBytes(16);U=c.getBytes(16);W=c.getLittleEndian32();Z=c.getLittleEndian32();Y=c.getLittleEndian32();aa=c.getBytes(16);X=c.getLittleEndian32();c.skipPosition(X);h=new Uint8Array(20);y=new RdpBuffer(h,0,20);y.setLittleEndian32(0|2147483648);y.setLittleEndian32(F);if(hi5.Arrays.equals([118,105,100,115,0,0,
16,0,128,0,0,170,0,56,155,113],Q)&&hi5.Arrays.equals([77,74,80,71,0,0,16,0,128,0,0,170,0,56,155,113],U)&&hi5.Arrays.equals([128,159,88,5,86,195,206,17,191,1,0,170,0,85,89,90],aa))y.setLittleEndian32(1);else{y.setLittleEndian32(0);svGlobal.logger.warn("Format is not supported:");svGlobal.logger.warn(Q);svGlobal.logger.warn(U);svGlobal.logger.warn(aa)}y.setLittleEndian32(p);b.send(h);break;case 261:m=c.getBytes(16);p=c.getLittleEndian32();break;case 258:m=c.getBytes(16);v=c.getLittleEndian32();P=c.getLittleEndian32();
c.skipPosition(P);break;case 263:m=c.getBytes(16);h=new Uint8Array(16);y=new RdpBuffer(h,0,16);y.setLittleEndian32(0|2147483648);y.setLittleEndian32(F);y.setLittleEndian32(1);b.send(h);case 277:m=c.getBytes(16);v=c.getLittleEndian32();break;case 262:m=c.getBytes(16);z.flushImgs();z.setImgRect(0,0,0,0);h=new Uint8Array(12);y=new RdpBuffer(h,0,12);y.setLittleEndian32(0|2147483648);y.setLittleEndian32(F);b.send(h);break;case 278:m=c.getBytes(16);var ma=c.getLittleEndian32();var V=c.getLittleEndian32();
var ba=c.getLittleEndian32();var ha=c.getLittleEndian32();z.setImgRect(ma,V,ba-ma,ha-V);break;case 265:m=c.getBytes(16);var fa=c.getLittleEndian64();var ia=c.getLittleEndian32()==1;break;case 266:m=c.getBytes(16);break;case 268:m=c.getBytes(16);break;case 267:m=c.getBytes(16);break;case 269:m=c.getBytes(16);var ja=c.getLittleEndian32();break;case 274:break;case 275:break;case 259:m=c.getBytes(16);v=c.getLittleEndian32();l=c.getLittleEndian32();c.skipPosition(32);l=c.getLittleEndian32();var na=new Image;
g=c.getPosition();f[0]=c.getData().subarray(g,g+l);var ca=new Blob(f,d);na.src=URL.createObjectURL(ca);z.addImg(na);break;case 270:z.flushImgs();break;case 273:break;case 260:break;case 276:m=c.getBytes(16);l=c.getLittleEndian32();g=c.getPosition()+l;c.skipPosition(8);var T=c.getLittleEndian32();svGlobal.logger.info("window state:"+T);var Sc=c.getLittleEndian32();var da=c.getLittleEndian32();ma=c.getLittleEndian32();V=c.getLittleEndian32();c.skipPosition(8);var ga=c.getLittleEndian32();var la=c.getLittleEndian32();
svGlobal.logger.info("Window rect, left:"+ma+" top:"+V+" w:"+Sc+" h:"+da+" cl:"+ga+" ct:"+la);c.setPosition(g);var pa=c.getLittleEndian32();for(g=c.getPosition()+pa;c.getPosition()<g;){var ra=c.getLittleEndian32();var qa=c.getLittleEndian32();var sa=c.getLittleEndian32();var ua=c.getLittleEndian32();svGlobal.logger.info("visible region, l:"+qa+" t:"+ra+" r:"+ua+" b:"+sa)}z.setImgRect(ma,V,Sc,da);break;case 1:case 2:break;default:svGlobal.logger.warn("unknown function:"+K)}break;default:svGlobal.logger.warn("unkown interface:"+
u)}};return b}function k(){ga=new m.DynamicChannel;ga.name="Microsoft::Windows::RDS::DisplayControl";ga.enabled=false;ga.process=function(b){var d=b.getLittleEndian32();var f=b.getLittleEndian32();switch(d){case 5:var c=b.getLittleEndian32();ga.maxMonitorAreaFactorA=b.getLittleEndian32();ga.maxMonitorAreaFactorB=b.getLittleEndian32();ga.enabled=true;svGlobal.logger.warn("Display control maxNumMonitors:"+c+" factorA:"+ga.maxMonitorAreaFactorA+" factorB:"+ga.maxMonitorAreaFactorB);b=new Uint8Array(2);
b[0]=146;b[1]=4;Q.send(b.buffer);case 2:}};ga.applyResolution=function(b,d){if(ga.enabled){var f=new Uint8Array(56);var c=new RdpBuffer(f,0,56);if(b>ga.maxMonitorAreaFactorA)b=ga.maxMonitorAreaFactorA;else b=$a(b);if(d>ga.maxMonitorAreaFactorB)d=ga.maxMonitorAreaFactorB;else d=$a(d);c.setLittleEndian32(2);c.setLittleEndian32(56);c.setLittleEndian32(40);c.setLittleEndian32(1);c.setLittleEndian32(1);c.setLittleEndian32(0);c.setLittleEndian32(0);c.setLittleEndian32(b);c.setLittleEndian32(d);c.setLittleEndian32(b*
.26458|0);c.setLittleEndian32(d*.26458|0);c.setLittleEndian32(b>d?0:90);c.setLittleEndian32(100);c.setLittleEndian32(100);ga.send(f);svGlobal.logger.warn("Display control: "+b+"x"+d)}else svGlobal.logger.warn("Display control disabled.")};return ga}function v(d){var f=false;var c=0;var g=0;var h=0;var l=0;var k=[];var p=new Uint8Array(4);audioPlayback=new m.DynamicChannel;audioPlayback.name="AUDIO_PLAYBACK_DVC";audioPlayback.onclose=function(){};audioPlayback.process=function(m){function v(f){f.skipPosition(14);
var c=f.getLittleEndian16();var g=f.getByte();var h=f.getLittleEndian16();f.skipPosition(1);var l=0;var n=false;k.length=0;for(var m=0;m<c;m++){var p=new b;p.fromBuffer(f);n=p.nSamplesPerSec>=22050&&(p.formatTag==1||p.formatTag==49&&p.nSamplesPerSec==22050&&d==0);if(n)k.push(p)}var q=20;l=k.length;for(m=0;m<l;m++)q=q+k[m].getSize();var u=q+4;var t=new RdpBuffer(new Uint8Array(u),0,u);t.setByte(7);t.setByte(2);t.setLittleEndian16(q);t.setLittleEndian32(1|2);t.setLittleEndian32(4294967295);t.setLittleEndian32(0);
t.setLittleEndian16(0);t.setLittleEndian16(l);t.skipPosition(1);t.setLittleEndian16(h);t.setByte(124);for(m=0;m<l;m++){p=k[m];p.toBuffer(t)}t.markEnd();audioPlayback.send(t);if(h>5){t=new RdpBuffer(new Uint8Array(8),0,8);t.setByte(12);t.skipPosition(1);t.setLittleEndian16(4);t.setLittleEndian16(0);t.setLittleEndian16(0);t.markEnd();audioPlayback.send(t)}}function x(b){var d=b.getLittleEndian16();var f=b.getLittleEndian16();var c=new RdpBuffer(new Uint8Array(8),0,8);c.setByte(6);c.setByte(35);c.setLittleEndian16(4);
c.setLittleEndian16(d);c.setLittleEndian16(f);c.markEnd();audioPlayback.send(c)}function y(){var b=k[h];if(b.formatTag!=ba.tag||b.nSamplesPerSec!=ba.samplePerSec||ba.channels!=b.nChannels){ba.tag=b.formatTag;ba.channels=b.nChannels;ba.samplePerSec=b.nSamplesPerSec;ba.bitsPerSample=b.formatTag==49?8:b.bitsPerSample}}function z(b){g=b.getLittleEndian16();h=b.getLittleEndian16();l=b.getByte();b.skipPosition(3);p[0]=b.getByte();p[1]=b.getByte();p[2]=b.getByte();p[3]=b.getByte();f=true;y()}function E(b,
d){var f=new RdpBuffer(new Uint8Array(8),0,8);f.setByte(5);f.skipPosition(1);f.setLittleEndian16(4);f.setLittleEndian16(b);f.setByte(d);f.skipPosition(1);f.markEnd();audioPlayback.send(f)}function u(b,d){return function(){E(b,d)}}function H(b){f=false;var d=c-8;var h=Date.now();b.copyFromByteArray(p,0,b.getPosition(),4);var m=Hb(b,l,g,d);m=(m-na.delay)*1E3;var k=g+(Date.now()-h)+m;E(k,l)}function F(b){var d=Date.now();g=b.getLittleEndian16();h=b.getLittleEndian16();l=b.getByte();b.skipPosition(7);
y();var f=Hb(b,l,g,0);f=(f-na.delay)*1E3;var c=g+(Date.now()-d)+f;E(c,l)}if(f){H(m);return}var K=m.getByte();m.skipPosition(1);c=m.getLittleEndian16();switch(K){case 7:v(m);break;case 6:x(m);break;case 2:z(m);break;case 1:closed=true;break;case 3:var L=m.getLittleEndian16();var M=m.getLittleEndian16();break;case 4:break;case 13:F(m);default:}};return audioPlayback}if(L.disableDVC||!d&&!f&&!g&&!L.enableTSMF)return;ia.count=0;ia.names.length=0;if(d){var p=new m.DynamicChannel;p.name="Microsoft::Windows::RDS::Input";
p.process=function(b){var d=b.getLittleEndian16();var f=b.getLittleEndian32();switch(d){case 1:b.skipPosition(4);var c=new RdpBuffer(new Uint8Array(16),0,16);c.setLittleEndian16(2);c.setLittleEndian32(16);c.setLittleEndian32(1|2);c.setLittleEndian32(65536);c.setLittleEndian16(256);c.markEnd();p.send(c);case 5:F.execute("setTouchRemoting",[true]);ia.isTouchReady=true;svGlobal.logger.info("Touch remoting start");break;case 4:F.execute("setTouchRemoting",[false]);ia.isTouchReady=false;svGlobal.logger.info("Touch remoting suspend")}};
m.addDynamicChannel(p)}if(g){svGlobal.logger.warn("Audio input on");var l=new m.DynamicChannel;(function n(){function d(f){var c=f.getLittleEndian32();var g=f.getLittleEndian32();var h=[];var n=[];var m=0;var k=na.getContext().sampleRate;for(m=0;m<c;m++){var p=new b;p.fromBuffer(f);if(p.formatTag==49&&p.nSamplesPerSec==22050){p.hasLocalSupport=true;h.push(p)}else if(p.formatTag==1&&p.nSamplesPerSec==k&&p.nChannels==2)n.push(p)}l.send(v);var q=0;g=h.length;if(g==0){h=n;g=n.length;u.directInput=true}for(m=
0;m<g;m++)q+=h[m].getSize();var t=new RdpBuffer(new Uint8Array(1024),0,1024);t.setByte(2);t.setLittleEndian32(g);t.setLittleEndian32(q+9);for(m=0;m<g;m++)h[m].toBuffer(t);t.skipPosition(1024-q-9);t.markEnd();l.send(t)}function f(b){var d=new RdpBuffer(new Uint8Array(5),0,5);d.setByte(7);d.setLittleEndian32(b);d.markEnd();l.send(d)}function c(d){var g=d.getLittleEndian32();var h=d.getLittleEndian32();var n=new b;n.fromBuffer(d);x=true;y=m.reconnectOnResize;m.reconnectOnResize=false;if(!u.onopen)u.onopen=
function(b){if(fa){p=b;m.reconnectOnResize=y;f(h);var d=new RdpBuffer(new Uint8Array(5),0,5);d.setByte(4);d.setLittleEndian32(b?0:1);d.markEnd();l.send(d)}};if(!u.ondata)u.ondata=function(b,d){if(p){if(z.length!=d+1){z=new Uint8Array(d+1);z[0]=6}l.send(v);z.set(b,1);l.send(z)}};u.start()}function g(b){var d=b.getLittleEndian32();if(!x){f(d);x=false}}function h(b){function d(f){x=true;if(n.onopen)n.onopen(true);E=new k;g=f;l=b.createMediaStreamSource(f);var h=n.directInput?1024:4096;m=b.createJavaScriptNode?
b.createJavaScriptNode(h,1,1):b.createScriptProcessor(h,1,1);if(n.directInput&&!y)y=new Int16Array(2048);m.onaudioprocess=function(b){if(!c)return;var d=b.inputBuffer.getChannelData(0);if(n.directInput){var f=0;var g=0;for(var h=0;h<1024;h++){g=d[h]*32767;y[f++]=g;y[f++]=g}u.ondata(new Uint8Array(y.buffer),4196)}else A.addData(d,v);d.fill(0)};var p=b.createBiquadFilter();p.frequency.value=q/2;l.connect(p);p.connect(m);m.connect(b.destination)}function f(){if(!c){if(g&&g.getTracks){var b=g.getTracks()[0];
b.stop()}m&&m.disconnect();l&&l.disconnect();x=false}}var c=false;var g=null;var l=null;var m=null;var n=this;var p=b.sampleRate;var q=22050;var v=p/q;var x=false;this.directInput=false;n=this;var y;this.start=function(){if(!x)navigator.getUserMedia({audio:true},d,function(b){x=false;c=false;if(n.onopen)n.onopen(false);svGlobal.logger.warn("Error on getUserMedia: "+b)});else if(n.onopen)n.onopen(true);c=true};this.stop=function(){c=false};this.close=function(){c=false;if(A)A.reset();E=new k;f()};
var A=new function(){function b(d){var m=l/g|0;for(var n=0;n<m;n++){f(d,h);h+=g;l-=g}if(l>0)c=d;else c=null}function d(f){var g=l+f.length;var m=new Float32Array(g);m.set(c.subarray(h));m.set(f,l);h=0;l=g;b(m)}function f(b,d){var c=E.encode(b,d,p,m);m+=c;if(m==k){m=0;n.ondata(p,k)}}var c=null;var g=160;var h=0;var l=0;var m=0;var k=Math.floor(Math.floor(Math.floor(4096/v)/160)/2)*65;var p=new Uint8Array(k);this.reset=function(){m=0;h=0;l=0;c=null};this.addData=function(f,c){f=$c(f,c);if(l==0){l=f.length;
h=0;b(f)}else d(f)}}}function k(){function b(d,f){var c=0;for(var g=0;g<160;g++){c=d[f++];pa[g]=c<0?c*32768:c*32767}}function d(){qa=!qa;var b=0;f();var c=0;if(qa){c=T[0]<<4|T[1]<<10;N[b++]=c>>4;c=c>>5|T[2]<<11;N[b++]=c>>7;c=c>>5|T[3]<<11;c=c>>4|T[4]<<12;N[b++]=c>>6;c=c>>4|T[5]<<12;c=c>>3|T[6]<<13;N[b++]=c>>7;c=c>>3|T[7]<<13;c=c>>7|da[0]<<9;N[b++]=c>>5;c=c>>2|ka[0]<<14;c=c>>2|ga[0]<<14;c=c>>6|la[0]<<10;N[b++]=c>>3;c=c>>3|G[0]<<13;N[b++]=c>>8;c=c>>3|G[1]<<13;c=c>>3|G[2]<<13;c=c>>3|G[3]<<13;N[b++]=
c>>7;c=c>>3|G[4]<<13;c=c>>3|G[5]<<13;c=c>>3|G[6]<<13;N[b++]=c>>6;c=c>>3|G[7]<<13;c=c>>3|G[8]<<13;N[b++]=c>>8;c=c>>3|G[9]<<13;c=c>>3|G[10]<<13;c=c>>3|G[11]<<13;N[b++]=c>>7;c=c>>3|G[12]<<13;c=c>>7|da[1]<<9;N[b++]=c>>5;c=c>>2|ka[1]<<14;c=c>>2|ga[1]<<14;c=c>>6|la[1]<<10;N[b++]=c>>3;c=c>>3|G[13]<<13;N[b++]=c>>8;c=c>>3|G[14]<<13;c=c>>3|G[15]<<13;c=c>>3|G[16]<<13;N[b++]=c>>7;c=c>>3|G[17]<<13;c=c>>3|G[18]<<13;c=c>>3|G[19]<<13;N[b++]=c>>6;c=c>>3|G[20]<<13;c=c>>3|G[21]<<13;N[b++]=c>>8;c=c>>3|G[22]<<13;c=c>>
3|G[23]<<13;c=c>>3|G[24]<<13;N[b++]=c>>7;c=c>>3|G[25]<<13;c=c>>7|da[2]<<9;N[b++]=c>>5;c=c>>2|ka[2]<<14;c=c>>2|ga[2]<<14;c=c>>6|la[2]<<10;N[b++]=c>>3;c=c>>3|G[26]<<13;N[b++]=c>>8;c=c>>3|G[27]<<13;c=c>>3|G[28]<<13;c=c>>3|G[29]<<13;N[b++]=c>>7;c=c>>3|G[30]<<13;c=c>>3|G[31]<<13;c=c>>3|G[32]<<13;N[b++]=c>>6;c=c>>3|G[33]<<13;c=c>>3|G[34]<<13;N[b++]=c>>8;c=c>>3|G[35]<<13;c=c>>3|G[36]<<13;c=c>>3|G[37]<<13;N[b++]=c>>7;c=c>>3|G[38]<<13;c=c>>7|da[3]<<9;N[b++]=c>>5;c=c>>2|ka[3]<<14;c=c>>2|ga[3]<<14;c=c>>6|la[3]<<
10;N[b++]=c>>3;c=c>>3|G[39]<<13;N[b++]=c>>8;c=c>>3|G[40]<<13;c=c>>3|G[41]<<13;c=c>>3|G[42]<<13;N[b++]=c>>7;c=c>>3|G[43]<<13;c=c>>3|G[44]<<13;c=c>>3|G[45]<<13;N[b++]=c>>6;c=c>>3|G[46]<<13;c=c>>3|G[47]<<13;N[b++]=c>>8;c=c>>3|G[48]<<13;c=c>>3|G[49]<<13;c=c>>3|G[50]<<13;N[b++]=c>>7;c=c>>3|G[51]<<13;N[b]=c>>12;ra=N[b]}else{c=ra<<6|T[0]<<10;N[b++]=c>>6;c=c>>6|T[1]<<10;N[b++]=c>>8;c=c>>5|T[2]<<11;c=c>>5|T[3]<<11;N[b++]=c>>6;c=c>>4|T[4]<<12;c=c>>4|T[5]<<12;N[b++]=c>>6;c=c>>3|T[6]<<13;c=c>>3|T[7]<<13;N[b++]=
c>>8;c=c>>7|da[0]<<9;c=c>>2|ka[0]<<14;N[b++]=c>>7;c=c>>2|ga[0]<<14;c=c>>6|la[0]<<10;N[b++]=c>>7;c=c>>3|G[0]<<13;c=c>>3|G[1]<<13;c=c>>3|G[2]<<13;N[b++]=c>>6;c=c>>3|G[3]<<13;c=c>>3|G[4]<<13;N[b++]=c>>8;c=c>>3|G[5]<<13;c=c>>3|G[6]<<13;c=c>>3|G[7]<<13;N[b++]=c>>7;c=c>>3|G[8]<<13;c=c>>3|G[9]<<13;c=c>>3|G[10]<<13;N[b++]=c>>6;c=c>>3|G[11]<<13;c=c>>3|G[12]<<13;N[b++]=c>>8;c=c>>7|da[1]<<9;c=c>>2|ka[1]<<14;N[b++]=c>>7;c=c>>2|ga[1]<<14;c=c>>6|la[1]<<10;N[b++]=c>>7;c=c>>3|G[13]<<13;c=c>>3|G[14]<<13;c=c>>3|G[15]<<
13;N[b++]=c>>6;c=c>>3|G[16]<<13;c=c>>3|G[17]<<13;N[b++]=c>>8;c=c>>3|G[18]<<13;c=c>>3|G[19]<<13;c=c>>3|G[20]<<13;N[b++]=c>>7;c=c>>3|G[21]<<13;c=c>>3|G[22]<<13;c=c>>3|G[23]<<13;N[b++]=c>>6;c=c>>3|G[24]<<13;c=c>>3|G[25]<<13;N[b++]=c>>8;c=c>>7|da[2]<<9;c=c>>2|ka[2]<<14;N[b++]=c>>7;c=c>>2|ga[2]<<14;c=c>>6|la[2]<<10;N[b++]=c>>7;c=c>>3|G[26]<<13;c=c>>3|G[27]<<13;c=c>>3|G[28]<<13;N[b++]=c>>6;c=c>>3|G[29]<<13;c=c>>3|G[30]<<13;N[b++]=c>>8;c=c>>3|G[31]<<13;c=c>>3|G[32]<<13;c=c>>3|G[33]<<13;N[b++]=c>>7;c=c>>
3|G[34]<<13;c=c>>3|G[35]<<13;c=c>>3|G[36]<<13;N[b++]=c>>6;c=c>>3|G[37]<<13;c=c>>3|G[38]<<13;N[b++]=c>>8;c=c>>7|da[3]<<9;c=c>>2|ka[3]<<14;N[b++]=c>>7;c=c>>2|ga[3]<<14;c=c>>6|la[3]<<10;N[b++]=c>>7;c=c>>3|G[39]<<13;c=c>>3|G[40]<<13;c=c>>3|G[41]<<13;N[b++]=c>>6;c=c>>3|G[42]<<13;c=c>>3|G[43]<<13;N[b++]=c>>8;c=c>>3|G[44]<<13;c=c>>3|G[45]<<13;c=c>>3|G[46]<<13;N[b++]=c>>7;c=c>>3|G[47]<<13;c=c>>3|G[48]<<13;c=c>>3|G[49]<<13;N[b++]=c>>6;c=c>>3|G[50]<<13;c=c>>3|G[51]<<13;N[b++]=c>>8}}function f(){var b=0;var d=
0;var g=0;var h=120;var l=new Int16Array(50);var m=new Int16Array(160);c(m);y(m,T);P(ca,T,m);var n=ca.dp0;var k=0;var p=0;for(var q=0;q<=3;q++,b+=13){u(m,q*40,l,n,n,h,da,ka,d++);F(l,la,ga,g++,G,b);for(k=0;k<=39;k++){p=l[5+k]+n[k+h];n[k+h]=p<-32768?-32768:p>32767?32767:p}h+=40}for(k=0;k<120;k++)n[k]=n[160+k]}function c(b){var d=0;var f=0;var g=ca.z1;var h=ca.l_z2;var n=ca.mp;var k=0;var p=0;var q=0;var t=0;var u=0;var v=0;for(var x=160;x!=0;){x--;t=pa[d++]>>3<<2<<16>>16;k=t-g<<16>>16;g=t;u=k;u<<=15;
p=h>>15<<16>>16;q=h-(p<<15)<<16>>16;u+=l(q,32735);v=p*32735;h=m(v,u);v=m(h,16384);p=l(n,-28180);n=v>>15<<16>>16;var y=n+p;b[f++]=y<-32768?-32768:y>32767?32767:y}ca.z1=g;ca.l_z2=h;ca.mp=n}function g(b,d){var c=0;var f=qa?32:33;for(c=0;c<f;c++)b[c+d]=N[c];return f}function h(b,d){if(b==-32768&&d==-32768)return 32767;else return b*d>>15<<16>>16}function l(b,d){if(b==-32768&&d==-32768)return 32767;else{var c=b*d+16384;c>>=15;return c<<16>>16}}function m(b,d){var c=0;if(b<=0)if(d>=0)return b+d;else{c=
-(b+1)-(d+1);return c>=2147483647?-2147483648:-c-2}else if(d<=0)return b+d;else{c=b+d;return c>2147483647?2147483647:c}}function n(b){if(b<0){if(b<=-1073741824)return 0;b=~b}return((b&4294901760)!=0?(b&4278190080)!=0?-1+sa[255&b>>24]:7+sa[255&b>>16]:(b&65280)!=0?15+sa[255&b>>8]:23+sa[255&b])<<16>>16}function p(b,d){if(d>=16)return 0;if(d<=-16)if(b<0)return-1;else return-0;if(d<0)return q(b,-d);return b<<d<<16>>16}function q(b,d){if(d>=16)if(b<0)return-1;else return-0;if(d<=-16)return 0;if(d<0)return b<<
-d<<16>>16;return b>>d<<16>>16}function t(b,d){var c=b;var f=d;var g=0;var h=15;if(b==0)return 0;for(;h!=0;){h--;g=g<<17>>16;c<<=1;if(c>=f){c-=f;g++}}return g<<16>>16}function u(b,d,c,f,g,h,l,n,m){v(b,d,f,h,n,l,m);x(n[m],l[m],f,b,d,g,c,h)}function v(b,d,c,f,g,l,m){var k=0;var p=0;var q=new Int16Array(40);var t=0;var u=0;var x=0;var y=0;var A=0;var B=0;var C=0;for(var D=0;D<=39;D++){C=b[D+d];C=(C<0?C==-32768?32767:-C:C)<<16>>16;if(C>A)A=C}C=0;if(A==0)B=0;else C=n(A<<16);if(C>6)B=0;else B=6-C<<16>>
16;for(D=0;D<=39;D++)q[D]=b[D+d]>>B;t=0;p=40;for(k=40;k<=120;k++){var z=0;var w=1;z=q[0]*c[f-k];z+=q[1]*c[w+f-k];w++;z+=q[2]*c[w+f-k];w++;z+=q[3]*c[w+f-k];w++;z+=q[4]*c[w+f-k];w++;z+=q[5]*c[w+f-k];w++;z+=q[6]*c[w+f-k];w++;z+=q[7]*c[w+f-k];w++;z+=q[8]*c[w+f-k];w++;z+=q[9]*c[w+f-k];w++;z+=q[10]*c[w+f-k];w++;z+=q[11]*c[w+f-k];w++;z+=q[12]*c[w+f-k];w++;z+=q[13]*c[w+f-k];w++;z+=q[14]*c[w+f-k];w++;z+=q[15]*c[w+f-k];w++;z+=q[16]*c[w+f-k];w++;z+=q[17]*c[w+f-k];w++;z+=q[18]*c[w+f-k];w++;z+=q[19]*c[w+f-k];
w++;z+=q[20]*c[w+f-k];w++;z+=q[21]*c[w+f-k];w++;z+=q[22]*c[w+f-k];w++;z+=q[23]*c[w+f-k];w++;z+=q[24]*c[w+f-k];w++;z+=q[25]*c[w+f-k];w++;z+=q[26]*c[w+f-k];w++;z+=q[27]*c[w+f-k];w++;z+=q[28]*c[w+f-k];w++;z+=q[29]*c[w+f-k];w++;z+=q[30]*c[w+f-k];w++;z+=q[31]*c[w+f-k];w++;z+=q[32]*c[w+f-k];w++;z+=q[33]*c[w+f-k];w++;z+=q[34]*c[w+f-k];w++;z+=q[35]*c[w+f-k];w++;z+=q[36]*c[w+f-k];w++;z+=q[37]*c[w+f-k];w++;z+=q[38]*c[w+f-k];w++;z+=q[39]*c[w+f-k];w++;if(z>t){p=k<<16>>16;t=z}}l[m]=p;t<<=1;t=t>>6-B;u=0;for(D=
0;D<=39;D++){var E=0;E=c[D-p+f]>>3<<16>>16;u+=E*E}u<<=1;if(t<=0){g[m]=0;return}if(t>=u){g[m]=3;return}C=n(u);x=t<<C>>16<<16>>16;y=u<<C>>16<<16>>16;for(var F=0;F<=2;F++){if(x<=h(y,ia[F]))break;g[m]=F}}function x(b,d,c,f,g,h,k,m){var n=0;var p=0;var q=0;switch(b){case 0:n=3277;for(p=0;p<=39;p++){h[p+m]=l(n,c[p-d+m]);q=f[p+g]-h[p+m];k[p+5]=q<-32768?-32768:q>32767?32767:q}break;case 1:n=11469;for(p=0;p<=39;p++){h[p+m]=l(n,c[p-d+m]);q=f[p+g]-h[p+m];k[p+5]=q<-32768?-32768:q>32767?32767:q}break;case 2:n=
21299;for(p=0;p<=39;p++){h[p+m]=l(n,c[p-d+m]);q=f[p+g]-h[p+m];k[p+5]=q<-32768?-32768:q>32767?32767:q}break;case 3:n=32767;for(p=0;p<=39;p++){h[p+m]=l(n,c[p-d+m]);q=f[p+g]-h[p+m];k[p+5]=q<-32768?-32768:q>32767?32767:q}}}function y(b,d){B(b);C(d);D(d);E(d)}function A(b,d,c,f,g){for(var h=0;h<g;h++)c[f+h]=b[d+h]}function B(b){var d=0;var c=0;var f=0;var g=0;var h=0;var k=0;var m=0;for(k=0;k<=159;k++){m=b[k]+0;f=m<-32768?-32768:m>32767?32767:m;if(f>g)g=f}if(g==0)h=0;else h=4-n(g<<16)<<16>>16;if(h>0)switch(h){case 1:for(k=
0;k<=159;k++)b[k]=l(b[k],16384);break;case 2:for(k=0;k<=159;k++)b[k]=l(b[k],16384>>1);break;case 3:for(k=0;k<=159;k++)b[k]=l(b[k],16384>>2);break;case 4:for(k=0;k<=159;k++)b[k]=l(b[k],16384>>3)}var p=b;var q=p[c];var t=[0,0,0,0,0,0,0,0,0];A(t,0,S,0,S.length);S[0]+=q*p[c-0];q=p[++c];S[0]+=q*p[c-0];S[1]+=q*p[c-1];q=p[++c];S[0]+=q*p[c-0];S[1]+=q*p[c-1];S[2]+=q*p[c-2];q=p[++c];S[0]+=q*p[c-0];S[1]+=q*p[c-1];S[2]+=q*p[c-2];S[3]+=q*p[c-3];q=p[++c];S[0]+=q*p[c-0];S[1]+=q*p[c-1];S[2]+=q*p[c-2];S[3]+=q*p[c-
3];S[4]+=q*p[c-4];q=p[++c];S[0]+=q*p[c-0];S[1]+=q*p[c-1];S[2]+=q*p[c-2];S[3]+=q*p[c-3];S[4]+=q*p[c-4];S[5]+=q*p[c-5];q=p[++c];S[0]+=q*p[c-0];S[1]+=q*p[c-1];S[2]+=q*p[c-2];S[3]+=q*p[c-3];S[4]+=q*p[c-4];S[5]+=q*p[c-5];S[6]+=q*p[c-6];q=p[++c];S[0]+=q*p[c-0];S[1]+=q*p[c-1];S[2]+=q*p[c-2];S[3]+=q*p[c-3];S[4]+=q*p[c-4];S[5]+=q*p[c-5];S[6]+=q*p[c-6];S[7]+=q*p[c-7];q=p[++c];for(d=c;d<160;++d){q=p[d];S[0]+=q*p[d-0];S[1]+=q*p[d-1];S[2]+=q*p[d-2];S[3]+=q*p[d-3];S[4]+=q*p[d-4];S[5]+=q*p[d-5];S[6]+=q*p[d-6];S[7]+=
q*p[d-7];S[8]+=q*p[d-8]}for(k=0;k<9;k++)S[k]<<=1;if(h>0)for(k=0;k<160;k++)b[k]<<=h}function C(b){var c=new Int16Array(1);var d=0;var f=0;var g=new Int16Array(9);var h=new Int16Array(9);var k=new Int16Array(9);if(S[0]==0){for(f=0;f<8;f++)b[f]=0;return}c[0]=n(S[0]);for(f=0;f<=8;f++)g[f]=S[f]<<c[0]>>16;A(g,0,k,0,7);A(g,0,h,0,8);for(var m=1;m<=8;m++,d++){c[0]=h[1];c[0]=(c[0]<0?c[0]==-32768?32767:-c[0]:c[0])<<16>>16;if(h[0]<c[0]){for(f=m;f<8;f++)b[f]=0;return}b[d]=t(c[0],h[0]);if(h[1]>0)b[d]=-b[d];if(m==
8)return;c[0]=l(h[1],b[d]);var p=h[0]+c[0];h[0]=p<-32768?-32768:p>32767?32767:p;for(var q=1;q<=8-m;q++){c[0]=l(k[q],b[d]);var u=h[q+1]+c[0];h[q]=u<-32768?-32768:u>32767?32767:u;c[0]=l(h[q+1],b[d]);var v=k[q]+c[0];k[q]=v<-32768?-32768:v>32767?32767:v}}}function D(b){var c;for(var d=0;d<8;d++){c=b[d];c=(c<0?c==-32768?32767:-c:c)<<16>>16;if(c<22118)c>>=1;else if(c<31130)c-=11059;else{c-=26112;c<<=2}b[d]=b[d]<0?-c:c}}function E(b){var c=0;z(20480,0,31,-32,b,c++);z(20480,0,31,-32,b,c++);z(20480,2048,15,
-16,b,c++);z(20480,-2560,15,-16,b,c++);z(13964,94,7,-8,b,c++);z(15360,-1792,7,-8,b,c++);z(8534,-341,3,-4,b,c++);z(9036,-1144,3,-4,b,c++)}function z(b,c,d,f,g,l){var k=0;k=h(b<<16>>16,g[l]);var m=k+(c<<16>>16);k=m<-32768?-32768:m>32767?32767:m;var n=k+256;k=n<-32768?-32768:n>32767?32767:n;k=k>>9<<16>>16;g[l]=(k>d?d-f:k<f?0:k-f)<<16>>16}function F(b,c,d,f,g,h){var l=new Int16Array(13);var k=new Int16Array(13);I(b);J(l,d,f);K(l,g,h,c,f);M(g,k,h,ta);O(d[f],k,b,ta)}function I(b){var c=0;for(var d=0;d<=
39;d++){c=8192>>1;c+=b[d+0]*-134+b[d+1]*-374+b[d+3]*2054+b[d+4]*5741+b[d+5]*8192+b[d+6]*5741+b[d+7]*2054+b[d+9]*-374+b[d+10]*-134;c=c>>13<<16>>16;ya[d]=c<-32768?-32768:c>32767?32767:c}}function J(b,c,d){var f=0;var g=0;var h=0;var l;f=0;f+=w(0,1)+w(0,2)+w(0,3)+w(0,4)+w(0,5)+w(0,6)+w(0,7)+w(0,8)+w(0,9)+w(0,10)+w(0,11)+w(0,12);l=f;f+=w(0,0);f<<=1;g=f;f=0;f+=w(1,0)+w(1,1)+w(1,2)+w(1,3)+w(1,4)+w(1,5)+w(1,6)+w(1,7)+w(1,8)+w(1,9)+w(1,10)+w(1,11)+w(1,12);f<<=1;if(f>g){h=1;g=f}f=0;f+=w(2,0)+w(2,1)+w(2,2)+
w(2,3)+w(2,4)+w(2,5)+w(2,6)+w(2,7)+w(2,8)+w(2,9)+w(2,10)+w(2,11)+w(2,12);f<<=1;if(f>g){h=2;g=f}f=l;f+=w(3,12);f<<=1;if(f>g){h=3;g=f}for(var k=0;k<=12;k++)b[k]=ya[h+3*k];c[d]=h}function w(b,c){var d;d=ya[b+3*c]>>2<<16>>16;return d*d}function K(b,c,d,f,g){var k=0;var l=0;var m=0;var n=0;var p=0;var q=0;var t=0;var u=0;var v=0;for(v=0;v<=12;v++){n=b[v];n=n<0?n==-32768?32767:-n:n;if(n>l)l=n}t=0;n=l>>9<<16>>16;k=0;for(v=0;v<=5;v++){if(n<=0)k|=1;else k|=0;n=n>>1<<16>>16;if(k==0)t++}n=t+5<<16>>16;var w=
(l>>n<<16>>16)+(t<<3<<16>>16);m=w<-32768?-32768:w>32767?32767:w;L(m,ta);t=ua;u=va;p=6-t<<16>>16;q=ja[u];for(v=0;v<=12;v++){n=b[v]<<p<<16>>16;n=h(n,q);n=n>>12<<16>>16;c[v+d]=n+4<<16>>16}va=u;ua=t;f[g]=m}function L(b,c){var d=0;var f=0;if(b>15)d=(b>>3<<16>>16)-1<<16>>16;f=b-(d<<3)<<16>>16;if(f==0){d=-4;f=7}else{for(;f<=7;){f=(f<<1|1)<<16>>16;d--}f-=8}if(c==ta){ua=d;va=f}else{wa=d;xa=f}}function M(b,c,d,f){var g=0;var h=0;var k=0;var m=0;var n=0;var t=0;if(f==ta){h=na[va];n=6-ua<<16>>16;k=n<-32768?-32768:
n>32767?32767:n}else{h=na[xa];n=6-wa<<16>>16;k=n<-32768?-32768:n>32767?32767:n}n=k-1;m=p(1,n<-32768?-32768:n>32767?32767:n);za=0;for(var u=0;u<13;u++){g=(b[d++]<<1)-7<<16>>16;g=g<<28>>16;g=l(h,g);t=g+m;g=t<-32768?-32768:t>32767?32767:t;c[za++]=q(g,k)}}function O(b,c,d,f){var g=13;var h=0;var k=0;if(f==ta)k=5;else k=0;switch(b){case 3:d[k++]=0;do{d[k++]=0;d[k++]=0;d[k++]=c[h++];--g}while(g!=0);break;case 2:do{d[k++]=0;d[k++]=0;d[k++]=c[h++];--g}while(g!=0);break;case 1:do{d[k++]=0;d[k++]=c[h++];d[k++]=
0;--g}while(g!=0);break;case 0:do{d[k++]=c[h++];d[k++]=0;d[k++]=0;--g}while(g!=0)}if(f==ta)d[k++]=0}function P(b,c,d){var f=new Int16Array(8);var g=b.j;var h=g;h^=1;b.j=h;var k=b.larpp[g];var l=b.larpp[h];R(c,k);U(l,k,f);X(f);Y(b,f,13,d,0);W(l,k,f);X(f);Y(b,f,14,d,13);Z(l,k,f);X(f);Y(b,f,13,d,27);aa(k,f);X(f);Y(b,f,120,d,40)}function R(b,c){var d=0;var f=0;Q(b,c,f++,d,0,-32,13107);Q(b,c,f++,d,0,-32,13107);Q(b,c,f++,d,2048,-16,13107);Q(b,c,f++,d,-2560,-16,13107);Q(b,c,f++,d,94,-8,19223);Q(b,c,f++,
d,-1792,-8,17476);Q(b,c,f++,d,-341,-4,31454);Q(b,c,f++,d,-1144,-4,29708)}function Q(b,c,d,f,g,h,k){var n=b[d]+h;f=(n<-32768?-32768:n>32767?32767:n)<<26>>16;var m=f-(g<<17>>16);f=m<-32768?-32768:m>32767?32767:m;f=l(k,f);var p=f+f;c[d]=p<-32768?-32768:p>32767?32767:p}function U(b,c,d){for(var f=0;f<8;f++){var g=(b[f]>>2<<16>>16)+(c[f]>>2<<16>>16);d[f]=g<-32768?-32768:g>32767?32767:g;var h=d[f]+(b[f]>>1<<16>>16);d[f]=h<-32768?-32768:h>32767?32767:h}}function W(b,c,d){for(var f=0;f<8;f++){var g=(b[f]>>
1<<16>>16)+(c[f]>>1<<16>>16);d[f]=g<-32768?-32768:g>32767?32767:g}}function Z(b,c,d){for(var f=0;f<8;f++){var g=(b[f]>>2<<16>>16)+(c[f]>>2<<16>>16);d[f]=g<-32768?-32768:g>32767?32767:g;var h=d[f]+(c[f]>>1<<16>>16);d[f]=h<-32768?-32768:h>32767?32767:h}}function aa(b,c){for(var d=0;d<8;d++)c[d]=b[d]}function X(b){var c=0;var d=0;for(var f=0;f<8;f++)if(b[f]<0){c=(b[f]==-32768?32767:-b[f])<<16>>16;d=(c>>2<<16>>16)+26112;b[f]=-(c<11059?c<<1:c<20070?c+11059:d<-32768?-32768:d>32767?32767:d)<<16>>16}else{c=
b[f];d=(c>>2<<16>>16)+26112;b[f]=(c<11059?c<<1:c<20070?c+11059:d<-32768?-32768:d>32767?32767:d)<<16>>16}}function Y(b,c,d,f,g){var h=b.u;var k=0;var n=0;var m=0;var p=0;var q=0;var t=0;var u=0;for(var v=0;d!=0;){d--;k=p=f[g];for(t=0;t<8;t++){m=h[t];q=c[t];h[t]=p;n=l(q,k);u=m+n;p=u<-32768?-32768:u>32767?32767:u;n=l(q,m);v=k+n;k=v<-32768?-32768:v>32767?32767:v}f[g++]=k}b.u=h}function ba(){this.dp0=new Int16Array(280);this.z1=0;this.l_z2=0;this.mp=0;this.u=new Int16Array(8);this.larpp=[new Int16Array(8),
new Int16Array(8)];this.j=0;this.nrp=40;this.v=new Int16Array(9);this.msr=0}var fa=33;var ia=[6554,16384,26214,32767];var ja=[29128,26215,23832,21846,20165,18725,17476,16384];var na=[18431,20479,22527,24575,26623,28671,30719,32767];var ca=new ba;var T=new Int16Array(8);var da=new Int16Array(4);var ga=new Int16Array(4);var ka=new Int16Array(4);var la=new Int16Array(4);var G=new Int16Array(13*4);var pa=new Int16Array(160);var N=new Uint8Array(fa);var ra=0;this.encode=function(c,f,h,k){b(c,f);d();return g(h,
k)};var qa=false;var sa=[8,7,6,6,5,5,5,5,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var S=new Int32Array(9);var ua=0;var va=0;var wa=0;var xa=0;var za=0;var ta=0;var Ba=1;var ya=new Int16Array(40)}l.name="AUDIO_INPUT";l.process=function(b){var f=b.getByte();var h=null;switch(f){case 1:var k=b.getLittleEndian32();h=new RdpBuffer(new Uint8Array(5),0,5);h.setByte(1);h.setLittleEndian32(k);h.markEnd();l.send(h);break;case 2:d(b);break;case 3:c(b);break;case 7:g(b);break;default:svGlobal.logger.warn("audioInpt: invalid tag:"+f)}};var p=false;l.onclose=
function(){p=false;if(u)u.close()};var v=new Uint8Array(1);v[0]=5;var x=false;var y=m.reconnectOnResize;var z=new Uint8Array(0);var E=null;var u=new h(na.getContext())})();m.addDynamicChannel(l)}if(L.enableTSMF||xa)m.addDynamicChannel(h());if(!xa)m.addDynamicChannel(k());m.addDynamicChannel(v(c))}};var Va=new Wb;var Ga=new Yb;var Y=new Db;var mb=new nd;var Fa=0;var db=new function(){var d=[];this.set=function(f,g){d[f]=g};this.get=function(f){return d[f]};this.toPDU=function(){var f=2;var g=2;var c=
0;var b=0;var h=d.length;for(var k;b<h;b++){k=d[b];if(k){c++;g=g+7+(k.rawData?k.rawData.length:0)}}if(!c)return null;var m=new Uint32Array(g);m[0]=100728861;m[1]=c;for(b=0;b<h;b++){k=d[b];if(k){m[f++]=k.cache_idx|k.bpp<<16;m[f++]=k.hotX|k.hotY<<16;m[f++]=k.width|k.height<<16;m[f++]=k.xorSize;m[f++]=k.andSize;m[f++]=k.distance;m[f++]=k.rawData.length;m.set(k.rawData,f);f+=k.rawData.length}}return m};this.fromStream=function(f){var g=f.getPosition();var c=new Uint32Array(f.getData().buffer,g);var b=
c[0];var h=0;var k=0;var m=0;var p=0;var l=0;var r=0;var n=0;var q=0;var x=0;var w=0;var y=0;var z;var t;for(g=1;h<b;h++){k=c[g]&65535;m=c[g++]>>16;p=c[g]&65535;l=c[g++]>>16;r=c[g]&65535;n=c[g++]>>16;q=c[g++];x=c[g++];w=c[g++];y=c[g++];z=new Uint32Array(y);z.set(c.subarray(g,g+y));g+=y;t=new Jb(k,z,p,l,r,n,m,q,x);if(w){t.distance=w;t.init()}d[k]=t}}};this.getFileUrl=function(d){return m.modifyURL(za()+"/DOWNLOAD?s="+jb+"&f="+d)};this.exeAppCmd=function(d){var f=F.getFocused();if(f)f.exeCommand(d)};
this.reconnect=function(d,f,g){g=g||false;if(!fa&&!g)return false;if(x.minWidth&&d<x.minWidth)d=x.minWidth;if(x.minHeight&&f<x.minHeight)f=x.minHeight;d=$a(d);f=$a(f);if(!g&&Math.abs(d-P)<4&&Math.abs(f-Z)<4)return false;if(ga&&ga.enabled)ga.applyResolution(d,f);else bc(d,f);return true};this.notify=function(d,f){d="8E6"+d;if(f)d+="\t"+f.join(";");M(d)};this.getUploadManager=function(){return ra};this.addSurface=function(d){if(F.hasSurface(d))return;if(!ub)z.setContext(d.context);if(F.indexOf(d)!=
-1&&d.railWin)return;if(xa)d.setPlayerMode();if(x.mouseMoveEmu)d.mouseMoveEmu=qa(x.mouseMoveEmu);d.setConfig(L);F.addSurface(d);d.setSize(P,Z,T?"hidden":null);d.setController(Sa);d.setFastCopy(qa(x.fastCopy));d.setTouchpad(qa(x.touchpad));d.setClipboard(qa(x.mapClipboard));if(Gb)cc(d);if(x.invitation){F.setReadOnly(true);btn=hi5.$("requestControl");if(btn)btn.disabled=false}d.run(parseInt(x.keyboard||1033,10))};this.getRunninApps=this.getRunningApps=function(){var d=[];var f=0;for(var g=F.length;f<
g;f++){if(!F[f].railWin.getMain(F.zOrders))continue;d.push(F[f].railWin.getMain(F.zOrders)["titleInfo"])}return d};this.startApp=function(d,f,g){M("8C2"+d+"\t"+f+"\t"+g);var c=F[F.length-1];if(c)c.remoteApp=new dc(d,f,g)};this.startExitingApp=function(d){var f=F.popWins(d);var g=f.length;for(var c=g-1;c>=0;c--)F.addWin(f[c])};this.VirtualChannel=function(){return new Eb(143)};this.GatewayChannel=function(){return new Eb(28)};this.DynamicChannel=function(){return new Eb(64)};this.addChannel=function(d){Pa[d.name]=
d};this.addGatewayChannel=function(d){Qa[d.name]=d};this.addDynamicChannel=function(d){ia.names.push(d.name);ia[d.name]=d;ia.count++};if(qa(x.smartCard)){var qb=new m.GatewayChannel;var Qb=null;qb.name="SCARDSTB";qb.onopen=function(){Qb=document.getElementById(hi5.appcfg.clientAppletId||"clientApplet")};qb.process=function(d){var f=null;if(Qb){var g=d.getPosition();var c=hi5.Base64.enc(d.getData(),d.getEnd()-g,g);try{c=Qb.deviceControl(c);f=hi5.Base64.dec(c,0)}catch(h){svGlobal.logger.warn(h)}}if(!f)f=
[0];var b=new hi5.DataBuffer(f);b.markEnd(f.length);qb.send(b)};m.addGatewayChannel(qb)}this.run=function(){fc();if(na.supportWebAudio)na.iOSFix()};this.getDesktop=function(){return z};this.mouseDown=function(d,f,g){if(wa)M("80"+d+"\t"+f+"\t"+g)};this.mouseMove=function(d,f){if(wa)M("82"+d+"\t"+f)};this.mouseUp=function(d,f,g){if(wa)M("81"+d+"\t"+f+"\t"+g)};this.writeKeyCode=function(d,f){if(wa)M("8B"+(d?0:49152)+"\t"+f)};this.writeScancode=function(d,f){if(wa){if(typeof d=="number"){M("84"+"0\t"+
d);M("84"+"49152\t"+d);return}M("84"+(d?0:49152)+"\t"+f)}};this.writeRawInput=function(d){if(wa)M(d)};var la=new RdpBuffer([],0,0);this.suppressOutput=function(d){if(!m.sessionInfo.suppressOutput)return false;if(d==undefined)d=true;var f=new Uint8Array(d?3:11);f[0]=146;f[1]=3;f[2]=d?1:0;if(!d){f[3]=aa;f[4]=aa>>8;f[5]=X;f[6]=X>>8;f[7]=U;f[8]=U>>8;f[9]=W;f[10]=W>>8}Q.send(f.buffer);return true};this.refreshOutput=function(d,f,g,c){var b=new Uint8Array(g?11:3);b[0]=146;b[1]=3;b[2]=2;if(g){b[3]=d;b[4]=
d>>8;b[5]=f;b[6]=f>>8;b[7]=g;b[8]=g>>8;b[9]=c;b[10]=c>>8}Q.send(b.buffer)};this.sendPing=function(d){var f=d?2+d.length:2;var g=new Uint8Array(f);g[0]=146;g[1]=0;if(d)g.set(d,2);Q.send(g.buffer)};this.startPing=function(d,f){f=f||0;if(!pa)pa=new hi5.tool.ResponseMonitor(function(){if(fa)m.sendPing()},function(){if(fa&&m.onnoresponse)return m.onnoresponse()});pa.setInterval(d,f);var g=new Uint8Array(4);g[0]=146;g[1]=2;g[2]=d;g[3]=f;Q.send(g.buffer);pa.check()};this.stopPing=function(){if(pa)pa.stop()};
var Ba=null;var pc=0;this.play=function(){M("F3")};this.pause=function(){M("F2")};this.scan=function(d){M("F4"+(d?"1":"0"))};this.seek=function(d){var f=F.getFocused();if(f&&fa){M("F4"+(d?"1":"0")+"\t"+(d/f.getScale()|0));z.pause(true)}};var ba={tag:0,channels:0,bitsPerSample:0,samplePerSec:22050,toStream:function(d){d.setLittleEndian16(this.tag);d.setLittleEndian16(this.channels);d.setLittleEndian16(this.bitsPerSample);d.setLittleEndian32(this.samplePerSec)},fromStream:function(d){this.tag=d.getLittleEndian16();
this.channels=d.getLittleEndian16();this.bitsPerSample=d.getLittleEndian16();this.samplePerSec=d.getLittleEndian32()}};var rc=false;this.showMessage=function(d,f,g){if(!m.displayMsg||!d)return;var c=f||F.getFocused();if(c)c.showMessage(d,g);else hi5.notifications.notify({"msg":d,"timeout":g||0})};var vb=new le;var Wa=new pe;var Cc=new ue;var Lc=new qe;var Ib=Lc.process;var Ge=[1,2,1,0,0,0,0,1,1,2,1,1,0,2,3,1,2,2,2,2,1,2,1,0,2,1,2,3];var nb={readVar4Bytes:function(d){var f=d.getByte();var g=(f&192)>>
6;var c=0;switch(g){case 0:c=f&63;break;case 1:c=(f&63)<<8;c|=d.getByte();break;case 2:c=(f&63)<<16;f=d.getByte();c|=f<<8;f=d.getByte();c|=f;break;case 3:c=(f&63)<<24;f=d.getByte();c|=f<<16;f=d.getByte();c|=f<<8;f=d.getByte();c|=f}return c},readVar2Bytes:function(d){var f=d.getByte();if((f&128)!=0)return(f&127)<<8|d.getByte();else return f}};this.close=function(){Ka=true;svGlobal.logger.info("closing...");if(Q&&Q.readyState!=WebSocket.CLOSING&&Q.readyState!=WebSocket.CLOSED)try{for(;Q&&Q.readyState!=
WebSocket.CLOSING&&Q.readyState!=WebSocket.CLOSED;){if(!xa&&Q.readyState==WebSocket.OPEN)M("85-1");Q.close()}}finally{Ra()}else Ra()};if(!hi5.browser.isChromeApp)window.addEventListener("unload",Ra,false);else chrome.runtime.onSuspend.addListener(Ra);var ca=16777215}if(!svGlobal.Rdp)svGlobal.Rdp=Rdp;var RdpBuffer=hi5.DataBuffer;
