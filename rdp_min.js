var svManager={getInstance:function(){var p=window.$rdp;if(p&&p.running&&p.running())return p;return null}};svGlobal.getInstance=svManager.getInstance;
function connvertServer(p){var H=new Object;H.id=p.id;H.server=p.id;H.displayName=p.displayName||p.id;var P=p.rdp;if(P){for(var sa in P)H[sa]=P[sa];H.user=P.username||"";H.pwd=P.password||"";H.useConsole=P.console||false;H.legacyMode=P.leagacyMode||P.legacyMode||false;H.server_bpp=P.color||16;H.exe=P.remoteProgram||"";H.args=P.remoteArgs||"";if(H.exe.length>0)H.startProgram="app";else if(H.command&&H.command.length>0)H.startProgram="shell";else H.startProgram="noapp"}return H}
function Rdp2(p){if(!p){var H=window.opener;try{if(H&&H.__sparkUser&&H.__sparkUser.server)p=H.__sparkUser.server;if(!p&&H.sparkServer)p=H.sparkServer}catch(pa){}if(!p)p=hi5.browser.cookie2Obj();if(!p||!p.gateway){hi5.notifications.notify({"msg":__svi18n.noauth});return null}}var P="";var sa=p.gateway||"";var V=0;var Fa=0;var ka=16;var ta=null;if(p.width)V=parseInt(p.width,10);if(p.height)Fa=parseInt(p.height,10);if(p.color)ka=parseInt(p.color,10);if(p.server_bpp)ka=parseInt(p.server_bpp,10);for(var L in p){svGlobal.logger.debug("** p:"+
L+" v="+p[L]);var ha=p[L];if("useSSL"==L){ta=ha=="true"||ha==true;continue}if(typeof ha=="boolean")if(ha)ha="on";else continue;if(""!=P)P+="&";P+=L+"="+encodeURIComponent(ha)}if(ta===null)ta="https:"==location.protocol;L=ta?"wss://":"ws://";P=L+sa+"/RDP?"+P;return new Rdp(P,V,Fa,ka)}if(!svGlobal.Rdp2)svGlobal.Rdp2=Rdp2;
function Rdp(p,H,P,sa){function V(b){return b=="on"||b=="true"}function Fa(b){return b=="off"||b=="false"}function ka(){var b=f.gateway;if(f.ongetgatewayaddress)b=f.ongetgatewayaddress(b);return b}function ta(){var b=hi5.storage.get("SV_CONN_SHARE_ID");if(!b){b=hi5.tool.uuid();hi5.storage.set("SV_CONN_SHARE_ID",b)}return b}function L(){return k.displayName||k.server||k.symlink||k.id||"undefined"}function ha(b,a,c){if(f.ontitlechange)b=f.ontitlechange(b,c);if(f.setTitle){a=a||window;a.document.title=
b+" - "+L()}}function pa(b){return b&~3}function db(b,a){if(v)v.resize(b,a);else v=new eb(b,a);return v}function za(b,a){switch(b){case 16:case 8:case 24:case 32:break;case 15:if(!k.invitation)f.showMessage("15 bit color is not supported anymore.");return false;default:return false}ua=b;Hb=(b+7)/8>>0;if(a)if(N)N.postMessage({type:0,cmd:1,data:b});else if(A)A.setColor(b);return true}function fb(){if(R&&!hi5.browser.isiOS){F=(k.waWidth||screen.width)|0;G=(k.waHeight||screen.height)|0}else{F=pa(F);G=
pa(G)}if(k.minWidth&&F<k.minWidth)F=k.minWidth|0;if(k.minHeight&&G<k.minHeight)G=k.minHeight|0;k.waWidth=k.waWidth||F;k.waHeight=k.waHeight||G}function qa(b,a,c,d){var e=F;var t=G;F=b;G=a;Ka=0,La=0,Ma=F-1,Na=G-1;fb();svGlobal.logger.warn("resolution changed, w:"+b+" h:"+a);v=db(F,G);q.setSize(F,G,R?"hidden":null);if(c)if(N)N.postMessage({type:0,cmd:2,data:{w:F,h:G}});else if(A)A.setResolution(F,G);if(f.onresolutionchange&&!d)f.onresolutionchange(b,a)}function y(b){if(ea)return;if(N){Oa.data=b;if(typeof b!=
"string")N.postMessage(Oa,[b]);else N.postMessage(Oa)}else A.writeRawInput(b)}function Ib(b,a){if(a==1)return b;else if(a<1){console.error("rate must be smaller than the original rate");return}var c=Math.round(b.length/a);var d=new Float32Array(c);var e=0;for(var f=0;e<d.length;){var g=Math.round((e+1)*a);var h=0;var m=0;for(var w=f;w<g&&w<b.length;w++){h+=b[w];m++}d[e]=h/m;e++;f=g}return d}function Pa(b){if(!f)return;var a=__svi18n.errorCode[b];if(!a)a="error "+b;if(f.onerror)f.onerror({name:b,message:a});
if(f.displayMsg)hi5.notifications.notify({"msg":a});if(svGlobal.log>0&&console.error)console.error(a)}function Qa(b){if(!f)return;var a=__svi18n.info[b];if(!a)a="info "+b;if(f.displayMsg)hi5.notifications.notify({"msg":a});svGlobal.logger.info(a)}function gb(){I=false;la=false}function Jb(){var b=q.getFocused();var a=b?b.getWindow():window;return"&waWidth="+k.waWidth+"&waHeight="+k.waHeight+"&dpWidth="+a.innerWidth+"&dpHeight="+a.innerHeight}function zc(b,a){function c(b){a(false,b.target.responseText)}
function d(b){a(true)}var e=a?true:false;var f=new XMLHttpRequest;if(e){f.addEventListener("load",c);f.addEventListener("error",d);f.addEventListener("abort",d)}f.open("GET",b,e);f.setRequestHeader("Content-Type","text/plain;charset=UTF-8");f.send(null);return e?"":f.responseText}function Kb(b,a){la=false;svGlobal.logger.info("reconnecting...");y("8E0"+b+"\t"+a)}function Lb(b){var a={};var c=0;var d=b;this.enabled=false;hi5.EventControl(this);var e=this;var t=null;this.release=function(){e=null;b=
null;d=null;a=null};this.read=function(d,h,m){function t(a){if(a.target.readyState==FileReader.DONE){var l=new Uint8Array(a.target.result);b.send(d,h,m,l,k.preferPaste);c+=m;e.fireEvent("progress",[c])}}var k=a[a[d]];if(typeof k=="undefined")return;var u=k.size;var r=k.name;if(u<1){f.showMessage(__svi18n.file.zero+r,null,3E3);return}var n=k.slice(h,h+m);var l=new FileReader;l.onloadend=t;l.readAsArrayBuffer(n)};this.mkdirs=function(a){if(!e.enabled)return;if(a.charAt(a.length-1)!="/")a+="/";b.start([a],
0,true)};this.addFiles=function(d,c){var m=d.length;if(!m||!e.enabled)return;var t=c&&!!(W&65536);for(var k=0;k<m;k++){var u=d[k];if(c)u.preferPaste=true;var r=u.fullPath||u.name;if(f.beforeupload)if(f.beforeupload(u,r,t))return;e.fireEvent("beforeupload",[u,r,t]);r=encodeURIComponent(r);a[r]=u}b.start(d,c);e.fireEvent("uploadstarted",[t])};this.removeFile=function(b){d.remove(b)};this.confirmId=function(b,d,e){a[b]=d;if(e)c+=parseInt(e)};this.close=function(b){var d=true;if(b){var m=a[b];if(m){d=
a[m].preferPaste;delete a[b];delete a[m];var t=decodeURIComponent(m);if(f.onfileuploaded)f.onfileuploaded(t,d);e.fireEvent("fileuploaded",[t,d&&!!(W&65536)])}for(var k in a)return}else a={};c=0;e.fireEvent("uploaded",[d&&!!(W&65536)]);if(f.onuploaded)f.onuploaded(d&&!!(W&65536))};this.cancelAll=function(){d.cancelAll();if(f.onuploadingCancelled)f.onuploadingCancelled();e.fireEvent("uploadingCancelled");e.close()};this.list=function(b,a){t=a;d.list(b)};this.notifyFiles=function(b){if(t)t(b);e.fireEvent("files")};
this.download=function(){d.download()}}function Mb(){function b(b,c){var d=c.length;var e=new Uint8Array(2+d*2);e[0]=58;e[1]=b;var f=0;var g=2;for(var h=0;h<d;h++){f=c.charCodeAt(h);e[g++]=f&255;e[g++]=f>>8&255}y(e.buffer)}this.start=function(b,c,d){var e=b.length;var f=e*20+2;var g=0;var h=new Uint8Array(8);var m=2;var w="";var k=0;var u=0;var r=0;for(var n=0;g<e;g++)if(d)f+=(encodeURIComponent(b[g]).length+1)*2;else f+=(encodeURIComponent(b[g].fullPath||b[g].name).length+1)*2;var l=new Uint8Array(f);
l[0]=58;l[1]=0;if(c)l[1]|=128;for(g=0;g<e;g++){n=d?0:b[g].size;l[m++]=n&255;l[m++]=n>>8&255;l[m++]=n>>16&255;l[m++]=n>>24&255;m+=4;if(!d)hi5.NumUtils.toBytes(b[g].lastModified||b[g].lastModifiedDate.getTime(),h);l.set(h,m);m+=12;w=encodeURIComponent(d?b[g]:b[g].fullPath||b[g].name);k=w.length;for(u=0;u<k;u++){r=w.charCodeAt(u);l[m++]=r&255;l[m++]=r>>8&255}m+=2}y(l.buffer)};this.send=function(b,c,d,e,f){var g=new Uint8Array(22+d);g[0]=58;g[1]=3;if(f)g[1]|=128;var h=2;g[h++]=b&255;g[h++]=b>>8&255;g[h++]=
b>>16&255;g[h++]=b>>24&255;g[h++]=c&255;g[h++]=c>>8&255;g[h++]=c>>16&255;g[h++]=c>>24&255;h+=4;g[h++]=d&255;g[h++]=d>>8&255;g[h++]=d>>16&255;g[h++]=d>>24&255;h+=4;g.set(e,h);y(g.buffer)};this.remove=function(a){b(6,a)};this.list=function(a){b(5,a)};this.cancelAll=function(){b(7,"")};this.download=function(){b(8|128,"")}}function hb(b){if(!S)S=new Lb(new Mb);b.setFileHandler(S)}function ib(b,a,c){var d=false;this.exe=b;this.args=a||"";this._dir=c||"";var e=this;this.close=function(){if(!d&&I){d=true;
y("8C5"+e.exe+"\t"+e.args+"\t"+f.sessionInfo.appInfo.session)}}}function Ra(b){var a=this;if(!b)b=143;this.send=function(c){var d=!!c.buffer;var e=d?c:c.getData();var f=b==64;var g=d?e.length:c.getEnd()||e.length;if(g<e.length)if(d)e=e.subarray(0,g);else e=e.slice(0,g);var h=f?5:9;var m=h+g;var w=new Uint8Array(m);w[0]=b;if(f){w[1]=a.id;w[2]=a.id>>8;w[3]=a.id>>16;w[4]=a.id>>24}else{var k=a.name;var u=Math.min(k.length,8);for(var r=0;r<u;r++)w[1+r]=k.charCodeAt(r)}w.set(e,h);y(w.buffer)};this.name=
"";this.flags=0;this.id=0;this.count=0}function Nb(){var b=window.opener;if(b)try{if(b.__sparkUser&&b.__sparkUser.session)return b.__sparkUser;else if(b.opener&&b.opener.__sparkUser.session)return b.opener.__sparkUser}catch(a){}return null}function jb(){var b="";if(k&&V(k.connectif)&&k.symlink&&"sessionStorage"in window){b="SV_"+k.symlink;if(k.domain)b+=k.domain;if(k.user)b+=k.user}return b}function Ob(){var b=jb();var a="";if(b){a=sessionStorage[b]||"";if(a)a="&preSymJoin="+a}return a}function Pb(b,
a){var c=0;var d=q.size();var e=new Array(d);var t=new Array(d);var g=0;var h=0;var m=0;var w=0;var E=0;var u=0;var r="";var n;if(b){t=v.parseMonitorDef(b);for(d=t.length;c<d;c++){n=t[c];if(n[0]<m)m=n[0];if(n[1]<w)w=n[1];if(n[2]>E)E=n[2];if(n[3]>u)u=n[3]}if(m<0)g=-m;if(w<0)h=-w;if(a<0)n=[m,w,E,u];else n=t[a];k.width=n[2]-n[0]+1;k.height=n[3]-n[1]+1;var l=q.getSurface(0);l.setMonitor(n[0],n[1],n[2],n[3]);if(g||h){n=l.getMousePosition();n.left+=g;n.right+=g;n.top+=h;n.bottom+=h;for(c=0;c<d;c++){n=t[c];
n[0]+=g;n[1]+=h;n[2]+=g;n[3]+=h}}v.setMonitorLayout(t);if(a<0)v.setMonitorCount(0);f.reconnectOnResize=false;return"&monitorDef="+b+"&width="+k.width+"&height="+k.height}if(d>1&&!R){for(var D;c<d;c++){D=q.getSurface(c);n=D.getMousePosition();if(n.left<m)m=n.left;if(n.top<w)w=n.top;if(n.right>E)E=n.right;if(n.bottom>u)u=n.bottom;e[c]=n;if(r)r+=",";r+=n.left+":"+n.top+":"+n.right+":"+n.bottom}if(m<0)g=-m;if(w<0)h=-w;for(c=0;c<d;c++){n=q.getSurface(c).getMousePosition();if(g||h){n.left+=g;n.right+=g;
n.top+=h;n.bottom+=h}t[c]=[n.left,n.top,n.right,n.bottom,n.left==g&&n.top==h?1:0]}v.setMonitorLayout(t);f.reconnectOnResize=false}if(r){svGlobal.logger.warn("MonitorDef:"+r);k.width=E-m+1;k.height=u-w+1;r="&monitorDef="+r+"&width="+k.width+"&height="+k.height}return r}function kb(){if(I)return;la=false;if(R)qa(F,G,false,false);var b="";if(ea)J.init(false,true,false,0);else{b=p+"&width="+F+"&height="+G+"&server_bpp="+ua+"&audio="+(M.available||Sa)+Ob()+Pb(k.monitorDef,k.monitor);if(p.indexOf("waWidth")<
0)b+=Jb();var a=new Date;b+="&tzOffset="+a.getTimezoneOffset()+"&time="+a.getTime();if(k.soundPref==undefined){k.soundPref=0;b+="&soundPref=0"}var c="";var d="";var e="";for(e in ma){var t=ma[e];if("flags"in t){if(c){c+=",";d+=","}c+=t.name;d+=t.flags}}if(c){b+="&channelName="+c;b+="&channelFlags="+d}c="";for(e in na){t=na[e];if("flags"in t){if(c)c+=",";c+=t.name}}if(c)b+="&gwChannelName="+c;var g=Nb();if(g){var h=g.account;var m=g.session;if(h)b+="&account="+h;if(m)b+="&session="+m}var w=hi5.browser.isTouch&&
(window.innerWidth>=1024||window.innerHeight>=768);k.audioRecord=V(k.audioRecord)&&hi5.audio.recordable;J.init(w,!!k.remotefx,k.audioRecord,k.soundPref);if(k.audioRecord)b+="&audioRecord=on";if(J.count>0)b+="&dvcChannels="+J.names.join(",");if(hi5.browser.binaryWS())b+="&binary=on";if(x.existingFile)b+="&existingFile="+x.existingFile;b+="&isTouch="+w+"&gatewayAddr="+encodeURIComponent(ka());b=f.modifyURL(b);if(x.copyTextOnly&&V(k.mapClipboard))b+="&copyTextOnly=on";p=b}var E=x.updateFix===true;if(x.wsPost==
undefined)x.wsPost=false;if(N){if(ea){ea.onopen=Ta;ea.onclose=Aa;ea.onmessage=function(b){Ua.data=b.data;N.postMessage(Ua,[Ua.data])}}N.postMessage({type:0,cmd:0,data:{"addr":b,"width":F,"height":G,"server_bpp":ua,"libPath":hi5.libPath,"libMin":hi5.libMin,"updateFix":E,"wsPost":x.wsPost}})}else{A=new RdpGeneral(ea||b,F,G,ua,v,false,x.wsPost);if(E)A.enableUpdateFix();A.run()}svGlobal.logger.info(p);if(N)N.addEventListener("message",lb,false);else{A.onopen=Ta;A.onmessage=mb;A.onclose=Aa;A.onerror=Pa;
A.oninfo=Qa;A.onloggedin=nb;A.onresolutionchange=function(b,a){qa(b,a,false,k.monitorDef&&k.monitor>=0?true:false)};A.onAltSecWindows=ob;A.onMoveCursor=Va;A.onCloseSurface=pb;A.onColorChange=za;A.onHistoryReceived=function(){Wa()}}var u=q.getSurface(q.size()-1);if(u)if(R){if(u)u.remoteApp=new ib(k["exe"],k["args"],"")}else ha(L(),u.getWindow());if(k.invitation){var r=null;if(u)r=u.initChat(k.expert);Ba=new f.GatewayChannel;Ba.name="C_H_A_T";Ba.process=function(b){var a=b.getUnicodeString(b.getEnd()-
b.getPosition(),true);if(r)r.add(a,k.novice)};if(r)r.onchat=function(b){if(I){var a=new Array(b.length*2);var d=new hi5.DataBuffer(a,0,a.length);d.setUnicodeString(b);d.markEnd();Ba.send(d)}};f.addGatewayChannel(Ba)}if(Sa&&!va){va=hi5.browser.loadFlash(x.flash||hi5.libPath+"plugin.swf");if(va)qb=true}}function lb(b){var a=b.data;switch(a.type){case 1:switch(a.event){case 0:Ta();break;case 1:Aa(a.expected);break;case 2:Pa(a.code);break;case 3:Qa(a.code);break;case 4:nb();break;case 5:qa(a.w,a.h,false,
k.monitorDef&&k.monitor>=0?true:false);break;case 6:Va(a.x,a.y,true);break;case 7:pb();break;case 8:if(a.id==0)Wa();if(T)T.check(a.id>1?15555:0);break;case 9:za(a.color);break;default:svGlobal.logger.warn("Invalid worker event "+a.type)}break;case 2:v.setRGBs(a.x,a.y,a.w,a.h,a.pixel,a.offset,a.scansize);break;case 3:v.moveArea(a.srcx,a.srcy,a.cx,a.cy,a.dx,a.dy);break;case 5:v.fillRect(a.l,a.t,a.w,a.h,a.color);break;case 6:v.drawLine(a.x1,a.y1,a.x2,a.y2,a.color);break;case 7:v.bitBlt(a.opcode,a.dstwidth,
a.x,a.y,a.cx,a.cy,a.src,a.srcwidth,a.srcx,a.srcy);break;case 8:v.drawLineExt(a.x1,a.y1,a.x2,a.y2,a.color,a.opcode);break;case 9:rb(a);break;case 10:mb(a);break;case 11:Q.attach(a.data,0,a.data.length);ob(Q,a.size);break;case 12:v.drawText(a.font,a.flags,a.mixmode,a.foregroundColor,a.backgroundColor,a.clipLeft,a.clipTop,a.clipcx,a.clipcy,a.boxLeft,a.boxTop,a.boxcx,a.boxcy,a.x,a.y,a.length,a.text,a._left,a._top,a._right,a._bottom);break;case 13:v.drawBitmap(a.cacheID,a.cacheIDX,a.x,a.y,a.cx,a.cy,a.srcx,
a.srcy,a.opcode);break;case 14:v.saveDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 15:v.restoreDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 16:v.putFont(a.font,a.character,a.glyph);break;case 17:v.putCursor(a.idx,a.cursor);break;case 18:v.setCursor(a.idx);break;case 19:v.getHistory(y);if(T)T.check(15555);break;case 20:Q.attach(a.data,a.off,a.data.length-a.off);v.setHistory(a.order,Q);break;case 21:v.putBitmap(a.id,a.idx,a.bitmap);break;default:svGlobal.logger.warn("Invalid worker msg "+a.type)}}
function sb(b){if(T)T.check(b)}function Ta(){I=true;if(f.onopen)f.onopen();if(x.joinCloseMode)f.setJoinCloseMode(x.joinCloseMode)}function pb(){q.close()}function Ac(b){svGlobal.logger.warn(b)}function mb(b){var a;var c=b.data;if(typeof c!="string"){var d=new Uint8Array(c);Q.attach(d,0,c.byteLength);a=Q.getLittleEndian16();switch(a){case 28:Qb(Q);break;case 55:Rb(Q);if(T)T.check();break;case 56:tb(Q.getUnicodeString(Q.getEnd()-Q.getPosition(),false));break;case 60:ub(Q);break;case 62:vb(Q.getUnicodeString(Q.getEnd()-
Q.getPosition(),false));break;case 63:wb(Q);if(T)T.check();break;case 64:Sb(Q);if(T)T.check();break;case 146:Tb(Q);break;default:if(f.onunknownmessage)f.onunknownmessage(a,Q);else svGlobal.logger.warn("@TODO:"+a+"\n")}}else{a=parseInt(c.substring(0,2),16);var e=c.substring(2);switch(a){case 0:Ub();break;case 15:Vb(e);break;case 26:Wb(e);break;case 27:Xb(e);break;case 50:Yb(e);break;case 51:Zb(e);break;case 54:$b(e);break;case 55:ac(e);break;case 56:tb(e);break;case 57:bc(e);break;case 58:cc(e);break;
case 59:dc(e);break;case 60:ub(b64ToBuffer(e));break;case 61:ec(e);break;case 62:vb(e);break;case 63:wb(b64ToBuffer(e));break;default:if(f.onunknownmessage)f.onunknownmessage(a,e);else svGlobal.logger.warn("@TODO:"+c+"\n")}}}function Bc(b,a){var c=b.length+8;var d=new Uint8Array(c);var e=new RdpBuffer(d,0,c);d[0]=29;d[2]=1;d[3]=a;e.skipPosition(4);e.setLittleEndian32(b.length);e.setAscllString(b);return d}function Wa(){if(oa||X)return;X=true;if(f){if(x.pingInterval)f.startPing(x.pingInterval);if(f.onready)f.onready()}}
function Tb(b){var a=b.getByte();switch(a){case 0:var c=new Uint8Array(2);c[0]=146;c[1]=1;y(c.buffer);break;case 1:break;case 5:var d=b.getByte();var e=b.getLittleEndian32();if(d==0)if(!(e&4)){W^=65536;q.execute("setFeature",[W])}}}function Qb(b){var a=b.getAscllString(8);var c=na[a];if(c!=null)c.process(b);else svGlobal.logger.warn("Channel "+a+" not found")}function Ub(){var b=p.substring(p.indexOf("?")+1);y("00"+b);y("87"+navigator.userAgent)}function bc(b){var a=b.split("\t");svGlobal.logger.debug(b);
var c=q.getWinById(parseInt(a[0]));if(c){if(!q.hasApp(a[1])){var d=q.getOwnerSurface(c);if(d&&d.railWin){d.railWin.appId=a[1];d.railWin.addApp(a[1])}if(f.onremoteappstart)f.onremoteappstart({"id":a[1]});if(c.isVisible()&&c.titleInfo)f.ontitlechange(d.railWin.getFullTitle(c.id),a[1])}c.appId=a[1]}}function fc(b,a){var c=0;var d=false;this.width=b;this.interval=a;var e=0;this.start=function(){if(d)return;d=true;c=setInterval(function(){var a=q.getFocused();if(a&&I){var d=a.getThumbnail(b);if(d&&d.length!=
e){y("8E7"+d);e=d.length}}},a)};this.stop=function(){clearInterval(c)}}function gc(b,a){if(fa&&(fa.width!=b||fa.interval!=a)){fa.stop();fa=null}if(!fa)fa=new fc(b,a);fa.start()}function xb(){if(fa){fa.stop();fa=null}}function Vb(b){if(!f)return;Xa=false;wa=f.reconnectTimes;if(f&&f.mode==0||V(k.connectif))Wa();var a="";for(a in ma){var c=ma[a];if(c&&c.onopen)c.onopen()}for(a in na){c=na[a];if(c&&c.onopen)c.onopen()}if(b){var d=JSON.parse(b);if(d.capability&&f)f.sessionInfo.suppressOutput=d.capability.suppressOutput}}
function wb(b){var a=b.getAscllString(8);var c=ma[a];if(c&&c.process)c.process(b)}function Sb(b){var a=b.getByte();var c=b.getLittleEndian32();switch(a){case 1:var d=b.getAscllString();if(J[d]){J[d].id=c;svGlobal.logger.info("DVC create, name:"+d+" id:"+c);J[c]=J[d];if(J[c].onopen)J[c].onopen()}break;case 3:if(J[c])J[c].process(b);break;case 4:if(J[c]&&J[c].onclose)J[c].onclose();svGlobal.logger.info("close DVC, id:"+c)}}function vb(b){var a=parseInt(b.substring(0,1),16);var c;var d;var e=b.substring(1);
var t=false;var g=f.sessionInfo.appInfo;switch(a){case 0:d=JSON.parse(e);gb();I=true;var h=d.width;var m=d.height;if(h==F&&m==G)break;qa(h,m,true,false);break;case 1:d=JSON.parse(e);f.sessionInfo.joinedSessions.push(d.numericId);g.sessions[d.numericId]=d.name||d.__ip;if(!g.joined||x.alertJoin){if(f.onsessionjoin)t=f.onsessionjoin(d);if(!t)f.showMessage(__svi18n.info.joinsession.applyArgs([d.numericId,d.__ip,d.name]))}break;case 2:d=JSON.parse(e);f.sessionInfo.joinedSessions.removeElm(d.numericId);
delete g.sessions[d.numericId];if(!g.joined||x.alertJoin){if(f.onsessionexit)t=f.onsessionexit(d);if(!t)f.showMessage(__svi18n.info.exitsession.applyArgs([d.numericId,d.__ip,d.name]))}break;case 3:d=JSON.parse(e);if(g.joinMode!=d.mode){g.joinMode=d.mode;var w=hi5.$("joinSelect");if(w)w.value=d.mode}if(g.hasControl)return;g.hasControl=true;q.setReadOnly(false,d.mode==2);c=hi5.$("requestControl");if(c)c.disabled=true;if(f.ongivecontrol)t=f.ongivecontrol();if(t)break;f.showMessage(__svi18n.info.givecontrol,
null,5E3);break;case 4:d=JSON.parse(e);q.setReadOnly(true,d.mode==2);g.hasControl=false;c=hi5.$("requestControl");if(c)c.disabled=false;if(f.ontakebackcontrol)t=f.ontakebackcontrol();if(t)break;f.showMessage(__svi18n.info.nocontrol,null,5E3);break;case 5:var E=function(){f.refuseControl(d.numericId);this.destroy()};var u=function(){f.giveControl(d.numericId);this.destroy();if(v.isPaused())f.pauseSession(f.sessionInfo.appInfo.numericId,false)};d=JSON.parse(e);if(f.onrequirecontrol)t=f.onrequirecontrol(d);
if(t)break;var r=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);var n=__svi18n.info.recontrol;if(v.isPaused)n+="<br><br>"+(__svi18n.info.autoresume||"");hi5.notifications.notify({"title":r,"msg":n,"cbYes":u,"cbNo":E});break;case 6:q.execute("setTouchRemoting",[true]);break;case 7:d=JSON.parse(e);if(d.width&&d.height)qa(d.width,d.height,true,k.monitorDef&&k.monitor>=0?true:false);if(d.color){za(d.color,true);svGlobal.logger.warn("Color depth changed to:"+d.color)}break;case 8:d=JSON.parse(e);
Xa=true;if(f.onrequestcredential&&f.onrequestcredential(d,Ca.reconnect))return;if(f.onautherror&&f.onautherror(d,Ca.reconnect))return;var l=q.getFocused();l.requestCredential(d,Ca.reconnect);break;case 9:d=JSON.parse(e);if(d.interval>0&&d.width>0)gc(d.width,d.interval);else xb();break;case 11:var D=function(){f.allowJoin(d.numericId,false);this.destroy()};var p=function(){f.allowJoin(d.numericId,true);this.destroy()};d=JSON.parse(e);if(f.onrequirejoin)t=f.onrequirejoin(d);if(t)break;r=__svi18n.info.title.applyArgs([d.name,
d.numericId,d.__ip]);hi5.notifications.notify({"title":r,"msg":__svi18n.info.reqjoin,"cbYes":p,"cbNo":D})}}function ec(b){var a=JSON.parse(b);switch(a.type){case 0:qa(a.width,a.height,true,false);za(a.color);var c=a.server;if(c&&f)f.server=a.server;yb=a.length;var d=q.getFocused();R=a.isRail==true;if(d){d.setAutoScale(!R);if(c)ha(L(),d.getWindow());c=a.keyboard;if(typeof c!="undefined"&&c==0)d.setUnicode(true);c=a.mapDisk;if(c){Ya=true;hb(d)}}if(f.onopened)f.onopened(a);break;case 1:var e=a.duration;
if(f.onprogress)f.onprogress(e,yb);break;case 2:if(a.status==2){gb();I=true}else{var t=a.status==0;if(t!=v.isPaused()){if(f.onsessionpause&&f.onsessionpause(t,a))break;v.pause(t);if(!t)q.repaint(0,0,v.width-1,v.height-1);if(a.warn)f.showMessage(t?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)}}}}function ub(b){var a=b.getByte();switch(a){case 32:hc(b)}}function hc(b){if(v.isPaused())return;var a=b.getLittleEndian16();var c=b.getLittleEndian16();var d=b.getLittleEndian16();var e=undefined;
var t=undefined;if(!x.noCursorName){e=b.getLittleEndian32();if(f.sessionInfo.appInfo)t=f.sessionInfo.appInfo.sessions[e]}Va(c,d,true,t,e)}function Va(b,a,c,d,e){if(v.isPaused())return;q.getFocused().moveCursor(b,a,c,d,e)}function rb(b){q.setCursor(b)}function dc(b){var a=hi5.Base64.dec(b,0);var c=new RdpBuffer(a,0,a.length);W=c.getLittleEndian32();if(oa||!(W&16)&&!(W&65536)){Ya=false;S=null}else if(W&128)S=null;if(W&64)f.showMessage(__svi18n.info.recording);q.execute("setFeature",[W])}function tb(b){var a=
JSON.parse(b);var c=a;zb=a.session;if(!c.server)c.server=L();var d=hi5.$("joinSelect");if(d)d.value=c.joinMode;d=hi5.$("requestControl");if(d)d.disabled=c.hasControl;if(a.joined)q.execute("setAutoScale",[true]);else{f.mode=0;if(V(k.connectif))q.setSize(F,G);if(x.disableJoinedAppResize)f.windowState=0}var e=x.page&&x.page.join||"join.html";var t=ka();e=t+"/"+e+"?id="+(a.joined||a.numericId);var g=a.webAddress;if(g&&g.length>0&&g.toLowerCase()!=t.toLowerCase()){var h=g.indexOf("://");f.protocol=g.substring(0,
h)=="http"?"ws":"wss";f.gateway=g;e+="&gateway="+encodeURIComponent(g)}e=f.modifyURL(e);c.joinLink=e;f.sessionInfo.appInfo=c;if("isApp"in c&&R!==c.isApp){R=c.isApp;fb();q.setSize(F,G,R?"hidden":null);v=db(F,G);if(!la)q.execute("setAutoScale",[true])}if(a.ver&&a.ver!=svGlobal.version)svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);if(f.onsessionstart)f.onsessionstart(f.sessionInfo)}function cc(b){if(!S)return;var a=parseInt(b.charAt(0),10);b=b.substring(1);if(a==5){S.notifyFiles(JSON.parse(b));
return}var c=b.split("\t");switch(a){case 1:S.confirmId(c[0],c[1],c[2]);break;case 2:S.read(c[0],parseInt(c[1],10),parseInt(c[2],10));break;case 4:S.close(c[0]);break;case 9:var d='<a href="'+c[0]+'" download="'+c[1]+'" target="_blank">'+__svi18n.info.fileReady+"</a>";q.getFocused().showMessage({msg:d,title:__svi18n.info.download})}}function ac(b){var a=parseInt(b.substring(0,1),16);var c=b.substring(1);switch(a){case 0:ic(c);break;case 1:jc(c);break;case 2:Ab();case 3:}}function Rb(b){var a=b.getByte();
switch(a){case 0:kc(b);break;case 1:lc(b);break;case 2:Ab();case 3:}}function Ab(){}function jc(b){function a(b){var a=0;b=b*m;for(k=0;k<m;k++)a|=(f[b+k]&255)<<k*8;if(a>u){a-=n;a/=-r}else a/=u;return a}function c(b){return function(){y("8A"+b)}}if(!M.available||v.isPaused())return;var d=b.indexOf("\t");var e=b.substring(0,d);var f=hi5.Base64.dec(b,d+1);var g=C.tag!=1;if(g){if(!xa)xa=new MSGSM;f=xa.decode(f,0,f.length)}var h=C.bitsPerSample;var m=h>>3;var w=Math.floor(f.length/m);var k=0;var u=Math.pow(2,
h-1)-1;var r=-u-1;var n=Math.pow(2,h);var l=0;var D=C.channels;var p=Math.floor(w/D);var q=M.getBuffer(p);var x=q.getChannelData(0);var Z=q.getChannelData(1);for(l=0;l<p;){var ja=l*2;var ra=a(ja);if(D==1){x[l]=ra;Z[l]=ra}else{x[l]=ra;Z[l]=a(ja+1)}l++}var U=M.playBuffer(q);setTimeout(c(e),(U-M.delay)*1E3)}function lc(b){function a(b){return function(){y("8A"+b)}}var c=b.getByte();var d=b.getLittleEndian16();var e=Date.now();b.skipPosition(8);var f=Za(b,c,d,0);f=(f-M.delay)*1E3;if(!oa){d+=Date.now()-
e+f;setTimeout(a(c+","+d),f)}}function Za(b,a,c,d){if(!qb||v.isPaused())return;var e=0;var f=0;var g=b.getPosition();var h=b.getData();if(!d)d=b.getEnd()-g;var m=d;if(C.tag==41222){var w=M.getContext();if(w)w.decodeAudioData(h.buffer.slice(g),function(b){var a=M.playBuffer(b);if(!oa)setTimeout(sendLater(Qa),(a-M.delay)*1E3)},function(b){svGlobal.logger.warn(b)});return}var k=C.tag!=1;if(k){if(!xa)xa=new MSGSM;h=xa.decode(h,g,m);g=0;m=h.length}var u=C.bitsPerSample;var r=u>>3;var n=Math.floor(m/r);
var l=0;var p=0;var q=0;if(!k){l=Math.pow(2,u-1)-1;p=-l-1;q=Math.pow(2,u)}var x=C.channels;if(va){var y="";if(k){for(;e<m;e++){if(e>0)y+=",";y+=h[e]+","+h[e]+","+h[e]+","+h[e]}va.write(y);return d/65*.025}else{for(;e<m;){if(e>0)y+=",";f=h[e++]|h[e++]<<8;if(f<9)f=0;else if(f>l){f-=q;f/=-p}else f/=l;y+=f;if(x==1)y+=","+f}va.write(y);return d/r/C.samplePerSec*.6}}var Z=g;var ja=Math.floor(n/x);var ra=M.getBuffer(ja);var U=ra.getChannelData(0);var ia=ra.getChannelData(1);e=0;if(k)for(;e<ja;){if(x==1)ia[e]=
U[e]=h[Z++];else{U[e]=h[Z++];ia[e]=h[Z++]}e++}else for(;e<ja;){f=h[Z++]|h[Z++]<<8;if(f>l){f-=q;f/=-p}else f/=l;if(x==1){U[e]=f;ia[e]=f}else{U[e]=f;f=h[Z++]|h[Z++]<<8;if(f>l){f-=q;f/=-p}else f/=l;ia[e]=f}e++}var A=M.playBuffer(ra);return A}function Bb(){if(N)N.postMessage({type:0,cmd:5,data:{tag:C.tag,channels:C.channels,samplePerSec:C.samplePerSec,bitsPerSample:C.bitsPerSample}})}function ic(b){var a=b.split("\t");C.tag=parseInt(a[0],10);C.channels=parseInt(a[1],10);C.bitsPerSample=parseInt(a[2],
10);C.samplePerSec=parseInt(a[3],10);svGlobal.logger.debug("Audio Format, tag="+C.tag+" channels="+C.channels+" bitsPerSample="+C.bitsPerSample+" samplePerSec="+C.samplePerSec);Bb()}function kc(b){C.tag=b.getLittleEndian16();C.channels=b.getLittleEndian16();C.samplePerSec=b.getLittleEndian32();b.skipPosition(6);C.bitsPerSample=b.getLittleEndian16();svGlobal.logger.info("Audio Format, tag="+C.tag+" channels="+C.channels+" bitsPerSample="+C.bitsPerSample+" samplePerSec="+C.samplePerSec);Bb()}function mc(b){var a=
null;this.available=false;this.delay=b;this.supportWebAudio=false;if(k.playSound==0||f.mode>0){a=hi5.audio.getAudioContext();if(a){this.available=true;this.supportWebAudio=true}}this.getContext=function(){return a};this.getBuffer=function(b){return a.createBuffer(2,b,C.samplePerSec)};var c=0;var d=null;var e=null;this.setVolume=function(b){if(b==1)d=null;else{if(!d)d=a.createGain();d.gain.value=b}};this.playBuffer=function(f){e=a.createBufferSource();e.buffer=f;if(d){e.connect(d);d.connect(a.destination)}else e.connect(a.destination);
var g=a.currentTime;var h=c>0?c:g+b;if(h<g)h=g;c=h+f.duration;if(e.start)e.start(h);else e.noteOn(h);return c-g};this.iOSFix=function(){if(a&&hi5.browser.isTouch&&hi5.browser.isSafari){var b=this.getBuffer(1024);var d=a.createBufferSource();d.buffer=b;d.connect(a.destination);if(d.start)d.start(0);else d.noteOn(0)}};this.close=function(){if(a){if(d)d.disconnect();if(e)e.disconnect();hi5.audio.releaseAudioContext()}}}function $b(b){var a=b.split("\t");b=ka()+a[0];b=f.modifyURL(b);svGlobal.logger.info("Downloading file:"+
b+" name:"+a[1]+" driver:"+a[2]);if(f.onprintingready)if(f.onprintingready({"link":b,"printerName":a[1],"pinterDriver":a[2]}))return;var c=q.getFocused();if(c)c.showPDF(b)}function Zb(b){q.setReadOnly(b=="1")}function Yb(b){if(!I)return;var a=parseInt(b.substring(0,1),10);b=b.substring(1);switch(a){case 1:nc(b);break;case 2:oc(b);break;case 5:pc(b)}}function pc(b){var a=q.getFocused();if(a&&b!="0")a.setIgnorePaste(true)}function oc(b){var a=q.getFocused();if(a)if(!a.processClipReq(b))if((x.clipWarnAlways||
!Cb)&&k&&!k["leagacyMode"]){f.showMessage(__svi18n.info.menucopy,null,5E3);Cb=true}}function qc(b){if(!f.openLink||b.length>2E3)return false;var a=b.indexOf(";");if(a>0)b=b.substring(a+1);var c=b;b=b.toLowerCase();var d=b.indexOf("http://")==0||b.indexOf("https://")==0||b.indexOf("ftp://")==0||b.indexOf("mailto:")==0||b.indexOf("tel:")==0||b.indexOf("callto:")==0;if(!d)if(b.indexOf("www.")==0){d=true;b="http://"+b}else if(b.indexOf("ftp.")==0){d=true;b="ftp://"+b}if(d){if(b.indexOf("\r")>0||b.indexOf("\n")>
0)return false;if(f.onurlredirection&&f.onurlredirection(d))return true;var e=q.getFocused();if(!e)return false;e.processLink(c);return true}return false}function nc(b){if(f.onservercopy&&f.onservercopy(b))return;qc(b);q.copyToClip(b);setTimeout(function(){y("883")},999)}function Cc(b){var a=b.getLittleEndian32().toString(16).toUpperCase();var c=__svi18n.serverStatus[a];if(f&&f.displayMsg)svGlobal.logger.info(c)}function Dc(){var b=f.sessionInfo.appInfo;if(b&&!b.joined&&la)svGlobal.logger.info("Recovering")}
function nb(){if(!la){setTimeout(function(){if(I)y("884")},999);if(f.onloggedin)f.onloggedin()}la=true;if(R)q.execute("setAutoScale",[false]);if(S)S.enabled=true;if(Ga&&!R){v.setContext(q.getFocused().context);q.repaint(0,0,v.width-1,v.height-1)}}function Wb(b){var a=JSON.parse(b);if(f.onnotify)f.onnotify(a);if(!a.name){if(svGlobal.log>0)console.erro("No error code for message:"+b);return}svGlobal.logger.info("msg="+b);if(a.type&&f.onerror)f.onerror(a);var c=__svi18n.errorCode["S"+a.name]||"";c+=
a.message;f.showMessage(c,null)}function Xb(b){q.drawLicense(b)}function Ec(b){return hi5.Base64.dec(b,0)}function Aa(b){if(!f)return;svGlobal.logger.warn("closed "+(f.sessionInfo.appInfo?f.sessionInfo.appInfo.numericId:0));var a=jb();if(a&&f.sessionInfo.appInfo&&f.mode==0)sessionStorage[a]=f.sessionInfo.appInfo.session;if(f){var c=f.mode==0;if(!I&&c)Pa("connection");var d=c&&(I||wa<f.reconnectTimes)&&wa>0&&!b;I=false;X=false;if(d){wa--;f.showMessage(__svi18n.info.reconnecting+" "+(f.reconnectTimes-
wa)+"/"+f.reconnectTimes,null,3E3);setTimeout(kb,5);svGlobal.logger.info("Reconnecting..."+wa);return}}if(Xa){svGlobal.logger.info("Req credential");return}if(N){N.postMessage({type:0,cmd:4});N.removeEventListener("message",lb,false)}if(S){S.release();S=null}p=null;K=null;if(J){J.close();J=null}if(ma)hi5.Arrays.release(ma);if(na)hi5.Arrays.release(na);xb();if(M){M.close();M=null}try{if(f.onclose)f.onclose(b);else svGlobal.logger.info("onclose: null");if(q){q.close();q=null}}catch(e){}Q=null;if(A){A.onopen=
null;A.onmessage=null;A.onclose=null;A.onerror=null;A=null}Ca=null;q=null;if(v){v.release();v=null}if(!hi5.browser.isChromeApp)window.removeEventListener("unload",f.close,false);else chrome.runtime.onSuspend.removeListener(f.close);f=null;if(window&&window.$rdp)window.$rdp=null}function Fc(b,a){}function ob(b,a){var c=b.getLittleEndian32();if((c&16777216)!=0)rc(c,b);else if((c&33554432)!=0)svGlobal.logger.info("XXX Alt Sec window Notify="+c);else if((c&67108864)!=0)sc(c,b);else svGlobal.logger.info("XXX Alt Sec window order flgas="+
c)}function rc(b,a){var c=a.getLittleEndian32();if((b&1073741824)!=0)tc(c,a,b&8192);else if((b&2147483648)!=0)svGlobal.logger.info("XXX rail cache icon, winId="+c);else if((b&536870912)!=0)uc(c);else vc(a,b,c)}function tc(b,a,c){var d=a.getLittleEndian16();var e=a.getByte();var f=e==65535;var g=a.getByte();var h=a.getLittleEndian16();var m=a.getLittleEndian16();var w=0;if(g<16)w=a.getLittleEndian16();var k=a.getLittleEndian16();var u=a.getLittleEndian16();var r=a.getBytes(k);var n=w?a.getBytes(w):
null;console.log("icon, winId:"+b+" w:"+h+" h:"+m+" big:"+c+" Bpp:"+g,r);if(g>=8){var l=q.getFocused();if(l&&l.onremoteappicon){var p=new hi5.graphic.Bitmap(h,m,32);var x=a.getPosition();var v=new Uint8Array(h*m*4);var y=a.getPosition();var Z=y+u;var ja=0;var A=a.getData();var U=0;var ia=0;var C=0;for(var ya=0;y<Z;)switch(g){case 16:ja=A[y++]|A[y++]<<8;if(ja){ya=ja>>7&248;C=ja>>2&248;ia=ja<<3&248;ya|=ya>>5;C|=C>>5;ia|=ia>>5;v[U++]=ia;v[U++]=C;v[U++]=ya;v[U++]=255}else U+=4;break;case 32:v[U++]=A[y++];
v[U++]=A[y++];v[U++]=A[y++];v[U++]=A[y++]}p.putPixels(v,0,v.length);console.log(p.getDataURL());var F=q.getWinById(b);l.onremoteappicon(F,p)}}}function sc(b,a){svGlobal.logger.info("*** -- Alt Sec window Desktop="+b);if((b&1)!=0){svGlobal.logger.info("Desktop non monitored flags="+b);return}if((b&32)!=0){var c=a.getLittleEndian32();svGlobal.logger.info("Desktop monitored flags="+b+" winId="+c);q.setTitle(c);if(!v.getContext()){var d=q.getFocused();if(d)v.setContext(d.context)}}else return;if((b&16)!=
0){var e=a.getByte();if(e>0){var f=q.zOrders;f.length=e;for(var g=0;g<e;g++){f[g]=a.getLittleEndian32();svGlobal.logger.info("---zorders:"+f[g])}}}}function uc(b){svGlobal.logger.info("***** delete winId="+b);q.delWin(b)}function vc(b,a,c){if(!R)R=true;var d=(a&268435456)==0;svGlobal.logger.info("\n\n=========== winId="+c+" existed="+d);var e=q.getWinById(c);if(e)d=true;else e=new q.LocalWin(c);if(!e){svGlobal.logger.warn("XXX, No win with id:"+c);return}if((a&2)!=0){e["ownerWinid"]=b.getLittleEndian32();
svGlobal.logger.info("***** ownerWinid="+e["ownerWinid"])}var f=false;if((a&8)!=0){f=true;e["style"]=b.getLittleEndian32();e["extStyle"]=b.getLittleEndian32();svGlobal.logger.info("***** winId="+c+" style="+e["style"]+" extStyle="+e["extStyle"]);svGlobal.logger.info("*****--- WS_POPUP="+((e["style"]&2147483648)!=0));svGlobal.logger.info("*****--- WS_DLGFRAME="+((e["style"]&4194304)!=0));svGlobal.logger.info("*****--- DS_MODALFRAME="+((e["style"]&128)!=0));svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+
((e["extStyle"]&1)!=0));svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+((e["extStyle"]&128)!=0));svGlobal.logger.info("*****--- WS_BORDER="+((e["style"]&8388608)!=0));svGlobal.logger.info("*****--- WS_CAPTION="+((e["style"]&12582912)!=0));svGlobal.logger.info("*****--- WS_OVERLAPPED="+((e["style"]&0)!=0));svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+((e["style"]&13565952)!=0));svGlobal.logger.info("*****--- WS_POPUPWINDOW="+((e["style"]&2156396544)!=0));svGlobal.logger.info("*****--- WS_SIZEBOX="+
((e["style"]&262144)!=0));svGlobal.logger.info("*****--- WS_CHILD="+((e["style"]&1073741824)!=0));svGlobal.logger.info("*****--- WS_SIZEBOX="+((e["style"]&262144)!=0));svGlobal.logger.info("*****--- WS_EX_MDICHILD="+((e["extStyle"]&64)!=0));svGlobal.logger.info("*****--- WS_EX_LAYERED="+((e["extStyle"]&524288)!=0))}if((a&16)!=0){e.setShowState(b.getByte());svGlobal.logger.info("***** winId="+c+" showState="+e["showState"]);var g=e["showState"];if(g==2)if(x.noMinimize!=false)setTimeout(function(){e.exeCommand(61728)},
50)}var h=(a&4)!=0;if(h){var m=b.getLittleEndian16();e["titleInfo"]=b.getUnicodeString(m,false);svGlobal.logger.info("***** winId="+c+" title="+e["titleInfo"])}if((a&16384)!=0){e["clientOffsetX"]=b.getLittleEndian32();e["clientOffsetY"]=b.getLittleEndian32();svGlobal.logger.info("***** winId="+c+" coffX"+e["clientOffsetX"]+" coffY="+e["clientOffsetY"])}if((a&65536)!=0){e["clientAreaWidth"]=b.getLittleEndian32();e["clientAreaHeight"]=b.getLittleEndian32();svGlobal.logger.info("***** winId="+c+" cw"+
e["clientAreaWidth"]+" ch="+e["clientAreaHeight"])}if((a&131072)!=0)e["rpContent"]=b.getLittleEndian32();if((a&262144)!=0)e["rootParentHandle"]=b.getLittleEndian32();if((a&2048)!=0){var w=b.getLittleEndian32();var k=b.getLittleEndian32();e["winOffsetX"]=w;e["winOffsetY"]=k;svGlobal.logger.info("***** winId="+c+" offX"+e["winOffsetX"]+" offY="+e["winOffsetY"])}if((a&32768)!=0){e["winClientDeltaX"]=b.getLittleEndian32();e["winClientDeltaY"]=b.getLittleEndian32();svGlobal.logger.info("***** winId="+
c+" dX"+e["winClientDeltaX"]+" dY="+e["winClientDeltaY"])}if((a&1024)!=0){e["winWidth"]=b.getLittleEndian32();e["winHeight"]=b.getLittleEndian32();svGlobal.logger.info("***** winId="+c+" w"+e["winWidth"]+" h="+e["winHeight"])}if((a&256)!=0){var u=b.getLittleEndian16();if(u>0)b.skipPosition(u*8)}if((a&4096)!=0){e["visibleOffsetX"]=b.getLittleEndian32();e["visibleOffsetY"]=b.getLittleEndian32()}if((a&512)!=0){var r=b.getLittleEndian16();e["numVisibilityRects"]=r;if(r>0)b.skipPosition(r*8)}if(!d)q.addWin(e);
else q.onWinChange(e);if(h)q.setTitle(c)}function eb(b,a){function c(b,a,d,c,e,f){var l=b+e;var h=a+f;var g=0;var m=0;if(z[0].set)for(;m<c;m++)z[h+m].set(z[a+m].subarray(b,b+d),l);else for(;m<c;m++){var n=z[h+m];var k=z[a+m];for(g=0;g<d;g++)n[l+g]=k[b+g]}}function d(b,a,d,c,e,f){var l=b+e;var h=a+f;var g=0;var m=0;if(z[0].set)for(m=c-1;m>=0;m--)z[h+m].set(z[a+m].subarray(b,b+d),l);else for(m=c-1;m>=0;m--){var n=z[h+m];var k=z[a+m];for(g=0;g<d;g++)n[l+g]=k[b+g]}}function e(b,a,d,c,e,f){var l=b+e;var h=
a+f;var g=0;var m=0;var n=0;var k=0;for(g=d-1;g>=0;g--){n=l+g;k=b+g;for(m=0;m<c;m++)z[h+m][n]=z[a+m][k]}}function f(b,a,d,c,e,l){var g=b+e;var h=a+l;var m=0;var n=0;var k=0;for(var w=0;m<d;m++){k=g+m;w=b+m;for(n=0;n<c;n++)z[h+n][k]=z[a+n][w]}}function g(b,a,d,c,e){if(e.width>0)e.union(b,a,d,c);else{e.x=b;e.y=a;e.width=d;e.height=c}}function h(b,a,d,c){var e;for(Da=0;Da<R;Da++){e=Q[Da];if(b>=e[0]&&a>=e[1]&&d<=e[2]&&c<=e[3])return S[Da]}return null}function m(b,a,d,c){if(!R)g(b,a,d,c,ga);else{var e=
h(b,a,b+d-1,a+c-1);if(e)g(b,a,d,c,e)}}function k(b,a,d,c,e,f,l){var g=e*d+c;var h=b.setRGB;var m=b.getRGB;for(var n=0;n<l;n++){for(var w=0;w<f;w++){if(b){var u=m(c+w,e+n);h(c+w,e+n,~u&16777215)}else a[g]=~a[g]&16777215;g++}g+=d-f}}function p(b,a,d,c,e,f){var l=b.setRGB;for(var g=d;g<d+e;g++)for(var h=c;h<c+f;h++)l(g,h,0)}function u(b,a,d,c,e,f){var l=b.setRGB;for(var g=d;g<d+e;g++)for(var h=c;h<c+f;h++)l(g,h,16777215)}function r(b,a,d,c,e,f,l,g,h){if(!f)b.moveArea(g,h,c,e,a-g,d-h);else b.setRGBs(a,
d,c,e,f,h*l+g,l)}function n(b,a,d,c,e,f,l,g,h,m){var n=m*g+h;var k=b.setRGB;var w=b.getRGB;for(var u=0;u<f;u++){for(var r=0;r<e;r++)k(d+e,c+f,~(w(d+e,c+f)|l[n])&16777215);n+=g-e}}function l(b,a,d,c,e,f,l,g,h,m){var n=m*g+h;var k=b.setRGB;var w=b.getRGB;for(var u=0;u<f;u++){for(var r=0;r<e;r++){var t=w(d+e,c+f);k(d+e,c+f,t&(~l[n]&16777215));n++}n+=g-e}}function q(b,a,d,c,e,f,l,g,h,m){var n=m*g+h;for(var k=0;k<f;k++){for(var w=0;w<e;w++){var u=z[c+k][d+w];z[c+k][d+w]=u^l[n]&16777215|4278190080;n++}n+=
g-e}}function x(b,a,d,c,e,f,l,g,h,m){var n=m*g+h;var k=b.setRGB;var w=b.getRGB;for(var u=0;u<f;u++){for(var r=0;r<e;r++){var t=w(d+r,c+u);k(d+r,c+u,~(t&l[n])&16777215);n++}n+=g-e}}function v(b,a,d,c,e,f,l,g,h,m){var n=m*g+h;var k=b.setRGB;var w=b.getRGB;for(var u=0;u<f;u++){for(var r=0;r<e;r++){var t=w(d+r,c+u);k(d+r,c+u,t&(l[n]&16777215));n++}n+=g-e}}function y(b,a,d,c,e,f,l,g,h,m){var n=m*g+h;var k=b.setRGB;var w=b.getRGB;for(var u=0;u<f;u++){for(var r=0;r<e;r++){var t=w(d+r,c+u);k(d+r,c+u,t^~l[n]&
16777215);n++}n+=g-e}}function Z(b,a,d,c,e,f,l,g,h,m){var n=m*g+h;var k=b.setRGB;var w=b.getRGB;for(var u=0;u<f;u++){for(var r=0;r<e;r++){var t=w(d+r,c+u);k(d+r,c+u,t|~l[n]&16777215);n++}n+=g-e}}function A(b,a,d,c,e,f,l,g,h,m){var n=m*g+h;var k=b.setRGB;var w=b.getRGB;for(var u=0;u<f;u++){for(var r=0;r<e;r++){var t=w(d+r,c+u);k(d+r,c+u,t|l[n]&16777215);n++}n+=g-e}}function C(b,a,d,c,e,f){var g;var l;if(a==c)if(d>b){l=d-b;if(l<1)return;for(g=0;g<l;g++)U(f,b+g,a,e)}else{l=b-d;if(l<1)return;for(g=0;g<
l;g++)U(f,d+g,a,e)}else if(c>a){l=c-a;if(l<1)return;for(g=0;g<l;g++)U(f,b,a+g,e)}else{l=a-c;if(l<1)return;for(g=0;g<l;g++)U(f,b,c+g,e)}}function U(b,a,d,c){var e=ca;if(!e)return;var f=e.getRGB(a,d);switch(b){case 0:e.setRGB(a,d,0);break;case 1:e.setRGB(a,d,~(f|c)&16777215);break;case 2:e.setRGB(a,d,f&(~c&16777215));break;case 3:e.setRGB(a,d,~c&16777215);break;case 4:e.setRGB(a,d,(~f&c)*16777215);break;case 5:e.setRGB(a,d,~f&16777215);break;case 6:e.setRGB(a,d,f^c&16777215);break;case 7:e.setRGB(a,
d,~f&c&16777215);break;case 8:e.setRGB(a,d,f&(c&16777215));break;case 9:e.setRGB(a,d,f^~c&16777215);break;case 10:break;case 11:e.setRGB(a,d,f|~c&16777215);break;case 12:e.setRGB(a,d,c);break;case 13:e.setRGB(a,d,(~f|c)&16777215);break;case 14:e.setRGB(a,d,f|c&16777215);break;case 15:e.setRGB(a,d,16777215);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+b);e.setRGB(a,d,c)}}function ia(b,a,d,c,e,f,g,l,h){if(b>l||a>h)return;var m=b+d-1;if(m>l)m=l;if(b<f)b=f;d=m-b+1;var n=a+c-1;if(n>
h)n=h;if(a<g)a=g;c=n-a+1;if(d<1||c<1)return;ca.fillRect(b,a,d,c,e)}function F(b,a,d,c,e,f,g,l,h,m,n,k){if(a>n||d>k)return;var w=a+c-1;if(w>n)w=n;var u=a<h?h:a;var r=w-a+1;var t=d+e-1;if(t>k)t=k;var p=d<m?m:d;var q=t-d+1;if(r<1||q<1)return;var x=u!=a||p!=d||r!=c||q!=e;var v=0;var D=128;var B=0;g|=4278190080;l|=4278190080;if(!x)if(b==0)for(var y=0;y<e;y++){v=d+y;for(var E=0;E<c;E++){if(D==0){B++;D=128}if((f[B]&D)!=0)z[v][a+E]=l;D>>=1}B++;D=128;if(B==f.length)B=0}else for(y=0;y<e;y++){v=d+y;for(E=0;E<
c;E++){if(D==0){B++;D=128}if((f[B]&D)!=0)z[v][a+E]=l;else z[v][a+E]=g;D>>=1}B++;D=128;if(B==f.length)B=0}else if(b==0)for(y=0;y<q;y++){v=d+y;for(E=0;E<r;E++){if(D==0){B++;D=128}if(a+E>=u&&v>=p)if((f[B]&D)!=0)z[v][a+E]=l;D>>=1}B++;D=128;if(B==f.length)B=0}else for(y=0;y<q;y++){v=d+y;for(E=0;E<r;E++){if(D==0){B++;D=128}if(a+E>=u&&d+y>=p)if((f[B]&D)!=0)z[v][a+E]=l;else z[v][a+E]=g;D>>=1}B++;D=128;if(B==f.length)B=0}}function ya(b,a,d,c,e){this.offset=b;this.baseLine=a;this.width=d;this.height=c;this.fontData=
e}function G(b,a,d,c,e,f){this.data=b;this.left=c;this.top=e;this.width=a;this.height=d;this.bitsperpixel=f;this.bytesperpixel=Math.floor((f+7)/8)}function I(b,a,d,c,e,f,g,l,h){function m(){var b=0|0;if(a){var d=0;for(var c=a.length;d<c;d++)if(a[d]!=0)b+=d%e+(d/e|0)}return b}function n(b){switch(b){case 507:return"text";case 2046:case 4359:return"default";default:return""}}this.cache_idx=b;this.rawData=a;this.none=!a;this.hotX=d;this.hotY=c;this.width=e;this.height=f;this.xorSize=l;this.andSize=h;
this.result="";this.distance=0;this.bpp=g;this.system="";if(a){if(!this.distance)this.distance=m();if(!this.system)this.system=n(this.distance)}var k="";if(!this.system&&a){var w=40;var u=e*f*4;var r=22+w+u+l+h;var t=new Uint8Array(r);var p=new hi5.DataBuffer(t,0,r);p.setLittleEndian16(0);p.setLittleEndian16(2);p.setLittleEndian16(1);p.setByte(e);p.setByte(f);p.setByte(0);p.setByte(0);p.setLittleEndian16(d);p.setLittleEndian16(c);p.setLittleEndian32(w+u+l+h);p.setLittleEndian32(22);p.setLittleEndian32(w);
p.setLittleEndian32(e);p.setLittleEndian32(f*2);p.setLittleEndian16(1);p.setLittleEndian16(32);p.setLittleEndian32(0);p.setLittleEndian32(l+h);p.setLittleEndian32(0);p.setLittleEndian32(0);p.setLittleEndian32(0);p.setLittleEndian32(0);var q;var D;for(q=f-1;q>=0;q--)for(D=0;D<e;D++){var B=a[e*q+D];p.setByte(B&255);p.setByte(B>>8&255);p.setByte(B>>16&255);p.setByte(B>>24&255)}k="data:image/x-icon;base64,"+hi5.Base64.enc(p.getData())}this.url=k}function J(){function b(a,d,c,e,f,l){this.x=a;this.y=d;
this.cx=c;this.cy=e;this.offset=f;this.data=l}var a=[];this.save=function(d,c,e,f,l,g){var h=new b(d,c,e,f,l,g);var m=0;for(var n=a.length;m<n;m++)if(!a[m]){a[m]=h;return}a.push(h)};this.restore=function(b,d,c,e,f){var l;var g=0;for(var h=a.length;g<h;g++){l=a[g];if(l&&l.x==b&&l.y==d&&l.cx==c&&l.cy==e)if(l.offset==f){var m=l.data;a[g]=null;return m}else svGlobal.logger.warn("TODO: offset")}return null};this.toPDU=function(){var b=0;var d=2;var c=0;var e=a.length;for(var f;c<e;c++)if(a[c]){b++;d+=
a[c].data.length+6}if(!b||!d)return null;var l=new Uint32Array(d);var g=2;l[0]=151060509;l[1]=b;for(c=0;c<e;c++){f=a[c];if(f){l[g++]=f.x;l[g++]=f.y;l[g++]=f.cx;l[g++]=f.cy;l[g++]=f.offset;l[g++]=f.data.length;l.set(f.data,g);g+=f.data.length}}return l};this.fromStream=function(b){var a=new Uint32Array(b.getData().buffer,b.getPosition());var d=1;var c=a[0];var e=0;var f=0;var l=0;var g=0;var h=0;var m=0;var $a;for(var n=0;n<c;n++){e=a[d++];f=a[d++];l=a[d++];g=a[d++];h=a[d++];m=a[d++];$a=new Uint32Array(m);
m=d+m;$a.set(a.subarray(d,m));d=m;this.save(e,f,l,g,h,$a)}}}function H(b,a){var d=L[b];if(d)d=null;L[b]=a}function wc(b){var a=L[b];if(a)return a;return null}function M(){var b=new Array;this.putFont=function(a,d,c){if(!b[a])b[a]=new Array;b[a][d]=c};this.getFont=function(a,d){return b[a]?b[a][d]:null};this.toPDU=function(){var a;var d;var c=0;var e=4;var f=0;var l;var g;var h=4;var m=0;for(var n=b.length;c<n;c++){g=b[c];if(g&&g.length){m=g.length;for(f=0;f<m;f++){l=g[f];if(l)h+=15+l.fontData.length}}}if(h<
5)return null;a=new Uint8Array(h);d=new hi5.DataBuffer(a,0,h);a[0]=29;a[2]=1;a[3]=5;d.skipPosition(4);for(c=0,n=b.length;c<n;c++){g=b[c];if(g&&g.length){m=g.length;for(f=0;f<m;f++){l=g[f];if(l){d.setByte(c);d.setLittleEndian16(f);d.setLittleEndian16(l.offset);d.setLittleEndian16(l.baseLine);d.setLittleEndian16(l.width);d.setLittleEndian16(l.height);d.setLittleEndian32(l.fontData.length);d.setBytes(l.fontData)}}}}return a};this.fromStream=function(b){for(;b.has(15);){var a=b.getByte();var d=b.getLittleEndian16();
var c=b.getLittleEndian16();var e=b.getLittleEndian16();var f=b.getLittleEndian16();var l=b.getLittleEndian16();var g=b.getLittleEndian32();var h=b.getBytes(g);this.putFont(a,d,new ya(c,e,f,l,h))}}}function B(){var b=new Array;var a=new Array;this.putBitmap=function(d,c,e){if(c==32767){if(a[d]){a[d].data=null;a[d]=null}a[d]=e;return}var f=b[d];if(f){if(f[c]){f[c].data=null;f[c]=null}}else b[d]=f=new Array;f[c]=e};this.getBitmap=function(d,c){if(c==32767)return a[d];return b[d]?b[d][c]:null};this.forEach=
function(a){var d=b.length;for(var c=0;c<d;c++)a(b[c],c,b)}}var z=[];var aa=null;var ga=new hi5.graphic.Rectangle(0,0,0,0);var N="Uint8ClampedArray"in window;var ba=null;var P=0;var Db=0;var K=0;var T=0;var Y=null;var Q;var S;var Da=0;var R=0;this.width=b;this.height=a;var V=false;var ca=this;var da={imgData:null,left:0,top:0,width:0,height:0};this.setProfiler=function(b){ba=b};this.getDirtyArea=function(){return ga};this.setImgRect=function(b,a,d,c){P=b;Db=a;K=d;T=c};this.parseMonitorDef=function(b){var a=
b.split(",");var d=a.length;var c=[];if(d>1){var e=false;for(var f=0;f<d;f++){var l=a[f].split(":");if(l.length==4){c[f]=new Array(5);c[f][0]=parseInt(l[0]);c[f][1]=parseInt(l[1]);c[f][2]=parseInt(l[2]);c[f][3]=parseInt(l[3]);c[f][4]=c[f][0]==0&&c[f][1]==0?1:0}else{e=true;break}}if(e){svGlobal.logger.warn("invaiid monitorDef:"+b);c.length=0}}return c};this.setMonitorLayout=function(b){var a=b.length;var d=0;Q=b;for(S=new Array(a);d<a;d++)S[d]=new hi5.graphic.Rectangle(0,0,0,0);R=a};this.setMonitorCount=
function(b){R=b};this.addImg=function(b){if(K){if(Y)URL.revokeObjectURL(Y.src);Y=b}};this.flushImgs=function(){if(Y){URL.revokeObjectURL(Y.src);Y=null;K=0}};this.getData=function(){return z};this.pause=function(b){V=b};this.release=function(){ga=null;hi5.Arrays.release(S);ca.flushImgs();ca=null;aa=null;z=null;da.imgData=null;da=null};this.isPaused=function(){return V};this.setContext=function(d){if(d==aa)return;if(!aa&&d&&!d.createImageData(1,1).data.buffer)N=false;aa=d;if(aa!=null)da.imgData=aa.createImageData(b,
a)};this.getContext=function(){return aa};this.resize=function(d,c){if(z.length==c&&z[0].length==d)return;for(var e=0;e<c;e++)z[e]=new Uint32Array(d);ca.width=b=d;ca.height=a=c;if(aa!=null)da.imgData=aa.createImageData(b,a)};ca.resize(b,a);this.getBuffer=function(){return z};this.setRGB=function(b,a,d){z[a][b]=d|4278190080};this.getRGB=function(b,a){return z[a][b]};this.setRGBs=function(b,d,c,e,f,l,g){var h=l;var n=0;var k=0;var w=b+c;var u=d+e;if(u>a)u=a;if(f.subarray)for(var r=d;r<u;r++,h+=g)z[r].set(f.subarray(h,
h+c),b);else{var p;for(r=d;r<u;r++,h+=g){k=h;p=z[r];for(n=b;n<w;n++)p[n]=f[k++]}}m(b,d,c,e)};this.moveArea=function(b,a,l,g,h,n){if(n>0)d(b,a,l,g,h,n);else if(n<0)c(b,a,l,g,h,n);else if(h>0)e(b,a,l,g,h,n);else f(b,a,l,g,h,n);m(b+h,a+n,l,g)};this.getRGBs=function(b,a,d,c,e){var f=d*c;var l=new Uint32Array(f);var g=b+d;var h=a+c;var m=0;var n=0;for(i=a;i<h;i++){l.set(z[i].subarray(b,g),m);m+=d}e(l)};this.repaint=function(d,c,e,f){var l=da.imgData.data;var g=0;var h=0;var m=0|0;var n=0;var k=0;var u=
0|0;var w=0|0;if(ba)ba.begin("paint");if(d<0){e+=d;d=0}if(c<0){f+=c;c=0}if(d+e>b)e=b-d;if(c+f>a)f=a-c;g=d+e;h=c+f;if(N){var r=new Uint32Array(l.buffer);for(k=c;k<h;k++){r.set(z[k].subarray(d,g),m);m+=b}}else{w=(b-e)*4|0;for(k=c;k<h;k++){for(n=d;n<g;n++){u=z[k][n];l[m++]=u&255;l[m++]=u>>8&255;l[m++]=u>>16&255;l[m++]=255}m+=w}}da.left=d;da.top=c;da.width=e;da.height=f;if(ba)ba.end("paint");return da};this.postPaint=m;this.draw=function(b,a,d,c){if(aa&&!V){if(Y&&Y.complete){aa.drawImage(Y,P,Db,K,T);
URL.revokeObjectURL(Y.src);Y=null}if(!R){if(ga.width){ca.repaint(ga.x,ga.y,ga.width,ga.height);ga.width=0;return da}}else{var e=h(b,a,d,c);if(e.width){ca.repaint(e.x,e.y,e.width,e.height);e.width=0;return da}}}return null};this.fillRect=function(b,a,d,c,e){var f=b+d;var l=a+c;if(z[0].fill){var g;for(var h=a;h<l;h++)z[h].fill(e,b,f)}else for(h=a;h<l;h++)for(g=b;g<f;g++)z[h][g]=e;m(b,a,d,c)};this.drawLine=function(b,a,d,c,e){var f=0;var l=0;if(a==c){if(b>d){l=b;b=d;d=l}var g=z[a];d++;if(g.fill)g.fill(e,
b,d);else for(f=b;f<d;f++)g[f]=e}else if(b==d){if(a>c){l=a;a=c;c=l}c++;for(f=a;f<c;f++)z[f][b]=e}else{var h=Math.abs(d-b);var m=Math.abs(c-a);var n=b;var k=a;var u=0;var w=0;var r=0;var p=0;var t=0;var q=0;var D=0;var B=0;if(d>=b){u=1;w=1}else{u=-1;w=-1}if(c>=a){r=1;p=1}else{r=-1;p=-1}if(h>=m){u=0;p=0;q=h;t=h/2|0;D=m;B=h}else{w=0;r=0;q=m;t=m/2|0;D=h;B=m}if(B<1)return;B++;for(var v=0;v<B;v++){z[k][n]=e;t+=D;if(t>=q){t-=q;n+=u;k+=r}n+=w;k+=p}}};this.bitBlt=function(b,a,d,c,e,f,g,h,t,B){var z=ca;if(e<
0|f<0|a<0|h<0)return;switch(b){case 0:p(z,a,d,c,e,f);break;case 1:n(z,a,d,c,e,f,g,h,t,B);break;case 2:l(z,a,d,c,e,f,g,h,t,B);break;case 3:k(z,g,h,t,B,e,f);r(z,d,c,e,f,g,h,t,B);break;case 4:k(z,null,a,d,c,e,f);v(z,a,d,c,e,f,g,h,t,B);break;case 5:k(z,null,a,d,c,e,f);break;case 6:q(z,a,d,c,e,f,g,h,t,B);break;case 7:x(z,a,d,c,e,f,g,h,t,B);break;case 8:v(z,a,d,c,e,f,g,h,t,B);break;case 9:y(z,a,d,c,e,f,g,h,t,B);break;case 10:break;case 11:Z(z,a,d,c,e,f,g,h,t,B);break;case 12:r(z,d,c,e,f,g,h,t,B);break;
case 13:k(z,null,a,d,c,e,f);A(z,a,d,c,e,f,g,h,t,B);break;case 14:A(z,a,d,c,e,f,g,h,t,B);break;case 15:u(z,a,d,c,e,f);break;default:svGlobal.logger.warn("unsupported opcode: "+b)}m(d,c,e,f)};this.drawLineExt=function(b,a,d,c,e,f){if(b==d||a==c)C(b,a,d,c,e,f);else{var l=Math.abs(d-b);var g=Math.abs(c-a);var h=b;var n=a;var k;var u;var w;var r;var t;var p;var B;var q;if(d>=b){k=1;u=1}else{k=-1;u=-1}if(c>=a){w=1;r=1}else{w=-1;r=-1}if(l>=g){k=0;r=0;p=l;t=l/2>>0;B=g;q=l}else{u=0;w=0;p=g;t=g/2>>0;B=l;q=
g}if(q<1)return;for(var D=0;D<=q;D++){U(f,h,n,e);t+=B;if(t>=p){t-=p;h+=k;n+=w}h+=u;n+=r}}var v=Math.min(b,d);var E=Math.max(b,d);var z=Math.min(a,c);var y=Math.max(a,c);if(E-v<0)return;if(y-z<0)return;m(v,z,E-v+1,y-z+1)};this.drawText=function(b,a,d,c,e,f,l,g,h,n,k,u,w,r,t,p,B,q,D,v,E){var z=null;var y=0;var x=0;if(u>1)ia(n,k,u,w,e,q,D,v,E);else if(d==1)ia(f,l,g,h,e,q,D,v,E);var U=p;for(var O=0;O<p;)switch(B[x+O]){case 255:var Z=B[x+O+2];if(Z>U-x){O=p=0;break}var Y=B.slice?B.slice(x,x+Z):B.subarray(x,
x+Z);H(B[x+O+1],Y);O+=3;p-=O;x=O;O=0;break;case 254:var A=wc(B[x+O+1]);if(A)if(A[1]==0&&(a&32)==0)if((a&4)!=0)t+=B[x+O+2];else r+=B[x+O+2];if(O+2<p)O+=3;else O+=2;p-=O;x=O;O=0;if(!A)break;var aa=A.length;for(var C=0;C<aa;C++){z=W.getFont(b,A[C]);if((a&32)==0){y=A[++C];if((y&128)!=0)if((a&4)!=0){t+=A[C+1]|A[C+2]<<8;C+=2}else{r+=A[C+1]|A[C+2]<<8;C+=2}else if((a&4)!=0)t+=y;else r+=y}if(z){F(d,r+z.offset&65535,t+z.baseLine&65535,z.width,z.height,z.fontData,e,c,q,D,v,E);if((a&32)!=0)r+=z.width}}break;
default:z=W.getFont(b,B[x+O]);if((a&32)==0){y=B[x+ ++O];if((y&128)!=0)if((a&4)!=0){t+=B[x+O+1]|B[x+O+2]<<8;O+=2}else{r+=B[x+O+1]|B[x+O+2]<<8;O+=2}else if((a&4)!=0)t+=y;else r+=y}if(z){F(d,r+z.offset&65535,t+z.baseLine&65535,z.width,z.height,z.fontData,e,c,q,D,v,E);if((a&32)!=0)r+=z.width}O++}if(u>1){if(w>0)m(n,k,u,w)}else if(g>0&&h>0)m(f,l,g,h)};this.drawBitmap=function(a,d,c,e,f,l,g,h,m){var n=X.getBitmap(a,d);if(!n){svGlobal.logger.warn("Failed to get bitmap from cache, id:"+a+" idx="+d);return}var k=
n.width;var u=n.height;if(f>k)f=k;if(l>u)l=u;if(m==12)ca.setRGBs(c,e,f,l,n.data,h*k+g,k);else ca.bitBlt(m,b,c,e,f,l,n.data,k,g,h)};this.saveDesktop=function(b,a,d,c,e){ca.getRGBs(b,a,d,c,function(f){Ha.save(b,a,d,c,e,f)})};this.restoreDesktop=function(b,a,d,c,e){var f=Ha.restore(b,a,d,c,e);if(!f){svGlobal.logger.warn("XXX no matched desktop save.");return}ca.setRGBs(b,a,d,c,f,0,d)};this.putFont=function(b,a,d){W.putFont(b,a,d)};this.putBitmap=function(b,a,d){X.putBitmap(b,a,d)};this.putCursor=function(b,
a){Ia.set(b,a)};this.setCursor=function(b){if(V)return;if(b==-1)ca.onSetCursor({"system":"none","none":false,"result":"none"});else{var a=Ia.get(b);if(a)ca.onSetCursor(a);else svGlobal.logger.warn("invalid cursor"+b)}};this.getHistory=function(b){var a=null;if(ba)ba.begin("his_bitmap");X.forEach(function(d,c,e){if(!d)return;var f=0;var l=0;var g=0;for(var h=d.length;g<h;g++)if(d[g].data){f++;l+=d[g].data.length}if(!f||!l)return;a=new Uint32Array(l+f*8+2);a[0]=67174429;a[1]=f;var m=2;for(g=0;g<h;g++){var n=
d[g];if(n.data){a[m++]=c;a[m++]=g;a[m++]=n.left;a[m++]=n.top;a[m++]=n.width;a[m++]=n.height;a[m++]=n.bitsperpixel;a[m++]=n.data.length;a.set(n.data,m);m+=n.data.length}}b(a.buffer)});if(ba)ba.end("his_bitmap");if(ba)ba.begin("his_font");a=W.toPDU();if(a)b(a.buffer);if(ba)ba.end("his_font");a=Ia.toPDU();if(a)b(a.buffer);var d=4;var c=0;for(var e=L.length;c<e;c++)if(L[c])d+=L[c].length+6;if(d>4){a=new Uint8Array(d);a[0]=29;a[2]=1;a[3]=7;var f=4;for(c=0,e=L.length;c<e;c++)if(L[c]&&L[c].length){a[f++]=
c;a[f++]=c>>8;d=L[c].length;a[f++]=d;a[f++]=d>>8;a[f++]=d>>16;a[f++]=d>>24;a.set(L[c],f);f+=d}b(a.buffer)}a=Ha.toPDU();if(a)b(a.buffer);a=new Uint8Array(5);a[0]=29;a[2]=1;a[3]=0;a[4]=1;b(a.buffer)};this.setHistory=function(b,a){switch(b){case 4:if(ba)ba.begin("his_bitmap_dec");var d=a.getLittleEndian32();for(var c=0;c<d;c++){var e=a.getLittleEndian32();var f=a.getLittleEndian32();var g=a.getLittleEndian32();var l=a.getLittleEndian32();var h=a.getLittleEndian32();var m=a.getLittleEndian32();var n=
a.getLittleEndian32();var k=a.getLittleEndian32();var u=new Uint32Array(a.getData().buffer,a.getPosition(),k);var w=new Uint32Array(k);w.set(u);a.skipPosition(k*4);X.putBitmap(e,f,new G(w,h,m,g,l,n))}if(ba)ba.end("his_bitmap_dec");break;case 5:W.fromStream(a);break;case 6:Ia.fromStream(a);break;case 7:for(;a.has(6);){c=a.getLittleEndian16();k=a.getLittleEndian32();if(k){H(c,a.getData().subarray(a.getPosition(),a.getPosition()+k));a.skipPosition(k)}}break;case 9:Ha.fromStream(a)}};var Ia=new function(){var b=
[];this.set=function(a,d){b[a]=d};this.get=function(a){return b[a]};this.total=function(){return b.length};this.toPDU=function(){var a=2;var d=2;var c=0;var e=0;var f=b.length;var g;for(var l=0;e<f;e++){g=b[e];if(g){c++;d=d+7+(g.rawData?g.rawData.length:0)}}if(!c)return null;var h=new Uint32Array(d);h[0]=100728861;h[1]=c;for(e=0;e<f;e++){g=b[e];if(g){l=g.rawData?g.rawData.length:0;h[a++]=g.cache_idx|g.bpp<<16;h[a++]=g.hotX|g.hotY<<16;h[a++]=g.width|g.height<<16;h[a++]=g.xorSize;h[a++]=g.andSize;h[a++]=
g.distance;h[a++]=l;if(l){h.set(g.rawData,a);a+=l}}}return h};this.fromStream=function(a){var d=a.getPosition();var c=new Uint32Array(a.getData().buffer,d);var e=c[0];var f=0;var g=0;var l=0;var h=0;var m=0;var n=0;var k=0;var u=0;var w=0;var r=0;var t=0;var p;var B;for(d=1;f<e;f++){g=c[d]&65535;l=c[d++]>>16;h=c[d]&65535;m=c[d++]>>16;n=c[d]&65535;k=c[d++]>>16;u=c[d++];w=c[d++];r=c[d++];t=c[d++];p=null;if(t){p=new Uint32Array(t);p.set(c.subarray(d,d+t));d+=t}B=new I(g,p,h,m,n,k,l,u,w);if(r)B.distance=
r;b[g]=B}}};var Ha=new J;var L=new Array;var W=new M;var X=new B}function xc(b,a,c){this.capsLock=this.numLock=false;this.setJoinMode=b.setJoinMode;this.requestControl=b.requestControl;this.writeKeyComb=b.writeKeyComb;this.writeText=b.writeText;this.draw=c.draw;var d=b.isRemoteApp();this.refresh=function(b,a,d,e){return c.repaint(b,a,d-b+1,e-a+1)};this.getAppMode=function(){return b.mode};this.send=b.writeRawInput;this.saveSession=function(a){b.saveSession(a)};this.sendInput=b.writeRawInput;var e=
null;this.getAppInfo=function(){return b.sessionInfo.appInfo};this.onresize=function(a){var c=a.target.svSurface;if(!c)return;var f=c.getFreeSpace();var m=f.width;var k=f.height;if(d){b.writeRawInput("8C6"+61441+"\t"+m+"\t"+k);return}if(b.reconnectOnResize&&b.running()){var p=function(){b.reconnect(m,k)};if(e){clearTimeout(e);e=0}e=setTimeout(p,333)}};this.onorientationchange=function(a){if(b.reconnectOnResize)b.reconnect(a.innerWidth,a.innerHeight);else if(d){if(!a.svSurface)return;if(b.windowState)b.writeRawInput("8C6"+
61441+"\t"+a.innerWidth+"\t"+a.innerHeight)}};this.getClipData=function(a){return hi5.httpGet(b.modifyURL(b.getGatewayAddr()+"/CLIP?s="+b.sessionInfo.appInfo.session+"&t="+Date.now()),a)};this.onfocus=function(e){var f=e.target;if(d&&f.svSurface&&f.svSurface.railWin){var h=f.svSurface.railWin.getTopWin(a.zOrders);if(!h||!b.running())return;var m=f.svSurface.context;if(m&&m!=c.getContext()){c.setContext(null);h.activate(1);svGlobal.logger.info("Activate win:"+h.id)}}};this.getShareFiles=b.listFiles;
this.getFile=function(a){b.reconnectOnResize=false;window.open(b.getFileUrl(a))};this.getFileLink=b.getFileUrl;this.getGateway=function(){return p};this.reconnect=function(a,d,c){if(k.symlink){var e="user="+a+"&pwd="+d;if(c)e+="&domain="+c;p=hi5.tool.replaceQuery(p,"parameters",e)}else{p=hi5.tool.replaceQuery(p,"user",a);p=hi5.tool.replaceQuery(p,"pwd",d);p=hi5.tool.replaceQuery(p,"domain",c)}b.run()};this.sendKeyboardSynchronize=function(a,d,c){var e=0;if(c)e=e|4;if(d)e=e|2;if(a)e=e|1;b.writeRawInput("8E5"+
e);this.capsLock=c;this.numLock=d};this.fromSyncedSurface=function(b){return a.fromSyncedSurface(b)}}function yc(b,a){function c(){function a(b){return b.winWidth&&b.winHeight&&b.showState&&b.winHeight>45&&b.winWidth>45}function d(b){for(;b.ownerWinid>0;){var a=r.getWinById(b.ownerWinid);if(a&&a.isVisible())b=a;else break}return b}function c(b){var a="";for(var d=b;d;){if(d.titleInfo)a=d.titleInfo;d=r.getWinById(d.ownerWinid)}return a}var e=[];var f=[];var k=0;var r=this;this.mainWin=null;this.appId=
"";this.onchange=function(a){if(!a.isVisible()&&a==r.mainWin)r.mainWin=null;else if(a.isVisible()&&!r.mainWin)if(a.isMainWin()){r.mainWin=a;if(b.windowState)a.exeCommand(61488)}};this.addWin=function(a){var d=e.length;var c=false;for(var f=0;f<d;f++)if(a.id==e[f].id){e[f]=a;c=true;break}if(!c)e.push(a);if(e.length==1)k=Date.now();if(b.windowState>0){var g=a.isMainWin();svGlobal.logger.info("is main win:"+g+" id:"+a.id);if(g&&!r.mainWin)r.mainWin=a}};this.popWins=function(a){var b=r.getWinById(a);
var d=[];if(b){a=b.ownerWinid>0?b.ownerWinid:b.id;var c=e.length;for(var f=c-1;f>=0;f--)if(e[f].ownerWinid==a||e[f].id==a){d.push(e[f]);e.splice(f,1)}}return d};this.hasApp=function(a){return f.indexOf(a)!=-1};this.addApp=function(a){if(f.indexOf(a)==-1){f.push(a);return true}return false};this.isNew=function(){return Date.now()-k<3E4};this.getAll=function(){return e};this.hasWin=function(a){return e.indexOf(a)>=0};this.close=function(){var a=0;for(var b=e.length;a<b;a++)e[a].close()};this.clear=
function(){e.length=0};this.delWin=function(a){var b=0;for(var d=e.length;b<d;b++)if(e[b].id==a){e.splice(b,1);return b}return-1};this.isRunning=function(){var a;var b=e.length;if(b<1)return false;var d=0;for(b=e.length;d<b;d++){a=e[d];if(a.isVisible())return true}return false};this.getWinById=function(a){var b;var d=e.length;if(d<1)return null;for(var c=0;c<d;c++){b=e[c];if(b.id==a)return b}return null};this.getMainWinByAppId=function(a){var b=null;var d=0;for(len=e.length;d<len;){b=e[d];if(b.appId==
a&&b.isVisible()&&b.ownerWinid<1)break;d++}return b};this.getTopWin=function(a){var b=null;var d;var c=a.length;for(d=0;d<c;d++){b=r.getWinById(a[d]);if(b&&b.isVisible())break;else b=null}if(!b){svGlobal.logger.warn("No win found");c=e.length;for(d=c-1;d>=0;d--){b=e[d];if(b.isVisible())break;else b=null}}return b};this.getMain=function(a){var b=r.getTopWin(a);if(b)return d(b);return null};this.getOtherApps=function(b,a,f){var g=e.length;if(g==0||!e[g-1])return;var k=e[g-1].appId;if(f||!k){setTimeout(function(){r.getOtherApps(b,
a)},f||3E3);return}var u=[];var p=r.getTopWin(b);if(p){var t=p.ownerWinid>0?p.ownerWinid:p.id;var q=[];var v=0;for(g=e.length;v<g;v++){if(e[v].ownerWinid==t||e[v].id==t||!e[v].isVisible())continue;q.push(e[v])}for(v=0,g=q.length;v<g;v++){if(q[v].ownerWinid==t||q[v].id==t)continue;u.push({title:c(q[v]),win:d(q[v])});t=q[v].ownerWinid>0?q[v].ownerWinid:q[v].id}}a(u)};this.getFullTitle=function(b){var a=null;for(var d="";1;){a=r.getWinById(b);if(!a)break;if(a.titleInfo&&a.isVisible()){if(d)d=" > "+d;
d=a.titleInfo+d}if(b<1)break;b=a.ownerWinid}return d}}var d=[];var e=b.isRemoteApp();this.repaint=function(a,b,c,e){var f=0;for(var k=d.length;f<k;f++)d[f].repaint(a,b,c,e)};this.size=function(){return d.length};this.getSurface=function(a){return d[a]};this.addSurface=function(a){d.push(a)};this.hasSurface=function(a){var b=d.length;for(var c=0;c<b;c++)if(d[c].equals(a))return true;return false};this.fromSyncedSurface=function(a){var b=d.length;var c=Date.now();for(var e=0;e<b;e++)if(d[e].isClipSynced(a))return true;
return false};this.setSize=function(a,b,c){var e=0;for(var f=d.length;e<f;e++)d[e].setSize(a,b,c)};var f=new Array;this.zOrders=f;this.drawLicense=function(a){var b=0;for(var c=d.length;b<c;b++)d[b].drawLicense(a)};this.setReadOnly=function(a,b){var c=0;for(var e=d.length;c<e;c++)d[c].setReadOnly(a,b)};this.setVisible=function(a,b){svGlobal.logger.info("TODO: setVisible")};this.copyToClip=function(a){if(d.length<1)return;d[0].copyToClip(a)};this.setCursor=function(a){var b=0;for(var c=d.length;b<
c;b++)d[b].setCursor(a)};this.hide=function(a){var b=0;for(var c=d.length;b<c;b++)d[b].hide()};this.execute=function(a,b){var c=0;for(var e=d.length;c<e;c++)d[c][a].apply(d[c],b)};this.addWin=function(f){var h=this.getFocused();if(!h){svGlobal.logger.warn("Focused surface not found!");h=d[d.length-1]}if(!h){svGlobal.logger.warn("No surface available!");return}e=true;if(!h.railWin){h.railWin=new c;h.onunload=function(){if(hi5.appcfg.closeRemoteApp)if(h.railWin)h.railWin.close();if(h.remoteApp)h.remoteApp.close();
if(h.railWin){h.railWin.clear();h.railWin=null}d.removeElm(h)}}if(h.context)a.setContext(h.context);h.railWin.addWin(f);if(b.windowState){var m=h.railWin.mainWin==f;if(m)setTimeout(function(){var a=h.getFreeSpace();b.writeRawInput("8C6"+61441+"\t"+a.width+"\t"+a.height);setTimeout(function(){f.exeCommand(61488)},50)},111)}if(hi5.browser.isIE)h.focus()};this.delWin=function(a){var c;for(var e=d.length-1;e>=0;e--){var f=d[e];c=f.railWin;var k=c.getWinById(a);var u=k&&k.appId&&k.appId.toLowerCase().indexOf("runonce")!=
-1;if(c.delWin(a)>=0){if(k==c.mainWin)c.mainWin=null;if(!c.hasApp(k.appId)){var r=function(a){return function(){svGlobal.logger.info("Start del:"+Date.now());if(!a.railWin||!a.railWin.isRunning()){if(a.remoteApp)a.remoteApp.close();this.delSurface(a)}}};var n=b.appTimeout;if(u||c.isNew())n*=10;svGlobal.logger.debug("Prepare del:"+Date.now());setTimeout(r(f),n)}}}};this.popWins=function(a){return d[0]&&d[0].railWin?d[0].railWin.popWins(a):[]};this.getWinById=function(a){var b;var c=0;for(var e=d.length;c<
e;c++)if(d[c].railWin){b=d[c].railWin.getWinById(a);if(b)return b}return null};this.getMainWinByAppId=function(a){var b;var c=0;for(var e=d.length;c<e;c++)if(d[c].railWin){b=d[c].railWin.getMainWinByAppId(a);if(b)return b}return null};this.onWinChange=function(a){var b;var c=0;for(var e=d.length;c<e;c++)if(d[c].railWin){b=d[c].railWin.getWinById(a.id);if(b)d[c].railWin.onchange(a)}};this.setTitle=function(a){var c;var e=0;for(var f=d.length;e<f;e++)if(d[e].railWin){c=d[e].railWin.getWinById(a);var k=
d[e].railWin.getFullTitle(a);if(k){b.changeTitle(k,d[e].getWindow(),c.appId);return}}};this.hasApp=function(a){var b=0;for(var c=d.length;b<c;b++)if(d[b].railWin.hasApp(a))return true;return false};this.delSurface=function(a){if(!a||a.railWin&&a.railWin.isRunning())return;svGlobal.logger.info("delete surface...");this.removeElm(a);a.close();if(d.length==0)b._unload()};this.getOwnerSurface=function(a){var b=0;for(var c=d.length;b<c;b++)if(d[b].railWin&&d[b].railWin.hasWin(a))return d[b];return null};
this.getFocused=function(){var a=d.length;for(var b=0;b<a;b++)if(d[b].focused)return d[b];return d[a-1]};this.close=function(){var a=0;for(var b=d.length;a<b;a++)if(d[a]){if(d[a].remoteApp)d[a].remoteApp.close();d[a].close();d[a]=null}};this.LocalWin=function(a){function d(){b.writeRawInput("8C0"+a)}this.id=a;this.appId="";var c=this;this.resizable=function(){return(c.style&262144)!=0||(c.style&65536)!=0||(c.style&16777216)!=0||c.showState==3};this.setShowState=function(a){c.showState=a};this.parent=
function(){return q.getWinById(c.ownerWinid)};this.resize=function(a,d,e,f){if(hi5.appcfg.disableJoinedAppResize&&b.mode==2)return;b.writeRawInput("8C1"+c.id+"\t"+a+"\t"+d+"\t"+e+"\t"+f)};this.exeCommand=function(d){b.writeRawInput("8C4"+a+"\t"+d)};this.activate=function(d){if(c.showState==2){c.exeCommand(61728);setTimeout(function(){b.writeRawInput("8C3"+a+"\t"+d)},50)}else b.writeRawInput("8C3"+a+"\t"+d)};this.close=function(){c.exeCommand(61536)};this.getAppId=d;this.isVisible=function(){return c.winWidth&&
c.winHeight&&c.showState&&c.winHeight>45&&c.winWidth>45};this.isMainWin=function(){if(!c.isVisible())return false;var a=c["ownerWinid"]<1;if(!a)return a;var b=c["style"];if((b&4194304)!=0)return true;if((b&2147483648)!=0&&((b&8388608)==0||(b&12582912)==0))return false;var d=(c.extStyle&128)!=0;a=a&&!d;if(a&&((b&2147483648)!=0&&(b&2156396544)==0))a=false;return a};d()}}this.reconnectOnResize=true;this.displayMsg=true;this.appTimeout=1600;this.reconnectTimes=0;this.windowState=3;this.openLink=true;
this.setTitle=true;this.audioBuffer=0;this.sessionInfo={domain:"",userName:"",sessionId:0,joinedSessions:[],suppressOutput:false,appInfo:null};this.mode=0;this.remoteAppLogin=true;var Ga=false;var ma={};var na={};var Ba=null;var f=this;var Xa=false;var X=false;var Gc=0;var W=0;var va=null;var x=hi5.appcfg||{img:{},toolbar:{fadable:true}};this.setConfig=function(b){x=b};var ea=typeof p=="object"?p:null;var k=ea?{}:hi5.tool.queryToObj(p.substring(p.indexOf("?")+1));var F=0;var G=0;var ua=(sa||k.color||
k.server_bpp||16)|0;var Hc=hi5.Arrays.arraycopy;var Ic=hi5.Arrays.fill;var xa=null;var Eb=null;var T=null;var Sa=hi5.browser.isIE;this.protocol=ea?"":p.substring(0,p.indexOf("://")).toLowerCase();this.setProfiler=function(b){Eb=b};this.getProfiler=function(){return Eb};this.gateway=function(){if(ea)return"";var b=p.lastIndexOf("/RDP?");if(b==-1)b=p.lastIndexOf("/JOIN?");if(b==-1)b=p.lastIndexOf("/PLAY?");var a=p.substring(0,b);return a.replace(/wss\:\/\//ig,"https://").replace(/ws\:\/\//ig,"http://")}();
svGlobal.logger.warn("Ver:"+svGlobal.version+" build:"+svGlobal.build);this.getGatewayAddr=ka;var oa=typeof p=="object"||p.indexOf("/PLAY?")>0;var Fb=!oa&&p.indexOf("invitation=")>0;if(Fb){var ab=decodeURIComponent(p);var Ja=ab.indexOf(' USERNAME="');if(Ja>0){Ja+=11;var Gb=ab.substring(Ja,ab.indexOf('"',Ja));p+="&novice="+Gb+"&server="+Gb}p+="&mapClipboard=on"}if(oa){this.mode=1;if(ea)p="";else{F=640|0;G=480|0}p+="&touchpad=on";this.reconnectOnResize=false}else if(p.indexOf("/JOIN?")>0||Fb){this.mode=
2;this.reconnectOnResize=false}if(H)F=parseInt(H);else if(k.width)F=parseInt(k.width);if(P)G=parseInt(P);else if(k.height)G=parseInt(k.height);if(F==-1)F=screen.width;if(G==-1)G=screen.height;if(k.symlink&&k.parameters)hi5.tool.queryToObj(k.parameters,k);if(!k.gateway)p+="&gateway="+encodeURIComponent(f.gateway);if(!k.minWidth&&x.minWidth)rdArgs.minWidth=x.minWidth;if(!k.minHeight&&x.minHeight)rdArgs.minHeight=x.minHeight;if(k.minWidth)k.minWidth=parseInt(k.minWidth);if(k.minHeight)k.minHeight=parseInt(k.minHeight);
if(k.waWidth)k.waWidth=parseInt(k.waWidth);if(k.waHeight)k.waHeight=parseInt(k.waHeight);if(!("useSSL"in k))p+="&useSSL="+(f.protocol=="wss");if(hi5.storage.isAvailable&&!Fa(k.shareClipboard))if(V(k.shareClipboard)||k.shareClipboardId||V(k.mapClipboard)&&k.shareClipboard==undefined)p+="&shareClipboardId="+(k.shareClipboardId||ta());if(x){if(x.displayMsg!=undefined)this.displayMsg=x.displayMsg;else x.displayMsg=this.displayMsg;if(x.appTimeout)this.appTimeout=x.appTimeout;if(x.reconnectOnResize!=undefined)this.reconnectOnResize=
x.reconnectOnResize;if(x.reconnectTimes)this.reconnectTimes=x.reconnectTimes;if(x.windowState!=undefined)this.windowState=x.windowState;if(x.openLink!=undefined)this.openLink=x.openLink;if(x.setTitle!=undefined)this.setTitle=x.setTitle;if(x.audioBuffer)this.audioBuffer=x.audioBuffer;if(typeof x.useWSS=="boolean")p=(x.useWSS?"wss":"ws")+p.substring(p.indexOf("://"));if(typeof x.remoteAppLogin=="boolean"){this.remoteAppLogin=x.remoteAppLogin;Ga=!x.remoteAppLogin;svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")}if(typeof x.hideLogin==
"boolean")Ga=x.hideLogin}var Jc=p.indexOf("nocurosr=on")>0;var R=p.indexOf("startProgram=app")>0;var Ya=p.indexOf("mapDisk=on")>0;var S=null;if(R)this.reconnectOnResize=false;if(x.useWorker==undefined)x.useWorker=true;if(x.useWorker)if(!window.Worker||hi5.browser.isFirefox||R&&!Sa||location.protocol=="file:"||navigator.userAgent.indexOf("MSIE 10.")>0)x.useWorker=false;if(hi5.libMin==undefined)hi5.libMin=true;var N=x.useWorker?new Worker(hi5.libPath+(x.rdpworker||(hi5.libMin?"rdpworker_min.js":"rdpworker.js"))):
null;var wa=this.reconnectTimes;var Oa=N?{type:5,data:null}:null;this.getDisplayName=L;this.server=L();this.port=parseInt(k.port,10);this.loadbalanceToken=x.loadbalanceTokenName?x.loadbalanceTokenName+"="+hi5.tool.uuid():"";this.modifyURL=function(b){if(f.loadbalanceToken)b+="&"+f.loadbalanceToken;return b};this.getURL=function(){return p};this.getColor=function(){return ua};this.changeTitle=ha;var Kc=hi5.graphic.Rectangle;if(hi5.browser.isTouch)if(Math.max(F,G)>Math.max(window.innerWidth,window.innerHeight))this.reconnectOnResize=
false;this.isRemoteApp=function(){return R};var A=null;var I=false;var la=false;var M=new mc(f.audioBuffer);var qb=M.available;var v=new eb(200,200);v.onSetCursor=rb;this.setVolume=function(b){if(M)M.setVolume(b)};this.setAudioBuffer=function(b){f.audioBuffer=b;M.delay=b};var Lc=new Array;var Ka=0;var La=0;var Ma=F-1;var Na=G-1;var zb="";var Hb=0;window.$rdp=this;za(ua);this.running=function(){return I};this.setJoinMode=function(b){if(!I)return;y("8E1"+b)};this.setJoinCloseMode=function(b){if(!I)return;
y("8EB3\t"+b)};this.refuseControl=function(b){if(!I)return;y("8E3"+b)};this.giveControl=function(b){if(!I)return;y("8E4"+b)};this.pauseSession=function(b,a){if(!I)return;y("8EB"+(a?1:0)+"\t"+b)};this.closeSession=function(b){if(!I)return;y("8EB2"+"\t"+b)};this.requestControl=function(){if(!I)return;y("8E2")};this.saveSession=function(b){if(!I)return;y("8E9"+(b.save?1:0)+"\t"+(b.timeout||0)+"\t"+(b.id||0))};this.allowJoin=function(b,a){if(!I)return;y("8EA"+b+"\t"+(a?1:0))};var bb=new function(){function b(){if(c&&
c.length>0){var a=c.shift();bb.sendSingleKey(a.down,a.key);if(c.length>0)setTimeout(b,d);else c=null}}var a={" ":57,"space":57,"pgup":201,"pageup":201,"pgdn":209,"pagedown":209,"end":207,"home":199,"left":203,"up":200,"right":205,"down":208,"printscreen":183,"insert":210,"del":211,"delete":211,"altgr":184,"windows":219,"windowsright":220,"context":221,"esc":1,"backspace":14,"tab":15,"enter":28,"meta":29,"command":29,"ctrl":29,"shift":42,"alt":56,"capslock":58,"f1":59,"f2":60,"f3":61,"f4":62,"f5":63,
"f6":64,"f7":65,"f8":66,"f9":67,"f10":68,"f11":87,"f12":88,"numlock":69,"scrolllock":70,"add":78};this.sendSingleKey=function(b,d){var c=a[d.toLowerCase()];if(c)f.writeScancode(b,c);else{var h=d.length;if(h==0)return;if(h==1)f.writeKeyCode(b,d.toUpperCase().charCodeAt(0));else if(b)f.writeText(d)}};var c=null;var d=0;this.sendKeyComb=function(a,f){if(!X)return;var g=a.split("+");var h=g.length;var k=0;if(h==0)return;var p=null;var q=new Array;for(k=0;k<h;k++){var u=g[k];if(u==""&&p=="")u="Add";if(u!=
"")q.push({"key":u,"down":true});p=u}h=q.length;for(k=h-1;k>=0;k--)q.push({"key":q[k].key,"down":false});if(!f)for(k=0,h=q.length;k<h;k++)bb.sendSingleKey(q[k].down,q[k].key);else{c=q;d=f;b()}}};this.writeKeyComb=function(b,a){if(X)bb.sendKeyComb(b,a)};this.writeText=function(b,a){if(X)if(a){var c=0;var d=false;var e=0;for(var f=b.length;e<f;e++){c=b.charCodeAt(e);if(c>64&&c<91)d=true;else{d=false;if(c>96&&c<123)c-=32}if(d)this.writeScancode(true,42);this.writeKeyCode(true,c);this.writeKeyCode(false,
c);if(d)this.writeScancode(false,42)}}else y("86"+b)};var q=new yc(f,v);this.getSurfaces=function(){return q};this.hide=function(){if(!q)return;q.hide()};this.getFileUrl=function(b){return f.modifyURL(ka()+"/DOWNLOAD?s="+zb+"&f="+b)};this.listFiles=function(b,a){if(la&&S)S.list(b,a)};this.writeRawInput=function(b){if(X){y(b);if(f.onactivity)f.onactivity(b)}};var Ca=new xc(f,q,v);var K=null;var J={count:0,names:[],close:function(){var b=J.names;var a=0;for(var c=b.length;a<c;a++)if(J[b[a]].onclose){J[b[a]].onclose();
J[b[a]]=null}b.length=0;b=null},init:function(b,a,c,d){function e(){this.WAVE_FORMAT_PCM=1;this.WAVE_FORMAT_ADPCM=2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=85;this.WAVE_FORMAT_AAC=41222;this.formatTag=0;this.nChannels=0;this.nSamplesPerSec=0;this.nAvgBytesPerSec=0;this.nBlockAlign=0;this.bitsPerSample=0;this.hasLocalSupport=false;this.cbSize=0;this.extenstion=null;var a=this;this.fromBuffer=function(b){a.formatTag=b.getLittleEndian16();
a.nChannels=b.getLittleEndian16();a.nSamplesPerSec=b.getLittleEndian32();a.nAvgBytesPerSec=b.getLittleEndian32();a.nBlockAlign=b.getLittleEndian16();a.bitsPerSample=b.getLittleEndian16();var d=b.getLittleEndian16();a.cbSize=d;if(d>0){a.extenstion=new Array(d);b.copyToByteArray(a.extenstion,0,b.getPosition(),d);b.skipPosition(d)}};this.toBuffer=function(b){b.setLittleEndian16(a.formatTag);b.setLittleEndian16(a.nChannels);b.setLittleEndian32(a.nSamplesPerSec);b.setLittleEndian32(a.nAvgBytesPerSec);
b.setLittleEndian16(a.nBlockAlign);b.setLittleEndian16(a.bitsPerSample);b.setLittleEndian16(a.cbSize);if(a.cbSize>0)b.setBytes(a.extenstion)};this.getSize=function(){return 18+a.cbSize};this.toString=function(){return"Audio Format, tag="+a.formatTag+" nChannels="+a.nChannels+" nSamplesPerSec="+a.nSamplesPerSec+" nAvgBytesPerSec"+a.nAvgBytesPerSec+" nBlockAlign"+a.nBlockAlign+" bitsPerSample"+a.bitsPerSample+" cbSize="+a.cbSize}}function k(){var a=new f.DynamicChannel;a.name="TSMF";var b={type:"image/jpeg"};
var d=new Array(1);a.process=function(c){var e=c.getPosition();var f;var g=0;var h=0;var k;var m=0;var p=0;var q=0;var t;var w=c.getLittleEndian32();var x=w&1073741823;var y=x>>>30;var A=c.getLittleEndian32();var C=c.getLittleEndian32();switch(x){case 2:if(C==256){var E=c.getLittleEndian32();f=new Uint8Array(16);t=new RdpBuffer(f,0,16);t.setLittleEndian32(2|0);t.setLittleEndian32(A);t.setLittleEndian32(1);t.setLittleEndian32(0);a.send(f)}break;case 0:switch(C){case 257:k=c.getBytes(16);p=c.getLittleEndian32();
break;case 256:e=c.getPosition();var F=c.getLittleEndian32();var G=0;var B=0;for(q=0;q<F;q++){G=c.getLittleEndian32();B=c.getLittleEndian32();h=c.getLittleEndian32();c.skipPosition(B-4)}g=c.getPosition()-e;h=g+8+4;f=new Uint8Array(h);t=new RdpBuffer(f,0,h);t.setLittleEndian32(0|2147483648);t.setLittleEndian32(A);f.set(c.getData().subarray(e,c.getPosition()),8);a.send(f);break;case 261:k=c.getBytes(16);m=c.getLittleEndian32();break;case 264:m=c.getLittleEndian32();c.skipPosition(4);var z=c.getLittleEndian32();
var aa;var ga;var H=0;var I=0;var J=0;var L;var M=0;aa=c.getBytes(16);ga=c.getBytes(16);H=c.getLittleEndian32();I=c.getLittleEndian32();J=c.getLittleEndian32();L=c.getBytes(16);M=c.getLittleEndian32();c.skipPosition(M);f=new Uint8Array(20);t=new RdpBuffer(f,0,20);t.setLittleEndian32(0|2147483648);t.setLittleEndian32(A);if(hi5.Arrays.equals([118,105,100,115,0,0,16,0,128,0,0,170,0,56,155,113],aa)&&hi5.Arrays.equals([77,74,80,71,0,0,16,0,128,0,0,170,0,56,155,113],ga)&&hi5.Arrays.equals([128,159,88,5,
86,195,206,17,191,1,0,170,0,85,89,90],L))t.setLittleEndian32(1);else{t.setLittleEndian32(0);svGlobal.logger.warn("Format is not supported:");svGlobal.logger.warn(aa);svGlobal.logger.warn(ga);svGlobal.logger.warn(L)}t.setLittleEndian32(m);a.send(f);break;case 261:k=c.getBytes(16);m=c.getLittleEndian32();break;case 258:k=c.getBytes(16);p=c.getLittleEndian32();z=c.getLittleEndian32();c.skipPosition(z);break;case 263:k=c.getBytes(16);f=new Uint8Array(16);t=new RdpBuffer(f,0,16);t.setLittleEndian32(0|
2147483648);t.setLittleEndian32(A);t.setLittleEndian32(1);a.send(f);case 277:k=c.getBytes(16);p=c.getLittleEndian32();break;case 262:k=c.getBytes(16);v.flushImgs();v.setImgRect(0,0,0,0);f=new Uint8Array(12);t=new RdpBuffer(f,0,12);t.setLittleEndian32(0|2147483648);t.setLittleEndian32(A);a.send(f);break;case 278:k=c.getBytes(16);var K=c.getLittleEndian32();var Y=c.getLittleEndian32();var N=c.getLittleEndian32();var P=c.getLittleEndian32();v.setImgRect(K,Y,N-K,P-Y);break;case 265:k=c.getBytes(16);var R=
c.getLittleEndian64();var S=c.getLittleEndian32()==1;break;case 266:k=c.getBytes(16);break;case 268:k=c.getBytes(16);break;case 267:k=c.getBytes(16);break;case 269:k=c.getBytes(16);var T=c.getLittleEndian32();break;case 274:break;case 275:break;case 259:k=c.getBytes(16);p=c.getLittleEndian32();g=c.getLittleEndian32();c.skipPosition(32);g=c.getLittleEndian32();var Q=new Image;e=c.getPosition();d[0]=c.getData().subarray(e,e+g);var da=new Blob(d,b);Q.src=URL.createObjectURL(da);v.addImg(Q);break;case 270:v.flushImgs();
break;case 273:break;case 260:break;case 276:k=c.getBytes(16);g=c.getLittleEndian32();e=c.getPosition()+g;c.skipPosition(8);var V=c.getLittleEndian32();svGlobal.logger.info("window state:"+V);var W=c.getLittleEndian32();var X=c.getLittleEndian32();K=c.getLittleEndian32();Y=c.getLittleEndian32();c.skipPosition(8);var ea=c.getLittleEndian32();var fa=c.getLittleEndian32();svGlobal.logger.info("Window rect, left:"+K+" top:"+Y+" w:"+W+" h:"+X+" cl:"+ea+" ct:"+fa);c.setPosition(e);var ha=c.getLittleEndian32();
for(e=c.getPosition()+ha;c.getPosition()<e;){var ka=c.getLittleEndian32();var la=c.getLittleEndian32();var ma=c.getLittleEndian32();var na=c.getLittleEndian32();svGlobal.logger.info("visible region, l:"+la+" t:"+ka+" r:"+na+" b:"+ma)}v.setImgRect(K,Y,W,X);break;case 1:case 2:break;default:svGlobal.logger.warn("unknown function:"+C)}break;default:svGlobal.logger.warn("unkown interface:"+x)}};return a}function g(){K=new f.DynamicChannel;K.name="Microsoft::Windows::RDS::DisplayControl";K.enabled=false;
K.process=function(a){var b=a.getLittleEndian32();var c=a.getLittleEndian32();switch(b){case 5:var d=a.getLittleEndian32();K.maxMonitorAreaFactorA=a.getLittleEndian32();K.maxMonitorAreaFactorB=a.getLittleEndian32();K.enabled=true;svGlobal.logger.warn("Display control maxNumMonitors:"+d+" factorA:"+K.maxMonitorAreaFactorA+" factorB:"+K.maxMonitorAreaFactorB);a=new Uint8Array(2);a[0]=146;a[1]=4;y(a.buffer);if(T)setTimeout(function(){T.check(5E3)},1900);case 2:}};K.applyResolution=function(a,b){if(K.enabled){var c=
new Uint8Array(56);var d=new RdpBuffer(c,0,56);if(a>K.maxMonitorAreaFactorA)a=K.maxMonitorAreaFactorA;else a=pa(a);if(b>K.maxMonitorAreaFactorB)b=K.maxMonitorAreaFactorB;else b=pa(b);d.setLittleEndian32(2);d.setLittleEndian32(56);d.setLittleEndian32(40);d.setLittleEndian32(1);d.setLittleEndian32(1);d.setLittleEndian32(0);d.setLittleEndian32(0);d.setLittleEndian32(a);d.setLittleEndian32(b);d.setLittleEndian32(a*.26458|0);d.setLittleEndian32(b*.26458|0);d.setLittleEndian32(a>b?0:90);d.setLittleEndian32(100);
d.setLittleEndian32(100);K.send(c);svGlobal.logger.warn("Display control: "+a+"x"+b)}else svGlobal.logger.warn("Display control disabled.")};return K}function h(a){var b=false;var c=0;var d=0;var g=0;var h=0;var k=[];var m=new Uint8Array(4);var p=new f.DynamicChannel;p.name="AUDIO_PLAYBACK_DVC";p.onclose=function(){};p.process=function(f){function t(b){b.skipPosition(14);var c=b.getLittleEndian16();var d=b.getByte();var f=b.getLittleEndian16();b.skipPosition(1);var g=0;var h=false;k.length=0;for(var l=
0;l<c;l++){var m=new e;m.fromBuffer(b);h=m.nSamplesPerSec>=22050&&(m.formatTag==1||m.formatTag==49&&m.nSamplesPerSec==22050&&a==0);if(h)k.push(m)}var n=20;g=k.length;for(l=0;l<g;l++)n=n+k[l].getSize();var r=n+4;var q=new RdpBuffer(new Uint8Array(r),0,r);q.setByte(7);q.setByte(2);q.setLittleEndian16(n);q.setLittleEndian32(1|2);q.setLittleEndian32(4294967295);q.setLittleEndian32(0);q.setLittleEndian16(0);q.setLittleEndian16(g);q.skipPosition(1);q.setLittleEndian16(f);q.setByte(124);for(l=0;l<g;l++){m=
k[l];m.toBuffer(q)}q.markEnd();p.send(q);if(f>5){q=new RdpBuffer(new Uint8Array(8),0,8);q.setByte(12);q.skipPosition(1);q.setLittleEndian16(4);q.setLittleEndian16(0);q.setLittleEndian16(0);q.markEnd();p.send(q)}}function q(a){var b=a.getLittleEndian16();var c=a.getLittleEndian16();var d=new RdpBuffer(new Uint8Array(8),0,8);d.setByte(6);d.setByte(35);d.setLittleEndian16(4);d.setLittleEndian16(b);d.setLittleEndian16(c);d.markEnd();p.send(d)}function v(){var a=k[g];if(a.formatTag!=C.tag||a.nSamplesPerSec!=
C.samplePerSec||C.channels!=a.nChannels){C.tag=a.formatTag;C.channels=a.nChannels;C.samplePerSec=a.nSamplesPerSec;C.bitsPerSample=a.formatTag==49?8:a.bitsPerSample}}function w(a){d=a.getLittleEndian16();g=a.getLittleEndian16();h=a.getByte();a.skipPosition(3);m[0]=a.getByte();m[1]=a.getByte();m[2]=a.getByte();m[3]=a.getByte();b=true;v()}function x(a,b){var c=new RdpBuffer(new Uint8Array(8),0,8);c.setByte(5);c.skipPosition(1);c.setLittleEndian16(4);c.setLittleEndian16(a);c.setByte(b);c.skipPosition(1);
c.markEnd();p.send(c)}function y(a,b){return function(){x(a,b)}}function A(a){b=false;var e=c-8;var f=Date.now();a.copyFromByteArray(m,0,a.getPosition(),4);var g=Za(a,h,d,e);g=(g-M.delay)*1E3;var k=d+(Date.now()-f)+g;x(k,h)}function E(a){var b=Date.now();d=a.getLittleEndian16();g=a.getLittleEndian16();h=a.getByte();a.skipPosition(7);v();var c=Za(a,h,d,0);c=(c-M.delay)*1E3;var e=d+(Date.now()-b)+c;x(e,h)}if(b){A(f);return}var F=f.getByte();f.skipPosition(1);c=f.getLittleEndian16();switch(F){case 7:t(f);
break;case 6:q(f);break;case 2:w(f);break;case 1:closed=true;break;case 3:var G=f.getLittleEndian16();var H=f.getLittleEndian16();break;case 4:break;case 13:E(f);default:}};return p}if(x.disableDVC)return;J.count=0;J.names.length=0;var m=new f.DynamicChannel;m.name="ECHO";m.process=function(a){var b=a.getPosition();var c=a.getEnd();var d=c-b;var e=new Uint8Array(d);e.set(a.getData().subarray(b,c));m.send(e)};f.addDynamicChannel(m);if(b){var p=new f.DynamicChannel;p.name="Microsoft::Windows::RDS::Input";
p.process=function(a){var b=a.getLittleEndian16();var c=a.getLittleEndian32();switch(b){case 1:a.skipPosition(4);var d=new RdpBuffer(new Uint8Array(16),0,16);d.setLittleEndian16(2);d.setLittleEndian32(16);d.setLittleEndian32(1|2);d.setLittleEndian32(65536);d.setLittleEndian16(256);d.markEnd();p.send(d);case 5:q.execute("setTouchRemoting",[true]);J.isTouchReady=true;svGlobal.logger.info("Touch remoting start");break;case 4:q.execute("setTouchRemoting",[false]);J.isTouchReady=false;svGlobal.logger.info("Touch remoting suspend")}};
f.addDynamicChannel(p)}if(c){svGlobal.logger.warn("Audio input on");var A=new f.DynamicChannel;(function r(){function a(b){var c=b.getLittleEndian32();var d=b.getLittleEndian32();var f=[];var g=[];var h=0;var m=M.getContext().sampleRate;for(h=0;h<c;h++){var l=new e;l.fromBuffer(b);if(l.formatTag==49&&l.nSamplesPerSec==22050){l.hasLocalSupport=true;f.push(l)}else if(l.formatTag==1&&l.nSamplesPerSec==m&&l.nChannels==2)g.push(l)}A.send(k);var n=0;d=f.length;if(d==0){f=g;d=g.length;v.directInput=true}for(h=
0;h<d;h++)n+=f[h].getSize();var p=new RdpBuffer(new Uint8Array(1024),0,1024);p.setByte(2);p.setLittleEndian32(d);p.setLittleEndian32(n+9);for(h=0;h<d;h++)f[h].toBuffer(p);p.skipPosition(1024-n-9);p.markEnd();A.send(p)}function b(a){var c=new RdpBuffer(new Uint8Array(5),0,5);c.setByte(7);c.setLittleEndian32(a);c.markEnd();A.send(c)}function c(a){var d=a.getLittleEndian32();var g=a.getLittleEndian32();var n=new e;n.fromBuffer(a);m=true;p=f.reconnectOnResize;f.reconnectOnResize=false;if(!v.onopen)v.onopen=
function(a){if(I){h=a;f.reconnectOnResize=p;b(g);var c=new RdpBuffer(new Uint8Array(5),0,5);c.setByte(4);c.setLittleEndian32(a?0:1);c.markEnd();A.send(c)}};if(!v.ondata)v.ondata=function(a,b){if(h){if(q.length!=b+1){q=new Uint8Array(b+1);q[0]=6}A.send(k);q.set(a,1);A.send(q)}};v.start()}function d(a){var c=a.getLittleEndian32();if(!m){b(c);m=false}}function g(a){function b(c){p=true;if(k.onopen)k.onopen(true);t=new MSGSMEncoder;e=c;f=a.createMediaStreamSource(c);var g=k.directInput?1024:4096;h=a.createJavaScriptNode?
a.createJavaScriptNode(g,1,1):a.createScriptProcessor(g,1,1);if(k.directInput&&!q)q=new Int16Array(2048);h.onaudioprocess=function(a){if(!d)return;var b=a.inputBuffer.getChannelData(0);if(k.directInput){var c=0;var e=0;for(var f=0;f<1024;f++){e=b[f]*32767;q[c++]=e;q[c++]=e}v.ondata(new Uint8Array(q.buffer),4196)}else r.addData(b,n);b.fill(0)};var l=a.createBiquadFilter();l.frequency.value=m/2;f.connect(l);l.connect(h);h.connect(a.destination)}function c(){if(!d){if(e&&e.getTracks){var a=e.getTracks()[0];
a.stop()}h&&h.disconnect();f&&f.disconnect();p=false}}var d=false;var e=null;var f=null;var h=null;var k=this;var l=a.sampleRate;var m=22050;var n=l/m;var p=false;this.directInput=false;k=this;var q;this.start=function(){if(!p)navigator.getUserMedia({audio:true},b,function(a){p=false;d=false;if(k.onopen)k.onopen(false);svGlobal.logger.warn("Error on getUserMedia: "+a)});else if(k.onopen)k.onopen(true);d=true};this.stop=function(){d=false};this.close=function(){d=false;if(r)r.reset();t=new MSGSMEncoder;
c()};var r=new function(){function a(b){var h=g/e|0;for(var k=0;k<h;k++){c(b,f);f+=e;g-=e}if(g>0)d=b;else d=null}function b(c){var e=g+c.length;var h=new Float32Array(e);h.set(d.subarray(f));h.set(c,g);f=0;g=e;a(h)}function c(a,b){var d=t.encode(a,b,m,h);h+=d;if(h==l){h=0;k.ondata(m,l)}}var d=null;var e=160;var f=0;var g=0;var h=0;var l=Math.floor(Math.floor(Math.floor(4096/n)/160)/2)*65;var m=new Uint8Array(l);this.reset=function(){h=0;f=0;g=0;d=null};this.addData=function(c,d){c=Ib(c,d);if(g==0){g=
c.length;f=0;a(c)}else b(c)}}}A.name="AUDIO_INPUT";A.process=function(b){var e=b.getByte();var f=null;switch(e){case 1:var g=b.getLittleEndian32();f=new RdpBuffer(new Uint8Array(5),0,5);f.setByte(1);f.setLittleEndian32(g);f.markEnd();A.send(f);break;case 2:a(b);break;case 3:c(b);break;case 7:d(b);break;default:svGlobal.logger.warn("audioInpt: invalid tag:"+e)}};var h=false;A.onclose=function(){h=false;if(v)v.close()};var k=new Uint8Array(1);k[0]=5;var m=false;var p=f.reconnectOnResize;var q=new Uint8Array(0);
var t=null;var v=new g(M.getContext())})();f.addDynamicChannel(A)}f.addDynamicChannel(k());if(!oa)f.addDynamicChannel(g())}};this.exeAppCmd=function(b){var a=q.getFocused();if(a)a.exeCommand(b)};this.activateApp=function(b){var a=null;if(hi5.tool.isNumber(b))a=q.getWinById(b);else a=q.getMainWinByAppId(b);if(a)a.activate(1);else svGlobal.logger.warn("No window found in "+b)};this.reconnect=function(b,a,c){if(c==undefined)c=x.forceReconnect||false;if(!I&&!c)return false;if(k.minWidth&&b<k.minWidth)b=
k.minWidth;if(k.minHeight&&a<k.minHeight)a=k.minHeight;b=pa(b);a=pa(a);if(!c&&Math.abs(b-F)<4&&Math.abs(a-G)<4)return false;if(K&&K.enabled)K.applyResolution(b,a);else Kb(b,a);return true};this.notify=function(b,a){b="8E6"+b;if(a)b+="\t"+a.join(";");y(b)};this.getUploadManager=function(){return S};this.addSurface=function(b){if(q.hasSurface(b))return;if(!Ga)v.setContext(b.context);if(q.hasSurface(b)&&b.railWin)return;if(oa)b.setPlayerMode();if(k.mouseMoveEmu)b.mouseMoveEmu=V(k.mouseMoveEmu);b.setSize(50,
50,"hidden");var a=b.getFreeSpace();if(F==0)F=a.width;if(G==0)G=a.height;b.setConfig(x);q.addSurface(b);qa(F,G,false,k.monitorDef?true:false);b.setController(Ca);b.setFastCopy(V(k.fastCopy));b.setTouchpad(V(k.touchpad));b.setClipboard(V(k.mapClipboard));if(Ya)hb(b);if(k.invitation){q.setReadOnly(true);btn=hi5.$("requestControl");if(btn)btn.disabled=false}b.run(parseInt(k.keyboard||1033,10))};this.getRunninApps=this.getRunningApps=function(){var b=[];var a=0;for(var c=q.size();a<c;a++){if(!q.getSurface(a).railWin.getMain(q.zOrders))continue;
b.push(q.getSurface(a).railWin.getMain(q.zOrders)["titleInfo"])}return b};this.startApp=function(b,a,c){y("8C2"+b+"\t"+a+"\t"+c);var d=q.getSurface(q.size()-1);if(d)d.remoteApp=new ib(b,a,c)};this.startExitingApp=function(b){var a=q.popWins(b);var c=a.length;for(var d=c-1;d>=0;d--)q.addWin(a[d])};this.VirtualChannel=function(){return new Ra(143)};this.GatewayChannel=function(){return new Ra(28)};this.DynamicChannel=function(){return new Ra(64)};this.addChannel=function(b){ma[b.name]=b};this.addGatewayChannel=
function(b){na[b.name]=b};this.addDynamicChannel=function(b){J.names.push(b.name);J[b.name]=b;J.count++};if(V(k.smartCard)){var Ea=new f.GatewayChannel;var cb=null;Ea.name="SCARDSTB";Ea.onopen=function(){cb=document.getElementById(hi5.appcfg.clientAppletId||"clientApplet")};Ea.process=function(b){var a=null;if(cb){var c=b.getPosition();var d=hi5.Base64.enc(b.getData(),b.getEnd()-c,c);try{d=cb.deviceControl(d);a=hi5.Base64.dec(d,0)}catch(f){svGlobal.logger.warn(f)}}if(!a)a=[0];var e=new hi5.DataBuffer(a);
e.markEnd(a.length);Ea.send(e)};f.addGatewayChannel(Ea)}var Ua={type:6,data:null};this.run=function(){kb();if(M.supportWebAudio)M.iOSFix()};this.getDesktop=function(){return v};this.mouseDown=function(b,a,c){if(X)y("80"+b+"\t"+a+"\t"+c)};this.mouseMove=function(b,a){if(X)y("82"+b+"\t"+a)};this.mouseUp=function(b,a,c){if(X)y("81"+b+"\t"+a+"\t"+c)};this.writeKeyCode=function(b,a){if(X)y("8B"+(b?0:49152)+"\t"+a)};this.writeScancode=function(b,a){if(X){if(typeof b=="number"){y("84"+"0\t"+b);y("84"+"49152\t"+
b);return}y("84"+(b?0:49152)+"\t"+a)}};var Q=new RdpBuffer([],0,0);this.suppressOutput=function(b){if(!f.sessionInfo.suppressOutput)return false;if(b==undefined)b=true;var a=new Uint8Array(b?3:11);a[0]=146;a[1]=3;a[2]=b?1:0;if(!b){a[3]=Ka;a[4]=Ka>>8;a[5]=La;a[6]=La>>8;a[7]=Ma;a[8]=Ma>>8;a[9]=Na;a[10]=Na>>8}y(a.buffer);return true};this.refreshOutput=function(b,a,c,d){var e=new Uint8Array(c?11:3);e[0]=146;e[1]=3;e[2]=2;if(c){e[3]=b;e[4]=b>>8;e[5]=a;e[6]=a>>8;e[7]=c;e[8]=c>>8;e[9]=d;e[10]=d>>8}y(e.buffer)};
this.sendPing=function(b){var a=b?2+b.length:2;var c=new Uint8Array(a);c[0]=146;c[1]=0;if(b)c.set(b,2);y(c.buffer)};this.startPing=function(b,a){a=a||0;if(!T)T=new hi5.tool.ResponseMonitor(function(){if(I)f.sendPing()},function(){if(I&&f.onnoresponse)return f.onnoresponse()});T.setInterval(b,a);var c=new Uint8Array(4);c[0]=146;c[1]=2;c[2]=b;c[3]=a;y(c.buffer);setTimeout(function(){T.check()},b*a*1E3);if(N)N.postMessage({type:0,cmd:6,start:1});else{A.onSlowPath=A.onFastPath=sb;A.onReqHistory=function(){sb(15555)}}};
this.stopPing=function(){if(T)T.stop();if(N)N.postMessage({type:0,cmd:6,start:0});else A.onSlowPath=A.onFastPath=A.onReqHistory=null};var fa=null;var yb=0;this.play=function(){y("F3")};this.pause=function(){y("F2")};this.scan=function(b){y("F4"+(b?"1":"0"))};this.seek=function(b){var a=q.getFocused();if(a&&I){y("F4"+(b?"1":"0")+"\t"+(b/a.getScale()|0));v.pause(true)}};var C={tag:0,channels:0,bitsPerSample:0,samplePerSec:22050,toStream:function(b){b.setLittleEndian16(this.tag);b.setLittleEndian16(this.channels);
b.setLittleEndian16(this.bitsPerSample);b.setLittleEndian32(this.samplePerSec)},fromStream:function(b){this.tag=b.getLittleEndian16();this.channels=b.getLittleEndian16();this.bitsPerSample=b.getLittleEndian16();this.samplePerSec=b.getLittleEndian32()}};var Cb=false;this.showMessage=function(b,a,c){if(!f||!f.displayMsg||!b)return;var d=a||q.getFocused();if(d)d.showMessage(b,c);else hi5.notifications.notify({"msg":b,"timeout":c||0})};this._unload=Aa;this.close=function(){svGlobal.logger.info("closing...");
if(A&&I)A.close();else Aa(true)};if(!hi5.browser.isChromeApp)window.addEventListener("unload",f.close,false);else chrome.runtime.onSuspend.addListener(f.close)}if(!svGlobal.Rdp)svGlobal.Rdp=Rdp;var RdpBuffer=hi5.DataBuffer;
