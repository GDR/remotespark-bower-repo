var svManager={getInstance:function(){var r=window.$rdp;return r&&r.running&&r.running()?r:null}};svGlobal.getInstance=svManager.getInstance;
function connvertServer(r){var M={};M.id=r.id;M.server=r.id;M.displayName=r.displayName||r.id;if(r=r.rdp){for(var Ka in r)M[Ka]=r[Ka];M.user=r.username||"";M.pwd=r.password||"";M.useConsole=r.console||!1;M.legacyMode=r.leagacyMode||r.legacyMode||!1;M.server_bpp=r.color||16;M.exe=r.remoteProgram||"";M.args=r.remoteArgs||"";M.startProgram=0<M.exe.length?"app":M.command&&0<M.command.length?"shell":"noapp"}return M}
hi5.browser.isChromeApp||window.addEventListener("beforeunload",function(r){var M=svManager.getInstance();if(M&&M.isRemoteApp()&&2!=M.mode&&M.displayMsg&&__svi18n.remoteApp.warn){var M=M.getRunninApps(),Ka=M.length;if(0<Ka){for(var Ra=__svi18n.remoteApp.warn+"<br>",Oa=0;Oa<Ka;Oa++)Ra+=M[Oa]+" ";Ra+="<br>"+__svi18n.remoteApp.close;hi5.notifications.notify({msg:Ra});r&&(r.returnValue=Ra);return Ra}}},!1);
function Rdp2(r){if(!r){var M=window.opener;try{M&&M.__sparkUser&&M.__sparkUser.server&&(r=M.__sparkUser.server),!r&&M.sparkServer&&(r=M.sparkServer)}catch(oa){}r||(r=hi5.browser.cookie2Obj());if(!r||!r.gateway)return hi5.notifications.notify({msg:__svi18n.noauth}),null}var M="",Ka=r.gateway||"",Ra=window.innerWidth,Oa=window.innerHeight,Va=16,bb=null;r.width&&(Ra=parseInt(r.width,10));r.height&&(Oa=parseInt(r.height,10));r.color&&(Va=parseInt(r.color,10));r.server_bpp&&(Va=parseInt(r.server_bpp,
10));for(var Da in r){svGlobal.logger.debug("** p:"+Da+" v="+r[Da]);var Ja=r[Da];if("useSSL"==Da)bb="true"==Ja||1==Ja;else{if("boolean"==typeof Ja)if(Ja)Ja="on";else continue;""!=M&&(M+="&");M+=Da+"="+encodeURIComponent(Ja)}}null===bb&&(bb="https:"==location.protocol);M=(bb?"wss://":"ws://")+Ka+"/RDP?"+M;return new Rdp(M,Ra,Oa,Va)}svGlobal.Rdp2=Rdp2;
function Rdp(r,M,Ka,Ra){var Oa,Va,bb,Da;function Ja(a){return"Uint32Array"in window?new Uint32Array(a):Array(a)}function oa(a){return"Int32Array"in window?new Int32Array(a):Array(a)}function fb(a){return"Uint8Array"in window?new Uint8Array(a):Array(a)}function Ib(a){return"on"==a||"true"==a}function cb(){var a=p.gateway;p.ongetgatewayaddress&&(a=p.ongetgatewayaddress(a));return a}function ee(a){if(hi5.browser.isiOS){var b=a-hi5.browser.innerHeight;10<b&&22>b&&(a=hi5.browser.innerHeight)}return a}
function Ze(){var a=hi5.storage.get("SV_CONN_SHARE_ID");a||(a=hi5.tool.uuid(),hi5.storage.set("SV_CONN_SHARE_ID",a));return a}function Vc(a,b){p.setTitle&&(b=b||window,p.ontitlechange&&(a=p.ontitlechange(a)),b.document.title=a)}function fe(){function a(a,k,t,x,f,u,Y,r){var Kd=0,F="Int32Array"in window?new Int32Array(160):Array(160);F.buffer||Ea(F,0,160,0);var Cd="Int32Array"in window?new Int32Array(40):Array(40);Cd.buffer||Ea(Cd,0,40,0);for(var C=0;3>=C;C++,Kd+=13){var S=f[C],Q=t[C],N=Kd,T=u,v=Cd,
y=oa(13);y.buffer||Ea(y,0,13,0);var pa=void 0,B=pa=0;15<S&&(pa=(S>>3)-1);B=S-(pa<<3);if(0==B)pa=-4,B=7;else{for(;7>=B;)B=B<<1|1,pa--;B-=8}S=Array(2);S[0]=pa;S[1]=B;for(var pa=S,S=y,M=void 0,td=B=void 0,O=void 0,B=g[pa[1]],td=l(6,pa[0]),pa=l(td,1),O=16<=pa?0:-16>=pa?-0:0>pa?n(1,-pa):1<<pa,L=pa=0;13>L;L++)M=(T[N++]<<1)-7,M<<=12,M=e(B,M),M+=O,-32768>M?M=-32768:32767<M&&(M=32767),S[pa++]=n(M,td);T=13;pa=S=0;switch(Q){case 3:v[pa++]=0;case 2:v[pa++]=0;case 1:v[pa++]=0;case 0:v[pa++]=y[S++],T--}do v[pa++]=
0,v[pa++]=0,v[pa++]=y[S++];while(0<--T);for(;4>++Q;)v[pa++]=0;S=k[C];pa=x[C];v=Cd;T=Q=y=void 0;p=T=40>S||120<S?p:S;y=m[pa];for(S=0;39>=S;S++)Q=e(y,h[S-T+120]),Q+=v[S],-32768>Q?Q=-32768:32767<Q&&(Q=32767),h[S+120]=Q;tb(h,40,h,0,120);tb(h,120,F,40*C,39)}k=oa(8);t=w[zd];x=w[zd^=1];f=0;b(a,t,f++,0,0,-32,13107);b(a,t,f++,0,0,-32,13107);b(a,t,f++,0,2048,-16,13107);b(a,t,f++,0,-2560,-16,13107);b(a,t,f++,0,94,-8,19223);b(a,t,f++,0,-1792,-8,17476);b(a,t,f++,0,-341,-4,31454);b(a,t,f++,0,-1144,-4,29708);for(f=
a=0;8>f;f++)a=(x[f]>>2)+(t[f]>>2),-32768>a?a=-32768:32767<a&&(a=32767),a+=x[f]>>1,-32768>a?a=-32768:32767<a&&(a=32767),k[f]=a;c(k);d(k,13,F,Y,0,r);for(f=a=0;8>f;f++)a=(x[f]>>1)+(t[f]>>1),-32768>a?a=-32768:32767<a&&(a=32767),k[f]=a;c(k);d(k,14,F,Y,13,r);for(f=a=0;8>f;f++)a=(x[f]>>2)+(t[f]>>2),-32768>a?a=-32768:32767<a&&(a=32767),a+=t[f]>>1,-32768>a?a=-32768:32767<a&&(a=32767),k[f]=a;c(k);d(k,13,F,Y,27,r);for(a=0;8>a;a++)k[a]=t[a];c(k);d(k,120,F,Y,40,r);F=0;a=r;for(k=r+160;k-- >r;a++)F=e(z,28180),z=
Y[a]+F,-32768>z?z=-32768:32767<z&&(z=32767),F=z<<1,-32768>F?F=-32768:32767<F&&(F=32767),Y[a]=F}function b(a,c,b,d,f,k,h){d=a[b]+k;-32768>d?d=-32768:32767<d&&(d=32767);d=l(d<<10,f<<1);d=e(h,d);d+=d;-32768>d?d=-32768:32767<d&&(d=32767);c[b]=d}function c(a){for(var b=0,c=0;8>c;c++)0>a[c]?(b=-32768==a[c]?32767:-a[c],a[c]=-(11059>b?b<<1:20070>b?b+11059:k(b>>2,26112))):(b=a[c],a[c]=11059>b?b<<1:20070>b?b+11059:k(b>>2,26112))}function d(a,b,c,d,f,e){for(var k=0,h=0,n=0;0!=b;){b--;for(var k=c[f],g=7;0<=g;g--)h=
a[g],n=t[g],n=((-32768==h&&-32768==n?32767:65535&h*n+16384>>15)&65535)<<16>>16,k=l(k,n),h=((-32768==h&&-32768==k?32767:65535&h*k+16384>>15)&65535)<<16>>16,h=t[g]+h,-32768>h?h=-32768:32767<h&&(h=32767),t[g+1]=h;d[e+f++]=t[0]=k}}function e(a,b){if(-32768==a&&-32768==b)return 32767;var c;return c=(a*b+16384>>15&65535)<<16>>16}function k(a,b){var c=a+b;return-32768>c?-32768:32767<c?32767:c}function l(a,b){var c=a-b;return-32768>c?-32768:32767<c?32767:c}function n(a,b){return 16<=b?0>a?-1:0:-16>=b?0:0>
b?a<<-b:a>>b}var g=[18431,20479,22527,24575,26623,28671,30719,32767],m=[3277,11469,21299,32767],h=oa(280);h[0]=0;var w=[oa(8),oa(8)],zd=0,p=40,t=oa(9),z=0,u=oa(320);u[0]=0;var x=[.1];this.decode=function(b,c,d){for(var l=0,f=0,f=0,e=oa(8),k=oa(4),h=oa(4),n=oa(4),g=oa(4),m=oa(52);c<d;){f=b[c++]&255;e[0]=f&63;f>>>=6;f|=b[c++]<<2&1023;e[1]=f&63;f>>>=6;f|=b[c++]<<4&4095;e[2]=f&31;f>>>=5;e[3]=f&31;f>>>=5;f|=b[c++]<<2&1023;e[4]=f&15;f>>>=4;e[5]=f&15;f>>>=4;f|=b[c++]<<2&1023;e[6]=f&7;f>>>=3;e[7]=f&7;f>>>=
3;f|=b[c++]<<4&4095;k[0]=f&127;f>>>=7;n[0]=f&3;f>>>=2;h[0]=f&3;f>>>=2;f|=b[c++]<<1&511;g[0]=f&63;f>>>=6;m[0]=f&7;f=b[c++]&255;m[1]=f&7;f>>>=3;m[2]=f&7;f>>>=3;f|=b[c++]<<2&1023;m[3]=f&7;f>>>=3;m[4]=f&7;f>>>=3;m[5]=f&7;f>>>=3;f|=b[c++]<<1&511;m[6]=f&7;f>>>=3;m[7]=f&7;f>>>=3;m[8]=f&7;f=b[c++]&255;m[9]=f&7;f>>>=3;m[10]=f&7;f>>>=3;f|=b[c++]<<2&1023;m[11]=f&7;f>>>=3;m[12]=f&7;f>>>=3;f|=b[c++]<<4&4095;k[1]=f&127;f>>>=7;n[1]=f&3;f>>>=2;h[1]=f&3;f>>>=2;f|=b[c++]<<1&511;g[1]=f&63;f>>>=6;m[13]=f&7;f=b[c++]&
255;m[14]=f&7;f>>>=3;m[15]=f&7;f>>>=3;f|=b[c++]<<2&1023;m[16]=f&7;f>>>=3;m[17]=f&7;f>>>=3;m[18]=f&7;f>>>=3;f|=b[c++]<<1&511;m[19]=f&7;f>>>=3;m[20]=f&7;f>>>=3;m[21]=f&7;f=b[c++]&255;m[22]=f&7;f>>>=3;m[23]=f&7;f>>>=3;f|=b[c++]<<2&1023;m[24]=f&7;f>>>=3;m[25]=f&7;f>>>=3;f|=b[c++]<<4&4095;k[2]=f&127;f>>>=7;n[2]=f&3;f>>>=2;h[2]=f&3;f>>>=2;f|=b[c++]<<1&511;g[2]=f&63;f>>>=6;m[26]=f&7;f=b[c++]&255;m[27]=f&7;f>>>=3;m[28]=f&7;f>>>=3;f|=b[c++]<<2&1023;m[29]=f&7;f>>>=3;m[30]=f&7;f>>>=3;m[31]=f&7;f>>>=3;f|=b[c++]<<
1&511;m[32]=f&7;f>>>=3;m[33]=f&7;f>>>=3;m[34]=f&7;f=b[c++]&255;m[35]=f&7;f>>>=3;m[36]=f&7;f>>>=3;f|=b[c++]<<2&1023;m[37]=f&7;f>>>=3;m[38]=f&7;f>>>=3;f|=b[c++]<<4&4095;k[3]=f&127;f>>>=7;n[3]=f&3;f>>>=2;h[3]=f&3;f>>>=2;f|=b[c++]<<1&511;g[3]=f&63;f>>>=6;m[39]=f&7;f=b[c++]&255;m[40]=f&7;f>>>=3;m[41]=f&7;f>>>=3;f|=b[c++]<<2&1023;m[42]=f&7;f>>>=3;m[43]=f&7;f>>>=3;m[44]=f&7;f>>>=3;f|=b[c++]<<1&511;m[45]=f&7;f>>>=3;m[46]=f&7;f>>>=3;m[47]=f&7;f=b[c++]&255;m[48]=f&7;f>>>=3;m[49]=f&7;f>>>=3;f|=b[c++]<<2&1023;
m[50]=f&7;f>>>=3;m[51]=f&7;f>>>=3;a(e,k,h,n,g,m,u,0);f&=15;f|=b[c++]<<4&4095;e[0]=f&63;f>>>=6;e[1]=f&63;f=b[c++]&255;e[2]=f&31;f>>>=5;f|=b[c++]<<3&2047;e[3]=f&31;f>>>=5;e[4]=f&15;f>>>=4;f|=b[c++]<<2&1023;e[5]=f&15;f>>>=4;e[6]=f&7;f>>>=3;e[7]=f&7;f=b[c++]&255;k[0]=f&127;f>>>=7;f|=b[c++]<<1&511;n[0]=f&3;f>>>=2;h[0]=f&3;f>>>=2;f|=b[c++]<<5&8191;g[0]=f&63;f>>>=6;m[0]=f&7;f>>>=3;m[1]=f&7;f>>>=3;f|=b[c++]<<1&511;m[2]=f&7;f>>>=3;m[3]=f&7;f>>>=3;m[4]=f&7;f=b[c++]&255;m[5]=f&7;f>>>=3;m[6]=f&7;f>>>=3;f|=b[c++]<<
2&1023;m[7]=f&7;f>>>=3;m[8]=f&7;f>>>=3;m[9]=f&7;f>>>=3;f|=b[c++]<<1&511;m[10]=f&7;f>>>=3;m[11]=f&7;f>>>=3;m[12]=f&7;f=b[c++]&255;k[1]=f&127;f>>>=7;f|=b[c++]<<1&511;n[1]=f&3;f>>>=2;h[1]=f&3;f>>>=2;f|=b[c++]<<5&8191;g[1]=f&63;f>>>=6;m[13]=f&7;f>>>=3;m[14]=f&7;f>>>=3;f|=b[c++]<<1&511;m[15]=f&7;f>>>=3;m[16]=f&7;f>>>=3;m[17]=f&7;f=b[c++]&255;m[18]=f&7;f>>>=3;m[19]=f&7;f>>>=3;f|=b[c++]<<2&1023;m[20]=f&7;f>>>=3;m[21]=f&7;f>>>=3;m[22]=f&7;f>>>=3;f|=b[c++]<<1&511;m[23]=f&7;f>>>=3;m[24]=f&7;f>>>=3;m[25]=f&
7;f=b[c++]&255;k[2]=f&127;f>>>=7;f|=b[c++]<<1&511;n[2]=f&3;f>>>=2;h[2]=f&3;f>>>=2;f|=b[c++]<<5&8191;g[2]=f&63;f>>>=6;m[26]=f&7;f>>>=3;m[27]=f&7;f>>>=3;f|=b[c++]<<1&511;m[28]=f&7;f>>>=3;m[29]=f&7;f>>>=3;m[30]=f&7;f=b[c++]&255;m[31]=f&7;f>>>=3;m[32]=f&7;f>>>=3;f|=b[c++]<<2&1023;m[33]=f&7;f>>>=3;m[34]=f&7;f>>>=3;m[35]=f&7;f>>>=3;f|=b[c++]<<1&511;m[36]=f&7;f>>>=3;m[37]=f&7;f>>>=3;m[38]=f&7;f=b[c++]&255;k[3]=f&127;f>>>=7;f|=b[c++]<<1&511;n[3]=f&3;f>>>=2;h[3]=f&3;f>>>=2;f|=b[c++]<<5&8191;g[3]=f&63;f>>>=
6;m[39]=f&7;f>>>=3;m[40]=f&7;f>>>=3;f|=b[c++]<<1&511;m[41]=f&7;f>>>=3;m[42]=f&7;f>>>=3;m[43]=f&7;f=b[c++]&255;m[44]=f&7;f>>>=3;m[45]=f&7;f>>>=3;f|=b[c++]<<2&1023;m[46]=f&7;f>>>=3;m[47]=f&7;f>>>=3;m[48]=f&7;f>>>=3;f|=b[c++]<<1&511;m[49]=f&7;f>>>=3;m[50]=f&7;f>>>=3;m[51]=f&7;a(e,k,h,n,g,m,u,160);for(var f=320*l++,w=0;320>w;w++)x[f++]=u[w]/32768}x.length=320*l;return x}}function ge(a,b){var c=[],d=null,e=new Wb(0,0,0,0),k="Uint8ClampedArray"in window,l="Uint32Array"in window;this.width=a;this.height=
b;var n=!1,g=this;this.getData=function(){return c};this.pause=function(a){n=a};this.isPaused=function(){return n};this.setContext=function(a){a!=d&&(d||!a||a.createImageData(1,1).data.buffer||(k=!1),d=a)};this.getContext=function(){return d};this.resize=function(d,e){if(l)for(var k=0;k<e;k++)c[k]=new Uint32Array(d);else if(e>c.length)for(k=c.length;k<e;k++)c[k]=[0];g.width=a=d;g.height=b=e};g.resize(a,b);this.getBuffer=function(){return c};this.setRGB=function(a,b,d){c[b][a]=d|4278190080};this.getRGB=
function(a,b){return c[b][a]};this.setRGBs=function(a,d,l,e,k,n,g){var u=0,x=0,P=a+l;e=d+e;e>b&&(e=b);if(k.subarray)for(;d<e;d++,n+=g)c[d].set(k.subarray(n,n+l),a);else for(;d<e;d++,n+=g)for(x=n,l=c[d],u=a;u<P;u++)l[u]=k[x++]};this.moveArea=function(a,b,d,e,l,k){if(0<k){l=a+l;k=b+k;var n=0,g=0;if(c[0].set)for(g=e-1;0<=g;g--)c[k+g].set(c[b+g].subarray(a,a+d),l);else for(g=e-1;0<=g;g--){e=c[k+g];for(var x=c[b+g],n=0;n<d;n++)e[l+n]=x[a+n]}}else if(0>k)if(l=a+l,k=b+k,g=n=0,c[0].set)for(;g<e;g++)c[k+g].set(c[b+
g].subarray(a,a+d),l);else for(;g<e;g++)for(var x=c[k+g],P=c[b+g],n=0;n<d;n++)x[l+n]=P[a+n];else if(0<l)for(l=a+l,k=b+k,P=x=g=n=0,n=d-1;0<=n;n--)for(x=l+n,P=a+n,g=0;g<e;g++)c[k+g][x]=c[b+g][P];else for(l=a+l,k=b+k,P=x=g=n=0;n<d;n++)for(x=l+n,P=a+n,g=0;g<e;g++)c[k+g][x]=c[b+g][P]};this.getRGBs=function(a,b,d,e){var k=Ja(d*e),g=a+d;e=b+e;var n=0,p=0;if(l)for(Wa=b;Wa<e;Wa++)k.set(c[Wa].subarray(a,g),n),n+=d;else for(Wa=b;Wa<e;Wa++)for(p=a;p<g;p++)k[n++]=c[Wa][p];return k};this.repaint=function(e,l,g,
p){if(d&&!n){0>e&&(g+=e,e=0);0>l&&(p+=l,l=0);e+g>a&&(g=a-e);l+p>b&&(p=b-l);var A=d.createImageData(g,p),t=A.data,z=e+g;p=l+p;var u=0;if(k)for(var t=new Uint32Array(t.buffer),x=l;x<p;x++)t.set(c[x].subarray(e,z),u),u+=g;else for(var P,K,x=l;x<p;x++)for(g=e;g<z;g++)P=c[x][g],K=u<<2,t[K]=P&255,t[K+1]=P>>8&255,t[K+2]=P>>16&255,t[K+3]=255,u++;d.putImageData(A,e,l)}};this.postPaint=function(a,b,c,d){0<e.width?e.union(a,b,c,d):(e.x=a,e.y=b,e.width=c,e.height=d)};this.commitPaint=function(){0<e.width&&(g.repaint(e.x,
e.y,e.width,e.height),e.width=0)};this.paintTo=function(c,d){0==c&&0==d?g.repaint(0,0,a,b):console.log("xx paintTo, x:"+c+" y:"+d)};this.fillRect=function(a,b,d,e,l){d=a+d;e=b+e;if(c[0].fill)for(var k=b;k<e;k++)c[k].fill(l,a,d);else for(k=b;k<e;k++)for(b=a;b<d;b++)c[k][b]=l};this.drawLine=function(a,b,d,e,l){var k=0,k=0;if(b==e)if(a>d&&(k=a,a=d,d=k),b=c[b],d++,b.fill)b.fill(l,a,d);else for(k=a;k<d;k++)b[k]=l;else if(a==d)for(b>e&&(k=b,b=e,e=k),e++,k=b;k<e;k++)c[k][a]=l;else{var g=Math.abs(d-a),n=
Math.abs(e-b),k=a,x=b,p=0,K=0,D=0,ba=0,f=0,Jb=0,Y=0,r=0;K=d>=a?p=1:p=-1;ba=e>=b?D=1:D=-1;g>=n?(ba=p=0,Jb=g,f=g/2|0,Y=n,r=g):(D=K=0,Jb=n,f=n/2|0,Y=g,r=n);if(!(1>r))for(r++,a=0;a<r;a++)c[x][k]=l,f+=Y,f>=Jb&&(f-=Jb,k+=p,x+=D),k+=K,x+=ba}}}function he(){var a="SI_"+p.server;C.domain&&(a+=C.domain);C.user&&(a+=C.user);return a}function $e(){if(!la&&"sessionStorage"in window&&!C.pwd){var a=sessionStorage[he()];if(a){a=JSON.parse(a);if(!("random"in a))return"";for(var b=a.random,c=0;16>c;c++)b[c]&=255;svGlobal.logger.info("load session, id="+
a.logId+" server="+p.server);return"&logId="+a.logId+"&random="+encodeURIComponent(hi5.Base64.enc(b))}}return""}function ie(){la?(W=(C.waWidth||screen.width)|0,da=(C.waHeight||screen.height)|0,768>da&&767<screen.height&&(da=768)):(W&=-4,da&=-4);C.minWidth&&W<C.minWidth&&(W=C.minWidth|0);C.minHeight&&da<C.minHeight&&(da=C.minHeight|0);C.waWidth=C.waWidth||W;C.waHeight=C.waHeight||da}function ic(a,b){F?F.resize(a,b):F=new ge(a,b);return F}function je(a){return 4278190080|(a<<3&248|a>>2&7)<<16|(a>>3&
252|a>>9&3)<<8|a>>8&248|a>>13&7}function af(a){return 4278190080|Xa[2][a]<<16|Xa[1][a]<<8|Xa[0][a]}function bf(a){return 4278190080|a}function gd(a,b,c,d,e,k){for(var l=0,n=0,g=0,m=g=0,h=0,w=0,p=w=0,A=0,t=b,z=k;n<d;){k=z+c*d*4-(n+1)*c*4;h=0;A=k;l=0;if(0==p)for(;l<c;){g=a[b++];m=g&15;g=g>>4&15;w=m<<4|g;47>=w&&16<=w&&(m=w,g=0);for(;0<g;)h=a[b++],e[k]=h,k+=4,l++,g--;for(;0<m;)e[k]=h,k+=4,l++,m--}else for(;l<c;){g=a[b++];m=g&15;g=g>>4&15;w=m<<4|g;47>=w&&16<=w&&(m=w,g=0);for(;0<g;)w=a[b++],0!=(w&1)?(w>>=
1,w+=1,h=-w):h=w>>=1,w=e[p+4*l]+h,e[k]=w,k+=4,l++,g--;for(;0<m;)w=e[p+4*l]+h,e[k]=w,k+=4,l++,m--}n++;p=A}return b-t}function Md(a,b,c){b||(b=a.length);c||(c=0);b=Math.floor(b/4);for(var d=Ja(b),e=d[0]=0,k=0;k<b;k++)e=(k<<2)+c,d[k]=(a[e+3]&255)<<24|a[e+2]&255|(a[e+1]&255)<<8|(a[e+0]&255)<<16;return d}function xc(a,b,c,d,e,k){var l,n;for(n=0;n<d;n++)for(l=0;l<c;l++)e[k+4*((d-n-1)*c+l)]=a[b+(n*c+l)]}function cf(a,b,c,d,e){c=d[e];var k=0;e+=1;var k=a*b,l=Ja(4*k);l[0]=0;if(0==(c&32)){for(var n=e,g,m=0,
h=0,w=0,p=w=0,A=0,t=n,z=3;h<b;){g=z+a*b*4-(h+1)*a*4;for(m=0;m<a;){w=d[n++];p=w&15;w=w>>4&15;A=p<<4|w;47>=A&&16<=A&&(p=A,w=0);for(;0<w;)n++,l[g]=255,g+=4,m++,w--;for(;0<p;)l[g]=255,g+=4,m++,p--}h++}e+=n-t}else for(g=n=0;g<k;g++)n=g<<2,l[n+3]=255;0!=(c&16)?(k=gd(d,e,a,b,l,2),e+=k,k=gd(d,e,a,b,l,1),e+=k,gd(d,e,a,b,l,0)):(xc(d,e,a,b,l,2),e+=k,xc(d,e,a,b,l,1),xc(d,e+k,a,b,l,0));return Md(l)}function ke(a,b,c,d,e){var k=-1,l=-1;c=e+c;var n=0,g=0,m=0,h=a,w=-1,p=0,A=g=0,t=0,z=m=0,u=4294967295,x=0,P=!1,K=
!1,x=!1,D=Ja(a*b);for(D[0]=0;e<c;){p=0;g=d[e++];n=g>>4;switch(n){case 12:case 13:case 14:n-=6;g&=15;m=16;break;case 15:n=g&15;9>n?(g=d[e++],g|=d[e++]<<8):g=11>n?8:1;m=0;break;default:n>>=1,g&=31,m=32}0!=m&&(x=2==n||7==n,0==g?g=x?d[e++]+1:d[e++]+m:x&&(g<<=3));switch(n){case 0:w!=n||h==a&&-1==k||(P=!0);break;case 8:x=d[e++]|d[e++]<<8,A=4278190080|x>>8&248|x>>13&7|(x>>3&252|x>>9&3)<<8|(x<<3&248|x>>2&7)<<16;case 3:x=d[e++]|d[e++]<<8;t=4278190080|x>>8&248|x>>13&7|(x>>3&252|x>>9&3)<<8|(x<<3&248|x>>2&7)<<
16;break;case 6:case 7:x=d[e++]|d[e++]<<8;u=4278190080|x>>8&248|x>>13&7|(x>>3&252|x>>9&3)<<8|(x<<3&248|x>>2&7)<<16;n-=5;break;case 9:z=3;n=2;p=3;break;case 10:z=5,n=2,p=5}w=n;for(m=0;0<g;)switch(h>=a&&(h=0,b--,k=l,l=0+b*a),n){case 0:P&&(D[l+h]=-1==k?u:D[k+h]^u|4278190080,P=!1,g--,h++);if(-1==k){for(;0!=(g&-8)&&h+8<a;)for(var ba=0;8>ba;ba++)D[l+h]=4278190080,g--,h++;for(;0<g&&h<a;)D[l+h]=4278190080,g--,h++}else{for(;0!=(g&-8)&&h+8<a;)for(ba=0;8>ba;ba++)D[l+h]=D[k+h],g--,h++;for(;0<g&&h<a;)D[l+h]=D[k+
h],g--,h++}break;case 1:if(-1==k){for(;0!=(g&-8)&&h+8<a;)for(ba=0;8>ba;ba++)D[l+h]=u,g--,h++;for(;0<g&&h<a;)D[l+h]=u,g--,h++}else{for(;0!=(g&-8)&&h+8<a;)for(ba=0;8>ba;ba++)D[l+h]=D[k+h]^u|4278190080,g--,h++;for(;0<g&&h<a;)D[l+h]=D[k+h]^u|4278190080,g--,h++}break;case 2:if(-1==k){for(;0!=(g&-8)&&h+8<a;)for(ba=0;8>ba;ba++)m<<=1,m&=255,0==m&&(z=0!=p?p&255:d[e++],m=1),D[l+h]=0!=(z&m)?u:4278190080,g--,h++;for(;0<g&&h<a;)m<<=1,m&=255,0==m&&(z=0!=p?p&255:d[e++],m=1),D[l+h]=0!=(z&m)?u:4278190080,g--,h++}else{for(;0!=
(g&-8)&&h+8<a;)for(ba=0;8>ba;ba++)m<<=1,m&=255,0==m&&(z=0!=p?p&255:d[e++],m=1),D[l+h]=0!=(z&m)?D[k+h]^u|4278190080:D[k+h],g--,h++;for(;0<g&&h<a;)m<<=1,m&=255,0==m&&(z=0!=p?p&255:d[e++],m=1),D[l+h]=0!=(z&m)?D[k+h]^u|4278190080:D[k+h],g--,h++}break;case 3:for(;0!=(g&-8)&&h+8<a;)for(ba=0;8>ba;ba++)D[l+h]=t,g--,h++;for(;0<g&&h<a;)D[l+h]=t,g--,h++;break;case 4:for(;0!=(g&-8)&&h+8<a;)for(ba=0;8>ba;ba++)x=d[e++]|d[e++]<<8,D[l+h]=4278190080|x>>8&248|x>>13&7|(x>>3&252|x>>9&3)<<8|(x<<3&248|x>>2&7)<<16,g--,
h++;for(;0<g&&h<a;)x=d[e++]|d[e++]<<8,D[l+h]=4278190080|x>>8&248|x>>13&7|(x>>3&252|x>>9&3)<<8|(x<<3&248|x>>2&7)<<16,g--,h++;break;case 8:for(;0!=(g&-8)&&h+8<a;)for(ba=0;8>ba;ba++)K?(D[l+h]=t,K=!1):(D[l+h]=A,K=!0,g++),g--,h++;for(;0<g&&h<a;)K?(D[l+h]=t,K=!1):(D[l+h]=A,K=!0,g++),g--,h++;break;case 13:for(;0!=(g&-8)&&h+8<a;)for(ba=0;8>ba;ba++)D[l+h]=4294967295,g--,h++;for(;0<g&&h<a;)D[l+h]=4294967295,g--,h++;break;case 14:for(;0!=(g&-8)&&h+8<a;)for(ba=0;8>ba;ba++)D[l+h]=4278190080,g--,h++;for(;0<g&&
h<a;)D[l+h]=4278190080,g--,h++;break;default:g--,h++}}return D}function yc(a){Xb=a;Nd=(a+7)/8>>0;switch(a){case 16:Eb=je;hd=ke;break;case 8:Eb=af;break;case 32:Eb=bf;hd=cf;break;default:C.invitation||p.showMessage(a+" bit color is not supported anymore.")}}function zc(a,b){W=a;da=b;qa=ra=0;ia=W-1;ja=da-1;svGlobal.logger.warn("resolution changed, w:"+a+" h:"+b);if(p.onresolutionchange)p.onresolutionchange(a,b)}function le(a,b,c){if(!db){var d=0;c&&(d|=4);b&&(d|=2);a&&(d|=1);y.send("8E5"+d)}}function Ac(a,
b,c,d,e,k){this.data=a;this.left=d;this.top=e;this.width=b;this.height=c;this.bitsperpixel=k;this.bytesperpixel=Math.floor((k+7)/8)}function me(){var a,b=Array(5),c=Array(5);c[0]=null;for(var d=0;5>d;d++)a=Array(600),a[0]=null,b[d]=a;this.putBitmap=function(a,d,l){32767==d?(c[a]&&(c[a].data=null,c[a]=null),c[a]=l):(a=b[a],a[d]&&(a[d].data=null,a[d]=null),a[d]=l)};this.getBitmap=function(a,d){return 32767==d?c[a]:b[a][d]}}function ne(a){var b=__svi18n.errorCode[a];b||(b="error "+a);if(p.onerror)p.onerror({name:a,
message:b});p.displayMsg&&hi5.notifications.notify({msg:b});0<svGlobal.log&&console.error&&console.error(b)}function df(){this.style=this.yOrigin=this.xOrigin=0;this.pattern=Array(8)}function ef(){this.bottom=this.top=this.right=this.left=0}function ff(){this.action=this.offset=this.bottom=this.top=this.right=this.left=0}function gf(){this.opcode=this.cy=this.cx=this.y=this.x=0}function hf(a,b){this.size=a;this.data=b}function jf(a,b,c,d,e,k,l){this.font=a;this.character=b;this.offset=c;this.baseLine=
d;this.width=e;this.height=k;this.fontData=l}function kf(){this.opcode=this.backgroundColor=this.endY=this.endX=this.startY=this.startX=this.mixmode=0;this.pen=new lf}function mf(){this.cacheIDX=this.cacheID=this.colorTable=this.srcY=this.srcX=this.opcode=this.cy=this.cx=this.y=this.x=0}function nf(){this.foregroundColor=this.backgroundColor=this.opcode=this.cy=this.cx=this.y=this.x=0;this.brush=new df}function lf(){this.color=this.width=this.style=0}function of(){this.dataSize=this.opcode=this.lines=
this.foregroundColor=this.flags=this.y=this.x=0;this.data=Array(256)}function pf(){this.color=this.cy=this.cx=this.y=this.x=0}function qf(){this.srcY=this.srcX=this.opcode=this.cy=this.cx=this.y=this.x=0}function rf(){this.length=this.opcode=this.boxBottom=this.boxRight=this.boxTop=this.boxLeft=this.clipBottom=this.clipRight=this.clipTop=this.clipLeft=this.font=this.unknown=this.y=this.x=this.backgroundColor=this.foregroundColor=this.mixmode=this.flags=0;this.text=null;this.textPos=0}function Bc(){this.orderType=
0;this.bounds=new ef;this.destBlt=new gf;this.patBlt=new nf;this.screenBlt=new qf;this.line=new kf;this.rectangle=new pf;this.deskSave=new ff;this.memBlt=new mf;this.polyLine=new of;this.text2=new rf;this._line=new hi5.graphic.Line}function oe(){nb=ea=!1;Xa=null;pe();Sa=new Bc;Fb=0;Cc=Array(256);jc=new me;for(var a=0;12>a;a++)id[a]=Array(256);Wc=Array(20);ob.reset()}function sf(a){if(!Dc)return"";a=p.modifyURL(cb()+"/CLIP?s="+Dc+"&t="+(new Date).getTime());var b=new XMLHttpRequest;b.open("GET",a,
!1);b.setRequestHeader("Content-Type","text/plain;charset=UTF-8");b.send(null);return b.responseText}function tf(){function a(a){if(!(a.winWidth&&a.winHeight&&a.showState&&45<a.winHeight&&45<a.winWidth))return!1;var b=1>a.ownerWinid;if(!b)return b;if(0==a.showState)return!1;var c=a.style;if(0!=(c&4194304))return!0;a=0!=(a.extStyle&128);(b=b&&!a)&&0!=(c&2147483648)&&0==(c&2156396544)&&(b=!1);return b}function b(a){for(;0<a.ownerWinid;){var b=k.getWinById(a.ownerWinid);if(b&&b.isVisible())a=b;else break}return a}
function c(a){for(var b="";a;)a.titleInfo&&(b=a.titleInfo),a=k.getWinById(a.ownerWinid);return b}var d=[],e=0,k=this;this.mainWin=null;this.addWin=function(b){for(var c=d.length,g=!1,m=0;m<c;m++)if(b.id==d[m].id){d[m]=b;g=!0;break}g||d.push(b);1==d.length&&(e=(new Date).getTime());0<p.windowState&&(a(b)&&!k.mainWin?(k.mainWin=b,0<p.windowState&&(b.fillBrowser(),b.activate(1),svGlobal.logger.info("MainWin:"+b.id),k.getOtherApps(v.zOrders,function(a){if(0<a.length&&p.onexistingapp)p.onexistingapp(a)},
5E3))):0<p.windowState&&b.checkBound())};this.popWins=function(a){a=k.getWinById(a);var b=[];if(a){a=0<a.ownerWinid?a.ownerWinid:a.id;for(var c=d.length-1;0<=c;c--)if(d[c].ownerWinid==a||d[c].id==a)b.push(d[c]),d.splice(c,1)}return b};this.hasApp=function(a){for(var b=0,c=d.length;b<c;b++)if(d[b].appId==a)return!0;return!1};this.isNew=function(){return 3E4>(new Date).getTime()-e};this.getAll=function(){return d};this.hasWin=function(a){return 0<=d.indexOf(a)};this.close=function(){for(var a=0,b=d.length;a<
b;a++)d[a].close()};this.clear=function(){d.length=0};this.delWin=function(a){for(var b=0,c=d.length;b<c;b++)if(d[b].id==a)return d.splice(b,1),b;return-1};this.isRunning=function(){var a,b=d.length;if(1>b)return!1;for(var c=0,b=d.length;c<b;c++)if(a=d[c],a.isVisible())return!0;return!1};this.getWinById=function(a){var b,c=d.length;if(1>c)return null;for(var k=0;k<c;k++)if(b=d[k],b.id==a)return b;return null};this.getTopWin=function(a){var b=null,c,e=a.length;for(c=0;c<e&&(!(b=k.getWinById(a[c]))||
!b.isVisible());c++)b=null;if(!b)for(svGlobal.logger.warn("No win found"),e=d.length,c=e-1;0<=c&&(b=d[c],!b.isVisible());c--)b=null;return b};this.getMain=function(a){return(a=k.getTopWin(a))?b(a):null};this.getOtherApps=function(a,e,g){var m=d.length;if(0!=m&&d[m-1])if(m=d[m-1].appId,g||!m)setTimeout(function(){k.getOtherApps(a,e)},g||3E3);else{g=[];if(m=k.getTopWin(a)){for(var h=0<m.ownerWinid?m.ownerWinid:m.id,w=[],p=0,m=d.length;p<m;p++)d[p].ownerWinid!=h&&d[p].id!=h&&d[p].isVisible()&&w.push(d[p]);
p=0;for(m=w.length;p<m;p++)w[p].ownerWinid!=h&&w[p].id!=h&&(g.push({title:c(w[p]),win:b(w[p])}),h=0<w[p].ownerWinid?w[p].ownerWinid:w[p].id)}e(g)}}}function uf(a){var b={},c=0;this.enabled=!1;hi5.EventControl(this);var d=this,e=null;this.read=function(k,e,n){function g(b){b.target.readyState==FileReader.DONE&&(b=new Uint8Array(b.target.result),a.send(k,e,n,b),c+=n,d.fireEvent("progress",[c]))}var m=b[b[k]];if("undefined"!=typeof m){var h=m.name;1>m.size?p.showMessage(__svi18n.file.zero+h,null,3E3):
(m=m.slice(e,e+n),h=new FileReader,h.onloadend=g,h.readAsArrayBuffer(m))}};this.addFile=function(c,e){if(d.enabled){if(!("slice"in c||(c.slice=c.webkitSlice||c.mozSlice,"slice"in c))){p.showMessage(__svi18n.file.slice);return}var n=e||c.name;p.beforeupload&&p.beforeupload(c,e)||(d.fireEvent("beforeupload",[c,e]),n=encodeURIComponent(n),b[n]=c,a.start(n,c.size))}};this.addFiles=function(a){if(d.enabled)for(var b=0,c=a.length;b<c;b++)d.addFile(a[b])};this.removeFile=function(b){a.remove(b)};this.confirmId=
function(a,d,e){b[a]=d;e&&(c+=parseInt(e))};this.close=function(a){if(a){var e=b[a];if(e){delete b[a];delete b[e];a=decodeURIComponent(e);if(p.onfileuploaded)p.onfileuploaded(a);d.fireEvent("fileuploaded",[a])}for(var n in b)return}else b={};c=0;d.fireEvent("uploaded");if(p.onuploaded)p.onuploaded()};this.cancelAll=function(){a.cancelAll();if(p.onuploadingCancelled)p.onuploadingCancelled();d.fireEvent("uploadingCancelled");d.close()};this.list=function(b,c){e=c;a.list(b)};this.notifyFiles=function(a){e&&
e(a);d.fireEvent("files")}}function vf(){function a(a,c){var d=c.length,e=new Uint8Array(2+2*d);e[0]=58;e[1]=a;for(var k=0,l=2,n=0;n<d;n++)k=c.charCodeAt(n),e[l++]=k&255,e[l++]=k>>8&255;y.send(e.buffer)}this.start=function(a,c){var d=a.length,e=new Uint8Array(10+2*d);e[0]=58;e[1]=0;e[2]=c&255;e[3]=c>>8&255;e[4]=c>>16&255;e[5]=c>>24&255;for(var k=0,l=10,n=0;n<d;n++)k=a.charCodeAt(n),e[l++]=k&255,e[l++]=k>>8&255;y.send(e.buffer)};this.send=function(a,c,d,e){var k=new Uint8Array(22+d);k[0]=58;k[1]=3;
var l=2;k[l++]=a&255;k[l++]=a>>8&255;k[l++]=a>>16&255;k[l++]=a>>24&255;k[l++]=c&255;k[l++]=c>>8&255;k[l++]=c>>16&255;k[l++]=c>>24&255;l+=4;k[l++]=d&255;k[l++]=d>>8&255;k[l++]=d>>16&255;k[l++]=d>>24&255;k.set(e,l+4);y.send(k.buffer)};this.remove=function(b){a(6,b)};this.list=function(b){a(5,b)};this.cancelAll=function(){a(7,"")}}function qe(a){La||(La=new uf(new vf));a.setFileHandler(La)}function re(a,b,c){var d=!1;this.exe=a;this.args=b||"";this._dir=c||"";var e=this;this.close=function(){!d&&ea&&
(d=!0,y.send("8C5"+e.exe+"\t"+e.args+"\t"+p.sessionInfo.appInfo.session))}}function Ec(a){var b=this;a||(a=143);this.send=function(c){var d=!!c.buffer,e=d?c:c.getData(),k=64==a;c=d?e.length:c.getEnd()||e.length;c<e.length&&(e=d?e.subarray(0,c):e.slice(0,c));d=k?5:9;c=new Uint8Array(d+c);c[0]=a;if(k)c[1]=b.id,c[2]=b.id>>8,c[3]=b.id>>16,c[4]=b.id>>24;else for(var k=b.name,l=Math.min(k.length,8),n=0;n<l;n++)c[1+n]=k.charCodeAt(n);c.set(e,d);y.send(c.buffer);Kb.sendPing()};this.name="";this.count=this.id=
this.flags=0}function wf(){var a=window.opener;if(a)try{return a.__sparkUser}catch(b){}return null}function se(){function a(a){Ma=new RecordingManager;Ma.setHeader({name:0<a.user.length?a.server+"_"+a.user:a.server,width:W,height:da,color:Xb,namesuffix:".rdpv",filetag:"RDPV",duration:0})}if(!ea){nb=!1;if(ub)y=ub;else{var b=r+"&width="+W+"&height="+da+"&server_bpp="+Xb+"&audio="+sa.available+$e();0>r.indexOf("waWidth")&&(b+="&waWidth="+C.waWidth+"&waHeight="+C.waHeight);var c=new Date,b=b+("&tzOffset="+
c.getTimezoneOffset()+"&time="+c.getTime()),d=c="",e="";for(e in Lb){var k=Lb[e];"flags"in k&&(c&&(c+=",",d+=","),c+=k.name,d+=k.flags)}c&&(b=b+("&channelName="+c)+("&channelFlags="+d));c="";for(e in Mb)k=Mb[e],"flags"in k&&(c&&(c+=","),c+=k.name);c&&(b+="&gwChannelName="+c);if(d=wf())c=d.account,d=d.session,c&&(b+="&account="+c),d&&(b+="&session="+d);c=hi5.browser.isTouch&&(1024<=window.innerWidth||768<=window.innerHeight);C.audioRecord=Ib(C.audioRecord)&&hi5.audio.recordable;ta.init(c,!!C.remotefx,
C.audioRecord);C.audioRecord&&(b+="&audioRecord=on");0<ta.count&&(b+="&dvcChannels="+ta.names.join(","));hi5.browser.binaryWS()&&(b+="&binary=on");O.existingFile&&(b+="&existingFile="+O.existingFile);b+="&isTouch="+c+"&gatewayAddr="+encodeURIComponent(cb());r=b=p.modifyURL(b);b=0==p.mode&&O.wsPost?r.substring(0,r.indexOf("?"))+"?_METHOD=post":r;y=p.oncreatewebsocket?p.oncreatewebsocket(b):new hi5.WebSocket(b);"binaryType"in y&&(y.binaryType="arraybuffer")}te.ws=y;svGlobal.logger.info(r);y.onopen=
function(a){ea=!0;if(p.onopen)p.onopen();y.send("87"+navigator.userAgent);O.joinCloseMode&&p.setJoinCloseMode(O.joinCloseMode)};void 0!=C.recording&&"on"==C.recording&&a(C);y.onmessage=xf;y.onclose=function(a){svGlobal.logger.warn("closed, code="+a.code+" reason="+a.reason);a=0==p.mode;!ea&&a&&ne("connection");a=a&&(ea||kc<p.reconnectTimes)&&0<kc&&!lc;Fa=ea=!1;if(a)kc--,p.showMessage(__svi18n.info.reconnecting+" "+(p.reconnectTimes-kc)+"/"+p.reconnectTimes,null,3E3),setTimeout(se,5);else{ta&&ta.close();
Ta&&Ta.stop();sa&&sa.close();try{null!=Ma&&(Ma.exit(),Ma=null),v&&v.close()}catch(b){}window&&window.$rdp&&(window.$rdp=null);if(p&&p.onclose&&!mc)p.onclose()}};y.onerror=yf;if(b=v[v.length-1])la?b&&(b.remoteApp=new re(C.exe,C.args,"")):Vc(C.displayName||p.server,b.getWindow());if(C.invitation){var l=null;b&&(l=b.initChat(C.expert));Yb=new p.GatewayChannel;Yb.name="C_H_A_T";Yb.process=function(a){a=a.getUnicodeString(a.getEnd()-a.getPosition(),!0);l&&l.add(a,C.novice)};l&&(l.onchat=function(a){if(ea){var b=
Array(2*a.length),b=new hi5.DataBuffer(b,0,b.length);b.setUnicodeString(a);b.markEnd();Yb.send(b)}});p.addGatewayChannel(Yb)}}}function yf(a){svGlobal.logger.warn(a)}function Nb(a){a=hi5.Base64.dec(a,0);wa.attach(a,0,a.length);return wa}function xf(a){var b,c=a.data;if("string"!=typeof c)switch(a=new Uint8Array(c),null!=Ma&&Ma.add(new RecordingObj(a,0,c.byteLength,-1)),wa.attach(a,0,c.byteLength),b=wa.getLittleEndian16(),b){case 28:ue(wa);break;case 48:ve(wa);break;case 49:we(wa);break;case 55:a=
wa;switch(a.getByte()){case 0:Oa=a.getLittleEndian16();Va=a.getLittleEndian16();bb=a.getLittleEndian32();a.skipPosition(6);Da=a.getLittleEndian16();svGlobal.logger.info("Audio Format, tag="+Oa+" channels="+Va+" bitsPerSample="+Da+" samplePerSec="+bb);sa.supportAudioData&&(kb=new xe(p.audioBuffer));break;case 1:zf(a)}break;case 60:ye(wa);break;case 62:ze(wa.getUnicodeString(wa.getEnd()-wa.getPosition(),!1));break;case 63:Ae(wa);break;case 64:c=wa;b=c.getByte();a=c.getLittleEndian32();switch(b){case 1:c=
c.getAscllString();ta[c].id=a;ta[a]=ta[c];if(ta[a].onopen)ta[a].onopen();break;case 3:ta[a].process(c);break;case 4:if(ta[a]&&ta[a].onclose)ta[a].onclose()}break;case 146:a=wa;switch(a.getByte()){case 1:Kb.processPong(a)}break;default:if(p.onunknownmessage)p.onunknownmessage(b,wa);else svGlobal.logger.warn("@TODO:"+b+"\n")}else switch(b=parseInt(c.substring(0,2),16),a=c.substring(2),b){case 0:a=r.substring(r.indexOf("?")+1);y.send("00"+a);y.send("87"+navigator.userAgent);break;case 15:Fa=!0;mc=lc=
!1;kc=p.reconnectTimes;Sa=new Bc;if(p.onready)p.onready();a="";for(a in Lb)if((c=Lb[a])&&c.onopen)c.onopen();for(a in Mb)if((c=Mb[a])&&c.onopen)c.onopen();break;case 26:c=JSON.parse(a);if(p.onnotify)p.onnotify(c);if(c.name){svGlobal.logger.info("msg="+a);if(c.type&&p.onerror)p.onerror(c);a=__svi18n.errorCode["S"+c.name]||"";a+=c.message;p.showMessage(a,null);lc=!0}else 0<svGlobal.log&&console.erro("No error code for message:"+a);break;case 27:v.drawLicense(a);break;case 28:ue(Nb(a));break;case 48:ve(Nb(a));
break;case 49:we(Nb(a));break;case 50:c=parseInt(a.substring(0,1),10);a=a.substring(1);switch(c){case 1:Af(a);break;case 2:!(c=v.getFocused())||c.processClipReq(a)||!O.clipWarnAlways&&Be||!C||C.leagacyMode||(p.showMessage(__svi18n.info.menucopy,null,5E3),Be=!0)}break;case 51:v.setReadOnly("1"==a);break;case 54:c=a.split("\t");a=cb()+c[0];a=p.modifyURL(a);svGlobal.logger.info("Downloading file:"+a+" name:"+c[1]+" driver:"+c[2]);p.onprintingready&&p.onprintingready({link:a,printerName:c[1],pinterDriver:c[2]})||
(c=v.getFocused())&&c.showPDF(a);break;case 55:c=parseInt(a.substring(0,1),16);a=a.substring(1);switch(c){case 0:a=a.split("\t");Oa=parseInt(a[0],10);Va=parseInt(a[1],10);Da=parseInt(a[2],10);bb=parseInt(a[3],10);svGlobal.logger.debug("Audio Format, tag="+Oa+" channels="+Va+" bitsPerSample="+Da+" samplePerSec="+bb);sa.supportAudioData&&(kb||(kb=new xe(p.audioBuffer)));break;case 1:Bf(a)}break;case 56:a=JSON.parse(a);Dc=a.session;a.server||(a.server=p.server);if(c=hi5.$("joinSelect"))c.value=a.joinMode;
if(c=hi5.$("requestControl"))c.disabled=a.hasControl;a.joined?v.execute("setAutoScale",[!0]):Ib(C.connectif)&&(p.mode=0,p.reconnectOnResize=gb,v.setSize(W,da));var c=O.page&&O.page.join||"join.html",d=cb(),c=d+"/"+c+"?id="+(a.joined||a.numericId);(b=a.webAddress)&&0<b.length&&b.toLowerCase()!=d.toLowerCase()&&(d=b.indexOf("://"),p.protocol="http"==b.substring(0,d)?"ws":"wss",p.gateway=b,c+="&gateway="+encodeURIComponent(b));c=p.modifyURL(c);a.joinLink=c;p.sessionInfo.appInfo=a;"isApp"in a&&la!==a.isApp&&
(la=a.isApp,ie(),v.setSize(W,da,la?"hidden":null),F=ic(W,da),nb||v.execute("setAutoScale",[!0]));a.ver&&a.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);if(p.onsessionstart)p.onsessionstart(p.sessionInfo);break;case 57:c=a.split("\t");svGlobal.logger.debug(a);if(a=v.getWinById(parseInt(c[0]))){if(!v.hasApp(c[1])&&p.onremoteappstart)p.onremoteappstart({id:c[1]});a.appId=c[1]}break;case 58:c=a;if(La)if(a=parseInt(c.charAt(0),10),c=c.substring(1),5==a)La.notifyFiles(JSON.parse(c));
else switch(c=c.split("\t"),a){case 1:La.confirmId(c[0],c[1],c[2]);break;case 2:La.read(c[0],parseInt(c[1],10),parseInt(c[2],10));break;case 4:La.close(c[0])}break;case 59:a=hi5.Base64.dec(a,0);a=(new RdpBuffer(a,0,a.length)).getLittleEndian32();!db&&a&16?a&128&&(La=null):(Xc=!1,La=null);a&64&&p.showMessage(__svi18n.info.recording);v.execute("setFeature",[a]);break;case 60:ye(Nb(a));break;case 61:a=JSON.parse(a);switch(a.type){case 0:zc(a.width,a.height);F=ic(W,da);yc(a.color);if(c=a.server)p.server=
a.server;Ce=a.length;b=v.getFocused();la=1==a.isRail;b&&(b.setSize(W,da,la?"hidden":null),b.setAutoScale(!la),c&&Vc(C.displayName||p.server,b.getWindow()),c=a.keyboard,"undefined"!=typeof c&&0==c&&b.setUnicode(!0),c=a.mapDisk)&&(Xc=!0,qe(b));if(p.onopened)p.onopened(a);break;case 1:a=a.duration;if(p.onprogress)p.onprogress(a,Ce);break;case 2:if(2==a.status)oe(),ea=!0;else if(c=0==a.status,c!=F.isPaused()){if(p.onsessionpause&&p.onsessionpause(c,a))break;F.pause(c);c||F.repaint(0,0,F.width,F.height);
a.warn&&p.showMessage(c?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)}}break;case 62:ze(a);break;case 63:Ae(Nb(a));break;default:if(p.onunknownmessage)p.onunknownmessage(b,a);else svGlobal.logger.warn("@TODO:"+c+"\n")}Kb.sendPing()}function ue(a){var b=a.getAscllString(8),c=Mb[b];null!=c?c.process(a):svGlobal.logger.warn("Channel "+b+" not found")}function Cf(a,b){var c=0,d=!1;this.width=a;this.interval=b;var e=this,k=0;this.start=function(){d||(d=!0,c=setInterval(function(){var a=v.getFocused();
a&&ea&&(a=a.getThumbnail(e.width))&&a.length!=k&&(y.send("8E7"+a),k=a.length)},e.interval))};this.stop=function(){clearInterval(c)}}function Df(a,b){!Ta||Ta.width==a&&Ta.interval==b||(Ta.stop(),Ta=null);Ta||(Ta=new Cf(a,b));Ta.start()}function Ae(a){var b=a.getAscllString(8);(b=Lb[b])&&b.process&&b.process(a)}function ze(a){var b=parseInt(a.substring(0,1),16),c,d=a.substring(1);a=!1;var e=p.sessionInfo.appInfo;switch(b){case 0:c=JSON.parse(d);oe();ea=!0;a=c.width;b=c.height;if(a==W&&b==da)break;zc(a,
b);v.setSize(a,b,la?"hidden":null);F=ic(a,b);break;case 1:gb=p.reconnectOnResize;p.reconnectOnResize=!1;c=JSON.parse(d);p.sessionInfo.joinedSessions.push(c.numericId);p.onsessionjoin&&(a=p.onsessionjoin(c));if(a)break;p.showMessage(__svi18n.info.joinsession.applyArgs([c.numericId,c.__ip,c.name]));break;case 2:c=JSON.parse(d);p.sessionInfo.joinedSessions.removeElm(c.numericId);0==p.sessionInfo.joinedSessions.length&&(p.reconnectOnResize=gb);p.onsessionexit&&(a=p.onsessionexit(c));if(a)break;p.showMessage(__svi18n.info.exitsession.applyArgs([c.numericId,
c.__ip,c.name]));break;case 3:c=JSON.parse(d);e.joinMode!=c.mode&&(e.joinMode=c.mode,b=hi5.$("joinSelect"))&&(b.value=c.mode);if(e.hasControl)break;v.setReadOnly(!1);if(b=hi5.$("requestControl"))b.disabled=!0;p.ongivecontrol&&(a=p.ongivecontrol());if(a)break;p.showMessage(__svi18n.info.givecontrol,null,5E3);break;case 4:v.setReadOnly(!0);e.hasControl=!1;if(b=hi5.$("requestControl"))b.disabled=!1;p.ontakebackcontrol&&(a=p.ontakebackcontrol());if(a)break;p.showMessage(__svi18n.info.nocontrol,null,5E3);
break;case 5:c=JSON.parse(d);p.onrequirecontrol&&(a=p.onrequirecontrol(c));if(a)break;a=__svi18n.info.title.applyArgs([c.name,c.numericId,c.__ip]);b=__svi18n.info.recontrol;F.isPaused&&(b+="<br><br>"+(__svi18n.info.autoresume||""));hi5.notifications.notify({title:a,msg:b,cbYes:function(){p.giveControl(c.numericId);this.destroy();F.isPaused()&&p.pauseSession(p.sessionInfo.appInfo.numericId,!1)},cbNo:function(){p.refuseControl(c.numericId);this.destroy()}});break;case 6:v.execute("setTouchRemoting",
[!0]);break;case 7:c=JSON.parse(d);c.width&&c.height&&(p.reconnectOnResize=!1,F=ic(c.width,c.height),zc(c.width,c.height),v.setSize(c.width,c.height));c.color&&(yc(c.color),svGlobal.logger.warn("Color depth changed to:"+c.color));break;case 8:c=JSON.parse(d);mc=!0;if(p.onrequestcredential&&p.onrequestcredential(c))break;v.getFocused().requestCredential(c);break;case 9:c=JSON.parse(d);0<c.interval&&0<c.width?Df(c.width,c.interval):Ta&&Ta.stop();break;case 11:c=JSON.parse(d);p.onrequirejoin&&(a=p.onrequirejoin(c));
if(a)break;a=__svi18n.info.title.applyArgs([c.name,c.numericId,c.__ip]);hi5.notifications.notify({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){p.allowJoin(c.numericId,!0);this.destroy()},cbNo:function(){p.allowJoin(c.numericId,!1);this.destroy()}})}}function ye(a){switch(a.getByte()){case 32:if(!F.isPaused()){a.getLittleEndian16();var b=a.getLittleEndian16();a=a.getLittleEndian16();v.getFocused().moveCursor(b,a,!0)}}}function Bf(a){function b(a){var b=0;a*=l;for(g=0;g<l;g++)b|=(k[a+g]&255)<<
8*g;b>m?(b-=w,b/=-h):b/=m;return b}function c(a){return function(){y.send("8A"+a)}}if(sa.available&&!F.isPaused()){var d=a.indexOf("\t"),e=a.substring(0,d),k=hi5.Base64.dec(a,d+1);1!=Oa&&(Ob||(Ob=new fe),k=Ob.decode(k,0,k.length));a=Da;var l=a>>3,n=Math.floor(k.length/l),g=0,m=Math.pow(2,a-1)-1,h=-m-1,w=Math.pow(2,a);a=0;if(sa.supportAudioData){d=Array(n);d[0]=.1;for(a=0;a<n;a++)d[a]=b(a);a=kb.add(d);setTimeout(c(e),a-1E3*sa.delay)}else{var d=Va,n=Math.floor(n/d),p=sa.getBuffer(n),A=p.getChannelData(0),
t=p.getChannelData(1);for(a=0;a<n;){var z=2*a,u=b(z);1==d?(A[a]=u,t[a]=u):(A[a]=u,t[a]=b(z+1));a++}a=sa.playBuffer(p);setTimeout(c(e),1E3*(a-sa.delay))}}}function zf(a){function b(a){return function(){y.send("8A"+a)}}if(sa.available&&!F.isPaused()){var c=a.getByte()+","+a.getLittleEndian16()+","+a.getLittleEndian64(),d=a.getPosition(),e=a.getData(),k=a.getEnd()-d;if(41222==Oa)(a=hi5.audio.getAudioContext())&&a.decodeAudioData(e.buffer.slice(d),function(a){a=sa.playBuffer(a);db||setTimeout(b(c),1E3*
(a-sa.delay))},function(a){console.log(a)});else{if(a=1!=Oa)Ob||(Ob=new fe),e=Ob.decode(e,d,k),d=0,k=e.length;var l=Da,n=Math.floor(k/(l>>3)),g=k=0,m=0;a||(k=Math.pow(2,l-1)-1,g=-k-1,m=Math.pow(2,l));var h=l=0;if(sa.supportAudioData){var w=Array(n);w[0]=.1;if(a)for(l=0;l<n;l++)w[l]=e[d++];else for(l=0;l<n;l++)h=e[d++]|e[d++]<<8,h>k?(h-=m,h/=-g):h/=k,w[l]=h;e=kb.add(w);setTimeout(b(c),e-1E3*sa.delay)}else{var w=Va,n=Math.floor(n/w),p=sa.getBuffer(n),A=p.getChannelData(0),t=p.getChannelData(1),l=0;
if(a)for(;l<n;)1==w?t[l]=A[l]=e[d++]:(A[l]=e[d++],t[l]=e[d++]),l++;else for(;l<n;)h=e[d++]|e[d++]<<8,h>k?(h-=m,h/=-g):h/=k,1==w?A[l]=h:(A[l]=h,h=e[d++]|e[d++]<<8,h>k?(h-=m,h/=-g):h/=k),t[l]=h,l++;e=sa.playBuffer(p);db||setTimeout(b(c),1E3*(e-sa.delay))}}}}function xe(a){var b=[],c,d,e,k=new Ef(Va,bb,function(b){var c=b.length,e=c>l.size();if(d||e)l.stop(),setTimeout(function(){l.start()},1E3*a);else for(e=0;e<c;e++)b[e]=l.pull()}),l=this;this.delay=a;this.reset=function(){c=b.length=0;d=!0;k.stop();
e=0};this.reset();this.start=function(){d&&(k.start(),d=!1)};this.stop=function(){k.stop();d=!0};this.size=function(){for(var a=b.length,c=0,d=0;d<a;d++)c+=b[d].length;return c};this.add=function(c){var d=(new Date).getTime();e<d&&(e=d);e+=c.length/(bb*Va)*1E3;var l=b.length;b[l]=c;0==l&&(d=(new Date).getTime(),setTimeout(function(){k.start()},1E3*a));return e-d};this.pull=function(){if(0==b.length)return null;var a=b[0];if(c<a.length)return a[c++];b.shift();c=0;return this.pull()}}function Ef(a,
b,c){function d(){var a;if(n){a=e.mozWriteAudio(n.subarray(g));k+=a;g+=a;if(g<n.length)return;n=null}a=e.mozCurrentSampleOffset()+l-k;if(0<a){var b=new Float32Array(a);c(b);a=e.mozWriteAudio(b);a<b.length&&(n=b,g=a);k+=a}}var e=new Audio;e.mozSetup(a,b);var k=0,l=a*Math.floor(b/2),n=null,g=0,m=null;this.start=function(){m=setInterval(d,100)};this.stop=function(){m&&clearInterval(m)}}function Ff(a){if(!p.openLink||2E3<a.length)return!1;var b=a.indexOf(";");0<b&&(a=a.substring(b+1));b=a;a=a.toLowerCase();
var c=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");c||(0==a.indexOf("www.")?(c=!0,a="http://"+a):0==a.indexOf("ftp.")&&(c=!0,a="ftp://"+a));if(c){if(0<a.indexOf("\r")||0<a.indexOf("\n"))return!1;if(p.onurlredirection&&p.onurlredirection(c))return!0;a=v.getFocused();if(!a)return!1;a.processLink(b);return!0}return!1}function Af(a){p.onservercopy&&p.onservercopy(a)||(Ff(a)||v.copyToClip(a),setTimeout(function(){y.send("883")},
999))}function ve(a){a.getLittleEndian16();var b=a.getByte(),c=a.getByte(),d=a.getLittleEndian16(),e=null;0!=(c&32)?(d-=18,ob.dec(a.getData(),a.getPosition(),d,c),e=ob.getData()):e=a;switch(b){case 2:a=e;b=a.getLittleEndian16();switch(b){case 0:a.skipPosition(2);b=a.getLittleEndian16();a.skipPosition(2);De(a,b);break;case 1:Ee(a);break;case 2:Fe(a);break;case 3:break;default:svGlobal.logger.warn("Unimplemented Update type "+b)}break;case 20:break;case 31:break;case 27:a=e;c=b=b=0;b=a.getLittleEndian16();
a.skipPosition(2);switch(b){case 3:b=a.getLittleEndian16();c=a.getLittleEndian16();if(F.isPaused())break;v.getFocused().moveCursor(b,c,!0);break;case 6:Fc(a,24);break;case 7:Yc(a.getLittleEndian16());break;case 1:a=a.getLittleEndian16();switch(a){case 0:v.setCursor("default");break;default:svGlobal.logger.warn("XXX system pointer message "+a)}break;case 8:b=a.getLittleEndian16(),Fc(a,b)}break;case 34:break;case 38:Gf(e);break;case 40:le(!1,!1,!1);break;case 47:lc=!0;a=e.getLittleEndian32();db||y.send("85"+
a);svGlobal.logger.info("Disconnect:"+a);(b=11==a&&la)&&v.close();1>a||b||ne(a.toString(16).toUpperCase());break;case 50:e.skipPosition(4);break;case 54:a=e.getLittleEndian32().toString(16).toUpperCase();a=__svi18n.serverStatus[a];p.displayMsg&&svGlobal.logger.info(a);break;case 55:break;default:svGlobal.logger.warn("Unimplemented Data PDU type "+b)}}function Hf(a,b){var c,d,e=p.sessionInfo;switch(b){case 0:a.skipPosition(4);e.domain=a.getUnicodeString(52,!0);a.skipPosition(4);e.userName=a.getUnicodeString(512,
!0);e.sessionId=a.getLittleEndian32();break;case 1:e.version=a.getLittleEndian16(),a.skipPosition(4),e.sessionId=a.getLittleEndian32(),c=a.getLittleEndian32(),d=a.getLittleEndian32(),a.skipPosition(558),e.domain=a.getUnicodeString(c,!0),e.userName=a.getUnicodeString(d,!0)}return e}function Ge(){if(!nb&&p.onloggedin)p.onloggedin();nb=!0;la&&v.execute("setAutoScale",[!1]);La&&(La.enabled=!0);Zc&&!la&&(F.setContext(v.getFocused().context),F.repaint(0,0,F.width,F.height))}function Gf(a){var b=a.getLittleEndian32();
if(3>b)Hf(a,b),Ge();else if(3==b&&(a.skipPosition(2),b=a.getLittleEndian32(),a.skipPosition(4),2!=b)){a.getLittleEndian32();a.skipPosition(4);var c={};c.logId=a.getLittleEndian32();c.time=(new Date).getTime();p.sessionInfo.sessionId=c.logId;Ge();a=a.getBytes(16);for(var b=Array(16),d=0;16>d;d++)b[d]=a[d]&255;c.random=b;a="8D"+c.logId+"\t"+hi5.Base64.enc(b);p.sessionInfo.userName&&(a+="\t"+p.sessionInfo.userName,p.sessionInfo.domain&&(a+="\t"+p.sessionInfo.domain));db||y.send(a);"sessionStorage"in
window&&setTimeout(function(){sessionStorage[he()]=JSON.stringify(c)},300)}}function we(a){var b=a.getByte(),c=b&15,d=b>>4&3,e,k=0;2==(b>>6&3)&&(k=a.getByte());e=a.getLittleEndian16();b=null;0!=(k&32)?(ob.dec(a.getData(),a.getPosition(),e,k),b=ob.getData(),e=ob.getDecompressedLength()):b=a;if(0!=d)switch(d){case 2:case 3:$c.addFragement(b,e);return;case 1:$c.addFragement(b,e),b=$c.clearFragements()}switch(c){case 0:a=b.getLittleEndian16();De(b,a);break;case 1:b.skipPosition(2);Ee(b);break;case 2:b.skipPosition(2);
Fe(b);break;case 3:break;case 4:a=b;for(c=a.getEnd();a.getPosition()<c;)switch(d=a.getLittleEndian16(),d){case 1:case 6:k=a.getLittleEndian16();b=a.getLittleEndian16();a.getLittleEndian16();a.getBigEndian16();var d=a,l=d.getByte();d.skipPosition(2);var n=d.getByte(),g=d.getLittleEndian16(),m=d.getLittleEndian16(),h=d.getLittleEndian32(),w=void 0;e=d.getPosition()+h;switch(n){case 0:l=Md(d.getData(),h,d.getPosition());w=Ja(l.length);Dd(l,0,w,g,m,1);F.setRGBs(k,b,g,m,w,0,g);F.postPaint(k,b,g,m);break;
case 1:He(d,l,g,m,Gc);l=Gc.getData();w=Gc.getDataSize();w=Ja(w);Dd(l,0,w,g,m,1);F.setRGBs(k,b,g,m,w,0,g);F.postPaint(k,b,g,m);break;case 3:for(var l=If.decode(d,h),g=l.getRects(),m=l.getTiles(),w=l.getTileSize(),n=(l=l.getRectSize())?new Wb(0,0,0,0):null,p=h=0;p<w;p++){var A=m[p];if(l)for(var t=0;t<l;t++)g[t].intersection(A.x,A.y,64,64,n),n.isEmpty()||(h=64*(n.y-A.y)+(n.x-A.x),n.x+=k,n.y+=b,F.setRGBs(n.x,n.y,n.width,n.height,A.data,h,64),F.postPaint(n.x,n.y,n.width,n.height));else F.setRGBs(A.x,A.y,
64,64,A.data,0,64),F.postPaint(A.x,A.y,64,64)}}d.setPosition(e);break;case 4:k=a;d=k.getLittleEndian16();k=k.getLittleEndian32();1==d&&y.send("91"+k);break;default:svGlobal.logger.warn("Invalid surface cmd:"+d)}F.commitPaint();break;case 5:v.setCursor("default");break;case 6:break;case 8:break;case 9:Fc(b,24);break;case 10:Yc(b.getLittleEndian16());break;case 11:a=b;c=a.getLittleEndian16();Fc(a,c);break;default:svGlobal.logger.warn("XXX RDP5 opcode "+c)}}function Dd(a,b,c,d,e,k){k*=d;for(var l=0;l<
e;l++)d=b+(e-l-1)*k,tb(a,d,c,l*k,k)}function Ie(a,b,c){var d=a,e=c,k=0,l=8,n=b;this.attach=function(a,b,c){d=a;e=c;k=0;l=8;n=b};this.getBits=function(a){for(var b=0,c=0;k<e&&0<a;)b=a,b>l&&(b=l),0!=c&&(c<<=b),c|=d[k+n]>>l-b&(1<<b)-1,l-=b,a-=b,0==l&&(l=8,k++);return c};this.putBits=function(a,b){for(var c=b,w=0;k<e&&0<c;)w=c,w>l&&(w=l),d[k+n]|=(a>>c-w&(1<<w)-1)<<l-w,l-=w,c-=w,0==l&&(l=8,k++)};this.eos=function(){return k>e};this.left=function(){return k>=e?0:8*(e-k-1)+l};this.getProcessBytes=function(){return 8>
l?k+1:k}}function Je(){this.y=this.x=this.CrLen=this.CbLen=this.YLen=this.quantIdxCr=this.quantIdxCb=this.quantIdxY=0;this.data=Ja(4096);this.data[0]=0;var a=this;this.readHeaderfromStream=function(b){b.skipPosition(6);a.quantIdxY=b.getByte();a.quantIdxCb=b.getByte();a.quantIdxCr=b.getByte();a.x=64*b.getLittleEndian16();a.y=64*b.getLittleEndian16();a.YLen=b.getLittleEndian16();a.CbLen=b.getLittleEndian16();a.CrLen=b.getLittleEndian16()}}function Jf(){function a(a,e,k,l,n,g,m){k=a.et;var h=4096,w=
a.bitStream,p=1,A=p<<3,t=1,z=t<<3,u=0,x=0,P=0,u=0;for(null==w?w=new Ie(l,n,g):w.attach(l,n,g);!w.eos()&&0<h;)if(0!=p){for(;!w.eos();){u=w.getBits(1);if(0!=u)break;l=p=1<<p;l>h&&(l=h);0<l&&(Ea(m,x,x+l,0),x+=l);h-=p;A+=4;80<A&&(A=80);0>A&&(A=0);p=A>>3}l=p=w.getBits(p);l>h&&(l=h);0<l&&(Ea(m,x,x+l,0),x+=l);h-=p;p=w.getBits(1);P=0;do if(u=w.getBits(1),1==u)P++;else break;while(1);u=w.getBits(t);u|=P<<t;0==P?(z+=-2,80<z&&(z=80),0>z&&(z=0),t=z>>3):1!=P&&(z+=P,80<z&&(z=80),0>z&&(z=0),t=z>>3);l=u+1;0<h&&(m[x++]=
0!=p?-l:l);h--;A+=-6;80<A&&(A=80);0>A&&(A=0);p=A>>3}else{P=0;do if(u=w.getBits(1),1==u)P++;else break;while(1);u=w.getBits(t);u|=P<<t;0==P?(z+=-2,80<z&&(z=80),0>z&&(z=0),t=z>>3):1!=P&&(z+=P,80<z&&(z=80),0>z&&(z=0),t=z>>3);l=u;if(1!=k){g=l;for(n=0;0!=g;)g>>=1,n++;n=w.getBits(n);l-=n;0!=n&&0!=l?(A+=-6,80<A&&(A=80),0>A&&(A=0),p=A>>3):0==n&&0==l&&(A+=6,80<A&&(A=80),0>A&&(A=0),p=A>>3);0<h&&(m[x++]=0!=(n&1)?-1*(n+1>>1):n>>1);h--;0<h&&(m[x++]=0!=(l&1)?-1*(l+1>>1):l>>1);h--}else 0==l?(0<h&&(m[x++]=0),h--,
A+=3):(0<h&&(m[x++]=0!=(l&1)?-1*(l+1>>1):l>>1),h--,A+=-3),80<A&&(A=80),0>A&&(A=0),p=A>>3}k=64;h=4032;for(w=4033;1<k;h++,w++,k--)m[w]+=m[h];c(m,0,4096,5);c(m,0,1024,e[8]-6);c(m,1024,1024,e[7]-6);c(m,2048,1024,e[9]-6);c(m,3072,256,e[5]-6);c(m,3328,256,e[4]-6);c(m,3584,256,e[6]-6);c(m,3840,64,e[2]-6);c(m,3904,64,e[1]-6);c(m,3968,64,e[3]-6);c(m,4032,64,e[0]-6);a=a.dwtBuffer;b(m,3840,a,8);b(m,3072,a,16);b(m,0,a,32)}function b(a,b,c,l){for(var n=0,g=0,m=0,h=m=g=n=0,p=0,r=0,A=0,t=0,z=0,u=0,A=l<<1,r=b+l*
l*3,m=b,n=0,h=b+l*l,p=b+l*l*2,g=l*l*2,z=0;z<l;z++){c[n]=a[r]-(a[m]+a[m]+1>>1)<<16>>16;c[g]=a[h]-(a[p]+a[p]+1>>1)<<16>>16;for(u=1;u<l;u++)t=u<<1,c[n+t]=a[r+u]-(a[m+u-1]+a[m+u]+1>>1)<<16>>16,c[g+t]=a[h+u]-(a[p+u-1]+a[p+u]+1>>1)<<16>>16;for(u=0;u<l-1;u++)t=u<<1,c[n+t+1]=(a[m+u]<<1)+(c[n+t]+c[n+t+2]>>1)<<16>>16,c[g+t+1]=(a[p+u]<<1)+(c[g+t]+c[g+t+2]>>1)<<16>>16;t=u<<1;c[n+t+1]=(a[m+u]<<1)+c[n+t]<<16>>16;c[g+t+1]=(a[p+u]<<1)+c[g+t]<<16>>16;r+=l;m+=l;n+=A;h+=l;p+=l;g+=A}for(t=0;t<A;t++){for(u=0;u<l;u++)z=
u<<1,n=b+z*A+t,g=u*A+t,m=g+l*A,a[n]=c[g]-((0<u?c[m-A]:c[m])+c[m]+1>>1)<<16>>16;for(u=0;u<l;u++)z=u<<1,n=b+z*A+t,g=u*A+t,m=g+l*A,a[n+A]=(c[m]<<1)+(a[n]+a[n+(u<l-1?2*A:0)]>>1)<<16>>16}}function c(a,b,c,l){if(0!=l)for(;0<c;b++,c--)a[b]<<=l}this.decodeRgb=function(b,c,k,l,n,g,m,h,p,r){a(b,k,n,c.getData(),c.getPosition(),l,b.yrBuffer);c.skipPosition(l);a(b,k,m,c.getData(),c.getPosition(),g,b.cbgBuffer);c.skipPosition(g);a(b,k,p,c.getData(),c.getPosition(),h,b.crbBuffer);c.skipPosition(h);c=b.yrBuffer;
k=b.cbgBuffer;l=b.crbBuffer;for(g=g=m=p=n=p=h=m=0;4096>g;g++)m=c[g],h=k[g],p=l[g],m=m+4096<<16,n=m+91947*p,p=m-22544*h-46792*p,m+=115998*h,n>>=21,p>>=21,m>>=21,c[g]=0>n?0:255<n?255:n,k[g]=0>p?0:255<p?255:p,l[g]=0>m?0:255<m?255:m;c=b.yrBuffer;k=b.cbgBuffer;b=b.crbBuffer;for(l=0;4096>l;l++)r[l]=4278190080|b[l]<<16|k[l]<<8|c[l]}}function Kf(){var a=[new Wb],b=[new Je],c=0,d=0;this.resetRects=function(b){if(a.length<b){var d=a.length;for(a.length=b;d<b;d++)a[d]=new Wb}c=b;return a};this.resetTiles=function(a){if(b.length<
a){var c=b.length;for(b.length=a;c<a;c++)b[c]=new Je}d=a;return b};this.getRectSize=function(){return c};this.getTileSize=function(){return d};this.getRects=function(){return a};this.getTiles=function(){return b}}function Lf(){this.ctxId=0;this.tileSize=64;this.qt=this.et=this.xft=this.cct=this.flags=0;this.yrBuffer=oa(4096);this.yrBuffer[0]=0;this.cbgBuffer=oa(4096);this.cbgBuffer[0]=0;this.crbBuffer=oa(4096);this.crbBuffer[0]=0;this.dwtBuffer=oa(4096);this.dwtBuffer[0]=0;var a=this;this.setProperties=
function(b){a.flags=b&7;a.cct=b>>3&3;a.xft=b>>5&15;a.et=b>>9&15};this.bitStream=new Ie}function Mf(a,b,c,d,e,k,l,n){this.x=a;this.y=b;this.width=c;this.height=d;this.mask=e;this.pixel=k;this.bpp=l;this.cache_idx=n}function Fc(a,b){if(!Nf){var c=0,d=0,e=0,k=0,l=0,n=0,g=0,l=a.getLittleEndian16(),c=a.getLittleEndian16(),d=a.getLittleEndian16(),e=a.getLittleEndian16(),k=a.getLittleEndian16(),n=a.getLittleEndian16(),g=a.getLittleEndian16(),m=a.getBytes(g),n=a.getBytes(n);if(0>c||c>=e-1)c=0;0>d?d=0:d>=
k&&(d=k-1);for(var h=!0,w=0;w<g;w++)if(0!=m[w]){h=!1;break}var c=new Mf(c,d,e,k,n,m,b,l),d=c.x,e=c.y,k=c.width,g=c.height,m=c.mask,n=c.pixel,r=c.bpp,c=c.cache_idx;if(h)d={data:null,hotX:d,hotY:e,url:null,rawData:null,width:k,height:g,none:!0};else{for(var h=Array(k*g),w=h[0]=0,A=!0,t=m.length,z=0;z<t;z++)if(0!=m[z]){A=!1;break}for(var u=0,z=0;z<g;z++)for(t=0;t<k;t++){h[w]=Of(t,z,k,g,r,n);if(!A){var u=z,x=k;1!=r&&(u=g-u-1);x=8*((x+7)/8|0);u=u*x+t;u=0==(m[u/8>>0]&128>>u%8)?1:0;if(0==u&&0!=h[w])h[w]=
~h[w],h[w]|=4278190080;else if(1==u||0!=h[w])h[w]|=4278190080;32==r&&-1==h[w]&&0==u&&(h[w]=0)}w++}w="";1==r&&(w=Ke.getName(h,k));z="";if(!w){var P=k*g*4,t=n.length,u=m.length,A=62+P+t+u,r=new Uint8Array(A);r[0]=0;x=new RdpBuffer(r,0,A);x.setLittleEndian16(0);x.setLittleEndian16(2);x.setLittleEndian16(1);x.setByte(k);x.setByte(g);x.setByte(0);x.setByte(0);x.setLittleEndian16(d);x.setLittleEndian16(e);x.setLittleEndian32(40+P+t+u);x.setLittleEndian32(22);x.setLittleEndian32(40);x.setLittleEndian32(k);
x.setLittleEndian32(2*g);x.setLittleEndian16(1);x.setLittleEndian16(32);x.setLittleEndian32(0);x.setLittleEndian32(t+u);x.setLittleEndian32(0);x.setLittleEndian32(0);x.setLittleEndian32(0);x.setLittleEndian32(0);for(var K,P=g-1;0<=P;P--)for(K=0;K<k;K++){var D=h[k*P+K];x.setByte(D&255);x.setByte(D>>8&255);x.setByte(D>>16&255);x.setByte(D>>24&255)}for(P=0;P<t;P++)x.setByte(n[P]);for(P=0;P<u;P++)x.setByte(m[P]);hi5.browser.isIE?(m=hi5.Arrays.hashCode(r),n=new Uint8Array(A+6),n[0]=142,n[1]=56,n[2]=m&
255,n[3]=m>>8&255,n[4]=m>>16&255,n[5]=m>>24&255,n.set(r,6),y.send(n.buffer),z=p.modifyURL(cb()+"/CURSOR?"+m)):w="data:image/x-icon;base64,"+hi5.Base64.enc(x.getData())}d={data:w,hotX:d,hotY:e,url:z,rawData:h,width:k,height:g,none:!1}}20>c&&(Wc[c]=d);Yc(l)}}function Of(a,b,c,d,e,k){1!=e&&(b=d-b-1);b=(b*c+a)*e;c=b/8>>0;a=k[c]&255;switch(e){case 1:return 0==(a&128>>b%8)?0:4294967295;case 8:return 0==a?0:4294967295;case 15:return a|=(k[c+1]&255)<<8,e=Array(4),Le(a,15,e,0),e[0]<<16|e[1]<<8|e[2];case 16:return a|=
(k[c+1]&255)<<8,e=Array(4),Le(a,16,e,0),e[0]<<16|e[1]<<8|e[2];case 24:return(k[c+2]&255)<<16|(k[c+1]&255)<<8|a;case 32:return(k[c+3]&255)<<24|(k[c+2]&255)<<16|(k[c+1]&255)<<8|a}svGlobal.logger.warn("invalid bpp value for Xor Mask.");return 0}function Yc(a){if(!F.isPaused()){a:{if(20>a&&(a=Wc[a]))break a;a=null}a&&v.setCursor(a)}}function Fe(a){var b=0,c=null,d=null,e=null,k=0;a.skipPosition(2);b=a.getLittleEndian16();a.skipPosition(2);c=Array(b);d=Array(b);e=Array(b);a=a.getBytes(3*b);for(var l=0;l<
b;l++)c[l]=a[k],d[l]=a[k+1],e[l]=a[k+2],k+=3;256==b&&(Xa||(Xa=Array(3)),Xa[0]=c,Xa[1]=d,Xa[2]=e)}function De(a,b){for(var c=0,d=0,e=0;c<b;){d=a.getByte();e=d&3;switch(e){case 1:var k=a,l=d,n=0,g=0,m=!1;0!=(l&8)&&(Sa.orderType=k.getByte());var g=Pf[Sa.orderType],h=k,p=g,r=0,A=0;0!=(l&64)&&p--;0!=(l&128)&&(p=2>p?0:p-2);for(var t=0;t<p;t++)A=h.getByte(),r|=A<<8*t;n=r;if(0!=(l&4)){if(0==(l&32)){var z=k,u=Sa.bounds,x=z.getByte();0!=(x&1)?u.left=L(z,u.left,!1):0!=(x&16)&&(u.left=L(z,u.left,!0));0!=(x&2)?
u.top=L(z,u.top,!1):0!=(x&32)&&(u.top=L(z,u.top,!0));0!=(x&4)?u.right=L(z,u.right,!1):0!=(x&64)&&(u.right=L(z,u.right,!0));0!=(x&8)?u.bottom=L(z,u.bottom,!1):0!=(x&128)&&(u.bottom=L(z,u.bottom,!0))}var P=Sa.bounds;ra=P.left;0>ra&&(ra=0);qa=P.top;0>qa&&(qa=0);ia=P.right;ia>=W&&(ia=W-1);ja=P.bottom;ja>=da&&(ja=da-1)}m=0!=(l&16);switch(Sa.orderType){case 0:var K=k,D=Sa.destBlt,ba=n,f=m;0!=(ba&1)&&(D.x=L(K,D.x,f));0!=(ba&2)&&(D.y=L(K,D.y,f));0!=(ba&4)&&(D.cx=L(K,D.cx,f));0!=(ba&8)&&(D.cy=L(K,D.cy,f));
0!=(ba&16)&&(D.opcode=K.getByte()&15);var Jb=D.x,Y=D.y,C=D.cx,y=D.cy,M=D.opcode;if(!(Jb>W||Y>da)){var O=Jb+C-1;O>ia&&(O=ia);Jb<ra&&(Jb=ra);var C=O-Jb+1,Ld=Y+y-1;Ld>ja&&(Ld=ja);Y<qa&&(Y=qa);y=Ld-Y+1;1>C||1>y||(ad(M,F,W,Jb,Y,C,y,null,0,0,0),F.postPaint(Jb,Y,C,y))}break;case 1:var S=k,Q=Sa.patBlt,N=n,T=m;0!=(N&1)&&(Q.x=L(S,Q.x,T));0!=(N&2)&&(Q.y=L(S,Q.y,T));0!=(N&4)&&(Q.cx=L(S,Q.cx,T));0!=(N&8)&&(Q.cy=L(S,Q.cy,T));0!=(N&16)&&(Q.opcode=S.getByte(),Q.opcode=Q.opcode&3|(Q.opcode&48)>>2);0!=(N&32)&&(Q.backgroundColor=
Zb(S));0!=(N&64)&&(Q.foregroundColor=Zb(S));var ea=Q.brush,la=N>>7;0!=(la&1)&&(ea.xOrigin=S.getByte());0!=(la&2)&&(ea.yOrigin=S.getByte());0!=(la&4)&&(ea.style=S.getByte());var pa=ea.pattern;0!=(la&8)&&(pa[0]=S.getByte());if(0!=(la&16))for(var B=1;8>B;B++)pa[B]=S.getByte();ea.pattern=pa;var sa=Q.x,td=Q.y;if(!(sa>ia||td>ja)){var ta=Q.opcode,ka=sa,oa=td,E=Q.cx,nc=Q.cy,wa=Q.foregroundColor,Oa=Q.backgroundColor,La=Q.brush.xOrigin,Ra=Q.brush.yOrigin,Va=Q.brush.style,bb=Q.brush.pattern,wa=Eb(wa),Oa=Eb(Oa),
Od=ka+E-1;Od>ia&&(Od=ia);ka<ra&&(ka=ra);var E=Od-ka+1,Pd=oa+nc-1;Pd>ja&&(Pd=ja);oa<qa&&(oa=qa);nc=Pd-oa+1;if(!(1>E||1>nc)){var Hc=null;switch(Va){case 0:for(var Hc=Ja(E*nc),jd=Hc[0]=0;jd<Hc.length;jd++)Hc[jd]=wa;ad(ta,F,W,ka,oa,E,nc,Hc,E,0,0);F.postPaint(ka,oa,E,nc);1==E&&v.execute("setCaretPos",[ka,oa]);break;case 2:svGlobal.logger.warn("hatch");break;case 3:for(var Hc=Ja(E*nc),Me=Hc[0]=0,jd=0;jd<nc;jd++)for(var Qd=0;Qd<E;Qd++)Hc[Me]=0==(bb[(jd+Ra)%8]&1<<(Qd+La)%8)?wa:Oa,Me++;ad(ta,F,W,ka,oa,E,nc,
Hc,E,0,0);F.postPaint(ka,oa,E,nc);break;default:svGlobal.logger.warn("Unsupported brush style "+Va)}}}break;case 2:var kd=k,H=Sa.screenBlt,ld=n,ud=m;0!=(ld&1)&&(H.x=L(kd,H.x,ud));0!=(ld&2)&&(H.y=L(kd,H.y,ud));0!=(ld&4)&&(H.cx=L(kd,H.cx,ud));0!=(ld&8)&&(H.cy=L(kd,H.cy,ud));0!=(ld&16)&&(H.opcode=kd.getByte()&15);0!=(ld&32)&&(H.srcX=L(kd,H.srcX,ud));0!=(ld&64)&&(H.srcY=L(kd,H.srcY,ud));var Ic=H.x,Jc=H.y;if(!(Ic>ia||Jc>ja)){var Da=H.cx,J=H.cy,Xa=H.opcode,Ma=H.srcX,Fa=H.srcY,Ta=Ic+Da-1;Ta>ia&&(Ta=ia);
Ic<ra&&(Ic=ra);var Da=Ta-Ic+1,Ka=Jc+J-1;Ka>ja&&(Ka=ja);Jc<qa&&(Jc=qa);J=Ka-Jc+1;Ma+=Ic-H.x;Fa+=Jc-H.y;1>Da||1>J||(12==Xa?F.moveArea(Ma,Fa,Da,J,Ic-Ma,Jc-Fa):ad(Xa,F,Da,Ic,Jc,Da,J,null,Da,Ma,Fa),F.postPaint(Ic,Jc,Da,J))}break;case 9:var oc=k,Ga=Sa.line,Ea=n,Wa=m;0!=(Ea&1)&&(Ga.mixmode=oc.getLittleEndian16());0!=(Ea&2)&&(Ga.startX=L(oc,Ga.startX,Wa));0!=(Ea&4)&&(Ga.startY=L(oc,Ga.startY,Wa));0!=(Ea&8)&&(Ga.endX=L(oc,Ga.endX,Wa));0!=(Ea&16)&&(Ga.endY=L(oc,Ga.endY,Wa));0!=(Ea&32)&&(Ga.backgroundColor=
Zb(oc));0!=(Ea&64)&&(Ga.opcode=oc.getByte());var db=Ga.pen,fb=Ea>>7;0!=(fb&1)&&(db.style=oc.getByte());0!=(fb&2)&&(db.width=oc.getByte());0!=(fb&4)&&(db.color=Zb(oc));var md=Ga.startX,Kc=Ga.startY,Pa=Ga.endX,U=Ga.endY,Ib=Ga.pen.color,tb=Ga.opcode-1;if(Kc==U){if(md>Pa)var Rd=md,md=Pa,Pa=Rd;md<ra&&(md=ra);Pa>ia&&(Pa=ia)}else md==Pa&&(Kc>U&&(Rd=Kc,Kc=U,U=Rd),Kc<qa&&(Kc=qa),Kc>ja&&(Kc=ja));Ne(md,Kc,Pa,U,Ib,tb);break;case 10:var ca=k,Ya=Sa.rectangle,R=n,Qa=m;0!=(R&1)&&(Ya.x=L(ca,Ya.x,Qa));0!=(R&2)&&(Ya.y=
L(ca,Ya.y,Qa));0!=(R&4)&&(Ya.cx=L(ca,Ya.cx,Qa));0!=(R&8)&&(Ya.cy=L(ca,Ya.cy,Qa));0!=(R&16)&&(Fb=Fb&4294967040|ca.getByte());0!=(R&32)&&(Fb=Fb&4294902015|ca.getByte()<<8);0!=(R&64)&&(Fb=Fb&4278255615|ca.getByte()<<16);Ya.color=Fb;Sd(Ya.x,Ya.y,Ya.cx,Ya.cy,Ya.color,!0);break;case 11:var vb=k,ma=Sa.deskSave,vd=n,lb=m;0!=(vd&1)&&(ma.offset=vb.getLittleEndian32());0!=(vd&2)&&(ma.left=L(vb,ma.left,lb));0!=(vd&4)&&(ma.top=L(vb,ma.top,lb));0!=(vd&8)&&(ma.right=L(vb,ma.right,lb));0!=(vd&16)&&(ma.bottom=L(vb,
ma.bottom,lb));0!=(vd&32)&&(ma.action=vb.getByte());var Ed=ma.right-ma.left+1,Fd=ma.bottom-ma.top+1;if(0==ma.action){var nb=ma.left,gb=ma.top;1>Ed||1>Fd||Oe.save(nb,gb,Ed,Fd,ma.offset,F.getRGBs(nb,gb,Ed,Fd))}else{var cb=Ed,Td=Fd,kb=ma.left,Ud=ma.top,ob=Oe.restore(kb,Ud,cb,Td,ma.offset);ob?(F.setRGBs(kb,Ud,cb,Td,ob,0,cb),F.postPaint(kb,Ud,cb,Td)):svGlobal.logger.warn("XXX no matched desktop save.")}break;case 13:var wb=k,ga=Sa.memBlt,Gb=n,pc=m;0!=(Gb&1)&&(ga.cacheID=wb.getByte(),ga.colorTable=wb.getByte());
0!=(Gb&2)&&(ga.x=L(wb,ga.x,pc));0!=(Gb&4)&&(ga.y=L(wb,ga.y,pc));0!=(Gb&8)&&(ga.cx=L(wb,ga.cx,pc));0!=(Gb&16)&&(ga.cy=L(wb,ga.cy,pc));0!=(Gb&32)&&(ga.opcode=wb.getByte()&15);0!=(Gb&64)&&(ga.srcX=L(wb,ga.srcX,pc));0!=(Gb&128)&&(ga.srcY=L(wb,ga.srcY,pc));0!=(Gb&256)&&(ga.cacheIDX=wb.getLittleEndian16());var va=ga.x,pb=ga.y;if(!(va>ia||pb>ja)){var mb=ga.cx,Ha=ga.cy,Gd=ga.srcX,Lc=ga.srcY,hb=va+mb-1;hb>ia&&(hb=ia);va<ra&&(va=ra);var mb=hb-va+1,Vd=pb+Ha-1;Vd>ja&&(Vd=ja);pb<qa&&(pb=qa);var Ha=Vd-pb+1,Gd=
Gd+(va-ga.x),Lc=Lc+(pb-ga.y),xb=jc.getBitmap(ga.cacheID,ga.cacheIDX);if(xb){var yb=xb.width,Kb=xb.height;mb>yb&&(mb=yb);Ha>Kb&&(Ha=Kb);12==ga.opcode?F.setRGBs(va,pb,mb,Ha,xb.data,Lc*yb+Gd,yb):ad(ga.opcode,F,W,va,pb,mb,Ha,xb.data,yb,Gd,Lc);F.postPaint(va,pb,mb,Ha)}else svGlobal.logger.warn("Failed to get bitmap from cache, id:"+ga.cacheID+" idx="+ga.cacheIDX)}break;case 22:var $b=k,Na=Sa.polyLine,qc=n,ac=m;0!=(qc&1)&&(Na.x=L($b,Na.x,ac));0!=(qc&2)&&(Na.y=L($b,Na.y,ac));0!=(qc&4)&&(Na.opcode=$b.getByte());
0!=(qc&16)&&(Na.foregroundColor=Zb($b));0!=(qc&32)&&(Na.lines=$b.getByte());if(0!=(qc&64)){var Lb=$b.getByte();Na.dataSize=Lb;Na.data=$b.getBytes(Lb)}var Hd=Na.x,Mc=Na.y,Qf=Na.foregroundColor,zb=Na.lines,Mb=Na.dataSize,Wd=Na.data,Id=Array(1);Id[0]=Math.floor((zb-1)/4)+1;for(var bc=0,Ob=0,Dc=Na.opcode-1,ub=0;ub<zb&&Id[0]<Mb;ub++){var kc=Hd,Yb=Mc;0==ub%4&&(bc=Wd[Ob++]);0==(bc&192)&&(bc|=192);0!=(bc&64)&&(Hd+=Pe(Wd,Id));0!=(bc&128)&&(Mc+=Pe(Wd,Id));Ne(kc,Yb,Hd,Mc,Qf,Dc);bc<<=2}break;case 27:var ya=k,
fa=Sa.text2,za=n;0!=(za&1)&&(fa.font=ya.getByte());0!=(za&2)&&(fa.flags=ya.getByte());0!=(za&4)&&(fa.opcode=ya.getByte());0!=(za&8)&&(fa.mixmode=ya.getByte());0!=(za&16)&&(fa.foregroundColor=Zb(ya));0!=(za&32)&&(fa.backgroundColor=Zb(ya));0!=(za&64)&&(fa.clipLeft=ya.getLittleEndian16());0!=(za&128)&&(fa.clipTop=ya.getLittleEndian16());0!=(za&256)&&(fa.clipRight=ya.getLittleEndian16());0!=(za&512)&&(fa.clipBottom=ya.getLittleEndian16());0!=(za&1024)&&(fa.boxLeft=ya.getLittleEndian16());0!=(za&2048)&&
(fa.boxTop=ya.getLittleEndian16());0!=(za&4096)&&(fa.boxRight=ya.getLittleEndian16());0!=(za&8192)&&(fa.boxBottom=ya.getLittleEndian16());0!=(za&16384)&&ya.skipPosition(1);0!=(za&32768)&&ya.skipPosition(1);0!=(za&65536)&&ya.skipPosition(1);0!=(za&131072)&&ya.skipPosition(1);0!=(za&262144)&&ya.skipPosition(7);0!=(za&524288)&&(fa.x=ya.getLittleEndian16());0!=(za&1048576)&&(fa.y=ya.getLittleEndian16());if(0!=(za&2097152)){var Nb=ya.getByte();fa.length=Nb;fa.text=ya.getBytes(Nb);fa.textPos=0}var aa=fa.font,
V=fa.flags,Xd=fa.mixmode,sb=fa.foregroundColor,Nc=fa.backgroundColor,X=fa.clipLeft,bd=fa.clipTop,Z=fa.boxLeft,Ab=fa.boxTop,Aa=fa.x,qb=fa.y,cc=fa.length,Ua=fa.text,Yd=fa.clipRight-X,Za=fa.clipBottom-bd,$a=fa.boxRight-Z,I=fa.boxBottom-Ab,G=null,Pb=0,Ia=0;Z+$a>W&&($a=W-Z);1<$a?Sd(Z,Ab,$a,I,Nc,!1):1==Xd&&Sd(X,bd,Yd,Za,Nc,!1);for(var Rf=cc,na=0;na<cc;)switch(Ua[Ia+na]){case 255:var Oc=Ua[Ia+na+2];if(Oc>Rf-Ia){na=cc=0;break}var Sf=Ua.slice?Ua.slice(Ia,Ia+Oc):Ua.subarray(Ia,Ia+Oc),rc=new hf(Oc,Sf),cd=Ua[Ia+
na+1],Bb=rc;if(cd<Cc.length){var dc=Cc[cd];dc&&(dc.data=null);Cc[cd]=Bb}na+=3;cc-=na;Ia=na;na=0;break;case 254:var ha;a:{var ab=Ua[Ia+na+1],Zd=null;if(ab<Cc.length&&(Zd=Cc[ab])&&Zd.data){ha=Zd;break a}ha=null}var sc=ha?ha.data:null;sc&&0==sc[1]&&0==(V&32)&&(0!=(V&4)?qb+=Ua[Ia+na+2]:Aa+=Ua[Ia+na+2]);na=na+2<cc?na+3:na+2;cc-=na;Ia=na;na=0;if(!ha)break;for(var Ub=ha.size,Cb=0;Cb<Ub;Cb++)G=Qe(aa,sc[Cb]),0==(V&32)&&(Pb=sc[++Cb],0!=(Pb&128)?(0!=(V&4)?qb+=sc[Cb+1]|sc[Cb+2]<<8:Aa+=sc[Cb+1]|sc[Cb+2]<<8,Cb+=
2):0!=(V&4)?qb+=Pb:Aa+=Pb),G&&(Re(Xd,Aa+G.offset&65535,qb+G.baseLine&65535,G.width,G.height,G.fontData,Nc,sb,Nd,Xb),0!=(V&32)&&(Aa+=G.width));break;default:G=Qe(aa,Ua[Ia+na]),0==(V&32)&&(Pb=Ua[Ia+ ++na],0!=(Pb&128)?(0!=(V&4)?qb+=Ua[Ia+na+1]|Ua[Ia+na+2]<<8:Aa+=Ua[Ia+na+1]|Ua[Ia+na+2]<<8,na+=2):0!=(V&4)?qb+=Pb:Aa+=Pb),G&&(Re(Xd,Aa+G.offset&65535,qb+G.baseLine&65535,G.width,G.height,G.fontData,Nc,sb,Nd,Xb),0!=(V&32)&&(Aa+=G.width)),na++}1<$a?0<I&&F.postPaint(Z,Ab,$a,I):0<Yd&&0<Za&&F.postPaint(X,bd,Yd,
Za);break;default:svGlobal.logger.warn("XXX Order type "+Sa.orderType)}0!=(l&4)&&pe();break;case 2:var Hb=a,Vb=d>>2;switch(Vb){case 11:var Qb=Hb,Wb=Qb.getLittleEndian16(),Ba=Qb.getLittleEndian32(),tc=Qb.getPosition()+(Wb-7);if(0!=(Ba&16777216)){var ib=Qb.getLittleEndian32();if(0!=(Ba&1073741824))svGlobal.logger.info("XXX rail icon, winId="+ib);else if(0!=(Ba&2147483648))svGlobal.logger.info("XXX rail cache icon, winId="+ib);else if(0!=(Ba&536870912)){var ic=ib;svGlobal.logger.info("***** delete winId="+
ic);v.delWin(ic)}else Tf(Qb,Ba,ib)}else if(0!=(Ba&33554432))svGlobal.logger.info("XXX Alt Sec window Notify="+Ba);else if(0!=(Ba&67108864))if(svGlobal.logger.info("*** -- Alt Sec window Desktop="+Ba),0!=(Ba&1))svGlobal.logger.info("Desktop non monitored flags="+Ba);else{if(0!=(Ba&32)){var yc=Qb.getLittleEndian32();svGlobal.logger.info("Desktop monitored flags="+Ba+" winId="+yc);v.setTitle(yc);if(!F.getContext()){var lc=v.getFocused();lc&&F.setContext(lc.context)}if(0!=(Ba&16)){var ua=Qb.getByte();
if(0<ua){var uc=v.zOrders;uc.length=ua;for(var vc=0;vc<ua;vc++)uc[vc]=Qb.getLittleEndian32(),svGlobal.logger.info("---zorders:"+uc[vc])}}}}else svGlobal.logger.info("XXX Alt Sec window order flgas="+Ba);Qb.setPosition(tc);break;case 13:Hb.getLittleEndian32();break;default:svGlobal.logger.warn("XXX Alt Sec order not implemented:"+Vb)}break;case 3:var Db=a,nd=void 0,$d=void 0,od=void 0,Fc=void 0,nd=Db.getLittleEndian16(),od=Db.getLittleEndian16(),$d=Db.getByte(),Fc=Db.getPosition()+nd+7;switch($d){case 0:var Rb=
Db,Zc=Rb.getByte();Rb.skipPosition(1);var Pc=Rb.getByte(),Qc=Rb.getByte(),pd=Rb.getByte(),Ca=Math.floor((pd+7)/8),ed=Rb.getLittleEndian16(),fd=Rb.getLittleEndian16(),Rc=Rb.getPosition();Rb.skipPosition(ed);for(var qd=Array(Pc*Qc*Ca),rb=qd[0]=0,rd=Pc*Ca,ec=0;ec<Qc;ec++)rb=Rc+(Qc-ec-1)*rd,Rb.copyToByteArray(qd,ec*rd,rb,rd);jc.putBitmap(Zc,fd,new Ac(Jd(qd,Ca),Pc,Qc,0,0,8*Ca));break;case 1:svGlobal.logger.info("TODO: color cache");break;case 2:var xa=Db,Vc=od,gd=xa.getByte();xa.getByte();var ae=xa.getByte(),
Sb=xa.getByte(),wd=xa.getByte(),Uf=Math.floor((wd+7)/8),Vf=xa.getLittleEndian16(),fc=xa.getLittleEndian16(),wc=0;0!=(Vc&1024)?wc=Vf:(xa.skipPosition(2),wc=xa.getLittleEndian16(),xa.skipPosition(2),xa.skipPosition(2));var dd=void 0,dd=1==Uf?be(ae,Sb,wc,xa.getData(),xa.getPosition()):hd(ae,Sb,wc,xa.getData(),xa.getPosition());xa.skipPosition(wc);jc.putBitmap(gd,fc,new Ac(dd,ae,Sb,0,0,wd));break;case 3:for(var gc=Db,xd=null,jb=0,Se=0,hc=0,sd=0,eb=0,q=0,Sc=0,Te=0,jb=gc.getByte(),Se=gc.getByte(),xc=0;xc<
Se;xc++){var hc=gc.getLittleEndian16(),sd=gc.getLittleEndian16(),eb=gc.getLittleEndian16(),q=gc.getLittleEndian16(),Sc=gc.getLittleEndian16(),Te=Sc*Math.floor((q+7)/8)+3&-4,Tc=xd=new jf(jb,hc,sd,eb,q,Sc,gc.getBytes(Te));if(12>Tc.font&&256>Tc.character){var zc=id[Tc.font][Tc.character];zc&&(zc.fontData=null);id[Tc.font][Tc.character]=Tc}else svGlobal.logger.warn("put font: font="+Tc.font+" c="+Tc.character)}break;case 4:Ue(Db,od,!1);break;case 5:Ue(Db,od,!0);break;case 8:var Tb=Db,Bc=od&7,Wc=Tb.getLittleEndian16();
Tb.skipPosition(8);var Ec=Tb.getByte();Tb.skipPosition(2);var mc=Tb.getByte(),Ad=Tb.getLittleEndian16(),Bd=Tb.getLittleEndian16(),Xc=Tb.getLittleEndian32(),yd=null;if(1==mc){He(Tb,Ec,Ad,Bd,Gc);var Yc=Gc.getData(),$c=Gc.getDataSize(),yd=Ja($c);Dd(Yc,0,yd,Ad,Bd,1);jc.putBitmap(Bc,Wc,new Ac(yd,Ad,Bd,0,0,32))}else if(0==mc){var Uc=Md(Tb.getData(),Xc,Tb.getPosition()),yd=Ja(Uc.length);Dd(Uc,0,yd,Ad,Bd,1);jc.putBitmap(Bc,Wc,new Ac(yd,Ad,Bd,0,0,32))}else svGlobal.logger.warn("XXX invalid codec id:"+mc);
Tb.skipPosition(Xc);break;default:svGlobal.logger.info("XXX second Order, type="+$d)}Db.setPosition(Fc)}c++}F.commitPaint()}function Wf(a){this.id=a;this.appId="";var b=this;this.resizable=function(){return 0!=(b.style&262144)||0!=(b.style&65536)||0!=(b.style&16777216)||3==b.showState};this.fillBrowser=function(){if((!O.disableJoinedAppResize||2!=p.mode)&&b.resizable()){var c=v.getOwnerSurface(b);c?(c=c.getWindow())&&b.resize(0,0,c.innerWidth,c.innerHeight):svGlobal.logger.warn("XXX No browser for "+
a)}};this.parent=function(){return v.getWinById(b.ownerWinid)};this.resize=function(a,d,e,k){O.disableJoinedAppResize&&2==p.mode||y.send("8C1"+b.id+"\t"+a+"\t"+d+"\t"+e+"\t"+k)};this.checkBound=function(){var a=v.getOwnerSurface(b);if(a){var a=a.getWindow(),d=b.winWidth,e=b.winHeight,k=b.winOffsetX,l=b.winOffsetY;if(a&&!(1>d||1>e)){var n=!1;d>a.innerWidth&&(d=a.innerWidth,n=!0);b.resizable()&&e>a.innerHeight&&(e=a.innerHeight,n=!0);0>k&&(k=0,n=!0);k+d>a.innerWidth&&(k=a.innerWidth-d,n=!0);0>l&&(l=
0,n=!0);l+e>a.innerHeight&&(l=a.innerHeight-e,n=!0);n&&b.resize(k,l,d,e)}}else svGlobal.logger.warn("no surface for checkBound")};this.exeCommand=function(b){y.send("8C4"+a+"\t"+b)};this.activate=function(b){y.send("8C3"+a+"\t"+b)};this.close=function(){b.exeCommand(61536)};this.getAppId=function(){y.send("8C0"+a)};this.isVisible=function(){return b.winWidth&&b.winHeight&&b.showState&&45<b.winHeight&&45<b.winWidth};this.getAppId()}function Tf(a,b,c){la||(la=!0);var d=0==(b&268435456);svGlobal.logger.info("\n\n=========== winId="+
c+" existed="+d);var e=d?v.getWinById(c):new Wf(c);if(e){0!=(b&2)&&(e.ownerWinid=a.getLittleEndian32(),svGlobal.logger.info("***** ownerWinid="+e.ownerWinid));0!=(b&8)&&(e.style=a.getLittleEndian32(),e.extStyle=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" style="+e.style+" extStyle="+e.extStyle),svGlobal.logger.info("*****--- WS_POPUP="+(0!=(e.style&2147483648))),svGlobal.logger.info("*****--- WS_DLGFRAME="+(0!=(e.style&4194304))),svGlobal.logger.info("*****--- DS_MODALFRAME="+(0!=
(e.style&128))),svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+(0!=(e.extStyle&1))),svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+(0!=(e.extStyle&128))),svGlobal.logger.info("*****--- WS_BORDER="+(0!=(e.style&8388608))),svGlobal.logger.info("*****--- WS_CAPTION="+(0!=(e.style&12582912))),svGlobal.logger.info("*****--- WS_OVERLAPPED="+(0!=(e.style&0))),svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+(0!=(e.style&13565952))),svGlobal.logger.info("*****--- WS_POPUPWINDOW="+(0!=(e.style&
2156396544))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(e.style&262144))),svGlobal.logger.info("*****--- WS_CHILD="+(0!=(e.style&1073741824))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(e.style&262144))),svGlobal.logger.info("*****--- WS_EX_MDICHILD="+(0!=(e.extStyle&64))),svGlobal.logger.info("*****--- WS_EX_LAYERED="+(0!=(e.extStyle&524288))));if(0!=(b&16))switch(e.showState=a.getByte(),svGlobal.logger.info("***** winId="+c+" showState="+e.showState),e.showState){case 2:3==p.windowState&&
setTimeout(function(){return function(){e.exeCommand(61728)}}(),50);break;case 3:e.fillBrowser()}var k=0!=(b&4);if(k){var l=a.getLittleEndian16();e.titleInfo=a.getUnicodeString(l,!1);svGlobal.logger.info("***** winId="+c+" title="+e.titleInfo)}0!=(b&16384)&&(e.clientOffsetX=a.getLittleEndian32(),e.clientOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" coffX"+e.clientOffsetX+" coffY="+e.clientOffsetY));0!=(b&65536)&&(e.clientAreaWidth=a.getLittleEndian32(),e.clientAreaHeight=a.getLittleEndian32(),
svGlobal.logger.info("***** winId="+c+" cw"+e.clientAreaWidth+" ch="+e.clientAreaHeight));0!=(b&131072)&&(e.rpContent=a.getLittleEndian32());0!=(b&262144)&&(e.rootParentHandle=a.getLittleEndian32());0!=(b&2048)&&(e.winOffsetX=a.getLittleEndian32(),e.winOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" offX"+e.winOffsetX+" offY="+e.winOffsetY));0!=(b&32768)&&(e.winClientDeltaX=a.getLittleEndian32(),e.winClientDeltaY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" dX"+
e.winClientDeltaX+" dY="+e.winClientDeltaY));0!=(b&1024)&&(e.winWidth=a.getLittleEndian32(),e.winHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" w"+e.winWidth+" h="+e.winHeight));0!=(b&256)&&(l=a.getLittleEndian16(),0<l&&a.skipPosition(8*l));0!=(b&4096)&&(e.visibleOffsetX=a.getLittleEndian32(),e.visibleOffsetY=a.getLittleEndian32());0!=(b&512)&&(b=a.getLittleEndian16(),e.numVisibilityRects=b,0<b&&a.skipPosition(8*b));d||v.addWin(e);k&&v.setTitle(c)}else svGlobal.logger.warn("XXX, No win with id:"+
c)}function Ue(a,b,c){var d,e,k,l,n,g;d=0;e=b&7;n=((b&120)>>3)-2;b=(b&65408)>>7;0!=(b&2)&&a.skipPosition(8);0!=(b&1)?l=k=sb.readVar2Bytes(a):(k=sb.readVar2Bytes(a),l=sb.readVar2Bytes(a));d=sb.readVar4Bytes(a);g=sb.readVar2Bytes(a);c&&0==(b&8)&&a.skipPosition(8);if(c){c=1==n?be(k,l,d,a.getData(),a.getPosition()):hd(k,l,d,a.getData(),a.getPosition());a.skipPosition(d);if(!c){svGlobal.logger.warn("Failed to decompress bitmap data");return}a=new Ac(c,k,l,0,0,8*n)}else{c=Array(k*l*n);c[0]=0;var m=a.getPosition(),
h=0,p=k*n;for(d=0;d<l;d++)h=m+(l-d-1)*p,a.copyToByteArray(c,d*p,h,p);a=new Ac(Jd(c,n),k,l,0,0,8*n)}jc.putBitmap(e,g,a);0!=(b&2)&&svGlobal.logger.warn("XXX:TODO, persistent")}function L(a,b,c){var d=0;c?(d=a.getByte()<<24>>24,b+=d):b=a.getLittleEndian16()<<16>>16;return b}function Zb(a){var b=0,c=0,b=c=a.getByte(),c=a.getByte(),b=b|c<<8,c=a.getByte();return b|c<<16}function Ee(a){var b=0,c=0,d=0,e=0,k=0,l=0,n=0,g=0,m=0,h=0,p=0,r=0,e=0,A,t,z,u;z=u=0;A=W;t=da;for(var b=a.getLittleEndian16(),x=0;x<b;x++){var c=
a.getLittleEndian16(),d=a.getLittleEndian16(),e=a.getLittleEndian16(),k=a.getLittleEndian16(),l=a.getLittleEndian16(),n=a.getLittleEndian16(),h=a.getLittleEndian16(),P=Math.floor((h+7)/8),p=a.getLittleEndian16(),r=a.getLittleEndian16(),g=e-c+1,m=k-d+1;A>c&&(A=c);t>d&&(t=d);z<e&&(z=e);u<k&&(u=k);Xb!=h&&(svGlobal.logger.warn("Server limited colour depth to "+h+" bits"),yc(h));if(0==p){k=l*P;h=n*k;e="Uint8Array"in window?new Uint8Array(h):Array(h);e[0]=0;p=a.getPosition();for(r=0;r<n;r++)tb(a.getData(),
p,e,(n-r-1)*k,k),p+=k;a.skipPosition(h);n=void 0;n=0;P=Jd(e,P);F.setRGBs(c,d,g,m,P,n,l);F.postPaint(c,d,g,m)}else 0!=(p&1024)?e=r:(a.skipPosition(2),e=a.getLittleEndian16(),a.skipPosition(4)),k=a.getData(),h=e,p=a.getPosition(),1==P?(n=be(l,n,h,k,p),k=void 0,k=0,P=Jd(n,P),F.setRGBs(c,d,g,m,P,k,l),F.postPaint(c,d,g,m)):(P=hd(l,n,h,k,p),1>g||1>m||(F.setRGBs(c,d,g,m,P,0,l),F.postPaint(c,d,g,m))),a.skipPosition(e)}F.commitPaint()}function pe(){ra=0;ia=W-1;qa=0;ja=da-1}function Ne(a,b,c,d,e,k){var l=Math.min(a,
c),n=Math.max(a,c),g=Math.min(b,d),m=Math.max(b,d);e=Eb(e);if(!(l>=ra&&n<=ia&&g>=qa&&m<=ja)){if(l>ia||n<ra||g>ja||m<qa)return;l=0;if(a==c)b>d&&(l=b,b=d,d=l),b<qa&&(b=qa),d>ja&&(d=ja);else if(b==d)a>c&&(l=a,a=c,c=l),a<ra&&(a=ra),c>ia&&(c=ia);else{l=Sa._line;l.set(a,b,c,d);n=l.intersection(ra,qa,ia,qa);g=[];n.onLine1&&n.onLine2&&g.push(n.x,n.y);n=l.intersection(ia,qa,ia,ja);n.onLine1&&n.onLine2&&g.push(n.x,n.y);n=l.intersection(ra,ja,ia,ja);n.onLine1&&n.onLine2&&g.push(n.x,n.y);n=l.intersection(ra,
qa,ra,ja);n.onLine1&&n.onLine2&&g.push(n.x,n.y);2==g.length&&(a>=ra&&a<=ia&&b>=qa&&b<=ja?g.push(a,b):c>=ra&&c<=ia&&d>=qa&&d<=ja&&g.push(c,d));if(4!=g.length)return;a=g[0];b=g[1];c=g[2];d=g[3]}}if(12==k)F.drawLine(a,b,c,d,e);else if(a==c||b==d){var l=a,n=b,g=c,m=d,h,p;if(n==m)if(g>l){if(p=g-l,!(1>p)){for(h=0;h<p;h++)Ub(k,F,l+h,n,e);F.postPaint(l,n,p+1,1)}}else{if(p=l-g,!(1>p)){for(h=0;h<p;h++)Ub(k,F,g+h,n,e);F.postPaint(g,n,p+1,1)}}else if(m>n){if(p=m-n,!(1>p)){for(h=0;h<p;h++)Ub(k,F,l,n+h,e);F.postPaint(l,
n,1,p+1)}}else if(p=n-m,!(1>p)){for(h=0;h<p;h++)Ub(k,F,l,m+h,e);F.postPaint(l,m,1,p+1)}}else{var r=Math.abs(c-a),A=Math.abs(d-b),l=a,n=b,t,z,u;m=c>=a?g=1:g=-1;p=d>=b?h=1:h=-1;r>=A?(p=g=0,z=r,t=r/2>>0,u=A):(h=m=0,z=A,t=A/2>>0,u=r,r=A);if(1>r)return;for(A=0;A<=r;A++)Ub(k,F,l,n,e),t+=u,t>=z&&(t-=z,l+=g,n+=h),l+=m,n+=p}l=Math.min(a,c);n=Math.max(a,c);g=Math.min(b,d);m=Math.max(b,d);0>n-l||0>m-g||F.postPaint(l,g,n-l+1,m-g+1)}function Re(a,b,c,d,e,k,l,n,g,m){g=128;n=Eb(n);l=Eb(l);if(!(b>ia||c>ja)){var h=
b+d-1;h>ia&&(h=ia);m=b<ra?ra:b;var h=h-b+1,p=c+e-1;p>ja&&(p=ja);var r=c<qa?qa:c,p=p-c+1;if(!(1>h||1>p)){var A=0,t=0,z=F.setRGB;if(r==c&&h==d&&p==e&&m==b)if(0==a)for(a=0;a<e;a++){for(var A=c+a,u=0;u<d;u++)0==g&&(t++,g=128),0!=(k[t]&g)&&z(b+u,A,n),g>>=1;t++;g=128;t==k.length&&(t=0)}else for(a=0;a<e;a++){A=c+a;for(u=0;u<d;u++)0==g&&(t++,g=128),0!=(k[t]&g)?z(b+u,A,n):z(b+u,A,l),g>>=1;t++;g=128;t==k.length&&(t=0)}else if(0==a)for(a=0;a<p;a++){A=c+a;for(u=0;u<h;u++)0==g&&(t++,g=128),b+u>=m&&A>=r&&0!=(k[t]&
g)&&z(b+u,A,n),g>>=1;t++;g=128;t==k.length&&(t=0)}else for(a=0;a<p;a++){A=c+a;for(u=0;u<h;u++)0==g&&(t++,g=128),b+u>=m&&c+a>=r&&(0!=(k[t]&g)?z(b+u,A,n):z(b+u,A,l)),g>>=1;t++;g=128;t==k.length&&(t=0)}}}}function Pe(a,b){var c=a[b[0]++]&255,d=c&128,c=0!=(c&64)?c|-64:c&63;0!=d&&(c=c<<8|a[b[0]++]&255);return c}function Sd(a,b,c,d,e,k){a>ia||b>ja||(c=a+c-1,c>ia&&(c=ia),a<ra&&(a=ra),c=c-a+1,d=b+d-1,d>ja&&(d=ja),b<qa&&(b=qa),d=d-b+1,1>c||1>d||(F.fillRect(a,b,c,d,Eb(e)),F.postPaint(a,b,c,d)))}function ed(a){if(y){if(ea)try{v.close(),
db||y.send("85-1"),y.close()}catch(b){}for(;y&&y.readyState!=WebSocket.CLOSING&&y.readyState!=WebSocket.CLOSED;)try{y.close()}catch(b){}}null!=Ma&&(Ma.exit(),Ma=null)}function fd(a,b,c,d,e,k,l){for(var n=e*c+d,g=a.setRGB,m=a.getRGB,h=0;h<l;h++){for(var p=0;p<k;p++){if(a){var r=m(d+p,e+h);g(d+p,e+h,~r&ka)}else b[n]=~b[n]&ka;n++}n+=c-k}}function ad(a,b,c,d,e,k,l,n,g,m,h){if(!(0>k|0>l|0>c|0>g))switch(a){case 0:n=b.setRGB;for(g=d;g<d+k;g++)for(b=e;b<e+l;b++)n(g,b,0);break;case 1:a=h*g+m;c=b.setRGB;b=
b.getRGB;for(m=0;m<l;m++){for(h=0;h<k;h++)c(d+k,e+l,~(b(d+k,e+l)|n[a])&ka);a+=g-k}break;case 2:a=h*g+m;c=b.setRGB;b=b.getRGB;for(m=0;m<l;m++){for(h=0;h<k;h++){var p=b(d+k,e+l);c(d+k,e+l,p&~n[a]&ka);a++}a+=g-k}break;case 3:fd(b,n,g,m,h,k,l);n?b.setRGBs(d,e,k,l,n,h*g+m,g):b.moveArea(m,h,k,l,d-m,e-h);break;case 4:fd(b,null,c,d,e,k,l);Ve(b,c,d,e,k,l,n,g,m,h);break;case 5:fd(b,null,c,d,e,k,l);break;case 6:a=h*g+m;c=b.setRGB;b=b.getRGB;for(m=0;m<l;m++){for(h=0;h<k;h++)p=b(d+h,e+m),c(d+h,e+m,p^n[a]&ka),
a++;a+=g-k}break;case 7:a=h*g+m;c=b.setRGB;b=b.getRGB;for(m=0;m<l;m++){for(h=0;h<k;h++)p=b(d+h,e+m),c(d+h,e+m,~(p&n[a])&ka),a++;a+=g-k}break;case 8:Ve(b,c,d,e,k,l,n,g,m,h);break;case 9:a=h*g+m;c=b.setRGB;b=b.getRGB;for(m=0;m<l;m++){for(h=0;h<k;h++)p=b(d+h,e+m),c(d+h,e+m,p^~n[a]&ka),a++;a+=g-k}break;case 10:break;case 11:a=h*g+m;c=b.setRGB;b=b.getRGB;for(m=0;m<l;m++){for(h=0;h<k;h++)p=b(d+h,e+m),c(d+h,e+m,p|~n[a]&ka),a++;a+=g-k}break;case 12:n?b.setRGBs(d,e,k,l,n,h*g+m,g):b.moveArea(m,h,k,l,d-m,e-
h);break;case 13:fd(b,null,c,d,e,k,l);We(b,c,d,e,k,l,n,g,m,h);break;case 14:We(b,c,d,e,k,l,n,g,m,h);break;case 15:n=b.setRGB;for(g=d;g<d+k;g++)for(b=e;b<e+l;b++)n(g,b,ka);break;default:svGlobal.logger.warn("unsupported opcode: "+a)}}function Ub(a,b,c,d,e){if(b){var k=b.getRGB(c,d);switch(a){case 0:b.setRGB(c,d,0);break;case 1:b.setRGB(c,d,~(k|e)&ka);break;case 2:b.setRGB(c,d,k&~e&ka);break;case 3:b.setRGB(c,d,~e&ka);break;case 4:b.setRGB(c,d,(~k&e)*ka);break;case 5:b.setRGB(c,d,~k&ka);break;case 6:b.setRGB(c,
d,k^e&ka);break;case 7:b.setRGB(c,d,~k&e&ka);break;case 8:b.setRGB(c,d,k&e&ka);break;case 9:b.setRGB(c,d,k^~e&ka);break;case 10:break;case 11:b.setRGB(c,d,k|~e&ka);break;case 12:b.setRGB(c,d,e);break;case 13:b.setRGB(c,d,(~k|e)&ka);break;case 14:b.setRGB(c,d,k|e&ka);break;case 15:b.setRGB(c,d,ka);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+a),b.setRGB(c,d,e)}}}function Ve(a,b,c,d,e,k,l,n,g,m){b=m*n+g;g=a.setRGB;a=a.getRGB;for(m=0;m<k;m++){for(var h=0;h<e;h++){var p=a(c+h,d+m);
g(c+h,d+m,p&l[b]&ka);b++}b+=n-e}}function We(a,b,c,d,e,k,l,n,g,m){b=m*n+g;g=a.setRGB;a=a.getRGB;for(m=0;m<k;m++){for(var h=0;h<e;h++){var p=a(c+h,d+m);g(c+h,d+m,p|l[b]&ka);b++}b+=n-e}}function Qe(a,b){if(12>a&&256>b){var c=id[a][b];if(c)return c}return null}function Le(a,b,c,d){switch(b){case 16:b=a>>8&248;var e=a>>3&252;a=a<<3&255;c[d]=b|b>>5;c[d+1]=e|e>>6;c[d+2]=a|a>>5;c[d+3]=255;break;case 15:b=a>>7&248;e=a>>2&248;a=a<<3&255;c[d]=b|b>>5;c[d+1]=e|e>>5;c[d+2]=a|a>>5;c[d+3]=255;break;case 8:c[d]=
Xa[0][a];c[d+1]=Xa[1][a];c[d+2]=Xa[2][a];c[d+3]=255;break;case 32:c[d]=a&255,c[d+1]=a>>8&255,c[d+2]=a>>16&255,c[d+3]=a>>24&255;default:c[d]=a&255,c[d+1]=a>>8&255,c[d+2]=a>>16&255,c[d+3]=255}}function Jd(a,b){var c=a.length/b>>0,d=Ja(c);d[0]=0;var e=Eb;switch(b){case 1:for(var k=0;k<c;k++)d[k]=e(a[k]);break;case 2:for(k=0;k<c;k++)d[k]=e(a[2*k+1]<<8|a[2*k]);break;default:for(k=0;k<c;k++)d[k]=e(a[k*b+2]<<16)|a[k*b+1]<<8|a[k*b]}return d}function be(a,b,c,d,e){var k=-1,l=0;c+=e;var n=0,g=0,m=0,h=a,p=-1,
r=0,A=g=0,t=0,z=m=0,u=4294967295,x=!1,P=!1,K=!1,D=Array(a*b);for(D[0]=0;e<c;){r=0;g=d[e++];n=g>>4;switch(n){case 12:case 13:case 14:n-=6;g&=15;m=16;break;case 15:n=g&15;9>n?(g=d[e++],g|=d[e++]<<8):g=11>n?8:1;m=0;break;default:n>>=1,g&=31,m=32}0!=m&&(K=2==n||7==n,0==g?g=K?d[e++]+1:d[e++]+m:K&&(g<<=3));switch(n){case 0:p!=n||h==a&&-1==k||(x=!0);break;case 8:A=d[e++];case 3:t=d[e++];break;case 6:case 7:u=d[e++];n-=5;break;case 9:z=3;n=2;r=3;break;case 10:z=5,n=2,r=5}p=n;for(m=0;0<g;)switch(h>=a&&(h=
0,b--,k=l,l=0+b*a),n){case 0:x&&(D[l+h]=-1==k?u:D[k+h]^u,x=!1,g--,h++);if(-1==k){for(;0!=(g&-8)&&h+8<a;)for(K=0;8>K;K++)D[l+h]=0,g--,h++;for(;0<g&&h<a;)D[l+h]=0,g--,h++}else{for(;0!=(g&-8)&&h+8<a;)for(K=0;8>K;K++)D[l+h]=D[k+h],g--,h++;for(;0<g&&h<a;)D[l+h]=D[k+h],g--,h++}break;case 1:if(-1==k){for(;0!=(g&-8)&&h+8<a;)for(K=0;8>K;K++)D[l+h]=u,g--,h++;for(;0<g&&h<a;)D[l+h]=u,g--,h++}else{for(;0!=(g&-8)&&h+8<a;)for(K=0;8>K;K++)D[l+h]=D[k+h]^u,g--,h++;for(;0<g&&h<a;)D[l+h]=D[k+h]^u,g--,h++}break;case 2:if(-1==
k){for(;0!=(g&-8)&&h+8<a;)for(K=0;8>K;K++)m<<=1,m&=255,0==m&&(z=0!=r?r:d[e++],m=1),D[l+h]=0!=(z&m)?u:0,g--,h++;for(;0<g&&h<a;)m<<=1,m&=255,0==m&&(z=0!=r?r:d[e++],m=1),D[l+h]=0!=(z&m)?u:0,g--,h++}else{for(;0!=(g&-8)&&h+8<a;)for(K=0;8>K;K++)m<<=1,m&=255,0==m&&(z=0!=r?r:d[e++],m=1),D[l+h]=0!=(z&m)?D[k+h]^u:D[k+h],g--,h++;for(;0<g&&h<a;)m<<=1,m&=255,0==m&&(z=0!=r?r:d[e++],m=1),D[l+h]=0!=(z&m)?D[k+h]^u:D[k+h],g--,h++}break;case 3:for(;0!=(g&-8)&&h+8<a;)for(K=0;8>K;K++)D[l+h]=t,g--,h++;for(;0<g&&h<a;)D[l+
h]=t,g--,h++;break;case 4:for(;0!=(g&-8)&&h+8<a;)for(K=0;8>K;K++)D[l+h]=d[e++],g--,h++;for(;0<g&&h<a;)D[l+h]=d[e++],g--,h++;break;case 8:for(;0!=(g&-8)&&h+8<a;)for(K=0;8>K;K++)P?(D[l+h]=t,P=!1):(D[l+h]=A,P=!0,g++),g--,h++;for(;0<g&&h<a;)P?(D[l+h]=t,P=!1):(D[l+h]=A,P=!0,g++),g--,h++;break;case 13:for(;0!=(g&-8)&&h+8<a;)for(K=0;8>K;K++)D[l+h]=255,g--,h++;for(;0<g&&h<a;)D[l+h]=255,g--,h++;break;case 14:for(;0!=(g&-8)&&h+8<a;)for(K=0;8>K;K++)D[l+h]=0,g--,h++;for(;0<g&&h<a;)D[l+h]=0,g--,h++;break;default:g--,
h++}}return D}sessionStorage&&sessionStorage.clear();this.displayMsg=this.reconnectOnResize=!0;this.appTimeout=1600;this.reconnectTimes=0;this.windowState=3;this.setTitle=this.openLink=!0;this.audioBuffer=0;this.sessionInfo={domain:"",userName:"",sessionId:0,joinedSessions:[]};this.mode=0;this.remoteAppLogin=!0;var Zc=!1,Lb={},Mb={},Yb=null,p=this,gb=!0,lc=!1,mc=!1,Fa=!1,O=hi5.appcfg||{img:{},toolbar:{fadable:!0}};this.setConfig=function(a){O=a};var W=0,da=0,Xb=(Ra?parseInt(Ra,10):16)|0,tb=hi5.Arrays.arraycopy,
Ea=hi5.Arrays.fill,Ob=null,ub="object"==typeof r?r:null;this.protocol=ub?"":r.substring(0,r.indexOf("://")).toLowerCase();this.gateway=function(){if(ub)return"";var a=r.lastIndexOf("/RDP?");-1==a&&(a=r.lastIndexOf("/JOIN?"));-1==a&&(a=r.lastIndexOf("/PLAY?"));return r.substring(0,a).replace(/wss\:\/\//ig,"https://").replace(/ws\:\/\//ig,"http://")}();var db="object"==typeof r||0<r.indexOf("/PLAY?"),Xe=!db&&0<r.indexOf("invitation=");if(Xe){var Uc=decodeURIComponent(r),Hb=Uc.indexOf(' USERNAME="');
if(0<Hb){var Hb=Hb+11,Ye=Uc.substring(Hb,Uc.indexOf('"',Hb));r+="&novice="+Ye+"&server="+Ye}r+="&mapClipboard=on"}if(db)this.mode=1,ub?r="":(W=640,da=480),r+="&touchpad=on",this.reconnectOnResize=!1;else if(0<r.indexOf("/JOIN?")||Xe)this.mode=2,gb=this.reconnectOnResize,this.reconnectOnResize=!1;W=M&&0!=M?M|0:window.innerWidth|0;Ka&&0!=Ka?da=Ka|0:(da=window.innerHeight|0,da=ee(da)|0);-1==W&&(W=screen.width|0);-1==da&&(da=screen.height|0);var C=hi5.tool.queryToObj(r.substring(r.indexOf("?")+1));C.gateway||
(r+="&gateway="+encodeURIComponent(p.gateway));!C.minWidth&&O.minWidth&&(rdArgs.minWidth=O.minWidth);!C.minHeight&&O.minHeight&&(rdArgs.minHeight=O.minHeight);C.minWidth&&(C.minWidth=parseInt(C.minWidth));C.minHeight&&(C.minHeight=parseInt(C.minHeight));C.waWidth&&(C.waWidth=parseInt(C.waWidth));C.waHeight&&(C.waHeight=parseInt(C.waHeight));"useSSL"in C||(r+="&useSSL="+("wss"==p.protocol));Ib(C.mapClipboard)&&hi5.storage.isAvailable&&(r+="&shareClipboardId="+Ze());O&&(void 0!=O.displayMsg?this.displayMsg=
O.displayMsg:O.displayMsg=this.displayMsg,O.appTimeout&&(this.appTimeout=O.appTimeout),void 0!=O.reconnectOnResize&&(gb=this.reconnectOnResize=O.reconnectOnResize),O.reconnectTimes&&(this.reconnectTimes=O.reconnectTimes),void 0!=O.windowState&&(this.windowState=O.windowState),void 0!=O.openLink&&(this.openLink=O.openLink),void 0!=O.setTitle&&(this.setTitle=O.setTitle),O.audioBuffer&&(this.audioBuffer=O.audioBuffer),"boolean"==typeof O.useWSS&&(r=(O.useWSS?"wss":"ws")+r.substring(r.indexOf("://"))),
"boolean"==typeof O.remoteAppLogin&&(this.remoteAppLogin=O.remoteAppLogin,Zc=!O.remoteAppLogin,svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")),"boolean"==typeof O.hideLogin&&(Zc=O.hideLogin));var kc=this.reconnectTimes;C.vmid&&-1==C.vmid.indexOf("EnhancedMode=1")&&(gb=this.reconnectOnResize=!1);this.server=C.server;this.port=parseInt(C.port,10);this.loadbalanceToken=O.loadbalanceTokenName?O.loadbalanceTokenName+"="+hi5.tool.uuid():"";this.modifyURL=function(a){p.loadbalanceToken&&
(a+="&"+p.loadbalanceToken);return a};this.getURL=function(){return r};this.getColor=function(){return Xb};var Wb=hi5.graphic.Rectangle,ob=new function(){function a(a){a=(a&1431655765)<<1|a>>>1&1431655765;a=(a&858993459)<<2|a>>>2&858993459;a=(a&252645135)<<4|a>>>4&252645135;if(0==a>>>8)return a;a=(a&16711935)<<8|a>>>8&16711935;return 0==a>>>16?a:(a&65535)<<16|a>>>16&65535}function b(a,b,e,g){var f,h=0,m=0,n,p,x,t,u=0!=(g&1),r=d;if(0==(g&32))return k=0,l=e,0;0!=(g&64)&&(c=0);if(0!=(g&128)){for(g=65536;0<=
--g;)r[g]=0;c=0}l=k=0;k=x=n=g=c;if(0==e)return 0;e+=m;do{if(0==h){if(m>=e)break;g=a[b+m++]<<24;h=8}if(0<=g){if(8>h){if(m>=e){if(0!=g)return-1;break}g|=a[b+m++]<<24-h;h+=8}if(65536<=n)return-1;r[n++]=g>>>24&255;g<<=8;h-=8}else{g<<=1;if(0==--h){if(m>=e)return-1;g=a[b+m++]<<24;h=8}if(0<=g){if(8>h){if(m>=e)return-1;g|=a[b+m++]<<24-h;h+=8}if(65536<=n)return-1;r[n++]=(g>>>24|128)&255;g<<=8;h-=8}else{g<<=1;if(--h<(u?3:2)){if(m>=e)return-1;g|=a[b+m++]<<24-h;h+=8}if(u)switch(g>>>29){case 7:for(;9>h;h+=8){if(m>=
e)return-1;g|=a[b+m++]<<24-h}g<<=3;f=g>>>26;g<<=6;h-=9;break;case 6:for(;11>h;h+=8){if(m>=e)return-1;g|=a[b+m++]<<24-h}g<<=3;f=(g>>>24)+64;g<<=8;h-=11;break;case 5:case 4:for(;13>h;h+=8){if(m>=e)return-1;g|=a[b+m++]<<24-h}g<<=2;f=(g>>>21)+320;g<<=11;h-=13;break;default:for(;17>h;h+=8){if(m>=e)return-1;g|=a[b+m++]<<24-h}g<<=1;f=(g>>>16)+2368;g<<=16;h-=17}else switch(g>>>30){case 3:if(8>h){if(m>=e)return-1;g|=a[b+m++]<<24-h;h+=8}g<<=2;f=g>>>26;g<<=6;h-=8;break;case 2:for(;10>h;h+=8){if(m>=e)return-1;
g|=a[b+m++]<<24-h}g<<=2;f=(g>>>24)+64;g<<=8;h-=10;break;default:for(;14>h;h+=8){if(m>=e)return-1;g|=a[b+m++]<<24-h}f=(g>>>18)+320;g<<=14;h-=14}if(0==h){if(m>=e)return-1;g=a[b+m++]<<24;h=8}if(0<=g)p=3,g<<=1,h--;else{t=u?14:11;do{g<<=1;if(0==--h){if(m>=e)return-1;g=a[b+m++]<<24;h=8}if(0<=g)break;if(0==--t)return-1}while(1);p=(u?16:13)-t;g<<=1;if(--h<p)for(;h<p;h+=8){if(m>=e)return-1;g|=a[b+m++]<<24-h}t=p;p=g>>>32-t&~(-1<<t)|1<<t;g<<=t;h-=t}if(65536<=n+p)return-1;f=n-f&(u?65535:8191);do r[n++]=r[f++];
while(0!=--p)}}}while(1);c=n;k=x;l=n-x;return 0}var c=0,d="Uint8Array"in window?new Uint8Array(65536):Array(65536);d[0]=0;d.buffer||Ea(d,0,65536,0);var e=Array(8);Ea(e,0,8,0);var k=0,l=0,n=[6,6,6,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,9,8,9,9,9,9,8,8,9,9,9,9,9,9,8,9,9,10,9,9,9,9,9,9,9,10,9,10,10,10,9,9,10,9,10,9,10,9,9,9,10,10,9,10,9,9,8,9,9,9,9,10,10,10,9,9,10,10,10,10,10,10,9,9,10,10,10,10,10,10,10,9,10,10,10,10,10,10,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,10,10,10,10,10,10,9,10,10,10,10,10,
10,9,7,9,9,10,9,10,10,10,9,10,10,10,10,10,10,10,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,13,10,10,10,10,10,10,11,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,10,10,10,10,9,10,10,10,10,10,9,10,10,10,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,8,9,9,10,9,10,10,10,9,10,10,10,9,9,8,7,13,13,7,7,10,7,7,6,6,6,6,5,6,6,6,5,6,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,8,5,6,7,7],g=[123,65311,65293,65063,65024,65285,65303,65128,197,65031,
65299,65216,65288,65048,65307,65203,65027,162,65090,65296,65035,65026,65169,65305,65152,233,65082,65301,65042,87,65239,65309,65294,65077,65129,65314,65304,65146,65025,65315,65300,65268,65204,65033,65308,65220,65289,65120,65136,65298,65029,65170,65185,65306,65039,65287,65110,65302,65282,65240,65256,65310,65053,59,65535,65286,65535,65137,65161,65535,65535,65068,65067,65056,65535,65211,65231,65032,65535,65248,65037,65535,65177,65535,65028,65194,65097,65535,65047,65121,65247,65535,65279,65270,65100,65535,
65535,65159,65535,65316,65535,65084,65138,65535,65535,65230,65535,65278,65535,65059,65212,65034,65193,65535,65041,65535,65154,65535,65030,65178,65269,65535,65058,65101,65119,65535,65283,65249,65535,65226,65228,65535,65049,65535,65207,65535,65535,65155,65065,65535,65535,65535,65132,65535,65261,65535,65535,65094,65116,65045,65535,65243,65190,65535,65535,65092,65535,65036,65535,65173,65276,65535,65535,65208,5833,65535,65264,65535,65080,65535,65535,65133,65150,65535,65535,65535,65535,65115,65244,65535,
65535,65260,65095,65055,65535,65151,65174,65535,65535,65189,65535,65040,65088,65074,65215,65535,65535,65236,65265,65535,65535,65535,65141,65535,65535,65165,65073,65535,65125,65051,65535,65252,65275,65535,65535,65106,65535,65038,65535,65181,65199,65535,65535,65105,65235,65535,65312,65535,65071,65535,65535,65217,65164,65535,65535,65535,65087,65535,65535,65142,65535,65274,65107,65061,65535,65124,65253,65535,65535,65198,65535,65043,65535,65160,65182,65535,65091,65535,65535,65188,65171,65535,65535,65535,
65085,65535,65535,65259,65241,65535,65044,65114,65535,65064,65149,65535,65535,65130,65535,65535,65281,65222,65224,65535,65535,65205,65535,65535,65535,65172,65144,65535,65535,65535,65187,65535,65535,65242,65112,65535,65054,65093,65258,65535,65131,65535,65535,65079,65535,65535,65535,65148,65206,65535,65535,65272,65535,65535,65535,65223,65179,65535,65535,65535,65104,65535,65535,65197,65250,65535,65050,65123,65102,65535,65535,65273,65535,65139,65535,65535,65535,65072,65163,65535,65535,65213,65070,256,
65535,65262,65234,65535,65535,65535,65196,65535,65535,65180,65156,65535,65060,65103,65271,65535,65535,65251,65122,65535,65535,65535,65535,65162,65140,65535,65535,65086,65535,65535,65535,65233,65214,65535,65535,65069,65535,65098,65267,65535,65535,65245,65118,65046,65535,65096,65192,65535,65195,65175,65535,65535,65232,65535,65535,65229,65209,65535,65535,65535,65066,65535,65535,65158,65134,65535,65535,65535,65246,65535,65535,65117,65099,65057,65535,65263,65176,65535,65535,65153,65535,65535,65535,65191,
65535,65210,65277,65535,65535,65535,65227,65535,65535,65135,65081,65535,65535,65535,65157,65535,268,65254,65127,65052,65535,65108,65202,65535,65535,65183,65535,65535,65535,65113,65201,65535,65218,65535,65535,65078,65266,65535,65535,65238,65143,65535,65535,65535,65075,65535,65535,65167,65109,65062,266,65284,65255,65535,289,65126,65535,65535,65535,65200,65184,65535,271,65168,65535,65535,65237,65535,65535,65219,65076,65535,65535,65535,65166,65535,273,65145,65089,267],m=[511,0,508,448,494,347,486,482],
h=[4,2,3,4,3,4,4,5,4,5,5,6,6,7,7,8,7,8,8,9,9,8,9,9,9,9,9,9,9,9,9,9],p=[4065,4064,4066,4072,14,4069,4068,4074,4081,4067,21,4071,4079,70,4080,4077,4095,4087,4091,25,4093,4084,300,4075,4094,4086,4090,137,4092,4083,4088,4082],r=[0,4,10,19],A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,14,14,15],t=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,32769,49153,65537],z=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,
6,6,8,8,14,14],u=[2,3,4,5,6,7,8,9,10,12,14,16,18,22,26,30,34,42,50,58,66,82,98,114,130,194,258,514,2,2],x=new RdpBuffer(d,0,1);this.reset=function(){c=0;d=Array(65536);l=k=d[0]=0;x=new RdpBuffer(d,0,1)};this.getData=function(){x.setPosition(k);x.markEnd(k+l);return x};this.getDecompressedLength=function(){return l};this.dec=function(x,K,D,F){if(2==(F&15)){var f=d,C=c,Y=0,v=0,y=0,M=0,O=K,L=0,S=0,Q=0,N,T=0;l=0;k=C;0!=(F&64)&&(tb(f,C-32768,f,0,32768),k=c=C=32768);0!=(F&128)&&(C=0,Ea(f,0,65536,0),Ea(e,
0,e.length,0),k=0);if(32!=(F&32))tb(x,0,f,C,D),C+=D,l=C-c;else{N=0;for(K+=D;O<K&&!(T=x[O++]&255,Y|=T<<N,S+=8,N+=8,32<=N););Y=a(Y);O<K?(L=a(x[O++]&255)&255,Q=8):Q=0;for(;8<=S;){v=0;for(N=5;13>=N&&(12==N||(T=a(Y&4294967295<<32-N),y=g[T&511^T>>>9^T>>>4^T>>>7],0!=(y^T)>>>9?T=y&511:(y=void 0,y=(T>>>8^T&255)>>>2&15,0!=T>>>9&&(y=~y),y&=65535,T=g[m[y%12]]),N!=n[T]));N++);Y<<=N;S-=N;if(256>T)f[C++]=T&255;else if(256<T&&289>T){y=T-257;N=A[y];v=t[y]-1;0!=N&&(v+=a(Y&4294967295<<32-N));y=e;M=v;D=y[2]|y[3]<<16;
D<<=16;y[2]=D&65535;y[3]=D>>>16&65535;var W=y[0]|y[1]<<16;D|=W>>>16;y[2]=D&65535;y[3]=D>>>16&65535;W=W<<16|M;y[0]=W&65535;y[1]=W>>>16&65535;Y<<=N;S-=N}else if(288<T&&293>T)y=T-289,v=e[y],0!=y&&(N=e,M=N[0],N[0]=N[y],N[y]=M);else if(256==T)break;for(N=32-S;0<N;)if(Q<N)T=L>>>8-Q,Y|=T<<32-S-Q,S+=Q,N-=Q,O<K?(L=a(x[O++]&255)&255,Q=8):Q=N=0;else{Q>N?(Y|=L>>>8-N,L<<=N,L&=255,Q-=N,S=32):(Y|=L>>>8-N,S=32,O<K?(L=a(x[O++]&255)&255,Q=8):Q=0);break}if(0!=v){for(N=2;9>=N&&(T=a(Y&4294967295<<32-N),y=p[T&31^T>>>5^
T>>>9],0!=(y^T)>>>5?T=y&31:(y=void 0,y=T>>>4&15,T=p[r[(y^y>>>2^y>>>3)&3]]),N!=h[T]);N++);Y<<=N;S-=N;N=z[T];y=u[T];0!=N&&(y+=a(Y&4294967295<<32-N));Y<<=N;S-=N;M=C-v;N=y>v?v:y;for(T=0;0<N;)f[C++]=f[M++],N--;for(;y>v;)T=T>=v?0:T,f[C++]=f[M+T++],y--;for(N=32-S;0<N;)if(Q<N)T=L>>>8-Q,Y|=T<<32-S-Q,S+=Q,N-=Q,O<K?(L=a(x[O++]&255)&255,Q=8):Q=N=0;else{Q>N?(Y|=L>>>8-N,L<<=N,L&=255,Q-=N,S=32):(Y|=L>>>8-N,S=32,O<K?(L=a(x[O++]&255)&255,Q=8):Q=0);break}}}l=0!=(F&128)?C:C-c}c=C;return 0}return b(x,K,D,F)}},Nf=0<r.indexOf("nocurosr=on"),
la=0<r.indexOf("startProgram=app"),Xc=0<r.indexOf("mapDisk=on"),La=null;la&&(gb=this.reconnectOnResize=!1);hi5.browser.isTouch&&Math.max(W,da)>Math.max(window.innerWidth,window.innerHeight)&&(gb=this.reconnectOnResize=!1);this.isRemoteApp=function(){return la};ie();var y=null,ea=!1,nb=!1,sa=new function(a){var b=null;this.available=!1;this.delay=a;this.supportAudioData=this.supportWebAudio=!1;if(0==C.playSound||0<p.mode)(b=hi5.audio.getAudioContext())?this.supportWebAudio=this.available=!0:"AudioDataDestination"in
window&&(this.available=this.supportAudioData=!0);this.getBuffer=function(a){return b.createBuffer(2,a,bb)};var c=0,d=null;this.setVolume=function(a){1==a?d=null:(d||(d=b.createGain()),d.gain.value=a)};this.playBuffer=function(e){var k=b.createBufferSource();k.buffer=e;d?(k.connect(d),d.connect(b.destination)):k.connect(b.destination);var l=b.currentTime,n=0<c?c:l+a;n<l&&(n=l);c=n+e.duration;k.start?k.start(n):k.noteOn(n);return c-l};this.iOSFix=function(){if(b&&hi5.browser.isTouch&&hi5.browser.isSafari){var a=
this.getBuffer(1024),c=b.createBufferSource();c.buffer=a;c.connect(b.destination);c.start?c.start(0):c.noteOn(0)}};this.close=function(){b=null}}(p.audioBuffer),F=new ge(W,da);this.setVolume=function(a){sa&&sa.setVolume(a)};this.setAudioBuffer=function(a){p.audioBuffer=a;sa.delay=a;kb&&(kb.delay=a)};for(var kb=null,id=Array(12),Wa=0;12>Wa;Wa++)id[Wa]=Array(256);var Cc=Array(256),ra=0,qa=0,ia=W-1,ja=da-1,Xa=null,Dc=null,Nd=0;window.$rdp=this;var Ma=null,Eb=je,hd=ke;yc(Xb);this.running=function(){return ea};
var Kb=new function(){function a(){p.sendPing(null);b=setTimeout(a,c)}var b=0,c=C.pingInterval||0;0<c&&(c*=1E3);this.setInterval=function(a){c=1E3*a};this.getInterval=function(){return c};this.processPong=function(a){if(p.onpong)p.onpong(a)};this.sendPing=function(){0<c&&(b&&clearTimeout(b),b=setTimeout(a,c))}};this.setJoinMode=function(a){ea&&y.send("8E1"+a)};this.setJoinCloseMode=function(a){ea&&y.send("8EB3\t"+a)};this.refuseControl=function(a){ea&&y.send("8E3"+a)};this.giveControl=function(a){ea&&
y.send("8E4"+a)};this.pauseSession=function(a,b){ea&&y.send("8EB"+(b?1:0)+"\t"+a)};this.closeSession=function(a){ea&&y.send("8EB2\t"+a)};this.requestControl=function(){ea&&y.send("8E2")};this.saveSession=function(a){ea&&y.send("8E9"+(a.save?1:0)+"\t"+(a.timeout||0)+"\t"+(a.id||0))};this.allowJoin=function(a,b){ea&&y.send("8EA"+a+"\t"+(b?1:0))};var ce=new function(){function a(){if(c&&0<c.length){var b=c.shift();ce.sendSingleKey(b.down,b.key);0<c.length?setTimeout(a,d):c=null}}var b={" ":57,space:57,
pageup:201,pagedown:209,end:207,home:199,left:203,up:200,right:205,down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.sendSingleKey=function(a,c){var d=b[c.toLowerCase()];d?p.writeScancode(a,d):(d=c.length,0!=d&&(1==d?p.writeKeyCode(a,c.toUpperCase().charCodeAt(0)):
a&&p.writeText(c)))};var c=null,d=0;this.sendKeyComb=function(b,k){if(Fa){var l=b.split("+"),n=l.length,g=0;if(0!=n){for(var m=null,h=[],g=0;g<n;g++){var p=l[g];""==p&&""==m&&(p="Add");""!=p&&h.push({key:p,down:!0});m=p}n=h.length;for(g=n-1;0<=g;g--)h.push({key:h[g].key,down:!1});if(k)c=h,d=k,a();else for(g=0,n=h.length;g<n;g++)ce.sendSingleKey(h[g].down,h[g].key)}}}};this.writeKeyComb=function(a,b){Fa&&ce.sendKeyComb(a,b)};var te=new function(){this.ws=null;this.setJoinMode=p.setJoinMode;this.requestControl=
p.requestControl;this.writeKeyComb=p.writeKeyComb;this.getAppMode=function(){return p.mode};this.send=function(a){ea&&(y.send(a),Kb.sendPing())};this.saveSession=function(a){p.saveSession(a)};this.sendInput=function(a){if(Fa&&!F.isPaused()){var c=a.substring(0,2),d=a.substring(2);if(Ma&&("80"==c||"81"==c||"82"==c||"83"==c)){var d=d.split("\t"),e=new Uint8Array(7),k=0,l=0,n=0,l=parseInt(d[0]),n=parseInt(d[1]);switch(parseInt(c,16)){case 128:k=("0"==d[2]?4096:8192)|32768;break;case 129:k="0"==d[2]?
4096:8192;break;case 130:k=2048;break;case 131:k="0"==d[2]?33408:33664}e[0]=32;e[1]=k&255;e[2]=k>>8;e[3]=l&255;e[4]=l>>8;e[5]=n&255;e[6]=n>>8;Ma.add(new RecordingObj(e,0,7,60))}y.send(a);Kb.sendPing();if(p.onactivity)p.onactivity(a)}};var a=null;this.getAppInfo=function(){return p.sessionInfo.appInfo};this.onresize=function(b){if(b=b.target.svSurface){var c=b.getFreeSpace(),d=c.width,e=c.height;la?((b=b.railWin)&&(b=b.getMain(v.zOrders)),b&&b.resize(0,0,d,e)):p.reconnectOnResize&&ea&&(a&&(clearTimeout(a),
a=0),a=setTimeout(function(){svGlobal.logger.warn("w:"+d+" ww:"+W+" h:"+e+" hh:"+da);p.reconnect(d,e,O.forceReconnect)},700))}};this.onorientationchange=function(a){var c=ee(a.innerHeight);if(p.reconnectOnResize)p.reconnect(a.innerWidth,c);else if(la&&a.svSurface){var d=a.svSurface.railWin;d&&(d=d.getMain(v.zOrders));d&&d.resize(0,0,a.innerWidth,c)}};this.getClipData=sf;this.onfocus=function(a){var c=a.target;la&&c.svSurface&&c.svSurface.railWin&&(a=c.svSurface.railWin.getTopWin(v.zOrders))&&y&&(c=
c.svSurface.context)&&c!=F.getContext()&&(F.setContext(null),a.activate(1),svGlobal.logger.info("Activate win:"+a.id))};this.getShareFiles=function(a,c){nb&&La&&La.list(a,c)};this.getFile=function(a){p.reconnectOnResize=!1;window.open(p.getFileUrl(a))};this.getFileLink=function(a){return p.modifyURL(cb()+"/DOWNLOAD?s="+Dc+"&f="+a)};this.getGateway=function(){return r};this.reconnect=function(a,c,d){r=hi5.tool.replaceQuery(r,"user",a);r=hi5.tool.replaceQuery(r,"pwd",c);r=hi5.tool.replaceQuery(r,"domain",
d);"sessionStorage"in window&&sessionStorage.clear();window.$rdp=this;a=v.getFocused();v.removeElm(a);p.addSurface(a);p.run()};this.sendKeyboardSynchronize=le},v=function(){var a=[];a.addSurface=function(b){a.push(b)};a.hasSurface=function(b){for(var c=a.length,d=0;d<c;d++)if(a[d].equals(b))return!0;return!1};a.setSize=function(b,c,d){for(var e=0,k=a.length;e<k;e++)a[e].setSize(b,c,d)};a.zOrders=[];a.drawLicense=function(b){for(var c=0,d=a.length;c<d;c++)a[c].drawLicense(b)};a.setReadOnly=function(b){for(var c=
0,d=a.length;c<d;c++)a[c].setReadOnly(b)};a.setVisible=function(a,c){svGlobal.logger.info("TODO: setVisible")};a.copyToClip=function(b){1>a.length||a[0].copyToClip(b)};a.setCursor=function(b){!la&&a[0]&&a[0].setCursor(b);var c=a.getFocused();c&&c.setCursor(b)};a.hide=function(b){if(la){b=0;for(var c=a.length;b<c;b++)a[b].getWindow().close()}else a[0].hide()};a.execute=function(b,c){for(var d=0,e=a.length;d<e;d++)a[d][b].apply(a[d],c)};a.addWin=function(b){var c=a.getFocused();c||(svGlobal.logger.warn("Focused surface not found!"),
c=a[a.length-1]);c?(la=!0,c.railWin||(c.railWin=new tf,c.onunload=function(){O.closeRemoteApp&&c.railWin&&c.railWin.close();c.remoteApp&&c.remoteApp.close();c.railWin&&(c.railWin.clear(),c.railWin=null);a.removeElm(c)}),c.context&&F.setContext(c.context),c.railWin.addWin(b),hi5.browser.isIE&&c.focus()):svGlobal.logger.warn("No surface available!")};a.delWin=function(b){for(var c,d=a.length-1;0<=d;d--){var e=a[d];c=e.railWin;var k=c.getWinById(b),l=k&&k.appId&&-1!=k.appId.toLowerCase().indexOf("runonce");
if(0<=c.delWin(b)&&!c.hasApp(k.appId)){k=p.appTimeout;if(l||c.isNew())k*=10;svGlobal.logger.debug("Prepare del:"+(new Date).getTime());setTimeout(function(b){return function(){svGlobal.logger.debug("Start del:"+(new Date).getTime());b.railWin&&b.railWin.isRunning()||(b.remoteApp&&b.remoteApp.close(),a.delSurface(b))}}(e),k)}}};a.popWins=function(b){return a[0]&&a[0].railWin?a[0].railWin.popWins(b):[]};a.getWinById=function(b){for(var c,d=0,e=a.length;d<e;d++)if(a[d].railWin&&(c=a[d].railWin.getWinById(b)))return c;
return null};a.setTitle=function(b){for(var c,d=0,e=a.length;d<e;d++)if(a[d].railWin&&(c=a[d].railWin.getWinById(b))&&c.titleInfo&&c.isVisible()){Vc(c.titleInfo+" - "+(C.displayName||p.server),a[d].getWindow());break}};a.hasApp=function(b){for(var c=0,d=a.length;c<d;c++)if(a[c].railWin.hasApp(b))return!0;return!1};a.delSurface=function(b){b.railWin.isRunning()||(svGlobal.logger.info("delete surface..."),a.removeElm(b),b.close(),0==a.length&&ed())};a.getOwnerSurface=function(b){for(var c=0,d=a.length;c<
d;c++)if(a[c].railWin&&a[c].railWin.hasWin(b))return a[c];return null};a.getFocused=function(){if(!la)return a[0];for(var b=a.length,c=0;c<b;c++)if(a[c].focused)return a[c];return a[b-1]};a.close=function(){for(var b=0,c=a.length;b<c;b++)a[b]&&(a[b].remoteApp&&a[b].remoteApp.close(),a[b].close())};return a}();this.getSurfaces=function(){return v};this.hide=function(){v&&v.hide()};var ta={count:0,names:[],close:function(){for(var a=ta.names,b=0,c=a.length;b<c;b++)ta[a[b]].close&&ta[a[b]].close()},
init:function(a,b,c){ta.count=0;ta.names.length=0;var d=new p.DynamicChannel;d.name="ECHO";d.process=function(a){var b=a.getPositon(),c=a.getEnd(),e=new Uint8Array(c-b);e.set(a.getData().subarray(b,c));d.send(e)};p.addDynamicChannel(d);if(a){var e=new p.DynamicChannel;e.name="Microsoft::Windows::RDS::Input";e.process=function(a){var b=a.getLittleEndian16();a.getLittleEndian32();switch(b){case 1:a.skipPosition(4),a=new RdpBuffer(new Uint8Array(16),0,16),a.setLittleEndian16(2),a.setLittleEndian32(16),
a.setLittleEndian32(3),a.setLittleEndian32(65536),a.setLittleEndian16(256),a.markEnd(),e.send(a);case 5:v.execute("setTouchRemoting",[!0]);ta.isTouchReady=!0;console.log("Touch remoting start");break;case 4:v.execute("setTouchRemoting",[!1]),ta.isTouchReady=!1,console.log("Touch remoting suspend")}};p.addDynamicChannel(e)}if(c){svGlobal.logger.warn("Audio input on");var k=new p.DynamicChannel;(function(){function a(b){var c=new RdpBuffer(new Uint8Array(5),0,5);c.setByte(7);c.setLittleEndian32(b);
c.markEnd();k.send(c)}function b(d){d.getLittleEndian32();var m=d.getLittleEndian32();(new c).fromBuffer(d);y=!0;A=p.reconnectOnResize;p.reconnectOnResize=!1;u.start();u.onopen||(u.onopen=function(b){e=b;p.reconnectOnResize=A;a(m);var c=new RdpBuffer(new Uint8Array(5),0,5);c.setByte(4);c.setLittleEndian32(b?0:1);c.markEnd();k.send(c)});u.ondata||(u.ondata=function(a,b){e&&(t.length!=b+1&&(t=new Uint8Array(b+1),t[0]=6),k.send(r),t.set(a,1),k.send(t))})}function c(){this.WAVE_FORMAT_PCM=1;this.WAVE_FORMAT_ADPCM=
2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=85;this.WAVE_FORMAT_AAC=41222;this.bitsPerSample=this.nBlockAlign=this.nAvgBytesPerSec=this.nSamplesPerSec=this.nChannels=this.formatTag=0;this.hasLocalSupport=!1;this.cbSize=0;this.extenstion=null;var a=this;this.fromBuffer=function(b){a.formatTag=b.getLittleEndian16();a.nChannels=b.getLittleEndian16();a.nSamplesPerSec=b.getLittleEndian32();a.nAvgBytesPerSec=b.getLittleEndian32();a.nBlockAlign=
b.getLittleEndian16();a.bitsPerSample=b.getLittleEndian16();var c=b.getLittleEndian16();a.cbSize=c;0<c&&(a.extenstion=Array(c),b.copyToByteArray(a.extenstion,0,b.getPosition(),c),b.skipPosition(c))};this.toBuffer=function(b){b.setLittleEndian16(a.formatTag);b.setLittleEndian16(a.nChannels);b.setLittleEndian32(a.nSamplesPerSec);b.setLittleEndian32(a.nAvgBytesPerSec);b.setLittleEndian16(a.nBlockAlign);b.setLittleEndian16(a.bitsPerSample);b.setLittleEndian16(a.cbSize);0<a.cbSize&&b.setBytes(a.extenstion)};
this.getSize=function(){return 18+a.cbSize};this.toString=function(){return"Audio Format, tag="+a.formatTag+" nChannels="+a.nChannels+" nSamplesPerSec="+a.nSamplesPerSec+" nAvgBytesPerSec"+a.nAvgBytesPerSec+" nBlockAlign"+a.nBlockAlign+" bitsPerSample"+a.bitsPerSample+" cbSize="+a.cbSize}}function d(){function a(b,c){return-32768==b&&-32768==c?32767:b*c>>15<<16>>16}function b(a,c){if(-32768==a&&-32768==c)return 32767;var d;d=a*c+16384>>15;return d<<16>>16}function c(a,b){var d=0;if(0>=a){if(0<=b)return a+
b;d=-(a+1)-(b+1);return 2147483647<=d?-2147483648:-d-2}if(0>=b)return a+b;d=a+b;return 2147483647<d?2147483647:d}function e(a){if(0>a){if(-1073741824>=a)return 0;a=~a}return(0!=(a&4294901760)?0!=(a&4278190080)?-1+L[255&a>>24]:7+L[255&a>>16]:0!=(a&65280)?15+L[255&a>>8]:23+L[255&a])<<16>>16}function g(a,b){return 16<=b?0>a?-1:-0:-16>=b?0:0>b?a<<-b<<16>>16:a>>b<<16>>16}function f(a,b,c,d,e){for(var f=0;f<e;f++)c[d+f]=a[b+f]}function k(b,c,d,e,f,h){var g=0,g=a(b<<16>>16,f[h]);b=g+(c<<16>>16);b=(-32768>
b?-32768:32767<b?32767:b)+256;g=(-32768>b?-32768:32767<b?32767:b)>>9<<16>>16;f[h]=(g>d?d-e:g<e?0:g-e)<<16>>16}function h(a,b){var c;c=la[a+3*b]>>2<<16>>16;return c*c}function l(a,c,d,e,f,h,g){a=a[d]+h;f=((-32768>a?-32768:32767<a?32767:a)<<26>>16)-(f<<17>>16);e=b(g,-32768>f?-32768:32767<f?32767:f);g=e+e;c[d]=-32768>g?-32768:32767<g?32767:g}function m(a){for(var b=0,c=0,d=0;8>d;d++)0>a[d]?(b=(-32768==a[d]?32767:-a[d])<<16>>16,c=(b>>2<<16>>16)+26112,a[d]=-(11059>b?b<<1:20070>b?b+11059:-32768>c?-32768:
32767<c?32767:c)<<16>>16):(b=a[d],c=(b>>2<<16>>16)+26112,a[d]=(11059>b?b<<1:20070>b?b+11059:-32768>c?-32768:32767<c?32767:c)<<16>>16)}function n(a,c,d,e,f){for(var h=a.u,g=0,k=0,l=0,m=0,p=0,w=0,g=m=0;0!=d;){d--;g=m=e[f];for(w=0;8>w;w++)l=h[w],p=c[w],h[w]=m,k=b(p,g),m=l+k,m=-32768>m?-32768:32767<m?32767:m,k=b(p,l),g+=k,g=-32768>g?-32768:32767<g?32767:g;e[f++]=g}a.u=h}var p=[6554,16384,26214,32767],t=[29128,26215,23832,21846,20165,18725,17476,16384],r=[18431,20479,22527,24575,26623,28671,30719,32767],
u=new function(){this.dp0=new Int16Array(280);this.mp=this.l_z2=this.z1=0;this.u=new Int16Array(8);this.larpp=[new Int16Array(8),new Int16Array(8)];this.j=0;this.nrp=40;this.v=new Int16Array(9);this.msr=0},w=new Int16Array(8),A=new Int16Array(4),z=new Int16Array(4),y=new Int16Array(4),C=new Int16Array(4),B=new Int16Array(52),F=new Int16Array(160),v=new Uint8Array(33),M=0;this.encode=function(d,L,zd,qa){for(var ra=L,oa=0,sa=0;160>sa;sa++)oa=d[ra++],F[sa]=0>oa?32768*oa:32767*oa;O=!O;for(var H=0,ta=
0,Da=0,Ja=0,wa=120,Ea=new Int16Array(50),J=new Int16Array(160),Oa=0,Sa=0,Ma=u.z1,Fa=u.l_z2,La=u.mp,Va=0,Ga=0,Wa=0,Ta=0,Ka=0,Ra=0,bb=160;0!=bb;){bb--;var Ta=F[Oa++]>>3<<2<<16>>16,Va=Ta-Ma<<16>>16,Ma=Ta,Ka=Va,Ka=Ka<<15,Ga=Fa>>15<<16>>16,Wa=Fa-(Ga<<15)<<16>>16,Ka=Ka+b(Wa,32735),Ra=32735*Ga,Fa=c(Ra,Ka),Ra=c(Fa,16384),Ga=b(La,-28180),La=Ra>>15<<16>>16,Xa=La+Ga;J[Sa++]=-32768>Xa?-32768:32767<Xa?32767:Xa}u.z1=Ma;u.l_z2=Fa;u.mp=La;for(var Pa=0,U=0,db=0,fb=0,cb=0,ca=0,Ya=0,ca=0;159>=ca;ca++)Ya=J[ca]+0,db=
-32768>Ya?-32768:32767<Ya?32767:Ya,db>fb&&(fb=db);cb=0==fb?0:4-e(fb<<16)<<16>>16;if(0<cb)switch(cb){case 1:for(ca=0;159>=ca;ca++)J[ca]=b(J[ca],16384);break;case 2:for(ca=0;159>=ca;ca++)J[ca]=b(J[ca],8192);break;case 3:for(ca=0;159>=ca;ca++)J[ca]=b(J[ca],4096);break;case 4:for(ca=0;159>=ca;ca++)J[ca]=b(J[ca],2048)}var R=J[U];f([0,0,0,0,0,0,0,0,0],0,E,0,E.length);E[0]+=R*J[U-0];R=J[++U];E[0]+=R*J[U-0];E[1]+=R*J[U-1];R=J[++U];E[0]+=R*J[U-0];E[1]+=R*J[U-1];E[2]+=R*J[U-2];R=J[++U];E[0]+=R*J[U-0];E[1]+=
R*J[U-1];E[2]+=R*J[U-2];E[3]+=R*J[U-3];R=J[++U];E[0]+=R*J[U-0];E[1]+=R*J[U-1];E[2]+=R*J[U-2];E[3]+=R*J[U-3];E[4]+=R*J[U-4];R=J[++U];E[0]+=R*J[U-0];E[1]+=R*J[U-1];E[2]+=R*J[U-2];E[3]+=R*J[U-3];E[4]+=R*J[U-4];E[5]+=R*J[U-5];R=J[++U];E[0]+=R*J[U-0];E[1]+=R*J[U-1];E[2]+=R*J[U-2];E[3]+=R*J[U-3];E[4]+=R*J[U-4];E[5]+=R*J[U-5];E[6]+=R*J[U-6];R=J[++U];E[0]+=R*J[U-0];E[1]+=R*J[U-1];E[2]+=R*J[U-2];E[3]+=R*J[U-3];E[4]+=R*J[U-4];E[5]+=R*J[U-5];E[6]+=R*J[U-6];E[7]+=R*J[U-7];++U;for(Pa=U;160>Pa;++Pa)R=J[Pa],E[0]+=
R*J[Pa-0],E[1]+=R*J[Pa-1],E[2]+=R*J[Pa-2],E[3]+=R*J[Pa-3],E[4]+=R*J[Pa-4],E[5]+=R*J[Pa-5],E[6]+=R*J[Pa-6],E[7]+=R*J[Pa-7],E[8]+=R*J[Pa-8];for(ca=0;9>ca;ca++)E[ca]<<=1;if(0<cb)for(ca=0;160>ca;ca++)J[ca]<<=cb;var Qa=new Int16Array(1),vb=0,ma=0,nb=new Int16Array(9),lb=new Int16Array(9),kb=new Int16Array(9);if(0==E[0])for(ma=0;8>ma;ma++)w[ma]=0;else{Qa[0]=e(E[0]);for(ma=0;8>=ma;ma++)nb[ma]=E[ma]<<Qa[0]>>16;f(nb,0,kb,0,7);f(nb,0,lb,0,8);for(var gb=1;8>=gb;gb++,vb++){Qa[0]=lb[1];Qa[0]=(0>Qa[0]?-32768==
Qa[0]?32767:-Qa[0]:Qa[0])<<16>>16;if(lb[0]<Qa[0]){for(ma=gb;8>ma;ma++)w[ma]=0;break}var Ib=vb,tb;var Eb=Qa[0],ob=Eb,Kb=lb[0],ub=0,Lb=15;if(0==Eb)tb=0;else{for(;0!=Lb;)Lb--,ub=ub<<17>>16,ob<<=1,ob>=Kb&&(ob-=Kb,ub++);tb=ub<<16>>16}w[Ib]=tb;0<lb[1]&&(w[vb]=-w[vb]);if(8==gb)break;Qa[0]=b(lb[1],w[vb]);var wb=lb[0]+Qa[0];lb[0]=-32768>wb?-32768:32767<wb?32767:wb;for(var ga=1;ga<=8-gb;ga++){Qa[0]=b(kb[ga],w[vb]);var Gb=lb[ga+1]+Qa[0];lb[ga]=-32768>Gb?-32768:32767<Gb?32767:Gb;Qa[0]=b(lb[ga+1],w[vb]);var pc=
kb[ga]+Qa[0];kb[ga]=-32768>pc?-32768:32767<pc?32767:pc}}}for(var va,pb=0;8>pb;pb++)va=w[pb],va=(0>va?-32768==va?32767:-va:va)<<16>>16,22118>va?va>>=1:31130>va?va-=11059:(va-=26112,va<<=2),w[pb]=0>w[pb]?-va:va;var mb=0;k(20480,0,31,-32,w,mb++);k(20480,0,31,-32,w,mb++);k(20480,2048,15,-16,w,mb++);k(20480,-2560,15,-16,w,mb++);k(13964,94,7,-8,w,mb++);k(15360,-1792,7,-8,w,mb++);k(8534,-341,3,-4,w,mb++);k(9036,-1144,3,-4,w,mb++);var Ha=new Int16Array(8),Xb=u.j,Lc=Xb,Lc=Lc^1;u.j=Lc;var hb=u.larpp[Xb],Fb=
u.larpp[Lc],xb=0;l(w,hb,xb++,0,0,-32,13107);l(w,hb,xb++,0,0,-32,13107);l(w,hb,xb++,0,2048,-16,13107);l(w,hb,xb++,0,-2560,-16,13107);l(w,hb,xb++,0,94,-8,19223);l(w,hb,xb++,0,-1792,-8,17476);l(w,hb,xb++,0,-341,-4,31454);l(w,hb,xb++,0,-1144,-4,29708);for(var yb=0;8>yb;yb++){var Mb=(Fb[yb]>>2<<16>>16)+(hb[yb]>>2<<16>>16);Ha[yb]=-32768>Mb?-32768:32767<Mb?32767:Mb;var $b=Ha[yb]+(Fb[yb]>>1<<16>>16);Ha[yb]=-32768>$b?-32768:32767<$b?32767:$b}m(Ha);n(u,Ha,13,J,0);for(var Na=0;8>Na;Na++){var qc=(Fb[Na]>>1<<
16>>16)+(hb[Na]>>1<<16>>16);Ha[Na]=-32768>qc?-32768:32767<qc?32767:qc}m(Ha);n(u,Ha,14,J,13);for(var ac=0;8>ac;ac++){var Nb=(Fb[ac]>>2<<16>>16)+(hb[ac]>>2<<16>>16);Ha[ac]=-32768>Nb?-32768:32767<Nb?32767:Nb;var Ob=Ha[ac]+(hb[ac]>>1<<16>>16);Ha[ac]=-32768>Ob?-32768:32767<Ob?32767:Ob}m(Ha);n(u,Ha,13,J,27);for(var Mc=0;8>Mc;Mc++)Ha[Mc]=hb[Mc];m(Ha);n(u,Ha,120,J,40);for(var sb=u.dp0,zb=0,Hb=0,Vb=0;3>=Vb;Vb++,ta+=13){for(var ic=J,bc=40*Vb,yc=Ea,jc=sb,Dc=sb,kc=wa,lc=A,ya=y,fa=Da++,za=ic,mc=bc,aa=jc,V=kc,
Yb=ya,Fc=lc,Nc=fa,X=0,bd=0,Z=new Int16Array(40),Ab=0,Aa=0,qb=0,cc=0,Ua=0,Zb=0,Za=0,$a=0;39>=$a;$a++)Za=za[$a+mc],Za=(0>Za?-32768==Za?32767:-Za:Za)<<16>>16,Za>Ua&&(Ua=Za);Za=0;0!=Ua&&(Za=e(Ua<<16));Zb=6<Za?0:6-Za<<16>>16;for($a=0;39>=$a;$a++)Z[$a]=za[$a+mc]>>Zb;Ab=0;for(X=bd=40;120>=X;X++){var I=0,G=1,I=Z[0]*aa[V-X],I=I+Z[1]*aa[G+V-X];G++;I+=Z[2]*aa[G+V-X];G++;I+=Z[3]*aa[G+V-X];G++;I+=Z[4]*aa[G+V-X];G++;I+=Z[5]*aa[G+V-X];G++;I+=Z[6]*aa[G+V-X];G++;I+=Z[7]*aa[G+V-X];G++;I+=Z[8]*aa[G+V-X];G++;I+=Z[9]*
aa[G+V-X];G++;I+=Z[10]*aa[G+V-X];G++;I+=Z[11]*aa[G+V-X];G++;I+=Z[12]*aa[G+V-X];G++;I+=Z[13]*aa[G+V-X];G++;I+=Z[14]*aa[G+V-X];G++;I+=Z[15]*aa[G+V-X];G++;I+=Z[16]*aa[G+V-X];G++;I+=Z[17]*aa[G+V-X];G++;I+=Z[18]*aa[G+V-X];G++;I+=Z[19]*aa[G+V-X];G++;I+=Z[20]*aa[G+V-X];G++;I+=Z[21]*aa[G+V-X];G++;I+=Z[22]*aa[G+V-X];G++;I+=Z[23]*aa[G+V-X];G++;I+=Z[24]*aa[G+V-X];G++;I+=Z[25]*aa[G+V-X];G++;I+=Z[26]*aa[G+V-X];G++;I+=Z[27]*aa[G+V-X];G++;I+=Z[28]*aa[G+V-X];G++;I+=Z[29]*aa[G+V-X];G++;I+=Z[30]*aa[G+V-X];G++;I+=Z[31]*
aa[G+V-X];G++;I+=Z[32]*aa[G+V-X];G++;I+=Z[33]*aa[G+V-X];G++;I+=Z[34]*aa[G+V-X];G++;I+=Z[35]*aa[G+V-X];G++;I+=Z[36]*aa[G+V-X];G++;I+=Z[37]*aa[G+V-X];G++;I+=Z[38]*aa[G+V-X];G++;I+=Z[39]*aa[G+V-X];I>Ab&&(bd=X<<16>>16,Ab=I)}Fc[Nc]=bd;Ab<<=1;Ab>>=6-Zb;for($a=Aa=0;39>=$a;$a++)var Pb=0,Pb=aa[$a-bd+V]>>3<<16>>16,Aa=Aa+Pb*Pb;Aa<<=1;if(0>=Ab)Yb[Nc]=0;else if(Ab>=Aa)Yb[Nc]=3;else for(var Za=e(Aa),qb=Ab<<Za>>16<<16>>16,cc=Aa<<Za>>16<<16>>16,Ia=0;2>=Ia&&!(qb<=a(cc,p[Ia]));Ia++)Yb[Nc]=Ia;var Ub=lc[fa],na=jc,Oc=
ic,Wb=bc,rc=Dc,cd=yc,Bb=kc,dc=0,ha=0,ab=0;switch(ya[fa]){case 0:dc=3277;for(ha=0;39>=ha;ha++)rc[ha+Bb]=b(dc,na[ha-Ub+Bb]),ab=Oc[ha+Wb]-rc[ha+Bb],cd[ha+5]=-32768>ab?-32768:32767<ab?32767:ab;break;case 1:dc=11469;for(ha=0;39>=ha;ha++)rc[ha+Bb]=b(dc,na[ha-Ub+Bb]),ab=Oc[ha+Wb]-rc[ha+Bb],cd[ha+5]=-32768>ab?-32768:32767<ab?32767:ab;break;case 2:dc=21299;for(ha=0;39>=ha;ha++)rc[ha+Bb]=b(dc,na[ha-Ub+Bb]),ab=Oc[ha+Wb]-rc[ha+Bb],cd[ha+5]=-32768>ab?-32768:32767<ab?32767:ab;break;case 3:for(dc=32767,ha=0;39>=
ha;ha++)rc[ha+Bb]=b(dc,na[ha-Ub+Bb]),ab=Oc[ha+Wb]-rc[ha+Bb],cd[ha+5]=-32768>ab?-32768:32767<ab?32767:ab}for(var xc=Ea,sc=C,zc=z,Cb=Ja++,Ac=B,Bc=ta,Qb=new Int16Array(13),Cc=new Int16Array(13),Ba=xc,tc=0,ib=0;39>=ib;ib++)tc=4096,tc+=-134*Ba[ib+0]+-374*Ba[ib+1]+2054*Ba[ib+3]+5741*Ba[ib+4]+8192*Ba[ib+5]+5741*Ba[ib+6]+2054*Ba[ib+7]+-374*Ba[ib+9]+-134*Ba[ib+10],tc=tc>>13<<16>>16,la[ib]=-32768>tc?-32768:32767<tc?32767:tc;var Wc=Qb,Xc=zc,Zc=Cb,ua=0,uc=0,vc=0,Db=void 0,ua=0,Db=ua+=h(0,1)+h(0,2)+h(0,3)+h(0,
4)+h(0,5)+h(0,6)+h(0,7)+h(0,8)+h(0,9)+h(0,10)+h(0,11)+h(0,12),ua=ua+h(0,0),uc=ua<<=1,ua=0,ua=ua+(h(1,0)+h(1,1)+h(1,2)+h(1,3)+h(1,4)+h(1,5)+h(1,6)+h(1,7)+h(1,8)+h(1,9)+h(1,10)+h(1,11)+h(1,12)),ua=ua<<1;ua>uc&&(vc=1,uc=ua);ua=0;ua+=h(2,0)+h(2,1)+h(2,2)+h(2,3)+h(2,4)+h(2,5)+h(2,6)+h(2,7)+h(2,8)+h(2,9)+h(2,10)+h(2,11)+h(2,12);ua<<=1;ua>uc&&(vc=2,uc=ua);ua=Db;ua+=h(3,12);ua<<=1;ua>uc&&(vc=3);for(var nd=0;12>=nd;nd++)Wc[nd]=la[vc+3*nd];Xc[Zc]=vc;for(var Gc=Qb,od=Ac,ed=Bc,Rb=sc,fd=Cb,Pc=0,Qc=0,pd=0,Ca=0,
Uc=0,Vc=0,Rc=0,qd=0,rb=0,rb=0;12>=rb;rb++)Ca=Gc[rb],Ca=0>Ca?-32768==Ca?32767:-Ca:Ca,Ca>Qc&&(Qc=Ca);Rc=0;Ca=Qc>>9<<16>>16;for(rb=Pc=0;5>=rb;rb++)Pc=0>=Ca?Pc|1:Pc|0,Ca=Ca>>1<<16>>16,0==Pc&&Rc++;var Ca=Rc+5<<16>>16,rd=(Qc>>Ca<<16>>16)+(Rc<<3<<16>>16),pd=-32768>rd?-32768:32767<rd?32767:rd,ec=0,xa=0;15<pd&&(ec=(pd>>3<<16>>16)-1<<16>>16);xa=pd-(ec<<3)<<16>>16;if(0==xa)ec=-4,xa=7;else{for(;7>=xa;)xa=(xa<<1|1)<<16>>16,ec--;xa-=8}ea==ea?(W=ec,da=xa):(ia=ec,ja=xa);Rc=W;qd=da;Uc=6-Rc<<16>>16;Vc=t[qd];for(rb=
0;12>=rb;rb++)Ca=Gc[rb]<<Uc<<16>>16,Ca=a(Ca,Vc),Ca=Ca>>12<<16>>16,od[rb+ed]=Ca+4<<16>>16;da=qd;W=Rc;Rb[fd]=pd;var gd=Ac,hd=Cc,id=Bc,Sb=0,wd=0,Ec=0,Yc=0,fc=0,wc=0;ea==ea?(wd=r[da],fc=6-W<<16>>16):(wd=r[ja],fc=6-ia<<16>>16);for(var Ec=-32768>fc?-32768:32767<fc?32767:fc,fc=Ec-1,dd=-32768>fc?-32768:32767<fc?32767:fc,Yc=16<=dd?0:-16>=dd?-0:0>dd?g(1,-dd):1<<dd<<16>>16,gc=ka=0;13>gc;gc++)Sb=(gd[id++]<<1)-7<<16>>16,Sb=Sb<<28>>16,Sb=b(wd,Sb),wc=Sb+Yc,Sb=-32768>wc?-32768:32767<wc?32767:wc,hd[ka++]=g(Sb,Ec);
var xd=Cc,jb=xc,$c=ea,hc=13,sd=0,eb=0,eb=$c==ea?5:0;switch(zc[Cb]){case 3:jb[eb++]=0;do jb[eb++]=0,jb[eb++]=0,jb[eb++]=xd[sd++],--hc;while(0!=hc);break;case 2:do jb[eb++]=0,jb[eb++]=0,jb[eb++]=xd[sd++],--hc;while(0!=hc);break;case 1:do jb[eb++]=0,jb[eb++]=xd[sd++],jb[eb++]=0,--hc;while(0!=hc);break;case 0:do jb[eb++]=xd[sd++],jb[eb++]=0,jb[eb++]=0,--hc;while(0!=hc)}$c==ea&&(jb[eb++]=0);for(zb=0;39>=zb;zb++)Hb=Ea[5+zb]+sb[zb+wa],sb[zb+wa]=-32768>Hb?-32768:32767<Hb?32767:Hb;wa+=40}for(zb=0;120>zb;zb++)sb[zb]=
sb[160+zb];var q=0;O?(q=w[0]<<4|w[1]<<10,v[H++]=q>>4,q=q>>5|w[2]<<11,v[H++]=q>>7,q=q>>5|w[3]<<11,q=q>>4|w[4]<<12,v[H++]=q>>6,q=q>>4|w[5]<<12,q=q>>3|w[6]<<13,v[H++]=q>>7,q=q>>3|w[7]<<13,q=q>>7|A[0]<<9,v[H++]=q>>5,q=q>>2|y[0]<<14,q=q>>2|z[0]<<14,q=q>>6|C[0]<<10,v[H++]=q>>3,q=q>>3|B[0]<<13,v[H++]=q>>8,q=q>>3|B[1]<<13,q=q>>3|B[2]<<13,q=q>>3|B[3]<<13,v[H++]=q>>7,q=q>>3|B[4]<<13,q=q>>3|B[5]<<13,q=q>>3|B[6]<<13,v[H++]=q>>6,q=q>>3|B[7]<<13,q=q>>3|B[8]<<13,v[H++]=q>>8,q=q>>3|B[9]<<13,q=q>>3|B[10]<<13,q=q>>
3|B[11]<<13,v[H++]=q>>7,q=q>>3|B[12]<<13,q=q>>7|A[1]<<9,v[H++]=q>>5,q=q>>2|y[1]<<14,q=q>>2|z[1]<<14,q=q>>6|C[1]<<10,v[H++]=q>>3,q=q>>3|B[13]<<13,v[H++]=q>>8,q=q>>3|B[14]<<13,q=q>>3|B[15]<<13,q=q>>3|B[16]<<13,v[H++]=q>>7,q=q>>3|B[17]<<13,q=q>>3|B[18]<<13,q=q>>3|B[19]<<13,v[H++]=q>>6,q=q>>3|B[20]<<13,q=q>>3|B[21]<<13,v[H++]=q>>8,q=q>>3|B[22]<<13,q=q>>3|B[23]<<13,q=q>>3|B[24]<<13,v[H++]=q>>7,q=q>>3|B[25]<<13,q=q>>7|A[2]<<9,v[H++]=q>>5,q=q>>2|y[2]<<14,q=q>>2|z[2]<<14,q=q>>6|C[2]<<10,v[H++]=q>>3,q=q>>
3|B[26]<<13,v[H++]=q>>8,q=q>>3|B[27]<<13,q=q>>3|B[28]<<13,q=q>>3|B[29]<<13,v[H++]=q>>7,q=q>>3|B[30]<<13,q=q>>3|B[31]<<13,q=q>>3|B[32]<<13,v[H++]=q>>6,q=q>>3|B[33]<<13,q=q>>3|B[34]<<13,v[H++]=q>>8,q=q>>3|B[35]<<13,q=q>>3|B[36]<<13,q=q>>3|B[37]<<13,v[H++]=q>>7,q=q>>3|B[38]<<13,q=q>>7|A[3]<<9,v[H++]=q>>5,q=q>>2|y[3]<<14,q=q>>2|z[3]<<14,q=q>>6|C[3]<<10,v[H++]=q>>3,q=q>>3|B[39]<<13,v[H++]=q>>8,q=q>>3|B[40]<<13,q=q>>3|B[41]<<13,q=q>>3|B[42]<<13,v[H++]=q>>7,q=q>>3|B[43]<<13,q=q>>3|B[44]<<13,q=q>>3|B[45]<<
13,v[H++]=q>>6,q=q>>3|B[46]<<13,q=q>>3|B[47]<<13,v[H++]=q>>8,q=q>>3|B[48]<<13,q=q>>3|B[49]<<13,q=q>>3|B[50]<<13,v[H++]=q>>7,q=q>>3|B[51]<<13,v[H]=q>>12,M=v[H]):(q=M<<6|w[0]<<10,v[H++]=q>>6,q=q>>6|w[1]<<10,v[H++]=q>>8,q=q>>5|w[2]<<11,q=q>>5|w[3]<<11,v[H++]=q>>6,q=q>>4|w[4]<<12,q=q>>4|w[5]<<12,v[H++]=q>>6,q=q>>3|w[6]<<13,q=q>>3|w[7]<<13,v[H++]=q>>8,q=q>>7|A[0]<<9,q=q>>2|y[0]<<14,v[H++]=q>>7,q=q>>2|z[0]<<14,q=q>>6|C[0]<<10,v[H++]=q>>7,q=q>>3|B[0]<<13,q=q>>3|B[1]<<13,q=q>>3|B[2]<<13,v[H++]=q>>6,q=q>>
3|B[3]<<13,q=q>>3|B[4]<<13,v[H++]=q>>8,q=q>>3|B[5]<<13,q=q>>3|B[6]<<13,q=q>>3|B[7]<<13,v[H++]=q>>7,q=q>>3|B[8]<<13,q=q>>3|B[9]<<13,q=q>>3|B[10]<<13,v[H++]=q>>6,q=q>>3|B[11]<<13,q=q>>3|B[12]<<13,v[H++]=q>>8,q=q>>7|A[1]<<9,q=q>>2|y[1]<<14,v[H++]=q>>7,q=q>>2|z[1]<<14,q=q>>6|C[1]<<10,v[H++]=q>>7,q=q>>3|B[13]<<13,q=q>>3|B[14]<<13,q=q>>3|B[15]<<13,v[H++]=q>>6,q=q>>3|B[16]<<13,q=q>>3|B[17]<<13,v[H++]=q>>8,q=q>>3|B[18]<<13,q=q>>3|B[19]<<13,q=q>>3|B[20]<<13,v[H++]=q>>7,q=q>>3|B[21]<<13,q=q>>3|B[22]<<13,q=
q>>3|B[23]<<13,v[H++]=q>>6,q=q>>3|B[24]<<13,q=q>>3|B[25]<<13,v[H++]=q>>8,q=q>>7|A[2]<<9,q=q>>2|y[2]<<14,v[H++]=q>>7,q=q>>2|z[2]<<14,q=q>>6|C[2]<<10,v[H++]=q>>7,q=q>>3|B[26]<<13,q=q>>3|B[27]<<13,q=q>>3|B[28]<<13,v[H++]=q>>6,q=q>>3|B[29]<<13,q=q>>3|B[30]<<13,v[H++]=q>>8,q=q>>3|B[31]<<13,q=q>>3|B[32]<<13,q=q>>3|B[33]<<13,v[H++]=q>>7,q=q>>3|B[34]<<13,q=q>>3|B[35]<<13,q=q>>3|B[36]<<13,v[H++]=q>>6,q=q>>3|B[37]<<13,q=q>>3|B[38]<<13,v[H++]=q>>8,q=q>>7|A[3]<<9,q=q>>2|y[3]<<14,v[H++]=q>>7,q=q>>2|z[3]<<14,q=
q>>6|C[3]<<10,v[H++]=q>>7,q=q>>3|B[39]<<13,q=q>>3|B[40]<<13,q=q>>3|B[41]<<13,v[H++]=q>>6,q=q>>3|B[42]<<13,q=q>>3|B[43]<<13,v[H++]=q>>8,q=q>>3|B[44]<<13,q=q>>3|B[45]<<13,q=q>>3|B[46]<<13,v[H++]=q>>7,q=q>>3|B[47]<<13,q=q>>3|B[48]<<13,q=q>>3|B[49]<<13,v[H++]=q>>6,q=q>>3|B[50]<<13,q=q>>3|B[51]<<13,v[H++]=q>>8);for(var Sc=0,ad=O?32:33,Sc=0;Sc<ad;Sc++)zd[Sc+qa]=v[Sc];return ad};var O=!1,L=[8,7,6,6,5,5,5,5,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,
2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],E=new Int32Array(9),W=0,da=0,ia=0,ja=0,ka=0,ea=0,la=new Int16Array(40)}k.name="AUDIO_INPUT";k.process=
function(d){var e=d.getByte(),h=null;switch(e){case 1:d=d.getLittleEndian32();h=new RdpBuffer(new Uint8Array(5),0,5);h.setByte(1);h.setLittleEndian32(d);h.markEnd();k.send(h);break;case 2:for(var m=d.getLittleEndian32(),p=d.getLittleEndian32(),h=[],f=[],e=0,p=hi5.audio.getAudioContext().sampleRate,e=0;e<m;e++){var t=new c;t.fromBuffer(d);49==t.formatTag&&22050==t.nSamplesPerSec?(t.hasLocalSupport=!0,h.push(t)):1==t.formatTag&&t.nSamplesPerSec==p&&2==t.nChannels&&f.push(t)}k.send(r);d=0;p=h.length;
0==p&&(h=f,p=f.length,u.directInput=!0);for(e=0;e<p;e++)d+=h[e].getSize();f=new RdpBuffer(new Uint8Array(1024),0,1024);f.setByte(2);f.setLittleEndian32(p);f.setLittleEndian32(d+9);for(e=0;e<p;e++)h[e].toBuffer(f);f.skipPosition(1024-d-9);f.markEnd();k.send(f);break;case 3:b(d);break;case 7:d=d.getLittleEndian32();y||(a(d),y=!1);break;default:console.log("audioInpt: invalid tag:"+e)}};var e=!1;k.onclose=function(){e=!1;u&&u.close()};var r=new Uint8Array(1);r[0]=5;var y=!1,A=p.reconnectOnResize,t=new Uint8Array(0),
z=null,u=new function(a){function b(c){n=!0;if(k.onopen)k.onopen(!0);z=new d;h=c;f=a.createMediaStreamSource(c);c=k.directInput?1024:4096;g=a.createJavaScriptNode?a.createJavaScriptNode(c,1,1):a.createScriptProcessor(c,1,1);k.directInput&&!p&&(p=new Int16Array(2048));g.onaudioprocess=function(a){if(e){a=a.inputBuffer.getChannelData(0);if(k.directInput){for(var b=0,c=0,d=0;1024>d;d++)c=32767*a[d],p[b++]=c,p[b++]=c;u.ondata(new Uint8Array(p.buffer),4196)}else w.addData(a,l);a.fill(0)}};c=a.createBiquadFilter();
c.frequency.value=11025;f.connect(c);c.connect(g);g.connect(a.destination)}function c(){e||(h.getTracks&&h.getTracks()[0].stop(),g&&g.disconnect(),f&&f.disconnect(),n=!1)}var e=!1,h=null,f=null,g=null,k=this,l=a.sampleRate/22050,n=!1;this.directInput=!1;var k=this,p;this.start=function(){if(!n)navigator.getUserMedia({audio:!0},b,function(a){e=n=!1;if(k.onopen)k.onopen(!1);console.log("Error on getUserMedia: "+a)});else if(k.onopen)k.onopen(!0);e=!0};this.stop=function(){e=!1};this.close=function(){e=
!1;w.reset();z=new d;setTimeout(c,8E3)};var w=new function(){function a(g){for(var l=d/160|0,m=0;m<l;m++){var n=z.encode(g,c,h,e);e+=n;e==f&&(e=0,k.ondata(h,f));c+=160;d-=160}b=0<d?g:null}var b=null,c=0,d=0,e=0,f=65*Math.floor(Math.floor(Math.floor(4096/l)/160)/2),h=new Uint8Array(f);this.reset=function(){d=c=e=0;b=null};this.addData=function(e,f){var h=e;if(1==f)e=h;else if(1>f)console.error("rate must be smaller than the original rate"),e=void 0;else{for(var g=new Float32Array(Math.round(h.length/
f)),k=0,l=0;k<g.length;){for(var m=Math.round((k+1)*f),n=0,p=0;l<m&&l<h.length;l++)n+=h[l],p++;g[k]=n/p;k++;l=m}e=g}0==d?(d=e.length,c=0,a(e)):(h=e,g=d+h.length,k=new Float32Array(g),k.set(b.subarray(c)),k.set(h,d),c=0,d=g,a(k))}}}(hi5.audio.getAudioContext())})();p.addDynamicChannel(k)}}},jc=new me,Sa=new Bc,Oe=new function(){function a(a,b,e,k,l,n){this.x=a;this.y=b;this.cx=e;this.cy=k;this.offset=l;this.data=n}var b=[];this.save=function(c,d,e,k,l,n){c=new a(c,d,e,k,l,n);d=0;for(e=b.length;d<e;d++)if(!b[d]){b[d]=
c;return}b.push(c)};this.restore=function(a,d,e,k,l){for(var n,g=0,m=b.length;g<m;g++)if((n=b[g])&&n.x==a&&n.y==d&&n.cx==e&&n.cy==k){if(n.offset==l)return a=n.data,b[g]=null,a;svGlobal.logger.warn("TODO: offset")}return null}},Wc=Array(20),Fb=0;this.getFileUrl=function(a){return p.modifyURL(cb()+"/DOWNLOAD?s="+Dc+"&f="+a)};this.reconnect=function(a,b,c){c=c||!1;if(!(ea&&nb||c))return!1;C.minWidth&&a<C.minWidth&&(a=C.minWidth);C.minHeight&&b<C.minHeight&&(b=C.minHeight);a&=-4;b&=-4;if(!c&&4>Math.abs(a-
W)&&4>Math.abs(b-da))return!1;nb=!1;svGlobal.logger.info("reconnecting...");y.send("8E0"+a+"\t"+b);return!0};this.notify=function(a,b){a="8E6"+a;b&&(a+="\t"+b.join(";"));y.send(a)};this.getUploadManager=function(){return La};this.addSurface=function(a){v.hasSurface(a)||(Zc||F.setContext(a.context),-1!=v.indexOf(a)&&a.railWin)||(db&&a.setPlayerMode(),C.mouseMoveEmu&&(a.mouseMoveEmu=Ib(C.mouseMoveEmu)),a.setConfig(O),v.addSurface(a),a.setSize(W,da,la?"hidden":null),a.setController(te),a.setFastCopy(Ib(C.fastCopy)),
a.setTouchpad(Ib(C.touchpad)),a.setClipboard(Ib(C.mapClipboard)),Xc&&qe(a),C.invitation&&(v.setReadOnly(!0),btn=hi5.$("requestControl"))&&(btn.disabled=!1),a.run(parseInt(C.keyboard||1033,10)))};this.getRunninApps=this.getRunningApps=function(){for(var a=[],b=0,c=v.length;b<c;b++)v[b].railWin.getMain(v.zOrders)&&a.push(v[b].railWin.getMain(v.zOrders).titleInfo);return a};this.startApp=function(a,b,c){y.send("8C2"+a+"\t"+b+"\t"+c);var d=v[v.length-1];d&&(d.remoteApp=new re(a,b,c))};this.startExitingApp=
function(a){a=v.popWins(a);for(var b=a.length-1;0<=b;b--)v.addWin(a[b])};this.VirtualChannel=function(){return new Ec(143)};this.GatewayChannel=function(){return new Ec(28)};this.DynamicChannel=function(){return new Ec(64)};this.addChannel=function(a){Lb[a.name]=a};this.addGatewayChannel=function(a){Mb[a.name]=a};this.addDynamicChannel=function(a){ta.names.push(a.name);ta[a.name]=a;ta.count++};if(Ib(C.smartCard)){var Vb=new p.GatewayChannel,de=null;Vb.name="SCARDSTB";Vb.onopen=function(){de=document.getElementById(hi5.appcfg.clientAppletId||
"clientApplet")};Vb.process=function(a){var b=null;if(de){var c=a.getPosition();a=hi5.Base64.enc(a.getData(),a.getEnd()-c,c);try{a=de.deviceControl(a),b=hi5.Base64.dec(a,0)}catch(d){console.log(d)}}b||(b=[0]);a=new hi5.DataBuffer(b);a.markEnd(b.length);Vb.send(a)};p.addGatewayChannel(Vb)}this.run=function(){setTimeout(se,5);sa.supportWebAudio&&sa.iOSFix()};this.getDesktop=function(){return F};this.mouseDown=function(a,b,c){Fa&&y.send("80"+a+"\t"+b+"\t"+c)};this.mouseMove=function(a,b){Fa&&y.send("82"+
a+"\t"+b)};this.mouseUp=function(a,b,c){Fa&&y.send("81"+a+"\t"+b+"\t"+c)};this.writeKeyCode=function(a,b){Fa&&y.send("8B"+(a?0:49152)+"\t"+b)};this.writeScancode=function(a,b){Fa&&("number"==typeof a?(y.send("840\t"+a),y.send("8449152\t"+a)):y.send("84"+(a?0:49152)+"\t"+b))};this.writeText=function(a){Fa&&y.send("86"+a)};this.writeRawInput=function(a){Fa&&y.send(a)};var wa=new RdpBuffer([],0,0);this.sendPing=function(a){if(ea){var b=new Uint8Array(a?2+a.length:2);b[0]=146;b[1]=0;a&&b.set(a,2);y.send(b.buffer)}};
this.startPing=function(a){Kb.setInterval(a)};var Ta=null,Ce=0;this.play=function(){y.send("F3")};this.pause=function(){y.send("F2")};this.scan=function(a){y.send("F4"+(a?"1":"0"))};this.seek=function(a){var b=v.getFocused();b&&ea&&(y.send("F4"+(a?"1":"0")+"\t"+(a/b.getScale()|0)),F.pause(!0))};Da=Va=Oa=0;bb=22050;var Be=!1;this.showMessage=function(a,b,c){p.displayMsg&&a&&((b=b||v.getFocused())?b.showMessage(a,c):hi5.notifications.notify({msg:a,timeout:c||0}))};var $c=new function(){var a=0,b=0,
c=[0],d=new RdpBuffer(c,0,0);this.addFragement=function(d,k){tb(d.getData(),d.getPosition(),c,b,k);b+=k;a+=k};this.clearFragements=function(){d.setPosition(0);d.markEnd(a);b=a=0;return d}},Gc=new function(){var a=Ja(10240),b=0,c=fb(10240),d=0,e=fb(10240),k=0,l=fb(10240),n=0,g=fb(0),m=0;this.getData=function(){return a};this.getDataSize=function(){return b};this.resetData=function(c){a.length<c&&(a=Ja(c));b=c;return a};this.resetLumaPlane=function(a){c.length<a&&(c=fb(a));d=a;return c};this.getLumaPlanceSize=
function(){return d};this.resetOrangeChromaPlane=function(a){e.length<a&&(e=fb(a));k=a;return e};this.getOrangeChromaPlane=function(){return k};this.resetGreenChromaPlane=function(a){l.length<a&&(l=fb(a));n=a;return l};this.getGreenChromaPlane=function(){return n};this.resetAlphaPlane=function(a){g.length<a&&(g=fb(a));m=a;return g};this.getAlphaPlane=function(){return m}},If=new function(){var a=new Kf,b=new Jf,c=new Lf;this.decode=function(b,k){for(var l=0,n=0,n=0,g=b.getPosition()+k;b.getPosition()<
g;){l=b.getLittleEndian16();n=b.getLittleEndian32();if(0==n)break;n=b.getPosition()-6+n;switch(l){case 52416:l=b;l.getLittleEndian32();l.getLittleEndian16();break;case 52417:b.skipPosition(4);break;case 52418:for(var l=b,m=l.getByte(),h=0;h<m;h++){var p=l.getByte(),r=l.getLittleEndian16(),v=l.getLittleEndian16();svGlobal.logger.info("Channel, id:"+p+" width:"+r+" height:"+v)}break;case 52419:l=b;l.skipPosition(2);c.ctxId=l.getByte();c.tileSize=l.getLittleEndian16();c.setProperties(l.getLittleEndian16());
break;case 52420:b.skipPosition(10);break;case 52421:b.skipPosition(2);break;case 52422:l=b;l.skipPosition(2);l.skipPosition(1);m=l.getLittleEndian16();h=a.resetRects(m);for(p=0;p<m;p++)r=h[p],r.x=l.getLittleEndian16(),r.y=l.getLittleEndian16(),r.width=l.getLittleEndian16(),r.height=l.getLittleEndian16();l.skipPosition(4);break;case 52423:l=b;m=c;l.skipPosition(6);h=l.getLittleEndian16();m.cct=h>>>4&3;m.xft=h>>>6&15;m.et=h>>>10&15;m.qt=h>>>14&3;v=l.getByte();l.skipPosition(1);h=l.getLittleEndian16();
l.skipPosition(4);for(var p=Array(10*v),t=0,z=void 0,r=void 0,r=0;r<v;r++)z=l.getByte(),p[t++]=z&15,p[t++]=z>>>4,z=l.getByte(),p[t++]=z&15,p[t++]=z>>>4,z=l.getByte(),p[t++]=z&15,p[t++]=z>>>4,z=l.getByte(),p[t++]=z&15,p[t++]=z>>>4,z=l.getByte(),p[t++]=z&15,p[t++]=z>>>4;v=a.resetTiles(h);for(r=0;r<h;r++)t=v[r],t.readHeaderfromStream(l),d(m,l,p,t.YLen,10*t.quantIdxY,t.CbLen,10*t.quantIdxCb,t.CrLen,10*t.quantIdxCr,t.data);break;default:svGlobal.logger.warn("unknown blockType 0x%X"+l)}b.setPosition(n)}return a};
var d=b.decodeRgb;this.getResult=function(){return a}},He=(new function(){function a(a,c,d,e,k){if(0==d)Ea(e,0,k,255);else if(d<k){var l=d=0,n=0,l=k;for(k=0;4<l;)n=a[c++],5==l?(e[k++]=n,l--):n==a[c]?(c++,255>(a[c]&255)?(d=a[c++]&255,d+=2):(c++,d=(a[c+3]&255)<<24|(a[c+2]&255)<<16|(a[c+1]&255)<<8|a[c]&255,c+=4),Ea(e,k,k+d,n),k+=d,l-=d):(e[k++]=n,l--);for(d=0;4>d;d++)e[k++]=a[c++]}else tb(a,c,e,0,k)}this.process=function(b,c,d,e,k){var l=b.getLittleEndian32(),n=b.getLittleEndian32(),g=b.getLittleEndian32();
b.skipPosition(4);var m=b.getByte();c=b.getByte();b.skipPosition(2);var h=b.getData(),p=b.getPosition();b=d*e;var r=4*b;b=k.resetData(b);var v=d+(~(d&7)+1&7),t=e+(~(e&1)+1&1),r=v*t,z=k.resetLumaPlane(r),u=k.resetOrangeChromaPlane(r);k=k.resetGreenChromaPlane(r);var r=d*e,t=0<c?(v>>1)*(t>>1):r,x=0<c?t:r;a(h,p,l,z,0<c?v*e:r);p+=l;a(h,p,n,u,t);a(h,p+n,g,k,x);for(var y=p=h=g=n=l=0,C=0,D=0,r=y=t=v=0,x=d+(~(d&7)+1&7),m=m-1,n=0;n<e;n++)for(0<c?(g=n*x,h=(n>>1)*(x>>1),p=(n>>1)*(x>>1)):(g=n*d,h=n*d,p=n*d),
l=0;l<d;l++)y=z[g]&255,C=(u[h]&255)<<m<<24>>24,D=k[p]<<m<<24>>24,v=y+C-D,t=y+D,y=y-C-D,y=0>y?0:255<y?255:y,t=0>t?0:255<t?255:t,v=0>v?0:255<v?255:v,b[r++]=4278190080|y<<16|t<<8|v,g++,h+=0<c?l%2:1,p+=0<c?l%2:1}}).process,Ke=new function(){var a=[{d:507,c:"text"}];this.distance=function(a,c){for(var d=0,e=0,k=a.length;e<k;e++)0!=a[e]&&(d+=e%c+(e/c|0));return d};this.getName=function(b,c){for(var d=Ke.distance(b,c),e=0,k=a.length;e<k;e++)if(128>Math.abs(d-a[e].d))return a[e].c;return null}},Pf=[1,2,1,
0,0,0,0,1,1,2,1,1,0,2,3,1,2,2,2,2,1,2,1,0,2,1,2,3],sb={readVar4Bytes:function(a){var b=a.getByte(),c=0;switch((b&192)>>6){case 0:c=b&63;break;case 1:c=(b&63)<<8|a.getByte();break;case 2:c=(b&63)<<16;b=a.getByte();c|=b<<8;b=a.getByte();c|=b;break;case 3:c=(b&63)<<24,b=a.getByte(),c|=b<<16,b=a.getByte(),c|=b<<8,b=a.getByte(),c|=b}return c},readVar2Bytes:function(a){var b=a.getByte();return 0!=(b&128)?(b&127)<<8|a.getByte():b}};this.close=ed;hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(ed):
window.addEventListener("unload",ed,!1);var ka=16777215}svGlobal.Rdp=Rdp;var RdpBuffer=hi5.DataBuffer;
