var svManager={getInstance:function(){var u=window.$rdp;return u&&u.running&&u.running()?u:null}};svGlobal.getInstance=svManager.getInstance;
function connvertServer(u){var Y={};Y.id=u.id;Y.server=u.id;Y.displayName=u.displayName||u.id;if(u=u.rdp){for(var Yb in u)Y[Yb]=u[Yb];Y.user=u.username||"";Y.pwd=u.password||"";Y.useConsole=u.console||!1;Y.legacyMode=u.leagacyMode||u.legacyMode||!1;Y.server_bpp=u.color||16;Y.exe=u.remoteProgram||"";Y.args=u.remoteArgs||"";Y.startProgram=0<Y.exe.length?"app":Y.command&&0<Y.command.length?"shell":"noapp"}return Y}
function Rdp2(u){if(!u){var Y=window.opener;try{Y&&Y.__sparkUser&&Y.__sparkUser.server&&(u=Y.__sparkUser.server),!u&&Y.sparkServer&&(u=Y.sparkServer)}catch(La){}u||(u=hi5.browser.cookie2Obj());if(!u||!u.gateway)return hi5.notifications.notify({msg:__svi18n.noauth}),null}var Y="",Yb=u.gateway||"",Rc=window.innerWidth,Fa=window.innerHeight,Ma=16,Na=null;u.width&&(Rc=parseInt(u.width,10));u.height&&(Fa=parseInt(u.height,10));u.color&&(Ma=parseInt(u.color,10));u.server_bpp&&(Ma=parseInt(u.server_bpp,
10));for(var Oa in u){svGlobal.logger.debug("** p:"+Oa+" v="+u[Oa]);var ya=u[Oa];if("useSSL"==Oa)Na="true"==ya||1==ya;else{if("boolean"==typeof ya)if(ya)ya="on";else continue;""!=Y&&(Y+="&");Y+=Oa+"="+encodeURIComponent(ya)}}null===Na&&(Na="https:"==location.protocol);Y=(Na?"wss://":"ws://")+Yb+"/RDP?"+Y;return new Rdp(Y,Rc,Fa,Ma)}svGlobal.Rdp2=Rdp2;
function Rdp(u,Y,Yb,Rc){var Fa,Ma,Na,Oa;function ya(a){return"Uint32Array"in window?new Uint32Array(a):Array(a)}function La(a){return"Int32Array"in window?new Int32Array(a):Array(a)}function gb(a){return"Uint8Array"in window?new Uint8Array(a):Array(a)}function za(a){return"on"==a||"true"==a}function Bf(a){return"off"==a||"false"==a}function Cb(){var a=g.gateway;g.ongetgatewayaddress&&(a=g.ongetgatewayaddress(a));return a}function Ge(a){if(hi5.browser.isiOS){var b=a-hi5.browser.innerHeight;10<b&&22>
b&&(a=hi5.browser.innerHeight)}return a}function Cf(){var a=hi5.storage.get("SV_CONN_SHARE_ID");a||(a=hi5.tool.uuid(),hi5.storage.set("SV_CONN_SHARE_ID",a));return a}function hd(a,b){g.setTitle&&(b=b||window,g.ontitlechange&&(a=g.ontitlechange(a)),b.document.title=a)}function He(){function a(a,h,t,C,f,aa,y,v){var ia=0,u="Int32Array"in window?new Int32Array(160):Array(160);u.buffer||Va(u,0,160,0);var ub="Int32Array"in window?new Int32Array(40):Array(40);ub.buffer||Va(ub,0,40,0);for(var x=120,D=0;3>=
D;D++,ia+=13){var O=f[D],F=t[D],P=ia,Q=aa,Ca=ub,K=La(13);K.buffer||Va(K,0,13,0);var ea=void 0,A=ea=0;15<O&&(ea=(O>>3)-1);A=O-(ea<<3);if(0==A)ea=-4,A=7;else{for(;7>=A;)A=A<<1|1,ea--;A-=8}O=Array(2);O[0]=ea;O[1]=A;for(var ea=O,O=K,L=void 0,E=A=void 0,R=void 0,A=n[ea[1]],E=l(6,ea[0]),ea=l(E,1),R=16<=ea?0:-16>=ea?-0:0>ea?k(1,-ea):1<<ea,xd=ea=0;13>xd;xd++)L=(Q[P++]<<1)-7,L<<=12,L=e(A,L),L+=R,-32768>L?L=-32768:32767<L&&(L=32767),O[ea++]=k(L,E);Q=13;ea=O=0;switch(F){case 3:Ca[ea++]=0;case 2:Ca[ea++]=0;case 1:Ca[ea++]=
0;case 0:Ca[ea++]=K[O++],Q--}do Ca[ea++]=0,Ca[ea++]=0,Ca[ea++]=K[O++];while(0<--Q);for(;4>++F;)Ca[ea++]=0;ea=h[D];P=C[D];Ca=ub;K=x;O=Q=F=void 0;w=O=40>ea||120<ea?w:ea;F=q[P];for(ea=0;39>=ea;ea++)Q=e(F,r[ea-O+K]),Q+=Ca[ea],-32768>Q?Q=-32768:32767<Q&&(Q=32767),r[ea+K]=Q;Db(r,K-80,r,K-120,120);Db(r,x,u,40*D,39)}h=La(8);t=m[g];C=m[g^=1];f=t;ia=aa=0;b(a,f,ia++,aa,0,-32,13107);b(a,f,ia++,aa,0,-32,13107);b(a,f,ia++,aa,2048,-16,13107);b(a,f,ia++,aa,-2560,-16,13107);b(a,f,ia++,aa,94,-8,19223);b(a,f,ia++,aa,
-1792,-8,17476);b(a,f,ia++,aa,-341,-4,31454);b(a,f,ia++,aa,-1144,-4,29708);a=C;f=t;aa=h;for(ub=ia=0;8>ub;ub++)ia=(a[ub]>>2)+(f[ub]>>2),-32768>ia?ia=-32768:32767<ia&&(ia=32767),ia+=a[ub]>>1,-32768>ia?ia=-32768:32767<ia&&(ia=32767),aa[ub]=ia;c(h);d(h,13,u,y,0,v);a=C;f=t;aa=h;for(ub=ia=0;8>ub;ub++)ia=(a[ub]>>1)+(f[ub]>>1),-32768>ia?ia=-32768:32767<ia&&(ia=32767),aa[ub]=ia;c(h);d(h,14,u,y,13,v);a=C;C=t;f=h;for(ia=aa=0;8>ia;ia++)aa=(a[ia]>>2)+(C[ia]>>2),-32768>aa?aa=-32768:32767<aa&&(aa=32767),aa+=C[ia]>>
1,-32768>aa?aa=-32768:32767<aa&&(aa=32767),f[ia]=aa;c(h);d(h,13,u,y,27,v);a=t;t=h;for(C=0;8>C;C++)t[C]=a[C];c(h);d(h,120,u,y,40,v);u=0;a=v;for(h=v+160;h-- >v;a++)u=e(z,28180),z=y[a]+u,-32768>z?z=-32768:32767<z&&(z=32767),u=z<<1,-32768>u?u=-32768:32767<u&&(u=32767),y[a]=u}function b(a,b,c,d,f,h,q){d=a[c]+h;-32768>d?d=-32768:32767<d&&(d=32767);d=l(d<<10,f<<1);d=e(q,d);d+=d;-32768>d?d=-32768:32767<d&&(d=32767);b[c]=d}function c(a){for(var b=0,c=0;8>c;c++)0>a[c]?(b=-32768==a[c]?32767:-a[c],a[c]=-(11059>
b?b<<1:20070>b?b+11059:h(b>>2,26112))):(b=a[c],a[c]=11059>b?b<<1:20070>b?b+11059:h(b>>2,26112))}function d(a,b,c,d,f,e){for(var h=0,q=0,m=0;0!=b;){b--;for(var h=c[f],r=7;0<=r;r--)q=a[r],m=y[r],m=((-32768==q&&-32768==m?32767:65535&q*m+16384>>15)&65535)<<16>>16,h=l(h,m),q=((-32768==q&&-32768==h?32767:65535&q*h+16384>>15)&65535)<<16>>16,q=y[r]+q,-32768>q?q=-32768:32767<q&&(q=32767),y[r+1]=q;d[e+f++]=y[0]=h}}function e(a,b){if(-32768==a&&-32768==b)return 32767;var c;return c=(a*b+16384>>15&65535)<<16>>
16}function h(a,b){var c=a+b;return-32768>c?-32768:32767<c?32767:c}function l(a,b){var c=a-b;return-32768>c?-32768:32767<c?32767:c}function k(a,b){return 16<=b?0>a?-1:0:-16>=b?0:0>b?a<<-b:a>>b}var n=[18431,20479,22527,24575,26623,28671,30719,32767],q=[3277,11469,21299,32767],r=La(280);r[0]=0;var m=[La(8),La(8)],g=0,w=40,y=La(9),z=0,t=La(320);t[0]=0;var v=[.1];this.decode=function(b,c,d){for(var l=0,f=0,f=0,e=La(8),h=La(4),q=La(4),m=La(4),r=La(4),k=La(52);c<d;){f=b[c++]&255;e[0]=f&63;f>>>=6;f|=b[c++]<<
2&1023;e[1]=f&63;f>>>=6;f|=b[c++]<<4&4095;e[2]=f&31;f>>>=5;e[3]=f&31;f>>>=5;f|=b[c++]<<2&1023;e[4]=f&15;f>>>=4;e[5]=f&15;f>>>=4;f|=b[c++]<<2&1023;e[6]=f&7;f>>>=3;e[7]=f&7;f>>>=3;f|=b[c++]<<4&4095;h[0]=f&127;f>>>=7;m[0]=f&3;f>>>=2;q[0]=f&3;f>>>=2;f|=b[c++]<<1&511;r[0]=f&63;f>>>=6;k[0]=f&7;f=b[c++]&255;k[1]=f&7;f>>>=3;k[2]=f&7;f>>>=3;f|=b[c++]<<2&1023;k[3]=f&7;f>>>=3;k[4]=f&7;f>>>=3;k[5]=f&7;f>>>=3;f|=b[c++]<<1&511;k[6]=f&7;f>>>=3;k[7]=f&7;f>>>=3;k[8]=f&7;f=b[c++]&255;k[9]=f&7;f>>>=3;k[10]=f&7;f>>>=
3;f|=b[c++]<<2&1023;k[11]=f&7;f>>>=3;k[12]=f&7;f>>>=3;f|=b[c++]<<4&4095;h[1]=f&127;f>>>=7;m[1]=f&3;f>>>=2;q[1]=f&3;f>>>=2;f|=b[c++]<<1&511;r[1]=f&63;f>>>=6;k[13]=f&7;f=b[c++]&255;k[14]=f&7;f>>>=3;k[15]=f&7;f>>>=3;f|=b[c++]<<2&1023;k[16]=f&7;f>>>=3;k[17]=f&7;f>>>=3;k[18]=f&7;f>>>=3;f|=b[c++]<<1&511;k[19]=f&7;f>>>=3;k[20]=f&7;f>>>=3;k[21]=f&7;f=b[c++]&255;k[22]=f&7;f>>>=3;k[23]=f&7;f>>>=3;f|=b[c++]<<2&1023;k[24]=f&7;f>>>=3;k[25]=f&7;f>>>=3;f|=b[c++]<<4&4095;h[2]=f&127;f>>>=7;m[2]=f&3;f>>>=2;q[2]=f&
3;f>>>=2;f|=b[c++]<<1&511;r[2]=f&63;f>>>=6;k[26]=f&7;f=b[c++]&255;k[27]=f&7;f>>>=3;k[28]=f&7;f>>>=3;f|=b[c++]<<2&1023;k[29]=f&7;f>>>=3;k[30]=f&7;f>>>=3;k[31]=f&7;f>>>=3;f|=b[c++]<<1&511;k[32]=f&7;f>>>=3;k[33]=f&7;f>>>=3;k[34]=f&7;f=b[c++]&255;k[35]=f&7;f>>>=3;k[36]=f&7;f>>>=3;f|=b[c++]<<2&1023;k[37]=f&7;f>>>=3;k[38]=f&7;f>>>=3;f|=b[c++]<<4&4095;h[3]=f&127;f>>>=7;m[3]=f&3;f>>>=2;q[3]=f&3;f>>>=2;f|=b[c++]<<1&511;r[3]=f&63;f>>>=6;k[39]=f&7;f=b[c++]&255;k[40]=f&7;f>>>=3;k[41]=f&7;f>>>=3;f|=b[c++]<<2&
1023;k[42]=f&7;f>>>=3;k[43]=f&7;f>>>=3;k[44]=f&7;f>>>=3;f|=b[c++]<<1&511;k[45]=f&7;f>>>=3;k[46]=f&7;f>>>=3;k[47]=f&7;f=b[c++]&255;k[48]=f&7;f>>>=3;k[49]=f&7;f>>>=3;f|=b[c++]<<2&1023;k[50]=f&7;f>>>=3;k[51]=f&7;f>>>=3;a(e,h,q,m,r,k,t,0);f&=15;f|=b[c++]<<4&4095;e[0]=f&63;f>>>=6;e[1]=f&63;f=b[c++]&255;e[2]=f&31;f>>>=5;f|=b[c++]<<3&2047;e[3]=f&31;f>>>=5;e[4]=f&15;f>>>=4;f|=b[c++]<<2&1023;e[5]=f&15;f>>>=4;e[6]=f&7;f>>>=3;e[7]=f&7;f=b[c++]&255;h[0]=f&127;f>>>=7;f|=b[c++]<<1&511;m[0]=f&3;f>>>=2;q[0]=f&3;
f>>>=2;f|=b[c++]<<5&8191;r[0]=f&63;f>>>=6;k[0]=f&7;f>>>=3;k[1]=f&7;f>>>=3;f|=b[c++]<<1&511;k[2]=f&7;f>>>=3;k[3]=f&7;f>>>=3;k[4]=f&7;f=b[c++]&255;k[5]=f&7;f>>>=3;k[6]=f&7;f>>>=3;f|=b[c++]<<2&1023;k[7]=f&7;f>>>=3;k[8]=f&7;f>>>=3;k[9]=f&7;f>>>=3;f|=b[c++]<<1&511;k[10]=f&7;f>>>=3;k[11]=f&7;f>>>=3;k[12]=f&7;f=b[c++]&255;h[1]=f&127;f>>>=7;f|=b[c++]<<1&511;m[1]=f&3;f>>>=2;q[1]=f&3;f>>>=2;f|=b[c++]<<5&8191;r[1]=f&63;f>>>=6;k[13]=f&7;f>>>=3;k[14]=f&7;f>>>=3;f|=b[c++]<<1&511;k[15]=f&7;f>>>=3;k[16]=f&7;f>>>=
3;k[17]=f&7;f=b[c++]&255;k[18]=f&7;f>>>=3;k[19]=f&7;f>>>=3;f|=b[c++]<<2&1023;k[20]=f&7;f>>>=3;k[21]=f&7;f>>>=3;k[22]=f&7;f>>>=3;f|=b[c++]<<1&511;k[23]=f&7;f>>>=3;k[24]=f&7;f>>>=3;k[25]=f&7;f=b[c++]&255;h[2]=f&127;f>>>=7;f|=b[c++]<<1&511;m[2]=f&3;f>>>=2;q[2]=f&3;f>>>=2;f|=b[c++]<<5&8191;r[2]=f&63;f>>>=6;k[26]=f&7;f>>>=3;k[27]=f&7;f>>>=3;f|=b[c++]<<1&511;k[28]=f&7;f>>>=3;k[29]=f&7;f>>>=3;k[30]=f&7;f=b[c++]&255;k[31]=f&7;f>>>=3;k[32]=f&7;f>>>=3;f|=b[c++]<<2&1023;k[33]=f&7;f>>>=3;k[34]=f&7;f>>>=3;k[35]=
f&7;f>>>=3;f|=b[c++]<<1&511;k[36]=f&7;f>>>=3;k[37]=f&7;f>>>=3;k[38]=f&7;f=b[c++]&255;h[3]=f&127;f>>>=7;f|=b[c++]<<1&511;m[3]=f&3;f>>>=2;q[3]=f&3;f>>>=2;f|=b[c++]<<5&8191;r[3]=f&63;f>>>=6;k[39]=f&7;f>>>=3;k[40]=f&7;f>>>=3;f|=b[c++]<<1&511;k[41]=f&7;f>>>=3;k[42]=f&7;f>>>=3;k[43]=f&7;f=b[c++]&255;k[44]=f&7;f>>>=3;k[45]=f&7;f>>>=3;f|=b[c++]<<2&1023;k[46]=f&7;f>>>=3;k[47]=f&7;f>>>=3;k[48]=f&7;f>>>=3;f|=b[c++]<<1&511;k[49]=f&7;f>>>=3;k[50]=f&7;f>>>=3;k[51]=f&7;a(e,h,q,m,r,k,t,160);for(var f=320*l++,n=0;320>
n;n++)v[f++]=t[n]/32768}v.length=320*l;return v}}function Ie(a,b){var c=[],d=null,e=new Sc(0,0,0,0),h="Uint8ClampedArray"in window,l="Uint32Array"in window;this.width=a;this.height=b;var k=!1,n=this;this.getData=function(){return c};this.pause=function(a){k=a};this.release=function(){c=d=n=null};this.isPaused=function(){return k};this.setContext=function(a){a!=d&&(d||!a||a.createImageData(1,1).data.buffer||(h=!1),d=a)};this.getContext=function(){return d};this.resize=function(d,e){if(l)for(var h=
0;h<e;h++)c[h]=new Uint32Array(d);else if(e>c.length)for(h=c.length;h<e;h++)c[h]=[0];n.width=a=d;n.height=b=e};n.resize(a,b);this.getBuffer=function(){return c};this.setRGB=function(a,b,d){c[b][a]=d|4278190080};this.getRGB=function(a,b){return c[b][a]};this.setRGBs=function(a,d,e,l,h,k,n){var t=0,g=0,B=a+e;l=d+l;l>b&&(l=b);if(h.subarray)for(;d<l;d++,k+=n)c[d].set(h.subarray(k,k+e),a);else for(;d<l;d++,k+=n)for(g=k,e=c[d],t=a;t<B;t++)e[t]=h[g++]};this.moveArea=function(a,b,d,e,l,h){if(0<h){l=a+l;h=
b+h;var k=0,n=0;if(c[0].set)for(n=e-1;0<=n;n--)c[h+n].set(c[b+n].subarray(a,a+d),l);else for(n=e-1;0<=n;n--){e=c[h+n];for(var g=c[b+n],k=0;k<d;k++)e[l+k]=g[a+k]}}else if(0>h)if(l=a+l,h=b+h,n=k=0,c[0].set)for(;n<e;n++)c[h+n].set(c[b+n].subarray(a,a+d),l);else for(;n<e;n++)for(var g=c[h+n],B=c[b+n],k=0;k<d;k++)g[l+k]=B[a+k];else if(0<l)for(l=a+l,h=b+h,B=g=n=k=0,k=d-1;0<=k;k--)for(g=l+k,B=a+k,n=0;n<e;n++)c[h+n][g]=c[b+n][B];else for(l=a+l,h=b+h,B=g=n=k=0;k<d;k++)for(g=l+k,B=a+k,n=0;n<e;n++)c[h+n][g]=
c[b+n][B]};this.getRGBs=function(a,b,d,e){var h=ya(d*e),k=a+d;e=b+e;var n=0,g=0;if(l)for(Za=b;Za<e;Za++)h.set(c[Za].subarray(a,k),n),n+=d;else for(Za=b;Za<e;Za++)for(g=a;g<k;g++)h[n++]=c[Za][g];return h};this.repaint=function(e,l,n,g){if(d&&!k){0>e&&(n+=e,e=0);0>l&&(g+=l,l=0);e+n>a&&(n=a-e);l+g>b&&(g=b-l);var w=d.createImageData(n,g),y=w.data,z=e+n;g=l+g;var t=0;if(h)for(var y=new Uint32Array(y.buffer),v=l;v<g;v++)y.set(c[v].subarray(e,z),t),t+=n;else for(var B,N,v=l;v<g;v++)for(n=e;n<z;n++)B=c[v][n],
N=t<<2,y[N]=B&255,y[N+1]=B>>8&255,y[N+2]=B>>16&255,y[N+3]=255,t++;d.putImageData(w,e,l)}};this.postPaint=function(a,b,c,d){0<e.width?e.union(a,b,c,d):(e.x=a,e.y=b,e.width=c,e.height=d)};this.commitPaint=function(){0<e.width&&(n.repaint(e.x,e.y,e.width,e.height),e.width=0)};this.paintTo=function(c,d){0==c&&0==d?n.repaint(0,0,a,b):svGlobal.logger.warn("xx paintTo, x:"+c+" y:"+d)};this.fillRect=function(a,b,d,e,l){d=a+d;e=b+e;if(c[0].fill)for(var h=b;h<e;h++)c[h].fill(l,a,d);else for(h=b;h<e;h++)for(b=
a;b<d;b++)c[h][b]=l};this.drawLine=function(a,b,d,e,l){var h=0,h=0;if(b==e)if(a>d&&(h=a,a=d,d=h),b=c[b],d++,b.fill)b.fill(l,a,d);else for(h=a;h<d;h++)b[h]=l;else if(a==d)for(b>e&&(h=b,b=e,e=h),e++,h=b;h<e;h++)c[h][a]=l;else{var k=Math.abs(d-a),n=Math.abs(e-b),h=a,g=b,B=0,N=0,H=0,C=0,f=0,aa=0,u=0,da=0;N=d>=a?B=1:B=-1;C=e>=b?H=1:H=-1;k>=n?(C=B=0,aa=k,f=k/2|0,u=n,da=k):(H=N=0,aa=n,f=n/2|0,u=k,da=n);if(!(1>da))for(da++,a=0;a<da;a++)c[g][h]=l,f+=u,f>=aa&&(f-=aa,h+=B,g+=H),h+=N,g+=C}}}function Je(){var a=
"SI_"+g.server;x.domain&&(a+=x.domain);x.user&&(a+=x.user);return a}function Df(){if(!oa&&"sessionStorage"in window&&!x.pwd){var a=sessionStorage[Je()];if(a){a=JSON.parse(a);if(!("random"in a))return"";for(var b=a.random,c=0;16>c;c++)b[c]&=255;svGlobal.logger.info("load session, id="+a.logId+" server="+g.server);return"&logId="+a.logId+"&random="+encodeURIComponent(hi5.Base64.enc(b))}}return""}function Ke(){oa?(R=(x.waWidth||screen.width)|0,ca=(x.waHeight||screen.height)|0,768>ca&&767<screen.height&&
(ca=768)):(R&=-4,ca&=-4);x.minWidth&&R<x.minWidth&&(R=x.minWidth|0);x.minHeight&&ca<x.minHeight&&(ca=x.minHeight|0);x.waWidth=x.waWidth||R;x.waHeight=x.waHeight||ca}function Tc(a,b){D?D.resize(a,b):D=new Ie(a,b);return D}function Le(a){return 4278190080|(a<<3&248|a>>2&7)<<16|(a>>3&252|a>>9&3)<<8|a>>8&248|a>>13&7}function Ef(a){return 4278190080|Ga[2][a]<<16|Ga[1][a]<<8|Ga[0][a]}function Ff(a){return 4278190080|a}function id(a,b,c,d,e,h){for(var l=0,k=0,n=0,q=n=0,r=0,m=0,g=m=0,w=0,y=b,z=h;k<d;){h=
z+c*d*4-(k+1)*c*4;r=0;w=h;l=0;if(0==g)for(;l<c;){n=a[b++];q=n&15;n=n>>4&15;m=q<<4|n;47>=m&&16<=m&&(q=m,n=0);for(;0<n;)r=a[b++],e[h]=r,h+=4,l++,n--;for(;0<q;)e[h]=r,h+=4,l++,q--}else for(;l<c;){n=a[b++];q=n&15;n=n>>4&15;m=q<<4|n;47>=m&&16<=m&&(q=m,n=0);for(;0<n;)m=a[b++],0!=(m&1)?(m>>=1,m+=1,r=-m):r=m>>=1,m=e[g+4*l]+r,e[h]=m,h+=4,l++,n--;for(;0<q;)m=e[g+4*l]+r,e[h]=m,h+=4,l++,q--}k++;g=w}return b-y}function ce(a,b,c){b||(b=a.length);c||(c=0);b=Math.floor(b/4);for(var d=ya(b),e=d[0]=0,h=0;h<b;h++)e=
(h<<2)+c,d[h]=(a[e+3]&255)<<24|a[e+2]&255|(a[e+1]&255)<<8|(a[e+0]&255)<<16;return d}function jd(a,b,c,d,e,h){var l,k;for(k=0;k<d;k++)for(l=0;l<c;l++)e[h+4*((d-k-1)*c+l)]=a[b+(k*c+l)]}function Gf(a,b,c,d,e){c=d[e];var h=0;e+=1;var h=a*b,l=ya(4*h);l[0]=0;if(0==(c&32)){for(var k=d,n=e,q=a,r=b,m=l,g,w=0,y=0,z=0,t=z=0,v=0,B=n,N=3;y<r;){g=N+q*r*4-(y+1)*q*4;for(w=0;w<q;){z=k[n++];t=z&15;z=z>>4&15;v=t<<4|z;47>=v&&16<=v&&(t=v,z=0);for(;0<z;)n++,m[g]=255,g+=4,w++,z--;for(;0<t;)m[g]=255,g+=4,w++,t--}y++}e+=
n-B}else for(n=k=0;n<h;n++)k=n<<2,l[k+3]=255;0!=(c&16)?(h=id(d,e,a,b,l,2),e+=h,h=id(d,e,a,b,l,1),e+=h,id(d,e,a,b,l,0)):(jd(d,e,a,b,l,2),e+=h,jd(d,e,a,b,l,1),jd(d,e+h,a,b,l,0));return ce(l)}function Me(a,b,c,d,e){var h=-1,l=-1,k=0;c=e+c;var n=0,q=0,r=0,m=a,g=-1,w=0,y=q=0,z=0,t=r=0,v=4294967295,B=0,N=!1,H=!1,B=!1,C=ya(a*b);for(C[0]=0;e<c;){w=0;q=d[e++];n=q>>4;switch(n){case 12:case 13:case 14:n-=6;q&=15;r=16;break;case 15:n=q&15;9>n?(q=d[e++],q|=d[e++]<<8):q=11>n?8:1;r=0;break;default:n>>=1,q&=31,r=
32}0!=r&&(B=2==n||7==n,0==q?q=B?d[e++]+1:d[e++]+r:B&&(q<<=3));switch(n){case 0:g!=n||m==a&&-1==h||(N=!0);break;case 8:B=d[e++]|d[e++]<<8,y=4278190080|B>>8&248|B>>13&7|(B>>3&252|B>>9&3)<<8|(B<<3&248|B>>2&7)<<16;case 3:B=d[e++]|d[e++]<<8;z=4278190080|B>>8&248|B>>13&7|(B>>3&252|B>>9&3)<<8|(B<<3&248|B>>2&7)<<16;break;case 6:case 7:B=d[e++]|d[e++]<<8;v=4278190080|B>>8&248|B>>13&7|(B>>3&252|B>>9&3)<<8|(B<<3&248|B>>2&7)<<16;n-=5;break;case 9:t=3;n=2;w=3;break;case 10:t=5,n=2,w=5}g=n;for(r=0;0<q;)switch(m>=
a&&(m=0,b--,h=l,l=k+b*a),n){case 0:N&&(C[l+m]=-1==h?v:C[h+m]^v|4278190080,N=!1,q--,m++);if(-1==h){for(;0!=(q&-8)&&m+8<a;)for(var f=0;8>f;f++)C[l+m]=4278190080,q--,m++;for(;0<q&&m<a;)C[l+m]=4278190080,q--,m++}else{for(;0!=(q&-8)&&m+8<a;)for(f=0;8>f;f++)C[l+m]=C[h+m],q--,m++;for(;0<q&&m<a;)C[l+m]=C[h+m],q--,m++}break;case 1:if(-1==h){for(;0!=(q&-8)&&m+8<a;)for(f=0;8>f;f++)C[l+m]=v,q--,m++;for(;0<q&&m<a;)C[l+m]=v,q--,m++}else{for(;0!=(q&-8)&&m+8<a;)for(f=0;8>f;f++)C[l+m]=C[h+m]^v|4278190080,q--,m++;
for(;0<q&&m<a;)C[l+m]=C[h+m]^v|4278190080,q--,m++}break;case 2:if(-1==h){for(;0!=(q&-8)&&m+8<a;)for(f=0;8>f;f++)r<<=1,r&=255,0==r&&(t=0!=w?w&255:d[e++],r=1),C[l+m]=0!=(t&r)?v:4278190080,q--,m++;for(;0<q&&m<a;)r<<=1,r&=255,0==r&&(t=0!=w?w&255:d[e++],r=1),C[l+m]=0!=(t&r)?v:4278190080,q--,m++}else{for(;0!=(q&-8)&&m+8<a;)for(f=0;8>f;f++)r<<=1,r&=255,0==r&&(t=0!=w?w&255:d[e++],r=1),C[l+m]=0!=(t&r)?C[h+m]^v|4278190080:C[h+m],q--,m++;for(;0<q&&m<a;)r<<=1,r&=255,0==r&&(t=0!=w?w&255:d[e++],r=1),C[l+m]=0!=
(t&r)?C[h+m]^v|4278190080:C[h+m],q--,m++}break;case 3:for(;0!=(q&-8)&&m+8<a;)for(f=0;8>f;f++)C[l+m]=z,q--,m++;for(;0<q&&m<a;)C[l+m]=z,q--,m++;break;case 4:for(;0!=(q&-8)&&m+8<a;)for(f=0;8>f;f++)B=d[e++]|d[e++]<<8,C[l+m]=4278190080|B>>8&248|B>>13&7|(B>>3&252|B>>9&3)<<8|(B<<3&248|B>>2&7)<<16,q--,m++;for(;0<q&&m<a;)B=d[e++]|d[e++]<<8,C[l+m]=4278190080|B>>8&248|B>>13&7|(B>>3&252|B>>9&3)<<8|(B<<3&248|B>>2&7)<<16,q--,m++;break;case 8:for(;0!=(q&-8)&&m+8<a;)for(f=0;8>f;f++)H?(C[l+m]=z,H=!1):(C[l+m]=y,H=
!0,q++),q--,m++;for(;0<q&&m<a;)H?(C[l+m]=z,H=!1):(C[l+m]=y,H=!0,q++),q--,m++;break;case 13:for(;0!=(q&-8)&&m+8<a;)for(f=0;8>f;f++)C[l+m]=4294967295,q--,m++;for(;0<q&&m<a;)C[l+m]=4294967295,q--,m++;break;case 14:for(;0!=(q&-8)&&m+8<a;)for(f=0;8>f;f++)C[l+m]=4278190080,q--,m++;for(;0<q&&m<a;)C[l+m]=4278190080,q--,m++;break;default:q--,m++}}return C}function Bc(a){Qb=a;de=(a+7)/8>>0;switch(a){case 16:pb=Le;kd=Me;break;case 8:pb=Ef;break;case 32:pb=Ff;kd=Gf;break;default:x.invitation||g.showMessage(a+
" bit color is not supported anymore.")}}function ld(a,b){R=a;ca=b;ga=ma=0;fa=R-1;ha=ca-1;svGlobal.logger.warn("resolution changed, w:"+a+" h:"+b);if(g.onresolutionchange)g.onresolutionchange(a,b)}function K(a){sa.send(a)}function mc(a,b,c,d,e,h){this.data=a;this.left=d;this.top=e;this.width=b;this.height=c;this.bitsperpixel=h;this.bytesperpixel=Math.floor((h+7)/8)}function Ne(){var a,b=Array(5),c=Array(5);c[0]=null;for(var d=0;5>d;d++)a=Array(600),a[0]=null,b[d]=a;this.putBitmap=function(a,d,l){32767==
d?(c[a]&&(c[a].data=null,c[a]=null),c[a]=l):(a=b[a],a[d]&&(a[d].data=null,a[d]=null),a[d]=l)};this.getBitmap=function(a,d){return 32767==d?c[a]:b[a][d]}}function Oe(a){var b=__svi18n.errorCode[a];b||(b="error "+a);if(g.onerror)g.onerror({name:a,message:b});g.displayMsg&&hi5.notifications.notify({msg:b});0<svGlobal.log&&console.error&&console.error(b)}function Hf(){this.style=this.yOrigin=this.xOrigin=0;this.pattern=Array(8)}function If(){this.bottom=this.top=this.right=this.left=0}function Jf(){this.action=
this.offset=this.bottom=this.top=this.right=this.left=0}function Kf(){this.opcode=this.cy=this.cx=this.y=this.x=0}function Lf(a,b){this.size=a;this.data=b}function Mf(a,b,c,d,e,h,l){this.font=a;this.character=b;this.offset=c;this.baseLine=d;this.width=e;this.height=h;this.fontData=l}function Nf(){this.opcode=this.backgroundColor=this.endY=this.endX=this.startY=this.startX=this.mixmode=0;this.pen=new Of}function Pf(){this.cacheIDX=this.cacheID=this.colorTable=this.srcY=this.srcX=this.opcode=this.cy=
this.cx=this.y=this.x=0}function Qf(){this.foregroundColor=this.backgroundColor=this.opcode=this.cy=this.cx=this.y=this.x=0;this.brush=new Hf}function Of(){this.color=this.width=this.style=0}function Rf(){this.dataSize=this.opcode=this.lines=this.foregroundColor=this.flags=this.y=this.x=0;this.data=Array(256)}function Sf(){this.color=this.cy=this.cx=this.y=this.x=0}function Tf(){this.srcY=this.srcX=this.opcode=this.cy=this.cx=this.y=this.x=0}function Uf(){this.length=this.opcode=this.boxBottom=this.boxRight=
this.boxTop=this.boxLeft=this.clipBottom=this.clipRight=this.clipTop=this.clipLeft=this.font=this.unknown=this.y=this.x=this.backgroundColor=this.foregroundColor=this.mixmode=this.flags=0;this.text=null;this.textPos=0}function Qd(){this.orderType=0;this.bounds=new If;this.destBlt=new Kf;this.patBlt=new Qf;this.screenBlt=new Tf;this.line=new Nf;this.rectangle=new Sf;this.deskSave=new Jf;this.memBlt=new Pf;this.polyLine=new Rf;this.text2=new Uf;this._line=new hi5.graphic.Line}function Vf(){function a(a,
b,e,h,l,k){this.x=a;this.y=b;this.cx=e;this.cy=h;this.offset=l;this.data=k}var b=[];this.save=function(c,d,e,h,l,k){c=new a(c,d,e,h,l,k);d=0;for(e=b.length;d<e;d++)if(!b[d]){b[d]=c;return}b.push(c)};this.restore=function(a,d,e,h,l){for(var k,n=0,q=b.length;n<q;n++)if((k=b[n])&&k.x==a&&k.y==d&&k.cx==e&&k.cy==h){if(k.offset==l)return a=k.data,b[n]=null,a;svGlobal.logger.warn("TODO: offset")}return null}}function Pe(){eb=ka=!1;Ga=null;Qe();Ua=new Qd;nc=0;Uc=Array(256);Cc=new Ne;for(var a=0;12>a;a++)Dc[a]=
Array(256);Ec=Array(20);fb.reset()}function Wf(a){if(!Zb)return"";a=g.modifyURL(Cb()+"/CLIP?s="+Zb+"&t="+Date.now());var b=new XMLHttpRequest;b.open("GET",a,!1);b.setRequestHeader("Content-Type","text/plain;charset=UTF-8");b.send(null);return a=b.responseText}function Xf(){function a(a){if(!(a.winWidth&&a.winHeight&&a.showState&&45<a.winHeight&&45<a.winWidth))return!1;var b=1>a.ownerWinid;if(!b)return b;if(0==a.showState)return!1;var c=a.style;if(0!=(c&4194304))return!0;a=0!=(a.extStyle&128);(b=b&&
!a)&&0!=(c&2147483648)&&0==(c&2156396544)&&(b=!1);return b}function b(a){for(;0<a.ownerWinid;){var b=h.getWinById(a.ownerWinid);if(b&&b.isVisible())a=b;else break}return a}function c(a){for(var b="";a;)a.titleInfo&&(b=a.titleInfo),a=h.getWinById(a.ownerWinid);return b}var d=[],e=0,h=this;this.mainWin=null;this.addWin=function(b){for(var c=d.length,n=!1,q=0;q<c;q++)if(b.id==d[q].id){d[q]=b;n=!0;break}n||d.push(b);1==d.length&&(e=Date.now());0<g.windowState&&(a(b)&&!h.mainWin?(h.mainWin=b,0<g.windowState&&
(b.fillBrowser(),b.activate(1),svGlobal.logger.info("MainWin:"+b.id),h.getOtherApps(F.zOrders,function(a){if(0<a.length&&g.onexistingapp)g.onexistingapp(a)},5E3))):0<g.windowState&&b.checkBound())};this.popWins=function(a){a=h.getWinById(a);var b=[];if(a){a=0<a.ownerWinid?a.ownerWinid:a.id;for(var c=d.length,c=c-1;0<=c;c--)if(d[c].ownerWinid==a||d[c].id==a)b.push(d[c]),d.splice(c,1)}return b};this.hasApp=function(a){for(var b=0,c=d.length;b<c;b++)if(d[b].appId==a)return!0;return!1};this.isNew=function(){return 3E4>
Date.now()-e};this.getAll=function(){return d};this.hasWin=function(a){return 0<=d.indexOf(a)};this.close=function(){for(var a=0,b=d.length;a<b;a++)d[a].close()};this.clear=function(){d.length=0};this.delWin=function(a){for(var b=0,c=d.length;b<c;b++)if(d[b].id==a)return d.splice(b,1),b;return-1};this.isRunning=function(){var a,b=d.length;if(1>b)return!1;for(var c=0,b=d.length;c<b;c++)if(a=d[c],a.isVisible())return!0;return!1};this.getWinById=function(a){var b,c=d.length;if(1>c)return null;for(var e=
0;e<c;e++)if(b=d[e],b.id==a)return b;return null};this.getTopWin=function(a){var b=null,c,e=a.length;for(c=0;c<e&&(!(b=h.getWinById(a[c]))||!b.isVisible());c++)b=null;if(!b)for(svGlobal.logger.warn("No win found"),e=d.length,c=e-1;0<=c&&(b=d[c],!b.isVisible());c--)b=null;return b};this.getMain=function(a){return(a=h.getTopWin(a))?b(a):null};this.getOtherApps=function(a,e,n){var q=d.length;if(0!=q&&d[q-1])if(q=d[q-1].appId,n||!q)setTimeout(function(){h.getOtherApps(a,e)},n||3E3);else{n=[];if(q=h.getTopWin(a)){for(var r=
0<q.ownerWinid?q.ownerWinid:q.id,m=[],g=0,q=d.length;g<q;g++)d[g].ownerWinid!=r&&d[g].id!=r&&d[g].isVisible()&&m.push(d[g]);g=0;for(q=m.length;g<q;g++)m[g].ownerWinid!=r&&m[g].id!=r&&(n.push({title:c(m[g]),win:b(m[g])}),r=0<m[g].ownerWinid?m[g].ownerWinid:m[g].id)}e(n)}}}function Yf(a){var b={},c=0,d=a;this.enabled=!1;hi5.EventControl(this);var e=this,h=null;this.release=function(){b=d=a=e=null};this.read=function(d,h,n){function q(b){b.target.readyState==FileReader.DONE&&(b=new Uint8Array(b.target.result),
a.send(d,h,n,b),c+=n,e.fireEvent("progress",[c]))}var r=b[b[d]];if("undefined"!=typeof r){var m=r.size,u=r.name;1>m?g.showMessage(__svi18n.file.zero+u,null,3E3):(r=r.slice(h,h+n),m=new FileReader,m.onloadend=q,m.readAsArrayBuffer(r))}};this.addFile=function(c,d){if(e.enabled){if(!("slice"in c||(c.slice=c.webkitSlice||c.mozSlice,"slice"in c))){g.showMessage(__svi18n.file.slice);return}var h=d||c.name;g.beforeupload&&g.beforeupload(c,d)||(e.fireEvent("beforeupload",[c,d]),h=encodeURIComponent(h),b[h]=
c,a.start(h,c.size))}};this.addFiles=function(a){if(e.enabled)for(var b=0,c=a.length;b<c;b++)e.addFile(a[b])};this.removeFile=function(a){d.remove(a)};this.confirmId=function(a,d,e){b[a]=d;e&&(c+=parseInt(e))};this.close=function(a){if(a){var d=b[a];if(d){delete b[a];delete b[d];a=decodeURIComponent(d);if(g.onfileuploaded)g.onfileuploaded(a);e.fireEvent("fileuploaded",[a])}for(var h in b)return}else b={};c=0;e.fireEvent("uploaded");if(g.onuploaded)g.onuploaded()};this.cancelAll=function(){d.cancelAll();
if(g.onuploadingCancelled)g.onuploadingCancelled();e.fireEvent("uploadingCancelled");e.close()};this.list=function(a,b){h=b;d.list(a)};this.notifyFiles=function(a){h&&h(a);e.fireEvent("files")}}function Zf(){function a(a,c){var d=c.length,e=new Uint8Array(2+2*d);e[0]=58;e[1]=a;for(var h=0,l=2,k=0;k<d;k++)h=c.charCodeAt(k),e[l++]=h&255,e[l++]=h>>8&255;K(e.buffer)}this.start=function(a,c){var d=a.length,e=new Uint8Array(10+2*d);e[0]=58;e[1]=0;e[2]=c&255;e[3]=c>>8&255;e[4]=c>>16&255;e[5]=c>>24&255;for(var h=
0,l=10,k=0;k<d;k++)h=a.charCodeAt(k),e[l++]=h&255,e[l++]=h>>8&255;K(e.buffer)};this.send=function(a,c,d,e){var h=new Uint8Array(22+d);h[0]=58;h[1]=3;var l=2;h[l++]=a&255;h[l++]=a>>8&255;h[l++]=a>>16&255;h[l++]=a>>24&255;h[l++]=c&255;h[l++]=c>>8&255;h[l++]=c>>16&255;h[l++]=c>>24&255;l+=4;h[l++]=d&255;h[l++]=d>>8&255;h[l++]=d>>16&255;h[l++]=d>>24&255;h.set(e,l+4);K(h.buffer)};this.remove=function(b){a(6,b)};this.list=function(b){a(5,b)};this.cancelAll=function(){a(7,"")}}function Re(a){Da||(Da=new Yf(new Zf));
a.setFileHandler(Da)}function Se(a,b,c){var d=!1;this.exe=a;this.args=b||"";this._dir=c||"";var e=this;this.close=function(){!d&&ka&&(d=!0,K("8C5"+e.exe+"\t"+e.args+"\t"+g.sessionInfo.appInfo.session))}}function ee(a){var b=this;a||(a=143);this.send=function(c){var d=!!c.buffer,e=d?c:c.getData(),h=64==a;c=d?e.length:c.getEnd()||e.length;c<e.length&&(e=d?e.subarray(0,c):e.slice(0,c));d=h?5:9;c=new Uint8Array(d+c);c[0]=a;if(h)c[1]=b.id,c[2]=b.id>>8,c[3]=b.id>>16,c[4]=b.id>>24;else for(var h=b.name,
l=Math.min(h.length,8),k=0;k<l;k++)c[1+k]=h.charCodeAt(k);c.set(e,d);K(c.buffer)};this.name="";this.count=this.id=this.flags=0}function $f(){var a=window.opener;if(a)try{if(a.__sparkUser&&a.__sparkUser.session)return a.__sparkUser;if(a.opener&&a.opener.__sparkUser.session)return a.opener.__sparkUser}catch(b){}return null}function Te(){function a(a){$a=new RecordingManager;a=0<a.user.length?a.server+"_"+a.user:a.server;a={name:a,width:R,height:ca,color:Qb,namesuffix:".rdpv",filetag:"RDPV",duration:0};
$a.setHeader(a)}if(!ka){eb=!1;if(Fc)sa=Fc;else{var b=u+"&width="+R+"&height="+ca+"&server_bpp="+Qb+"&audio="+ta.available+Df();0>u.indexOf("waWidth")&&(b+="&waWidth="+x.waWidth+"&waHeight="+x.waHeight);var c=new Date,b=b+("&tzOffset="+c.getTimezoneOffset()+"&time="+c.getTime()),d=c="",e="";for(e in $b){var h=$b[e];"flags"in h&&(c&&(c+=",",d+=","),c+=h.name,d+=h.flags)}c&&(b=b+("&channelName="+c)+("&channelFlags="+d));c="";for(e in ac)h=ac[e],"flags"in h&&(c&&(c+=","),c+=h.name);c&&(b+="&gwChannelName="+
c);if(d=$f())c=d.account,d=d.session,c&&(b+="&account="+c),d&&(b+="&session="+d);c=hi5.browser.isTouch&&(1024<=window.innerWidth||768<=window.innerHeight);x.audioRecord=za(x.audioRecord)&&hi5.audio.recordable;pa.init(c,!!x.remotefx,x.audioRecord);x.audioRecord&&(b+="&audioRecord=on");0<pa.count&&(b+="&dvcChannels="+pa.names.join(","));hi5.browser.binaryWS()&&(b+="&binary=on");A.existingFile&&(b+="&existingFile="+A.existingFile);b+="&isTouch="+c+"&gatewayAddr="+encodeURIComponent(Cb());u=b=g.modifyURL(b);
b=0==g.mode&&A.wsPost?u.substring(0,u.indexOf("?"))+"?_METHOD=post":u;sa=g.oncreatewebsocket?g.oncreatewebsocket(b):new WebSocket(b,"rdp");"binaryType"in sa&&(sa.binaryType="arraybuffer")}svGlobal.logger.info(u);sa.onopen=function(a){ka=!0;if(g.onopen)g.onopen();K("87"+navigator.userAgent);A.joinCloseMode&&g.setJoinCloseMode(A.joinCloseMode)};void 0!=x.recording&&"on"==x.recording&&a(x);sa.onmessage=ag;sa.onclose=hb;sa.onerror=bg;if(b=F[F.length-1])oa?b&&(b.remoteApp=new Se(x.exe,x.args,"")):hd(x.displayName||
g.server,b.getWindow());if(x.invitation){var l=null;b&&(l=b.initChat(x.expert));oc=new g.GatewayChannel;oc.name="C_H_A_T";oc.process=function(a){a=a.getUnicodeString(a.getEnd()-a.getPosition(),!0);l&&l.add(a,x.novice)};l&&(l.onchat=function(a){if(ka){var b=Array(2*a.length),b=new hi5.DataBuffer(b,0,b.length);b.setUnicodeString(a);b.markEnd();oc.send(b)}});g.addGatewayChannel(oc)}}}function bg(a){svGlobal.logger.warn(a)}function pc(a){a=hi5.Base64.dec(a,0);Ja.attach(a,0,a.length);return Ja}function ag(a){var b;
a=a.data;if("string"!=typeof a)switch(b=new Uint8Array(a),null!=$a&&$a.add(new RecordingObj(b,0,a.byteLength,-1)),Ja.attach(b,0,a.byteLength),b=Ja.getLittleEndian16(),b){case 28:Ue(Ja);break;case 48:Ve(Ja);break;case 49:We(Ja);break;case 55:a=Ja;b=a.getByte();switch(b){case 0:Fa=a.getLittleEndian16();Ma=a.getLittleEndian16();Na=a.getLittleEndian32();a.skipPosition(6);Oa=a.getLittleEndian16();svGlobal.logger.info("Audio Format, tag="+Fa+" channels="+Ma+" bitsPerSample="+Oa+" samplePerSec="+Na);ta.supportAudioData&&
(bc=new Xe(g.audioBuffer));break;case 1:cg(a)}break;case 60:Ye(Ja);break;case 62:Ze(Ja.getUnicodeString(Ja.getEnd()-Ja.getPosition(),!1));break;case 63:$e(Ja);break;case 64:b=Ja;var c=b.getByte();a=b.getLittleEndian32();switch(c){case 1:b=b.getAscllString();pa[b].id=a;pa[a]=pa[b];if(pa[a].onopen)pa[a].onopen();break;case 3:pa[a].process(b);break;case 4:if(pa[a]&&pa[a].onclose)pa[a].onclose()}break;case 146:a=Ja;b=a.getByte();switch(b){case 1:ib.processPong(a)}break;default:if(g.onunknownmessage)g.onunknownmessage(b,
Ja);else svGlobal.logger.warn("@TODO:"+b+"\n")}else switch(b=parseInt(a.substring(0,2),16),c=a.substring(2),b){case 0:a=u.substring(u.indexOf("?")+1);K("00"+a);K("87"+navigator.userAgent);break;case 15:Pa=!0;fe=qc=!1;cc=g.reconnectTimes;Ua=new Qd;if(g.onready)g.onready();a="";for(a in $b)if((b=$b[a])&&b.onopen)b.onopen();for(a in ac)if((b=ac[a])&&b.onopen)b.onopen();break;case 26:b=c;a=JSON.parse(b);if(g.onnotify)g.onnotify(a);if(a.name){svGlobal.logger.info("msg="+b);if(a.type&&g.onerror)g.onerror(a);
b=__svi18n.errorCode["S"+a.name]||"";b+=a.message;g.showMessage(b,null);qc=!0}else 0<svGlobal.log&&console.erro("No error code for message:"+b);break;case 27:F.drawLicense(c);break;case 28:Ue(pc(c));break;case 48:Ve(pc(c));break;case 49:We(pc(c));break;case 50:a=c;b=parseInt(a.substring(0,1),10);a=a.substring(1);switch(b){case 1:dg(a);break;case 2:!(b=F.getFocused())||b.processClipReq(a)||!A.clipWarnAlways&&af||!x||x.leagacyMode||(g.showMessage(__svi18n.info.menucopy,null,5E3),af=!0);break;case 5:(b=
F.getFocused())&&b.setIgnorePaste("0"!=a)}break;case 51:F.setReadOnly("1"==c);break;case 54:b=c.split("\t");a=Cb()+b[0];a=g.modifyURL(a);svGlobal.logger.info("Downloading file:"+a+" name:"+b[1]+" driver:"+b[2]);g.onprintingready&&g.onprintingready({link:a,printerName:b[1],pinterDriver:b[2]})||(b=F.getFocused())&&b.showPDF(a);break;case 55:b=c;a=parseInt(b.substring(0,1),16);b=b.substring(1);switch(a){case 0:a=b.split("\t");Fa=parseInt(a[0],10);Ma=parseInt(a[1],10);Oa=parseInt(a[2],10);Na=parseInt(a[3],
10);svGlobal.logger.debug("Audio Format, tag="+Fa+" channels="+Ma+" bitsPerSample="+Oa+" samplePerSec="+Na);ta.supportAudioData&&(bc||(bc=new Xe(g.audioBuffer)));break;case 1:eg(b)}break;case 56:b=a=JSON.parse(c);Zb=a.session;b.server||(b.server=g.server);if(c=hi5.$("joinSelect"))c.value=b.joinMode;if(c=hi5.$("requestControl"))c.disabled=b.hasControl;a.joined?F.execute("setAutoScale",[!0]):za(x.connectif)&&(g.mode=0,g.reconnectOnResize=Wa,F.setSize(R,ca));var c=A.page&&A.page.join||"join.html",d=
Cb(),c=d+"/"+c+"?id="+(a.joined||a.numericId),e=a.webAddress;e&&0<e.length&&e.toLowerCase()!=d.toLowerCase()&&(d=e.indexOf("://"),g.protocol="http"==e.substring(0,d)?"ws":"wss",g.gateway=e,c+="&gateway="+encodeURIComponent(e));c=g.modifyURL(c);b.joinLink=c;g.sessionInfo.appInfo=b;"isApp"in b&&oa!==b.isApp&&(oa=b.isApp,Ke(),F.setSize(R,ca,oa?"hidden":null),D=Tc(R,ca),eb||F.execute("setAutoScale",[!0]));a.ver&&a.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);
if(g.onsessionstart)g.onsessionstart(g.sessionInfo);break;case 57:b=c;a=b.split("\t");svGlobal.logger.debug(b);if(b=F.getWinById(parseInt(a[0]))){if(!F.hasApp(a[1])&&g.onremoteappstart)g.onremoteappstart({id:a[1]});b.appId=a[1]}break;case 58:b=c;if(Da)if(a=parseInt(b.charAt(0),10),b=b.substring(1),5==a)Da.notifyFiles(JSON.parse(b));else switch(b=b.split("\t"),a){case 1:Da.confirmId(b[0],b[1],b[2]);break;case 2:Da.read(b[0],parseInt(b[1],10),parseInt(b[2],10));break;case 4:Da.close(b[0])}break;case 59:a=
hi5.Base64.dec(c,0);a=new RdpBuffer(a,0,a.length);a=a.getLittleEndian32();!jb&&a&16?a&128&&(Da=null):(ge=!1,Da=null);a&64&&g.showMessage(__svi18n.info.recording);F.execute("setFeature",[a]);break;case 60:Ye(pc(c));break;case 61:a=JSON.parse(c);switch(a.type){case 0:ld(a.width,a.height);D=Tc(R,ca);Bc(a.color);if(b=a.server)g.server=a.server;bf=a.length;c=F.getFocused();oa=1==a.isRail;c&&(c.setSize(R,ca,oa?"hidden":null),c.setAutoScale(!oa),b&&hd(x.displayName||g.server,c.getWindow()),b=a.keyboard,
"undefined"!=typeof b&&0==b&&c.setUnicode(!0),b=a.mapDisk)&&(ge=!0,Re(c));if(g.onopened)g.onopened(a);break;case 1:a=a.duration;if(g.onprogress)g.onprogress(a,bf);break;case 2:if(2==a.status)Pe(),ka=!0;else if(b=0==a.status,b!=D.isPaused()){if(g.onsessionpause&&g.onsessionpause(b,a))break;D.pause(b);b||D.repaint(0,0,D.width,D.height);a.warn&&g.showMessage(b?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)}}break;case 62:Ze(c);break;case 63:$e(pc(c));break;default:if(g.onunknownmessage)g.onunknownmessage(b,
c);else svGlobal.logger.warn("@TODO:"+a+"\n")}ib.sendPing()}function Ue(a){var b=a.getAscllString(8),c=ac[b];null!=c?c.process(a):svGlobal.logger.warn("Channel "+b+" not found")}function fg(a,b){var c=0,d=!1;this.width=a;this.interval=b;var e=this,h=0;this.start=function(){d||(d=!0,c=setInterval(function(){var a=F.getFocused();a&&ka&&(a=a.getThumbnail(e.width))&&a.length!=h&&(K("8E7"+a),h=a.length)},e.interval))};this.stop=function(){clearInterval(c)}}function gg(a,b){!Qa||Qa.width==a&&Qa.interval==
b||(Qa.stop(),Qa=null);Qa||(Qa=new fg(a,b));Qa.start()}function $e(a){var b=a.getAscllString(8);(b=$b[b])&&b.process&&b.process(a)}function Ze(a){var b=parseInt(a.substring(0,1),16),c,d;c=a.substring(1);a=!1;var e=g.sessionInfo.appInfo;switch(b){case 0:d=JSON.parse(c);Pe();ka=!0;a=d.width;c=d.height;if(a==R&&c==ca)break;ld(a,c);F.setSize(a,c,oa?"hidden":null);D=Tc(a,c);break;case 1:Wa=g.reconnectOnResize;g.reconnectOnResize=!1;d=JSON.parse(c);g.sessionInfo.joinedSessions.push(d.numericId);g.onsessionjoin&&
(a=g.onsessionjoin(d));if(a)break;g.showMessage(__svi18n.info.joinsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 2:d=JSON.parse(c);g.sessionInfo.joinedSessions.removeElm(d.numericId);0==g.sessionInfo.joinedSessions.length&&(g.reconnectOnResize=Wa);g.onsessionexit&&(a=g.onsessionexit(d));if(a)break;g.showMessage(__svi18n.info.exitsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 3:d=JSON.parse(c);e.joinMode!=d.mode&&(e.joinMode=d.mode,c=hi5.$("joinSelect"))&&(c.value=d.mode);if(e.hasControl)break;
F.setReadOnly(!1);if(c=hi5.$("requestControl"))c.disabled=!0;g.ongivecontrol&&(a=g.ongivecontrol());if(a)break;g.showMessage(__svi18n.info.givecontrol,null,5E3);break;case 4:F.setReadOnly(!0);e.hasControl=!1;if(c=hi5.$("requestControl"))c.disabled=!1;g.ontakebackcontrol&&(a=g.ontakebackcontrol());if(a)break;g.showMessage(__svi18n.info.nocontrol,null,5E3);break;case 5:b=function(){g.refuseControl(d.numericId);this.destroy()};e=function(){g.giveControl(d.numericId);this.destroy();D.isPaused()&&g.pauseSession(g.sessionInfo.appInfo.numericId,
!1)};d=JSON.parse(c);g.onrequirecontrol&&(a=g.onrequirecontrol(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);c=__svi18n.info.recontrol;D.isPaused&&(c+="<br><br>"+(__svi18n.info.autoresume||""));hi5.notifications.notify({title:a,msg:c,cbYes:e,cbNo:b});break;case 6:F.execute("setTouchRemoting",[!0]);break;case 7:d=JSON.parse(c);d.width&&d.height&&(g.reconnectOnResize=!1,D=Tc(d.width,d.height),ld(d.width,d.height),F.setSize(d.width,d.height));d.color&&(Bc(d.color),svGlobal.logger.warn("Color depth changed to:"+
d.color));break;case 8:d=JSON.parse(c);fe=!0;if(g.onrequestcredential&&g.onrequestcredential(d,Rb.reconnect))break;if(g.onautherror&&g.onautherror(d))break;a=F.getFocused();a.requestCredential(d,Rb.reconnect);break;case 9:d=JSON.parse(c);0<d.interval&&0<d.width?gg(d.width,d.interval):Qa&&(Qa.stop(),Qa=null);break;case 11:b=function(){g.allowJoin(d.numericId,!1);this.destroy()};e=function(){g.allowJoin(d.numericId,!0);this.destroy()};d=JSON.parse(c);g.onrequirejoin&&(a=g.onrequirejoin(d));if(a)break;
a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);hi5.notifications.notify({title:a,msg:__svi18n.info.reqjoin,cbYes:e,cbNo:b})}}function Ye(a){var b=a.getByte();switch(b){case 32:if(b=a,!D.isPaused()){b.getLittleEndian16();a=b.getLittleEndian16();var b=b.getLittleEndian16(),c=F.getFocused();c.moveCursor(a,b,!0)}}}function eg(a){function b(a){var b=0;a*=l;for(n=0;n<l;n++)b|=(h[a+n]&255)<<8*n;b>q?(b-=m,b/=-r):b/=q;return b}function c(a){return function(){K("8A"+a)}}if(ta.available&&!D.isPaused()){var d=
a.indexOf("\t"),e=a.substring(0,d),h=hi5.Base64.dec(a,d+1);if(a=1!=Fa)Sb||(Sb=new He),h=Sb.decode(h,0,h.length);a=Oa;var l=a>>3,k=Math.floor(h.length/l),n=0,q=Math.pow(2,a-1)-1,r=-q-1,m=Math.pow(2,a);a=0;if(ta.supportAudioData){d=Array(k);d[0]=.1;for(a=0;a<k;a++)d[a]=b(a);a=bc.add(d);setTimeout(c(e),a-1E3*ta.delay)}else{var d=Ma,k=Math.floor(k/d),g=ta.getBuffer(k),w=g.getChannelData(0),y=g.getChannelData(1);for(a=0;a<k;){var z=2*a,t=b(z);1==d?(w[a]=t,y[a]=t):(w[a]=t,y[a]=b(z+1));a++}a=ta.playBuffer(g);
setTimeout(c(e),1E3*(a-ta.delay))}}}function cg(a){function b(a){return function(){ka&&K("8A"+a)}}if(ta.available&&!D.isPaused()){var c=a.getByte()+","+a.getLittleEndian16()+","+a.getLittleEndian64(),d=a.getPosition(),e=a.getData(),h=a.getEnd()-d;if(41222==Fa)(a=hi5.audio.getAudioContext())&&a.decodeAudioData(e.buffer.slice(d),function(a){a=ta.playBuffer(a);jb||setTimeout(b(c),1E3*(a-ta.delay))},function(a){svGlobal.logger.warn(a)});else{if(a=1!=Fa)Sb||(Sb=new He),e=Sb.decode(e,d,h),d=0,h=e.length;
var l=Oa,k=Math.floor(h/(l>>3)),n=h=0,q=0;a||(h=Math.pow(2,l-1)-1,n=-h-1,q=Math.pow(2,l));var r=l=0;if(ta.supportAudioData){var m=Array(k);m[0]=.1;if(a)for(l=0;l<k;l++)m[l]=e[d++];else for(l=0;l<k;l++)r=e[d++]|e[d++]<<8,r>h?(r-=q,r/=-n):r/=h,m[l]=r;e=bc.add(m);setTimeout(b(c),e-1E3*ta.delay)}else{var m=Ma,k=Math.floor(k/m),g=ta.getBuffer(k),w=g.getChannelData(0),y=g.getChannelData(1),l=0;if(a)for(;l<k;)1==m?y[l]=w[l]=e[d++]:(w[l]=e[d++],y[l]=e[d++]),l++;else for(;l<k;)r=e[d++]|e[d++]<<8,r>h?(r-=q,
r/=-n):r/=h,1==m?w[l]=r:(w[l]=r,r=e[d++]|e[d++]<<8,r>h?(r-=q,r/=-n):r/=h),y[l]=r,l++;e=ta.playBuffer(g);jb||setTimeout(b(c),1E3*(e-ta.delay))}}}}function Xe(a){function b(b){var c=b.length,d=c>k.size();if(e||d)k.stop(),setTimeout(function(){k.start()},1E3*a);else for(d=0;d<c;d++)b[d]=k.pull()}var c=[],d,e,h,l=new hg(Ma,Na,b),k=this;this.delay=a;this.reset=function(){d=c.length=0;e=!0;l.stop();h=0};this.reset();this.start=function(){e&&(l.start(),e=!1)};this.stop=function(){l.stop();e=!0};this.size=
function(){for(var a=c.length,b=0,d=0;d<a;d++)b+=c[d].length;return b};this.add=function(b){var d=Date.now();h<d&&(h=d);var e=b.length/(Na*Ma)*1E3;h+=e;e=c.length;c[e]=b;0==e&&(d=Date.now(),setTimeout(function(){l.start()},1E3*a));return h-d};this.pull=function(){if(0==c.length)return null;var a=c[0];if(d<a.length)return a[d++];c.shift();d=0;return this.pull()}}function hg(a,b,c){function d(){var a;if(k){a=e.mozWriteAudio(k.subarray(n));h+=a;n+=a;if(n<k.length)return;k=null}a=e.mozCurrentSampleOffset();
a=a+l-h;if(0<a){var b=new Float32Array(a);c(b);a=e.mozWriteAudio(b);a<b.length&&(k=b,n=a);h+=a}}var e=new Audio;e.mozSetup(a,b);var h=0,l=a*Math.floor(b/2),k=null,n=0,q=null;this.start=function(){q=setInterval(d,100)};this.stop=function(){q&&clearInterval(q)}}function ig(a){var b=null;this.available=!1;this.delay=a;this.supportAudioData=this.supportWebAudio=!1;if(0==x.playSound||0<g.mode)(b=hi5.audio.getAudioContext())?this.supportWebAudio=this.available=!0:"AudioDataDestination"in window&&(this.available=
this.supportAudioData=!0);this.getBuffer=function(a){return b.createBuffer(2,a,Na)};var c=0,d=null;this.setVolume=function(a){1==a?d=null:(d||(d=b.createGain()),d.gain.value=a)};this.playBuffer=function(e){var h=b.createBufferSource();h.buffer=e;d?(h.connect(d),d.connect(b.destination)):h.connect(b.destination);var l=b.currentTime,k=0<c?c:l+a;k<l&&(k=l);c=k+e.duration;h.start?h.start(k):h.noteOn(k);return c-l};this.iOSFix=function(){if(b&&hi5.browser.isTouch&&hi5.browser.isSafari){var a=this.getBuffer(1024),
c=b.createBufferSource();c.buffer=a;c.connect(b.destination);c.start?c.start(0):c.noteOn(0)}};this.close=function(){b=null}}function jg(a){if(!g.openLink||2E3<a.length)return!1;var b=a.indexOf(";");0<b&&(a=a.substring(b+1));b=a;a=a.toLowerCase();var c=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");c||(0==a.indexOf("www.")?(c=!0,a="http://"+a):0==a.indexOf("ftp.")&&(c=!0,a="ftp://"+a));if(c){if(0<a.indexOf("\r")||
0<a.indexOf("\n"))return!1;if(g.onurlredirection&&g.onurlredirection(c))return!0;a=F.getFocused();if(!a)return!1;a.processLink(b);return!0}return!1}function dg(a){g.onservercopy&&g.onservercopy(a)||(jg(a)||F.copyToClip(a),setTimeout(function(){K("883")},999))}function Ve(a){a.getLittleEndian16();var b=a.getByte(),c=a.getByte(),d=a.getLittleEndian16(),e=null;0!=(c&32)?(d-=18,fb.dec(a.getData(),a.getPosition(),d,c),e=fb.getData()):e=a;switch(b){case 2:a=e;b=a.getLittleEndian16();switch(b){case 0:a.skipPosition(2);
b=a.getLittleEndian16();a.skipPosition(2);cf(a,b);break;case 1:df(a);break;case 2:ef(a);break;case 3:break;default:svGlobal.logger.warn("Unimplemented Update type "+b)}break;case 20:break;case 31:break;case 27:a=e;c=b=b=0;b=a.getLittleEndian16();a.skipPosition(2);switch(b){case 3:b=a.getLittleEndian16();c=a.getLittleEndian16();if(D.isPaused())break;F.getFocused().moveCursor(b,c,!0);break;case 6:Vc(a,24);break;case 7:he(a.getLittleEndian16());break;case 1:a=a.getLittleEndian16();switch(a){case 0:F.setCursor("default");
break;default:svGlobal.logger.warn("XXX system pointer message "+a)}break;case 8:b=a.getLittleEndian16(),Vc(a,b)}break;case 34:break;case 38:kg(e);break;case 40:Rb.sendKeyboardSynchronize(za(x.scrollLock),za(x.numLock),za(x.capsLock));break;case 47:qc=!0;a=e.getLittleEndian32();jb||K("85"+a);svGlobal.logger.info("Disconnect:"+a);(b=11==a&&oa)&&F.close();1>a||b||Oe(a.toString(16).toUpperCase());break;case 50:e.skipPosition(4);break;case 54:a=e.getLittleEndian32().toString(16).toUpperCase();a=__svi18n.serverStatus[a];
g.displayMsg&&svGlobal.logger.info(a);break;case 55:break;default:svGlobal.logger.warn("Unimplemented Data PDU type "+b)}}function lg(a,b){var c,d,e=g.sessionInfo;switch(b){case 0:a.skipPosition(4);e.domain=a.getUnicodeString(52,!0);a.skipPosition(4);e.userName=a.getUnicodeString(512,!0);e.sessionId=a.getLittleEndian32();break;case 1:e.version=a.getLittleEndian16(),a.skipPosition(4),e.sessionId=a.getLittleEndian32(),c=a.getLittleEndian32(),d=a.getLittleEndian32(),a.skipPosition(558),e.domain=a.getUnicodeString(c,
!0),e.userName=a.getUnicodeString(d,!0)}return e}function ff(){if(!eb&&(setTimeout(function(){ka&&K("884")},999),g.onloggedin))g.onloggedin();eb=!0;oa&&F.execute("setAutoScale",[!1]);Da&&(Da.enabled=!0);rc&&!oa&&(D.setContext(F.getFocused().context),D.repaint(0,0,D.width,D.height))}function kg(a){var b=a.getLittleEndian32();if(3>b)lg(a,b),ff();else if(3==b&&(a.skipPosition(2),b=a.getLittleEndian32(),a.skipPosition(4),2!=b)){a.getLittleEndian32();a.skipPosition(4);var c={};c.logId=a.getLittleEndian32();
c.time=Date.now();g.sessionInfo.sessionId=c.logId;ff();a=a.getBytes(16);for(var b=Array(16),d=0;16>d;d++)b[d]=a[d]&255;c.random=b;a="8D"+c.logId+"\t"+hi5.Base64.enc(b);g.sessionInfo.userName&&(a+="\t"+g.sessionInfo.userName,g.sessionInfo.domain&&(a+="\t"+g.sessionInfo.domain));jb||K(a);"sessionStorage"in window&&setTimeout(function(){sessionStorage[Je()]=JSON.stringify(c)},300)}}function mg(){var a=0,b=0,c=[0],d=new RdpBuffer(c,0,0);this.addFragement=function(d,h){Db(d.getData(),d.getPosition(),c,
b,h);b+=h;a+=h};this.clearFragements=function(){d.setPosition(0);d.markEnd(a);b=a=0;return d}}function We(a){var b=a.getByte(),c=b&15,d=b>>4&3,e,h=0;2==(b>>6&3)&&(h=a.getByte());e=a.getLittleEndian16();b=null;0!=(h&32)?(fb.dec(a.getData(),a.getPosition(),e,h),b=fb.getData(),e=fb.getDecompressedLength()):b=a;if(0!=d)switch(d){case 2:case 3:Gc.addFragement(b,e);return;case 1:Gc.addFragement(b,e),b=Gc.clearFragements()}switch(c){case 0:a=b.getLittleEndian16();cf(b,a);break;case 1:b.skipPosition(2);df(b);
break;case 2:b.skipPosition(2);ef(b);break;case 3:break;case 4:a=b;for(c=a.getEnd();a.getPosition()<c;)switch(d=a.getLittleEndian16(),d){case 1:case 6:h=a.getLittleEndian16();b=a.getLittleEndian16();a.getLittleEndian16();a.getBigEndian16();var d=a,l=d.getByte();d.skipPosition(2);var k=d.getByte(),n=d.getLittleEndian16(),q=d.getLittleEndian16(),r=d.getLittleEndian32(),m=void 0;e=d.getPosition()+r;switch(k){case 0:l=ce(d.getData(),r,d.getPosition());m=ya(l.length);yd(l,0,m,n,q,1);D.setRGBs(h,b,n,q,
m,0,n);D.postPaint(h,b,n,q);break;case 1:re(d,l,n,q,Hc);l=Hc.getData();m=Hc.getDataSize();m=ya(m);yd(l,0,m,n,q,1);D.setRGBs(h,b,n,q,m,0,n);D.postPaint(h,b,n,q);break;case 3:for(var l=gf.decode(d,r),n=l.getRects(),q=l.getTiles(),m=l.getTileSize(),k=(l=l.getRectSize())?new Sc(0,0,0,0):null,g=0,r=0;r<m;r++){var w=q[r];if(l)for(var y=0;y<l;y++)g=n[y],g.intersection(w.x,w.y,64,64,k),k.isEmpty()||(g=64*(k.y-w.y)+(k.x-w.x),k.x+=h,k.y+=b,D.setRGBs(k.x,k.y,k.width,k.height,w.data,g,64),D.postPaint(k.x,k.y,
k.width,k.height));else D.setRGBs(w.x,w.y,64,64,w.data,0,64),D.postPaint(w.x,w.y,64,64)}}d.setPosition(e);break;case 4:h=a;d=h.getLittleEndian16();h=h.getLittleEndian32();1==d&&K("91"+h);break;default:svGlobal.logger.warn("Invalid surface cmd:"+d)}D.commitPaint();break;case 5:F.setCursor("default");break;case 6:break;case 8:break;case 9:Vc(b,24);break;case 10:he(b.getLittleEndian16());break;case 11:a=b;c=a.getLittleEndian16();Vc(a,c);break;default:svGlobal.logger.warn("XXX RDP5 opcode "+c)}}function yd(a,
b,c,d,e,h){h*=d;for(var l=0;l<e;l++)d=b+(e-l-1)*h,Db(a,d,c,l*h,h)}function ng(){var a=ya(10240),b=0,c=gb(10240),d=0,e=gb(10240),h=0,l=gb(10240),k=0,n=gb(0),q=0;this.getData=function(){return a};this.getDataSize=function(){return b};this.resetData=function(c){a.length<c&&(a=ya(c));b=c;return a};this.resetLumaPlane=function(a){c.length<a&&(c=gb(a));d=a;return c};this.getLumaPlanceSize=function(){return d};this.resetOrangeChromaPlane=function(a){e.length<a&&(e=gb(a));h=a;return e};this.getOrangeChromaPlane=
function(){return h};this.resetGreenChromaPlane=function(a){l.length<a&&(l=gb(a));k=a;return l};this.getGreenChromaPlane=function(){return k};this.resetAlphaPlane=function(a){n.length<a&&(n=gb(a));q=a;return n};this.getAlphaPlane=function(){return q}}function og(){function a(a,c,d,e,h){if(0==d)Va(e,0,h,255);else if(d<h){var l=d=0,k=0,l=h;for(h=0;4<l;)k=a[c++],5==l?(e[h++]=k,l--):k==a[c]?(c++,255>(a[c]&255)?(d=a[c++]&255,d+=2):(c++,d=(a[c+3]&255)<<24|(a[c+2]&255)<<16|(a[c+1]&255)<<8|a[c]&255,c+=4),
Va(e,h,h+d,k),h+=d,l-=d):(e[h++]=k,l--);for(d=0;4>d;d++)e[h++]=a[c++]}else Db(a,c,e,0,h)}this.process=function(b,c,d,e,h){c=b.getLittleEndian32();var l=b.getLittleEndian32(),k=b.getLittleEndian32();b.skipPosition(4);var n=b.getByte(),q=b.getByte();b.skipPosition(2);var r=b.getData(),m=b.getPosition(),g=d*e,w=4*g,y=h.resetData(g),z=d+(~(d&7)+1&7),t=e+(~(e&1)+1&1),w=z*t,v=h.resetLumaPlane(w),g=h.resetOrangeChromaPlane(w);h=h.resetGreenChromaPlane(w);var w=d*e,t=0<q?(z>>1)*(t>>1):w,B=0<q?t:w;a(r,m,c,
v,0<q?z*e:w);m+=c;a(r,m,l,g,t);a(r,m+l,k,h,B);for(var r=v,m=g,g=h,N=w=t=h=v=z=0,H=0,C=0,f=B=0,aa=N=0,u=d+(~(d&7)+1&7),n=n-1,v=0;v<e;v++)for(0<q?(h=v*u,t=(v>>1)*(u>>1),w=(v>>1)*(u>>1)):(h=v*d,t=v*d,w=v*d),z=0;z<d;z++)N=r[h]&255,H=(m[t]&255)<<n<<24>>24,C=g[w]<<n<<24>>24,B=N+H-C,f=N+C,N=N-H-C,N=0>N?0:255<N?255:N,f=0>f?0:255<f?255:f,B=0>B?0:255<B?255:B,y[aa++]=4278190080|N<<16|f<<8|B,h++,t+=0<q?z%2:1,w+=0<q?z%2:1;b.skipPosition(c+l+k)}}function hf(a,b,c){var d=a,e=c,h=0,l=8,k=b;this.attach=function(a,
b,c){d=a;e=c;h=0;l=8;k=b};this.getBits=function(a){for(var b=0,c=0;h<e&&0<a;)b=a,b>l&&(b=l),0!=c&&(c<<=b),c|=d[h+k]>>l-b&(1<<b)-1,l-=b,a-=b,0==l&&(l=8,h++);return c};this.putBits=function(a,b){for(var c=a,m=b,g=0;h<e&&0<m;)g=m,g>l&&(g=l),d[h+k]|=(c>>m-g&(1<<g)-1)<<l-g,l-=g,m-=g,0==l&&(l=8,h++)};this.eos=function(){return h>e};this.left=function(){return h>=e?0:8*(e-h-1)+l};this.getProcessBytes=function(){return 8>l?h+1:h}}function jf(){this.y=this.x=this.CrLen=this.CbLen=this.YLen=this.quantIdxCr=
this.quantIdxCb=this.quantIdxY=0;this.data=ya(4096);this.data[0]=0;var a=this;this.readHeaderfromStream=function(b){b.skipPosition(6);a.quantIdxY=b.getByte();a.quantIdxCb=b.getByte();a.quantIdxCr=b.getByte();a.x=64*b.getLittleEndian16();a.y=64*b.getLittleEndian16();a.YLen=b.getLittleEndian16();a.CbLen=b.getLittleEndian16();a.CrLen=b.getLittleEndian16()}}function pg(){function a(a,e,h,l,k,n,q){h=a.et;var r=l,m=k,g=n;n=4096;k=a.bitStream;var w=1;l=w<<3;var y=1,z=y<<3,t=0,v=q,B=0,N=0,t=0;for(null==k?
k=new hf(r,m,g):k.attach(r,m,g);!k.eos()&&0<n;)if(0!=w){for(;!k.eos();){t=k.getBits(1);if(0!=t)break;r=w=1<<w;r>n&&(r=n);0<r&&(Va(v,B,B+r,0),B+=r);n-=w;l+=4;80<l&&(l=80);0>l&&(l=0);w=l>>3}r=w=k.getBits(w);r>n&&(r=n);0<r&&(Va(v,B,B+r,0),B+=r);n-=w;w=k.getBits(1);N=0;do if(t=k.getBits(1),1==t)N++;else break;while(1);t=k.getBits(y);t|=N<<y;0==N?(z+=-2,80<z&&(z=80),0>z&&(z=0),y=z>>3):1!=N&&(z+=N,80<z&&(z=80),0>z&&(z=0),y=z>>3);r=t+1;0<n&&(v[B++]=0!=w?-r:r);n--;l+=-6;80<l&&(l=80);0>l&&(l=0);w=l>>3}else{N=
0;do if(t=k.getBits(1),1==t)N++;else break;while(1);t=k.getBits(y);t|=N<<y;0==N?(z+=-2,80<z&&(z=80),0>z&&(z=0),y=z>>3):1!=N&&(z+=N,80<z&&(z=80),0>z&&(z=0),y=z>>3);r=t;if(1!=h){N=r;for(m=0;0!=N;)N>>=1,m++;m=k.getBits(m);r-=m;0!=m&&0!=r?(l+=-6,80<l&&(l=80),0>l&&(l=0),w=l>>3):0==m&&0==r&&(l+=6,80<l&&(l=80),0>l&&(l=0),w=l>>3);0<n&&(v[B++]=0!=(m&1)?-1*(m+1>>1):m>>1);n--;0<n&&(v[B++]=0!=(r&1)?-1*(r+1>>1):r>>1);n--}else 0==r?(0<n&&(v[B++]=0),n--,l+=3):(0<n&&(v[B++]=0!=(r&1)?-1*(r+1>>1):r>>1),n--,l+=-3),
80<l&&(l=80),0>l&&(l=0),w=l>>3}h=q;n=64;k=4032;for(l=4033;1<n;k++,l++,n--)h[l]+=h[k];h=q;c(h,0,4096,5);c(h,0,1024,e[8]-6);c(h,1024,1024,e[7]-6);c(h,2048,1024,e[9]-6);c(h,3072,256,e[5]-6);c(h,3328,256,e[4]-6);c(h,3584,256,e[6]-6);c(h,3840,64,e[2]-6);c(h,3904,64,e[1]-6);c(h,3968,64,e[3]-6);c(h,4032,64,e[0]-6);a=a.dwtBuffer;b(q,3840,a,8);b(q,3072,a,16);b(q,0,a,32)}function b(a,b,c,l){for(var k=0,n=0,q=0,r=q=n=k=0,m=0,g=0,w=0,y=0,z=0,t=0,w=l<<1,g=b+l*l*3,q=b,k=0,r=b+l*l,m=b+l*l*2,n=l*l*2,z=0;z<l;z++){c[k]=
a[g]-(a[q]+a[q]+1>>1)<<16>>16;c[n]=a[r]-(a[m]+a[m]+1>>1)<<16>>16;for(t=1;t<l;t++)y=t<<1,c[k+y]=a[g+t]-(a[q+t-1]+a[q+t]+1>>1)<<16>>16,c[n+y]=a[r+t]-(a[m+t-1]+a[m+t]+1>>1)<<16>>16;for(t=0;t<l-1;t++)y=t<<1,c[k+y+1]=(a[q+t]<<1)+(c[k+y]+c[k+y+2]>>1)<<16>>16,c[n+y+1]=(a[m+t]<<1)+(c[n+y]+c[n+y+2]>>1)<<16>>16;y=t<<1;c[k+y+1]=(a[q+t]<<1)+c[k+y]<<16>>16;c[n+y+1]=(a[m+t]<<1)+c[n+y]<<16>>16;g+=l;q+=l;k+=w;r+=l;m+=l;n+=w}for(y=0;y<w;y++){for(t=0;t<l;t++)z=t<<1,k=b+z*w+y,n=t*w+y,q=n+l*w,a[k]=c[n]-((0<t?c[q-w]:
c[q])+c[q]+1>>1)<<16>>16;for(t=0;t<l;t++)z=t<<1,k=b+z*w+y,n=t*w+y,q=n+l*w,a[k+w]=(c[q]<<1)+(a[k]+a[k+(t<l-1?2*w:0)]>>1)<<16>>16}}function c(a,b,c,l){if(0!=l)for(;0<c;b++,c--)a[b]<<=l}this.decodeRgb=function(b,c,h,l,k,n,q,r,m,g){a(b,h,k,c.getData(),c.getPosition(),l,b.yrBuffer);c.skipPosition(l);a(b,h,q,c.getData(),c.getPosition(),n,b.cbgBuffer);c.skipPosition(n);a(b,h,m,c.getData(),c.getPosition(),r,b.crbBuffer);c.skipPosition(r);c=b.yrBuffer;h=b.cbgBuffer;l=b.crbBuffer;for(n=n=q=m=k=m=r=q=0;4096>
n;n++)q=c[n],r=h[n],m=l[n],q=q+4096<<16,k=q+91947*m,m=q-22544*r-46792*m,q+=115998*r,k>>=21,m>>=21,q>>=21,c[n]=0>k?0:255<k?255:k,h[n]=0>m?0:255<m?255:m,l[n]=0>q?0:255<q?255:q;c=b.yrBuffer;h=b.cbgBuffer;b=b.crbBuffer;for(l=0;4096>l;l++)g[l]=4278190080|b[l]<<16|h[l]<<8|c[l]}}function qg(){var a=[new Sc],b=[new jf],c=0,d=0;this.resetRects=function(b){if(a.length<b){var d=a.length;for(a.length=b;d<b;d++)a[d]=new Sc}c=b;return a};this.resetTiles=function(a){if(b.length<a){var c=b.length;for(b.length=a;c<
a;c++)b[c]=new jf}d=a;return b};this.getRectSize=function(){return c};this.getTileSize=function(){return d};this.getRects=function(){return a};this.getTiles=function(){return b}}function rg(){this.ctxId=0;this.tileSize=64;this.qt=this.et=this.xft=this.cct=this.flags=0;this.yrBuffer=La(4096);this.yrBuffer[0]=0;this.cbgBuffer=La(4096);this.cbgBuffer[0]=0;this.crbBuffer=La(4096);this.crbBuffer[0]=0;this.dwtBuffer=La(4096);this.dwtBuffer[0]=0;var a=this;this.setProperties=function(b){a.flags=b&7;a.cct=
b>>3&3;a.xft=b>>5&15;a.et=b>>9&15};this.bitStream=new hf}function sg(){var a=new qg,b=new pg,c=new rg;this.decode=function(b,h){for(var l=0,k=0,k=0,n=b.getPosition()+h;b.getPosition()<n;){l=b.getLittleEndian16();k=b.getLittleEndian32();if(0==k)break;k=b.getPosition()-6+k;switch(l){case 52416:l=b;l.getLittleEndian32();l.getLittleEndian16();break;case 52417:b.skipPosition(4);break;case 52418:for(var l=b,q=l.getByte(),r=0;r<q;r++){var m=l.getByte(),g=l.getLittleEndian16(),w=l.getLittleEndian16();svGlobal.logger.info("Channel, id:"+
m+" width:"+g+" height:"+w)}break;case 52419:l=b;l.skipPosition(2);c.ctxId=l.getByte();c.tileSize=l.getLittleEndian16();c.setProperties(l.getLittleEndian16());break;case 52420:b.skipPosition(10);break;case 52421:b.skipPosition(2);break;case 52422:l=b;l.skipPosition(2);l.skipPosition(1);q=l.getLittleEndian16();r=a.resetRects(q);for(m=0;m<q;m++)g=r[m],g.x=l.getLittleEndian16(),g.y=l.getLittleEndian16(),g.width=l.getLittleEndian16(),g.height=l.getLittleEndian16();l.skipPosition(4);break;case 52423:l=
b;q=c;l.skipPosition(6);r=l.getLittleEndian16();q.cct=r>>>4&3;q.xft=r>>>6&15;q.et=r>>>10&15;q.qt=r>>>14&3;w=l.getByte();l.skipPosition(1);r=l.getLittleEndian16();l.skipPosition(4);for(var m=Array(10*w),y=0,z=void 0,g=void 0,g=0;g<w;g++)z=l.getByte(),m[y++]=z&15,m[y++]=z>>>4,z=l.getByte(),m[y++]=z&15,m[y++]=z>>>4,z=l.getByte(),m[y++]=z&15,m[y++]=z>>>4,z=l.getByte(),m[y++]=z&15,m[y++]=z>>>4,z=l.getByte(),m[y++]=z&15,m[y++]=z>>>4;w=a.resetTiles(r);for(g=0;g<r;g++)y=w[g],y.readHeaderfromStream(l),d(q,
l,m,y.YLen,10*y.quantIdxY,y.CbLen,10*y.quantIdxCb,y.CrLen,10*y.quantIdxCr,y.data);break;default:svGlobal.logger.warn("unknown blockType 0x%X"+l)}b.setPosition(k)}return a};var d=b.decodeRgb;this.getResult=function(){return a}}function tg(a,b,c,d,e,h,l,k){this.x=a;this.y=b;this.width=c;this.height=d;this.mask=e;this.pixel=h;this.bpp=l;this.cache_idx=k}function Vc(a,b){if(!ug){var c=0,d=0,e=0,h=0,l=0,k=0,n=0,l=a.getLittleEndian16(),c=a.getLittleEndian16(),d=a.getLittleEndian16(),e=a.getLittleEndian16(),
h=a.getLittleEndian16(),k=a.getLittleEndian16(),n=a.getLittleEndian16(),q=a.getBytes(n),k=a.getBytes(k);if(0>c||c>=e-1)c=0;0>d?d=0:d>=h&&(d=h-1);for(var r=!0,m=0;m<n;m++)if(0!=q[m]){r=!1;break}c=new tg(c,d,e,h,k,q,b,l);d=c.x;e=c.y;h=c.width;n=c.height;q=c.mask;k=c.pixel;m=c.bpp;c=c.cache_idx;if(r)d={data:null,hotX:d,hotY:e,url:null,rawData:null,width:h,height:n,none:!0};else{for(var r=h,u=n,w=q,y=k,z=m,t=Array(r*u),v=t[0]=0,B=!0,N=w.length,H=0;H<N;H++)if(0!=w[H]){B=!1;break}for(var C=0,H=0;H<u;H++)for(N=
0;N<r;N++){t[v]=vg(N,H,r,u,z,y);if(!B){var C=H,f=r;1!=z&&(C=u-C-1);f=8*((f+7)/8|0);C=C*f+N;f=C/8>>0;C=w[f]&128>>C%8;C=0==C?1:0;if(0==C&&0!=t[v])t[v]=~t[v],t[v]|=4278190080;else if(1==C||0!=t[v])t[v]|=4278190080;32==z&&-1==t[v]&&0==C&&(t[v]=0)}v++}r=t;u="";1==m&&(u=kf.getName(r,h));y="";if(!u){B=40;H=h*n*4;z=k.length;t=q.length;w=22+B+H+z+t;m=new Uint8Array(w);m[0]=0;v=new RdpBuffer(m,0,w);v.setLittleEndian16(0);v.setLittleEndian16(2);v.setLittleEndian16(1);v.setByte(h);v.setByte(n);v.setByte(0);v.setByte(0);
v.setLittleEndian16(d);v.setLittleEndian16(e);v.setLittleEndian32(B+H+z+t);v.setLittleEndian32(22);v.setLittleEndian32(B);v.setLittleEndian32(h);v.setLittleEndian32(2*n);v.setLittleEndian16(1);v.setLittleEndian16(32);v.setLittleEndian32(0);v.setLittleEndian32(z+t);v.setLittleEndian32(0);v.setLittleEndian32(0);v.setLittleEndian32(0);v.setLittleEndian32(0);for(B=n-1;0<=B;B--)for(H=0;H<h;H++)N=r[h*B+H],v.setByte(N&255),v.setByte(N>>8&255),v.setByte(N>>16&255),v.setByte(N>>24&255);for(B=0;B<z;B++)v.setByte(k[B]);
for(B=0;B<t;B++)v.setByte(q[B]);hi5.browser.isIE?(q=hi5.Arrays.hashCode(m),k=new Uint8Array(w+6),k[0]=142,k[1]=56,k[2]=q&255,k[3]=q>>8&255,k[4]=q>>16&255,k[5]=q>>24&255,k.set(m,6),K(k.buffer),y=g.modifyURL(Cb()+"/CURSOR?"+q)):u="data:image/x-icon;base64,"+hi5.Base64.enc(v.getData())}d={data:u,hotX:d,hotY:e,url:y,rawData:r,width:h,height:n,none:!1}}20>c&&(Ec[c]=d);he(l)}}function vg(a,b,c,d,e,h){1!=e&&(b=d-b-1);b=(b*c+a)*e;c=b/8>>0;a=h[c]&255;switch(e){case 1:return 0==(a&128>>b%8)?0:4294967295;case 8:return 0==
a?0:4294967295;case 15:return a|=(h[c+1]&255)<<8,e=Array(4),lf(a,15,e,0),e[0]<<16|e[1]<<8|e[2];case 16:return a|=(h[c+1]&255)<<8,e=Array(4),lf(a,16,e,0),e[0]<<16|e[1]<<8|e[2];case 24:return(h[c+2]&255)<<16|(h[c+1]&255)<<8|a;case 32:return(h[c+3]&255)<<24|(h[c+2]&255)<<16|(h[c+1]&255)<<8|a}svGlobal.logger.warn("invalid bpp value for Xor Mask.");return 0}function he(a){if(!D.isPaused()){a:{if(20>a&&(a=Ec[a]))break a;a=null}a&&F.setCursor(a)}}function ef(a){var b=0,c=null,d=null,e=null,h=0;a.skipPosition(2);
b=a.getLittleEndian16();a.skipPosition(2);c=Array(b);d=Array(b);e=Array(b);a=a.getBytes(3*b);for(var l=0;l<b;l++)c[l]=a[h],d[l]=a[h+1],e[l]=a[h+2],h+=3;256==b&&(Ga||(Ga=Array(3)),Ga[0]=c,Ga[1]=d,Ga[2]=e)}function cf(a,b){for(var c=0,d=0,e=0;c<b;){d=a.getByte();e=d&3;switch(e){case 1:var h=a,l=d,k=0,n=0,q=!1;0!=(l&8)&&(Ua.orderType=h.getByte());var n=wg[Ua.orderType],r=h,m=n,g=0,w=0;0!=(l&64)&&m--;0!=(l&128)&&(m=2>m?0:m-2);for(var y=0;y<m;y++)w=r.getByte(),g|=w<<8*y;k=g;if(0!=(l&4)){if(0==(l&32)){var z=
h,t=Ua.bounds,v=z.getByte();0!=(v&1)?t.left=L(z,t.left,!1):0!=(v&16)&&(t.left=L(z,t.left,!0));0!=(v&2)?t.top=L(z,t.top,!1):0!=(v&32)&&(t.top=L(z,t.top,!0));0!=(v&4)?t.right=L(z,t.right,!1):0!=(v&64)&&(t.right=L(z,t.right,!0));0!=(v&8)?t.bottom=L(z,t.bottom,!1):0!=(v&128)&&(t.bottom=L(z,t.bottom,!0))}var B=Ua.bounds;ma=B.left;0>ma&&(ma=0);ga=B.top;0>ga&&(ga=0);fa=B.right;fa>=R&&(fa=R-1);ha=B.bottom;ha>=ca&&(ha=ca-1)}q=0!=(l&16);switch(Ua.orderType){case 0:var N=h,H=Ua.destBlt,C=k,f=q;0!=(C&1)&&(H.x=
L(N,H.x,f));0!=(C&2)&&(H.y=L(N,H.y,f));0!=(C&4)&&(H.cx=L(N,H.cx,f));0!=(C&8)&&(H.cy=L(N,H.cy,f));0!=(C&16)&&(H.opcode=N.getByte()&15);var aa=H.x,u=H.y,da=H.cx,x=H.cy,K=H.opcode;if(!(aa>R||u>ca)){var A=aa+da-1;A>fa&&(A=fa);aa<ma&&(aa=ma);var da=A-aa+1,Y=u+x-1;Y>ha&&(Y=ha);u<ga&&(u=ga);x=Y-u+1;1>da||1>x||(zd(K,D,R,aa,u,da,x,null,0,0,0),D.postPaint(aa,u,da,x))}break;case 1:var lc=h,O=Ua.patBlt,ja=k,P=q;0!=(ja&1)&&(O.x=L(lc,O.x,P));0!=(ja&2)&&(O.y=L(lc,O.y,P));0!=(ja&4)&&(O.cx=L(lc,O.cx,P));0!=(ja&8)&&
(O.cy=L(lc,O.cy,P));0!=(ja&16)&&(O.opcode=lc.getByte(),O.opcode=O.opcode&3|(O.opcode&48)>>2);0!=(ja&32)&&(O.backgroundColor=Wc(lc));0!=(ja&64)&&(O.foregroundColor=Wc(lc));var Q=lc,Ca=O.brush,be=ja>>7;0!=(be&1)&&(Ca.xOrigin=Q.getByte());0!=(be&2)&&(Ca.yOrigin=Q.getByte());0!=(be&4)&&(Ca.style=Q.getByte());var ea=Ca.pattern;0!=(be&8)&&(ea[0]=Q.getByte());if(0!=(be&16))for(var ka=1;8>ka;ka++)ea[ka]=Q.getByte();Ca.pattern=ea;var oa=O.x,E=O.y;if(!(oa>fa||E>ha)){var sa=O.cx,xd=O.cy,ta=O.opcode,pa=O.backgroundColor,
xa=O.foregroundColor,G=O.brush.xOrigin,La=O.brush.yOrigin,Da=O.brush.style,Ja=O.brush.pattern;var Qa=ta,Xc=oa,Yc=E,Tb=sa,dc=xd,Ad=xa,md=pa,se=G,xg=La,Bd=Da,Rd=Ja,Ad=pb(Ad),md=pb(md),te=Xc+Tb-1;te>fa&&(te=fa);Xc<ma&&(Xc=ma);var Tb=te-Xc+1,M=Yc+dc-1;M>ha&&(M=ha);Yc<ga&&(Yc=ga);dc=M-Yc+1;if(!(1>Tb||1>dc)){var ec=null;switch(Bd){case 0:for(var ec=ya(Tb*dc),Cd=ec[0]=0;Cd<ec.length;Cd++)ec[Cd]=Ad;zd(Qa,D,R,Xc,Yc,Tb,dc,ec,Tb,0,0);D.postPaint(Xc,Yc,Tb,dc);1==Tb&&F.execute("setCaretPos",[Xc,Yc]);break;case 2:svGlobal.logger.warn("hatch");
break;case 3:for(var Ma=Rd,ec=ya(Tb*dc),Na=ec[0]=0,Cd=0;Cd<dc;Cd++)for(var Oa=0;Oa<Tb;Oa++)ec[Na]=0==(Ma[(Cd+xg)%8]&1<<(Oa+se)%8)?Ad:md,Na++;zd(Qa,D,R,Xc,Yc,Tb,dc,ec,Tb,0,0);D.postPaint(Xc,Yc,Tb,dc);break;default:svGlobal.logger.warn("Unsupported brush style "+Bd)}}}break;case 2:var Dd=h,Ha=Ua.screenBlt,za=k,Sd=q;0!=(za&1)&&(Ha.x=L(Dd,Ha.x,Sd));0!=(za&2)&&(Ha.y=L(Dd,Ha.y,Sd));0!=(za&4)&&(Ha.cx=L(Dd,Ha.cx,Sd));0!=(za&8)&&(Ha.cy=L(Dd,Ha.cy,Sd));0!=(za&16)&&(Ha.opcode=Dd.getByte()&15);0!=(za&32)&&(Ha.srcX=
L(Dd,Ha.srcX,Sd));0!=(za&64)&&(Ha.srcY=L(Dd,Ha.srcY,Sd));var Mb=Ha.x,sc=Ha.y;if(!(Mb>fa||sc>ha)){var nd=Ha.cx,Ga=Ha.cy,Pa=Ha.opcode,Fa=Ha.srcX,Va=Ha.srcY,ue=Mb+nd-1;ue>fa&&(ue=fa);Mb<ma&&(Mb=ma);var nd=ue-Mb+1,ve=sc+Ga-1;ve>ha&&(ve=ha);sc<ga&&(sc=ga);Ga=ve-sc+1;Fa+=Mb-Ha.x;Va+=sc-Ha.y;1>nd||1>Ga||(12==Pa?D.moveArea(Fa,Va,nd,Ga,Mb-Fa,sc-Va):zd(Pa,D,nd,Mb,sc,nd,Ga,null,nd,Fa,Va),D.postPaint(Mb,sc,nd,Ga))}break;case 9:var Ic=h,Ra=Ua.line,vb=k,Xa=q;0!=(vb&1)&&(Ra.mixmode=Ic.getLittleEndian16());0!=(vb&
2)&&(Ra.startX=L(Ic,Ra.startX,Xa));0!=(vb&4)&&(Ra.startY=L(Ic,Ra.startY,Xa));0!=(vb&8)&&(Ra.endX=L(Ic,Ra.endX,Xa));0!=(vb&16)&&(Ra.endY=L(Ic,Ra.endY,Xa));0!=(vb&32)&&(Ra.backgroundColor=Wc(Ic));0!=(vb&64)&&(Ra.opcode=Ic.getByte());var kb=Ic,V=Ra.pen,Za=vb>>7;0!=(Za&1)&&(V.style=kb.getByte());0!=(Za&2)&&(V.width=kb.getByte());0!=(Za&4)&&(V.color=Wc(kb));var Jc=Ra.startX,wb=Ra.startY,ba=Ra.endX,od=Ra.endY,S=Ra.pen.color,T=Ra.opcode-1;if(wb==od){if(Jc>ba)var jb=Jc,Jc=ba,ba=jb;Jc<ma&&(Jc=ma);ba>fa&&(ba=
fa)}else Jc==ba&&(wb>od&&(jb=wb,wb=od,od=jb),wb<ga&&(wb=ga),wb>ha&&(wb=ha));mf(Jc,wb,ba,od,S,T);break;case 10:var ab=h,na=Ua.rectangle,xb=k,bb=q;0!=(xb&1)&&(na.x=L(ab,na.x,bb));0!=(xb&2)&&(na.y=L(ab,na.y,bb));0!=(xb&4)&&(na.cx=L(ab,na.cx,bb));0!=(xb&8)&&(na.cy=L(ab,na.cy,bb));0!=(xb&16)&&(nc=nc&4294967040|ab.getByte());0!=(xb&32)&&(nc=nc&4294902015|ab.getByte()<<8);0!=(xb&64)&&(nc=nc&4278255615|ab.getByte()<<16);na.color=nc;we(na.x,na.y,na.cx,na.cy,na.color,!0);break;case 11:var Zc=h,Ia=Ua.deskSave,
$c=k,Ed=q;0!=($c&1)&&(Ia.offset=Zc.getLittleEndian32());0!=($c&2)&&(Ia.left=L(Zc,Ia.left,Ed));0!=($c&4)&&(Ia.top=L(Zc,Ia.top,Ed));0!=($c&8)&&(Ia.right=L(Zc,Ia.right,Ed));0!=($c&16)&&(Ia.bottom=L(Zc,Ia.bottom,Ed));0!=($c&32)&&(Ia.action=Zc.getByte());var Eb=Ia,ne=Eb.right-Eb.left+1,oe=Eb.bottom-Eb.top+1;if(0==Eb.action){var fc=Eb.left,fb=Eb.top;1>ne||1>oe||xe.save(fc,fb,ne,oe,Eb.offset,D.getRGBs(fc,fb,ne,oe))}else{var gc=ne,$a=oe,ye=Eb.left,Nb=Eb.top,nf=xe.restore(ye,Nb,gc,$a,Eb.offset);nf?(D.setRGBs(ye,
Nb,gc,$a,nf,0,gc),D.postPaint(ye,Nb,gc,$a)):svGlobal.logger.warn("XXX no matched desktop save.")}break;case 13:var qb=h,qa=Ua.memBlt,Aa=k,hc=q;0!=(Aa&1)&&(qa.cacheID=qb.getByte(),qa.colorTable=qb.getByte());0!=(Aa&2)&&(qa.x=L(qb,qa.x,hc));0!=(Aa&4)&&(qa.y=L(qb,qa.y,hc));0!=(Aa&8)&&(qa.cx=L(qb,qa.cx,hc));0!=(Aa&16)&&(qa.cy=L(qb,qa.cy,hc));0!=(Aa&32)&&(qa.opcode=qb.getByte()&15);0!=(Aa&64)&&(qa.srcX=L(qb,qa.srcX,hc));0!=(Aa&128)&&(qa.srcY=L(qb,qa.srcY,hc));0!=(Aa&256)&&(qa.cacheIDX=qb.getLittleEndian16());
var rb=qa.x,sb=qa.y;if(!(rb>fa||sb>ha)){var Fb=qa.cx,Fd=qa.cy,ad=qa.srcX,yb=qa.srcY,gb=rb+Fb-1;gb>fa&&(gb=fa);rb<ma&&(rb=ma);var Fb=gb-rb+1,Db=sb+Fd-1;Db>ha&&(Db=ha);sb<ga&&(sb=ga);var Fd=Db-sb+1,ad=ad+(rb-qa.x),yb=yb+(sb-qa.y),tc=Cc.getBitmap(qa.cacheID,qa.cacheIDX);if(tc){var bd=tc.width,uc=tc.height;Fb>bd&&(Fb=bd);Fd>uc&&(Fd=uc);12==qa.opcode?D.setRGBs(rb,sb,Fb,Fd,tc.data,yb*bd+ad,bd):zd(qa.opcode,D,R,rb,sb,Fb,Fd,tc.data,bd,ad,yb);D.postPaint(rb,sb,Fb,Fd)}else svGlobal.logger.warn("Failed to get bitmap from cache, id:"+
qa.cacheID+" idx="+qa.cacheIDX)}break;case 22:var Gb=h,lb=Ua.polyLine,Jb=k,eb=q;0!=(Jb&1)&&(lb.x=L(Gb,lb.x,eb));0!=(Jb&2)&&(lb.y=L(Gb,lb.y,eb));0!=(Jb&4)&&(lb.opcode=Gb.getByte());0!=(Jb&16)&&(lb.foregroundColor=Wc(Gb));0!=(Jb&32)&&(lb.lines=Gb.getByte());if(0!=(Jb&64)){var hb=Gb.getByte();lb.dataSize=hb;lb.data=Gb.getBytes(hb)}var vc=lb,Ub=vc.x,Wa=vc.y,Yb=vc.foregroundColor,Cb=vc.lines,bc=vc.dataSize,ib=vc.data,Kc=Array(1);Kc[0]=Math.floor((Cb-1)/4)+1;for(var ic=0,Rb=0,$b=vc.opcode-1,ze=0;ze<Cb&&
Kc[0]<bc;ze++){var Lc=Ub,ac=Wa;0==ze%4&&(ic=ib[Rb++]);0==(ic&192)&&(ic|=192);0!=(ic&64)&&(Ub+=of(ib,Kc));0!=(ic&128)&&(Wa+=of(ib,Kc));mf(Lc,ac,Ub,Wa,Yb,$b);ic<<=2}break;case 27:var Ea=h,la=Ua.text2,Sa=k;0!=(Sa&1)&&(la.font=Ea.getByte());0!=(Sa&2)&&(la.flags=Ea.getByte());0!=(Sa&4)&&(la.opcode=Ea.getByte());0!=(Sa&8)&&(la.mixmode=Ea.getByte());0!=(Sa&16)&&(la.foregroundColor=Wc(Ea));0!=(Sa&32)&&(la.backgroundColor=Wc(Ea));0!=(Sa&64)&&(la.clipLeft=Ea.getLittleEndian16());0!=(Sa&128)&&(la.clipTop=Ea.getLittleEndian16());
0!=(Sa&256)&&(la.clipRight=Ea.getLittleEndian16());0!=(Sa&512)&&(la.clipBottom=Ea.getLittleEndian16());0!=(Sa&1024)&&(la.boxLeft=Ea.getLittleEndian16());0!=(Sa&2048)&&(la.boxTop=Ea.getLittleEndian16());0!=(Sa&4096)&&(la.boxRight=Ea.getLittleEndian16());0!=(Sa&8192)&&(la.boxBottom=Ea.getLittleEndian16());0!=(Sa&16384)&&Ea.skipPosition(1);0!=(Sa&32768)&&Ea.skipPosition(1);0!=(Sa&65536)&&Ea.skipPosition(1);0!=(Sa&131072)&&Ea.skipPosition(1);0!=(Sa&262144)&&Ea.skipPosition(7);0!=(Sa&524288)&&(la.x=Ea.getLittleEndian16());
0!=(Sa&1048576)&&(la.y=Ea.getLittleEndian16());if(0!=(Sa&2097152)){var pf=Ea.getByte();la.length=pf;la.text=Ea.getBytes(pf);la.textPos=0}var cd=la.font,Ya=la.flags,pd=la.mixmode,Sb=la.foregroundColor,pe=la.backgroundColor,Ae=la.clipLeft,Zb=la.clipTop,Fc=la.clipRight,oc=la.clipBottom,qd=la.boxLeft,Be=la.boxTop,pc=la.boxRight,cc=la.boxBottom,mb=la.x,Kb=la.y,W=la.length,U=la.text,Gd=Fc-Ae,Ac=oc-Zb,wc=pc-qd,Z=cc-Be,cb=null,X=0,va=0;qd+wc>R&&(wc=R-qd);1<wc?we(qd,Be,wc,Z,pe,!1):1==pd&&we(Ae,Zb,Gd,Ac,pe,
!1);for(var Mc=W,ua=0;ua<W;)switch(U[va+ua]){case 255:var Hd=U[va+ua+2];if(Hd>Mc-va){ua=W=0;break}var yg=U.slice?U.slice(va,va+Hd):U.subarray(va,va+Hd),Oc=new Lf(Hd,yg),nb=U[va+ua+1],Ob=Oc;if(nb<Uc.length){var I=Uc[nb];I&&(I.data=null);Uc[nb]=Ob}ua+=3;W-=ua;va=ua;ua=0;break;case 254:var J;a:{var qf=U[va+ua+1],rd=null;if(qf<Uc.length&&(rd=Uc[qf])&&rd.data){J=rd;break a}J=null}var Vb=J?J.data:null;Vb&&0==Vb[1]&&0==(Ya&32)&&(0!=(Ya&4)?Kb+=U[va+ua+2]:mb+=U[va+ua+2]);ua=ua+2<W?ua+3:ua+2;W-=ua;va=ua;ua=
0;if(!J)break;for(var zg=J.size,Lb=0;Lb<zg;Lb++)cb=rf(cd,Vb[Lb]),0==(Ya&32)&&(X=Vb[++Lb],0!=(X&128)?(0!=(Ya&4)?Kb+=Vb[Lb+1]|Vb[Lb+2]<<8:mb+=Vb[Lb+1]|Vb[Lb+2]<<8,Lb+=2):0!=(Ya&4)?Kb+=X:mb+=X),cb&&(sf(pd,mb+cb.offset&65535,Kb+cb.baseLine&65535,cb.width,cb.height,cb.fontData,pe,Sb,de,Qb),0!=(Ya&32)&&(mb+=cb.width));break;default:cb=rf(cd,U[va+ua]),0==(Ya&32)&&(X=U[va+ ++ua],0!=(X&128)?(0!=(Ya&4)?Kb+=U[va+ua+1]|U[va+ua+2]<<8:mb+=U[va+ua+1]|U[va+ua+2]<<8,ua+=2):0!=(Ya&4)?Kb+=X:mb+=X),cb&&(sf(pd,mb+cb.offset&
65535,Kb+cb.baseLine&65535,cb.width,cb.height,cb.fontData,pe,Sb,de,Qb),0!=(Ya&32)&&(mb+=cb.width)),ua++}1<wc?0<Z&&D.postPaint(qd,Be,wc,Z):0<Gd&&0<Ac&&D.postPaint(Ae,Zb,Gd,Ac);break;default:svGlobal.logger.warn("XXX Order type "+Ua.orderType)}0!=(l&4)&&Qe();break;case 2:var Id=a,xc=d>>2;switch(xc){case 11:var yc=Id,Pb=yc.getLittleEndian16(),Hb=yc.getLittleEndian32(),ra=yc.getPosition()+(Pb-7);if(0!=(Hb&16777216)){var db=Hb,Pc=yc,qe=Pc.getLittleEndian32();if(0!=(db&1073741824))svGlobal.logger.info("XXX rail icon, winId="+
qe);else if(0!=(db&2147483648))svGlobal.logger.info("XXX rail cache icon, winId="+qe);else if(0!=(db&536870912)){var Qc=qe;svGlobal.logger.info("***** delete winId="+Qc);F.delWin(Qc)}else Ag(Pc,db,qe)}else if(0!=(Hb&33554432))svGlobal.logger.info("XXX Alt Sec window Notify="+Hb);else if(0!=(Hb&67108864)){var Nc=Hb,Td=yc;svGlobal.logger.info("*** -- Alt Sec window Desktop="+Nc);if(0!=(Nc&1))svGlobal.logger.info("Desktop non monitored flags="+Nc);else if(0!=(Nc&32)){var tf=Td.getLittleEndian32();svGlobal.logger.info("Desktop monitored flags="+
Nc+" winId="+tf);F.setTitle(tf);if(!D.getContext()){var uf=F.getFocused();uf&&D.setContext(uf.context)}if(0!=(Nc&16)){var Ud=Td.getByte();if(0<Ud){var Wb=F.zOrders;Wb.length=Ud;for(var Xb=0;Xb<Ud;Xb++)Wb[Xb]=Td.getLittleEndian32(),svGlobal.logger.info("---zorders:"+Wb[Xb])}}}}else svGlobal.logger.info("XXX Alt Sec window order flgas="+Hb);yc.setPosition(ra);break;case 13:Id.getLittleEndian32();break;default:svGlobal.logger.warn("XXX Alt Sec order not implemented:"+xc)}break;case 3:var Ta=a,Rc=void 0,
ie=void 0,Jd=void 0,wa=void 0,Rc=Ta.getLittleEndian16(),Jd=Ta.getLittleEndian16(),ie=Ta.getByte(),wa=Ta.getPosition()+Rc+7;switch(ie){case 0:var zb=Ta,Kd=zb.getByte();zb.skipPosition(1);var Vd=zb.getByte(),dd=zb.getByte(),Sc=zb.getByte(),Wd=Math.floor((Sc+7)/8),Tc=zb.getLittleEndian16(),Bc=zb.getLittleEndian16(),Ec=zb.getPosition();zb.skipPosition(Tc);for(var ed=Array(Vd*dd*Wd),Ld=ed[0]=0,fd=Vd*Wd,Ka=0;Ka<dd;Ka++)Ld=Ec+(dd-Ka-1)*fd,zb.copyToByteArray(ed,Ka*fd,Ld,fd);Cc.putBitmap(Kd,Bc,new mc(Xd(ed,
Wd),Vd,dd,0,0,8*Wd));break;case 1:svGlobal.logger.info("TODO: color cache");break;case 2:var ob=Ta,qc=Jd,gd=ob.getByte();ob.getByte();var Md=ob.getByte(),Ib=ob.getByte(),Yd=ob.getByte(),sd=Math.floor((Yd+7)/8),jc=ob.getLittleEndian16(),Vc=ob.getLittleEndian16(),Nd=0;0!=(qc&1024)?Nd=jc:(ob.skipPosition(2),Nd=ob.getLittleEndian16(),ob.skipPosition(2),ob.skipPosition(2));var rc=void 0,rc=1==sd?Ce(Md,Ib,Nd,ob.getData(),ob.getPosition()):kd(Md,Ib,Nd,ob.getData(),ob.getPosition());ob.skipPosition(Nd);Cc.putBitmap(gd,
Vc,new mc(rc,Md,Ib,0,0,Yd));break;case 3:for(var Ab=Ta,je=null,Zd=0,ke=0,kc=0,Od=0,td=0,$d=0,ud=0,Bb=0,Zd=Ab.getByte(),ke=Ab.getByte(),le=0;le<ke;le++){var kc=Ab.getLittleEndian16(),Od=Ab.getLittleEndian16(),td=Ab.getLittleEndian16(),$d=Ab.getLittleEndian16(),ud=Ab.getLittleEndian16(),Bb=ud*Math.floor(($d+7)/8)+3&-4,tb=je=new Mf(Zd,kc,Od,td,$d,ud,Ab.getBytes(Bb));if(12>tb.font&&256>tb.character){var Pd=Dc[tb.font][tb.character];Pd&&(Pd.fontData=null);Dc[tb.font][tb.character]=tb}else svGlobal.logger.warn("put font: font="+
tb.font+" c="+tb.character)}break;case 4:vf(Ta,Jd,!1);break;case 5:vf(Ta,Jd,!0);break;case 8:var Ba=Ta,p=Jd&7,Gc=Ba.getLittleEndian16();Ba.skipPosition(8);var wd=Ba.getByte();Ba.skipPosition(2);var me=Ba.getByte(),zc=Ba.getLittleEndian16(),vd=Ba.getLittleEndian16(),hd=Ba.getLittleEndian32(),ae=null;if(1==me){re(Ba,wd,zc,vd,Hc);var id=Hc.getData(),jd=Hc.getDataSize(),ae=ya(jd);yd(id,0,ae,zc,vd,1);Cc.putBitmap(p,Gc,new mc(ae,zc,vd,0,0,32))}else if(0==me){var ld=ce(Ba.getData(),hd,Ba.getPosition()),
ae=ya(ld.length);yd(ld,0,ae,zc,vd,1);Cc.putBitmap(p,Gc,new mc(ae,zc,vd,0,0,32))}else svGlobal.logger.warn("XXX invalid codec id:"+me);Ba.skipPosition(hd);break;default:svGlobal.logger.info("XXX second Order, type="+ie)}Ta.setPosition(wa)}c++}D.commitPaint()}function Bg(a){this.id=a;this.appId="";var b=this;this.resizable=function(){return 0!=(b.style&262144)||0!=(b.style&65536)||0!=(b.style&16777216)||3==b.showState};this.fillBrowser=function(){if((!A.disableJoinedAppResize||2!=g.mode)&&b.resizable()){var c=
F.getOwnerSurface(b);c?(c=c.getWindow())&&b.resize(0,0,c.innerWidth,c.innerHeight):svGlobal.logger.warn("XXX No browser for "+a)}};this.parent=function(){return F.getWinById(b.ownerWinid)};this.resize=function(a,d,e,h){A.disableJoinedAppResize&&2==g.mode||K("8C1"+b.id+"\t"+a+"\t"+d+"\t"+e+"\t"+h)};this.checkBound=function(){var a=F.getOwnerSurface(b);if(a){var d=a.getWindow(),a=b.winWidth,e=b.winHeight,h=b.winOffsetX,l=b.winOffsetY;if(d&&!(1>a||1>e||0>h||0>l||hi5.browser.isTouch)){var k=!1,n=d.innerHeight,
d=d.innerWidth;b.resizable()?(a>d&&(a=d,k=!0),e>n&&(e=n,k=!0),h+a>d&&(h=d-a,k=!0),l+e>n&&(l=n-e,k=!0)):(h>d&&(h=d/2|0,k=!0),l>n&&(l=n/2|0,k=!0));k&&b.resize(h,l,a,e)}}else svGlobal.logger.warn("no surface for checkBound")};this.exeCommand=function(b){K("8C4"+a+"\t"+b)};this.activate=function(b){K("8C3"+a+"\t"+b)};this.close=function(){b.exeCommand(61536)};this.getAppId=function(){K("8C0"+a)};this.isVisible=function(){return b.winWidth&&b.winHeight&&b.showState&&45<b.winHeight&&45<b.winWidth};this.getAppId()}
function Ag(a,b,c){oa||(oa=!0);var d=0==(b&268435456);svGlobal.logger.info("\n\n=========== winId="+c+" existed="+d);var e=d?F.getWinById(c):new Bg(c);if(e){0!=(b&2)&&(e.ownerWinid=a.getLittleEndian32(),svGlobal.logger.info("***** ownerWinid="+e.ownerWinid));var h=!1,l=!1;0!=(b&8)&&(l=!0,e.style=a.getLittleEndian32(),e.extStyle=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" style="+e.style+" extStyle="+e.extStyle),svGlobal.logger.info("*****--- WS_POPUP="+(0!=(e.style&2147483648))),
svGlobal.logger.info("*****--- WS_DLGFRAME="+(0!=(e.style&4194304))),svGlobal.logger.info("*****--- DS_MODALFRAME="+(0!=(e.style&128))),svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+(0!=(e.extStyle&1))),svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+(0!=(e.extStyle&128))),svGlobal.logger.info("*****--- WS_BORDER="+(0!=(e.style&8388608))),svGlobal.logger.info("*****--- WS_CAPTION="+(0!=(e.style&12582912))),svGlobal.logger.info("*****--- WS_OVERLAPPED="+(0!=(e.style&0))),svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+
(0!=(e.style&13565952))),svGlobal.logger.info("*****--- WS_POPUPWINDOW="+(0!=(e.style&2156396544))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(e.style&262144))),svGlobal.logger.info("*****--- WS_CHILD="+(0!=(e.style&1073741824))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(e.style&262144))),svGlobal.logger.info("*****--- WS_EX_MDICHILD="+(0!=(e.extStyle&64))),svGlobal.logger.info("*****--- WS_EX_LAYERED="+(0!=(e.extStyle&524288))));if(0!=(b&16)){e.showState=a.getByte();svGlobal.logger.info("***** winId="+
c+" showState="+e.showState);var k=e.showState;switch(k){case 2:3==g.windowState&&setTimeout(function(){return function(){e.exeCommand(61728)}}(),50);break;case 3:e.fillBrowser()}}if(k=0!=(b&4)){var n=a.getLittleEndian16();e.titleInfo=a.getUnicodeString(n,!1);svGlobal.logger.info("***** winId="+c+" title="+e.titleInfo)}0!=(b&16384)&&(e.clientOffsetX=a.getLittleEndian32(),e.clientOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" coffX"+e.clientOffsetX+" coffY="+e.clientOffsetY));
0!=(b&65536)&&(e.clientAreaWidth=a.getLittleEndian32(),e.clientAreaHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" cw"+e.clientAreaWidth+" ch="+e.clientAreaHeight));0!=(b&131072)&&(e.rpContent=a.getLittleEndian32());0!=(b&262144)&&(e.rootParentHandle=a.getLittleEndian32());if(0!=(b&2048)){var n=a.getLittleEndian32(),q=a.getLittleEndian32();(0>e.winOffsetX||0>e.winOffsetY)&&0<n&&0<q&&l&&(h=!0);e.winOffsetX=n;e.winOffsetY=q;svGlobal.logger.info("***** winId="+c+" offX"+e.winOffsetX+
" offY="+e.winOffsetY)}0!=(b&32768)&&(e.winClientDeltaX=a.getLittleEndian32(),e.winClientDeltaY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" dX"+e.winClientDeltaX+" dY="+e.winClientDeltaY));0!=(b&1024)&&(e.winWidth=a.getLittleEndian32(),e.winHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" w"+e.winWidth+" h="+e.winHeight));0!=(b&256)&&(l=a.getLittleEndian16(),0<l&&a.skipPosition(8*l));0!=(b&4096)&&(e.visibleOffsetX=a.getLittleEndian32(),e.visibleOffsetY=a.getLittleEndian32());
0!=(b&512)&&(b=a.getLittleEndian16(),e.numVisibilityRects=b,0<b&&a.skipPosition(8*b));d?h&&e.checkBound():F.addWin(e);k&&F.setTitle(c)}else svGlobal.logger.warn("XXX, No win with id:"+c)}function vf(a,b,c){var d,e,h,l,k,n;d=0;e=b&7;k=((b&120)>>3)-2;b=(b&65408)>>7;0!=(b&2)&&a.skipPosition(8);0!=(b&1)?l=h=Ac.readVar2Bytes(a):(h=Ac.readVar2Bytes(a),l=Ac.readVar2Bytes(a));d=Ac.readVar4Bytes(a);n=Ac.readVar2Bytes(a);c&&0==(b&8)&&a.skipPosition(8);if(c){c=1==k?Ce(h,l,d,a.getData(),a.getPosition()):kd(h,
l,d,a.getData(),a.getPosition());a.skipPosition(d);if(!c){svGlobal.logger.warn("Failed to decompress bitmap data");return}a=new mc(c,h,l,0,0,8*k)}else{c=Array(h*l*k);c[0]=0;var q=a.getPosition(),r=0,m=h*k;for(d=0;d<l;d++)r=q+(l-d-1)*m,a.copyToByteArray(c,d*m,r,m);a=new mc(Xd(c,k),h,l,0,0,8*k)}Cc.putBitmap(e,n,a);0!=(b&2)&&svGlobal.logger.warn("XXX:TODO, persistent")}function L(a,b,c){var d=0;c?(d=a.getByte()<<24>>24,b+=d):b=a.getLittleEndian16()<<16>>16;return b}function Wc(a){var b=0,c=0,b=c=a.getByte(),
c=a.getByte(),b=b|c<<8,c=a.getByte();return b|c<<16}function df(a){var b=0,c=0,d=0,e=0,h=0,l=0,k=0,n=0,q=0,r=0,m=0,g=0,e=0,w,y,z,t;z=t=0;w=R;y=ca;for(var b=a.getLittleEndian16(),v=0;v<b;v++){var c=a.getLittleEndian16(),d=a.getLittleEndian16(),e=a.getLittleEndian16(),h=a.getLittleEndian16(),l=a.getLittleEndian16(),k=a.getLittleEndian16(),r=a.getLittleEndian16(),B=Math.floor((r+7)/8),m=a.getLittleEndian16(),g=a.getLittleEndian16(),n=e-c+1,q=h-d+1;w>c&&(w=c);y>d&&(y=d);z<e&&(z=e);t<h&&(t=h);Qb!=r&&(svGlobal.logger.warn("Server limited colour depth to "+
r+" bits"),Bc(r));if(0==m){h=l*B;r=k*h;e="Uint8Array"in window?new Uint8Array(r):Array(r);e[0]=0;m=a.getPosition();for(g=0;g<k;g++)Db(a.getData(),m,e,(k-g-1)*h,h),m+=h;a.skipPosition(r);k=void 0;k=0;B=Xd(e,B);D.setRGBs(c,d,n,q,B,k,l);D.postPaint(c,d,n,q)}else 0!=(m&1024)?e=g:(a.skipPosition(2),e=a.getLittleEndian16(),a.skipPosition(4)),h=a.getData(),r=e,m=a.getPosition(),1==B?(k=Ce(l,k,r,h,m),h=void 0,h=0,B=Xd(k,B),D.setRGBs(c,d,n,q,B,h,l),D.postPaint(c,d,n,q)):(B=kd(l,k,r,h,m),1>n||1>q||(D.setRGBs(c,
d,n,q,B,0,l),D.postPaint(c,d,n,q))),a.skipPosition(e)}D.commitPaint()}function Qe(){ma=0;fa=R-1;ga=0;ha=ca-1}function mf(a,b,c,d,e,h){var l=Math.min(a,c),k=Math.max(a,c),n=Math.min(b,d),q=Math.max(b,d);e=pb(e);var g=l>=ma&&k<=fa&&n>=ga&&q<=ha;if(!g){if(l>fa||k<ma||n>ha||q<ga)return;l=0;if(a==c)b>d&&(l=b,b=d,d=l),b<ga&&(b=ga),d>ha&&(d=ha);else if(b==d)a>c&&(l=a,a=c,c=l),a<ma&&(a=ma),c>fa&&(c=fa);else{l=Ua._line;l.set(a,b,c,d);k=l.intersection(ma,ga,fa,ga);n=[];k.onLine1&&k.onLine2&&n.push(k.x,k.y);
k=l.intersection(fa,ga,fa,ha);k.onLine1&&k.onLine2&&n.push(k.x,k.y);k=l.intersection(ma,ha,fa,ha);k.onLine1&&k.onLine2&&n.push(k.x,k.y);k=l.intersection(ma,ga,ma,ha);k.onLine1&&k.onLine2&&n.push(k.x,k.y);2==n.length&&(a>=ma&&a<=fa&&b>=ga&&b<=ha?n.push(a,b):c>=ma&&c<=fa&&d>=ga&&d<=ha&&n.push(c,d));if(4!=n.length)return;a=n[0];b=n[1];c=n[2];d=n[3]}}if(12==h)D.drawLine(a,b,c,d,e);else if(a==c||b==d){var l=a,k=b,n=c,q=d,m;if(k==q)if(n>l){if(m=n-l,!(1>m)){for(g=0;g<m;g++)Oc(h,D,l+g,k,e);D.postPaint(l,
k,m+1,1)}}else{if(m=l-n,!(1>m)){for(g=0;g<m;g++)Oc(h,D,n+g,k,e);D.postPaint(n,k,m+1,1)}}else if(q>k){if(m=q-k,!(1>m)){for(g=0;g<m;g++)Oc(h,D,l,k+g,e);D.postPaint(l,k,1,m+1)}}else if(m=k-q,!(1>m)){for(g=0;g<m;g++)Oc(h,D,l,q+g,e);D.postPaint(l,q,1,m+1)}}else{var u=Math.abs(c-a),w=Math.abs(d-b),l=a,k=b,y,z,t;q=c>=a?n=1:n=-1;m=d>=b?g=1:g=-1;u>=w?(m=n=0,z=u,y=u/2>>0,t=w):(g=q=0,z=w,y=w/2>>0,t=u,u=w);if(1>u)return;for(w=0;w<=u;w++)Oc(h,D,l,k,e),y+=t,y>=z&&(y-=z,l+=n,k+=g),l+=q,k+=m}l=Math.min(a,c);k=Math.max(a,
c);n=Math.min(b,d);q=Math.max(b,d);0>k-l||0>q-n||D.postPaint(l,n,k-l+1,q-n+1)}function sf(a,b,c,d,e,h,l,k,n,q){n=128;k=pb(k);l=pb(l);if(!(b>fa||c>ha)){var g=b+d-1;g>fa&&(g=fa);q=b<ma?ma:b;var g=g-b+1,m=c+e-1;m>ha&&(m=ha);var u=c<ga?ga:c,m=m-c+1;if(!(1>g||1>m)){var w=0,y=0,z=D.setRGB;if(u!=c||g!=d||m!=e||q!=b)if(0==a)for(a=0;a<m;a++){w=c+a;for(t=0;t<g;t++)0==n&&(y++,n=128),b+t>=q&&w>=u&&0!=(h[y]&n)&&z(b+t,w,k),n>>=1;y++;n=128;y==h.length&&(y=0)}else for(a=0;a<m;a++){w=c+a;for(t=0;t<g;t++)0==n&&(y++,
n=128),b+t>=q&&c+a>=u&&(0!=(h[y]&n)?z(b+t,w,k):z(b+t,w,l)),n>>=1;y++;n=128;y==h.length&&(y=0)}else if(0==a)for(a=0;a<e;a++){for(var w=c+a,t=0;t<d;t++)0==n&&(y++,n=128),0!=(h[y]&n)&&z(b+t,w,k),n>>=1;y++;n=128;y==h.length&&(y=0)}else for(a=0;a<e;a++){w=c+a;for(t=0;t<d;t++)0==n&&(y++,n=128),0!=(h[y]&n)?z(b+t,w,k):z(b+t,w,l),n>>=1;y++;n=128;y==h.length&&(y=0)}}}}function of(a,b){var c=a[b[0]++]&255,d=c&128,c=0!=(c&64)?c|-64:c&63;0!=d&&(c=c<<8|a[b[0]++]&255);return c}function we(a,b,c,d,e,h){a>fa||b>ha||
(c=a+c-1,c>fa&&(c=fa),a<ma&&(a=ma),c=c-a+1,d=b+d-1,d>ha&&(d=ha),b<ga&&(b=ga),d=d-b+1,1>c||1>d||(D.fillRect(a,b,c,d,pb(e)),D.postPaint(a,b,c,d)))}function hb(a){svGlobal.logger.warn("closed ...");if(g&&(a=0==g.mode,!ka&&a&&Oe("connection"),a=a&&(ka||cc<g.reconnectTimes)&&0<cc&&!qc,Pa=ka=!1,a)){cc--;g.showMessage(__svi18n.info.reconnecting+" "+(g.reconnectTimes-cc)+"/"+g.reconnectTimes,null,3E3);setTimeout(Te,5);return}if(!fe){pa=Ua=ta=null;Da&&(Da.release(),Da=null);Uc=Dc=Ec=Cc=xe=null;"undefined"!=
typeof rdp8bulkData&&rdp8bulkData.release();wf=re=Hc=gf=null;pa&&pa.close();Qa&&(Qa.stop(),Qa=null);ta&&ta.close();ib&&(ib.setInterval(0),ib=null);try{null!=$a&&($a.exit(),$a=null),F&&F.close()}catch(b){}Ja=null;sa&&(sa.onopen=null,sa.onmessage=null,sa.onclose=null,sa=sa.onerror=null);F=Gc=Rb=null;D&&(D.release(),D=null);fb&&(fb.release(),fb=null);g&&g.onclose&&(g.onclose(),g=null);hi5.browser.isChromeApp?chrome.runtime.onSuspend.removeListener(hb):window.removeEventListener("unload",hb,!1);window&&
window.$rdp&&(window.$rdp=null)}}function wd(a,b,c,d,e,h,l){for(var k=e*c+d,n=a.setRGB,q=a.getRGB,g=0;g<l;g++){for(var m=0;m<h;m++){if(a){var u=q(d+m,e+g);n(d+m,e+g,~u&xa)}else b[k]=~b[k]&xa;k++}k+=c-h}}function zd(a,b,c,d,e,h,l,k,n,q,g){if(!(0>h|0>l|0>c|0>n))switch(a){case 0:for(var m=d,u=e,w=h,y=l,z=b.setRGB,t=m;t<m+w;t++)for(var v=u;v<u+y;v++)z(t,v,0);break;case 1:for(var B=d,N=e,H=h,C=l,f=k,aa=n,x=g*aa+q,da=b.setRGB,D=b.getRGB,F=0;F<C;F++){for(var K=0;K<H;K++)da(B+H,N+C,~(D(B+H,N+C)|f[x])&xa);
x+=aa-H}break;case 2:for(var A=d,L=e,O=h,ja=l,P=k,Q=n,Ca=g*Q+q,R=b.setRGB,ea=b.getRGB,Y=0;Y<ja;Y++){for(var ca=0;ca<O;ca++){var E=ea(A+O,L+ja);R(A+O,L+ja,E&~P[Ca]&xa);Ca++}Ca+=Q-O}break;case 3:wd(b,k,n,q,g,h,l);var fa=b,xd=d,ha=e,ka=h,ga=l,G=k,ma=n,oa=q,sa=g;G?fa.setRGBs(xd,ha,ka,ga,G,sa*ma+oa,ma):fa.moveArea(oa,sa,ka,ga,xd-oa,ha-sa);break;case 4:wd(b,null,c,d,e,h,l);xf(b,c,d,e,h,l,k,n,q,g);break;case 5:wd(b,null,c,d,e,h,l);break;case 6:for(var ta=d,pa=e,ya=h,La=l,dc=k,Ad=n,md=g*Ad+q,se=b.setRGB,
za=b.getRGB,Bd=0;Bd<La;Bd++){for(var Rd=0;Rd<ya;Rd++){var Da=za(ta+Rd,pa+Bd);se(ta+Rd,pa+Bd,Da^dc[md]&xa);md++}md+=Ad-ya}break;case 7:for(var M=d,ec=e,Ga=h,Ua=l,Ja=k,Fa=n,Oa=g*Fa+q,Ha=b.setRGB,Va=b.getRGB,Qa=0;Qa<Ua;Qa++){for(var Mb=0;Mb<Ga;Mb++){var sc=Va(M+Mb,ec+Qa);Ha(M+Mb,ec+Qa,~(sc&Ja[Oa])&xa);Oa++}Oa+=Fa-Ga}break;case 8:xf(b,c,d,e,h,l,k,n,q,g);break;case 9:for(var Na=d,Ma=e,Za=h,Pa=l,jb=k,$a=n,Wa=g*$a+q,Ic=b.setRGB,Ra=b.getRGB,vb=0;vb<Pa;vb++){for(var Xa=0;Xa<Za;Xa++){var kb=Ra(Na+Xa,Ma+vb);
Ic(Na+Xa,Ma+vb,kb^~jb[Wa]&xa);Wa++}Wa+=$a-Za}break;case 10:break;case 11:for(var V=d,gb=e,Jc=h,wb=l,ba=k,od=n,S=g*od+q,T=b.setRGB,Db=b.getRGB,ab=0;ab<wb;ab++){for(var na=0;na<Jc;na++){var xb=Db(V+na,gb+ab);T(V+na,gb+ab,xb|~ba[S]&xa);S++}S+=od-Jc}break;case 12:var bb=b,Zc=d,Ia=e,$c=h,Ed=l,Eb=k,fb=n,eb=q,fc=g;Eb?bb.setRGBs(Zc,Ia,$c,Ed,Eb,fc*fb+eb,fb):bb.moveArea(eb,fc,$c,Ed,Zc-eb,Ia-fc);break;case 13:wd(b,null,c,d,e,h,l);yf(b,c,d,e,h,l,k,n,q,g);break;case 14:yf(b,c,d,e,h,l,k,n,q,g);break;case 15:for(var hb=
d,gc=e,ib=h,Cb=l,Nb=b.setRGB,pb=hb;pb<hb+ib;pb++)for(var qb=gc;qb<gc+Cb;qb++)Nb(pb,qb,xa);break;default:svGlobal.logger.warn("unsupported opcode: "+a)}}function Oc(a,b,c,d,e){if(b){var h=b.getRGB(c,d);switch(a){case 0:b.setRGB(c,d,0);break;case 1:b.setRGB(c,d,~(h|e)&xa);break;case 2:b.setRGB(c,d,h&~e&xa);break;case 3:b.setRGB(c,d,~e&xa);break;case 4:b.setRGB(c,d,(~h&e)*xa);break;case 5:b.setRGB(c,d,~h&xa);break;case 6:b.setRGB(c,d,h^e&xa);break;case 7:b.setRGB(c,d,~h&e&xa);break;case 8:b.setRGB(c,
d,h&e&xa);break;case 9:b.setRGB(c,d,h^~e&xa);break;case 10:break;case 11:b.setRGB(c,d,h|~e&xa);break;case 12:b.setRGB(c,d,e);break;case 13:b.setRGB(c,d,(~h|e)&xa);break;case 14:b.setRGB(c,d,h|e&xa);break;case 15:b.setRGB(c,d,xa);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+a),b.setRGB(c,d,e)}}}function xf(a,b,c,d,e,h,l,k,n,q){b=q*k+n;n=a.setRGB;a=a.getRGB;for(q=0;q<h;q++){for(var g=0;g<e;g++){var m=a(c+g,d+q);n(c+g,d+q,m&l[b]&xa);b++}b+=k-e}}function yf(a,b,c,d,e,h,l,k,n,g){b=g*
k+n;n=a.setRGB;a=a.getRGB;for(g=0;g<h;g++){for(var r=0;r<e;r++){var m=a(c+r,d+g);n(c+r,d+g,m|l[b]&xa);b++}b+=k-e}}function rf(a,b){if(12>a&&256>b){var c=Dc[a][b];if(c)return c}return null}function lf(a,b,c,d){switch(b){case 16:b=c;c=a>>8&248;var e=a>>3&252;a=a<<3&255;b[d]=c|c>>5;b[d+1]=e|e>>6;b[d+2]=a|a>>5;b[d+3]=255;break;case 15:b=c;c=a>>7&248;e=a>>2&248;a=a<<3&255;b[d]=c|c>>5;b[d+1]=e|e>>5;b[d+2]=a|a>>5;b[d+3]=255;break;case 8:c[d]=Ga[0][a];c[d+1]=Ga[1][a];c[d+2]=Ga[2][a];c[d+3]=255;break;case 32:c[d]=
a&255,c[d+1]=a>>8&255,c[d+2]=a>>16&255,c[d+3]=a>>24&255;default:c[d]=a&255,c[d+1]=a>>8&255,c[d+2]=a>>16&255,c[d+3]=255}}function Xd(a,b){var c=a.length/b>>0,d=ya(c);d[0]=0;var e=pb;switch(b){case 1:for(var h=0;h<c;h++)d[h]=e(a[h]);break;case 2:for(h=0;h<c;h++)d[h]=e(a[2*h+1]<<8|a[2*h]);break;default:for(h=0;h<c;h++)d[h]=e(a[h*b+2]<<16)|a[h*b+1]<<8|a[h*b]}return d}function Ce(a,b,c,d,e){var h=-1,l=0,k=0;c+=e;var n=0,g=0,r=0,m=a,u=-1,w=0,y=g=0,z=0,t=r=0,v=4294967295,B=!1,N=!1,H=!1,C=Array(a*b);for(C[0]=
0;e<c;){w=0;g=d[e++];n=g>>4;switch(n){case 12:case 13:case 14:n-=6;g&=15;r=16;break;case 15:n=g&15;9>n?(g=d[e++],g|=d[e++]<<8):g=11>n?8:1;r=0;break;default:n>>=1,g&=31,r=32}0!=r&&(H=2==n||7==n,0==g?g=H?d[e++]+1:d[e++]+r:H&&(g<<=3));switch(n){case 0:u!=n||m==a&&-1==h||(B=!0);break;case 8:y=d[e++];case 3:z=d[e++];break;case 6:case 7:v=d[e++];n-=5;break;case 9:t=3;n=2;w=3;break;case 10:t=5,n=2,w=5}u=n;for(r=0;0<g;)switch(m>=a&&(m=0,b--,h=l,l=k+b*a),n){case 0:B&&(C[l+m]=-1==h?v:C[h+m]^v,B=!1,g--,m++);
if(-1==h){for(;0!=(g&-8)&&m+8<a;)for(H=0;8>H;H++)C[l+m]=0,g--,m++;for(;0<g&&m<a;)C[l+m]=0,g--,m++}else{for(;0!=(g&-8)&&m+8<a;)for(H=0;8>H;H++)C[l+m]=C[h+m],g--,m++;for(;0<g&&m<a;)C[l+m]=C[h+m],g--,m++}break;case 1:if(-1==h){for(;0!=(g&-8)&&m+8<a;)for(H=0;8>H;H++)C[l+m]=v,g--,m++;for(;0<g&&m<a;)C[l+m]=v,g--,m++}else{for(;0!=(g&-8)&&m+8<a;)for(H=0;8>H;H++)C[l+m]=C[h+m]^v,g--,m++;for(;0<g&&m<a;)C[l+m]=C[h+m]^v,g--,m++}break;case 2:if(-1==h){for(;0!=(g&-8)&&m+8<a;)for(H=0;8>H;H++)r<<=1,r&=255,0==r&&(t=
0!=w?w:d[e++],r=1),C[l+m]=0!=(t&r)?v:0,g--,m++;for(;0<g&&m<a;)r<<=1,r&=255,0==r&&(t=0!=w?w:d[e++],r=1),C[l+m]=0!=(t&r)?v:0,g--,m++}else{for(;0!=(g&-8)&&m+8<a;)for(H=0;8>H;H++)r<<=1,r&=255,0==r&&(t=0!=w?w:d[e++],r=1),C[l+m]=0!=(t&r)?C[h+m]^v:C[h+m],g--,m++;for(;0<g&&m<a;)r<<=1,r&=255,0==r&&(t=0!=w?w:d[e++],r=1),C[l+m]=0!=(t&r)?C[h+m]^v:C[h+m],g--,m++}break;case 3:for(;0!=(g&-8)&&m+8<a;)for(H=0;8>H;H++)C[l+m]=z,g--,m++;for(;0<g&&m<a;)C[l+m]=z,g--,m++;break;case 4:for(;0!=(g&-8)&&m+8<a;)for(H=0;8>H;H++)C[l+
m]=d[e++],g--,m++;for(;0<g&&m<a;)C[l+m]=d[e++],g--,m++;break;case 8:for(;0!=(g&-8)&&m+8<a;)for(H=0;8>H;H++)N?(C[l+m]=z,N=!1):(C[l+m]=y,N=!0,g++),g--,m++;for(;0<g&&m<a;)N?(C[l+m]=z,N=!1):(C[l+m]=y,N=!0,g++),g--,m++;break;case 13:for(;0!=(g&-8)&&m+8<a;)for(H=0;8>H;H++)C[l+m]=255,g--,m++;for(;0<g&&m<a;)C[l+m]=255,g--,m++;break;case 14:for(;0!=(g&-8)&&m+8<a;)for(H=0;8>H;H++)C[l+m]=0,g--,m++;for(;0<g&&m<a;)C[l+m]=0,g--,m++;break;default:g--,m++}}return C}sessionStorage&&sessionStorage.clear();this.displayMsg=
this.reconnectOnResize=!0;this.appTimeout=1600;this.reconnectTimes=0;this.windowState=3;this.setTitle=this.openLink=!0;this.audioBuffer=0;this.sessionInfo={domain:"",userName:"",sessionId:0,joinedSessions:[]};this.mode=0;this.remoteAppLogin=!0;var rc=!1,$b={},ac={},oc=null,g=this,Wa=!0,qc=!1,fe=!1,Pa=!1,A=hi5.appcfg||{img:{},toolbar:{fadable:!0}};this.setConfig=function(a){A=a};var x=hi5.tool.queryToObj(u.substring(u.indexOf("?")+1)),R=0,ca=0,Qb=(Rc||x.color||x.server_bpp||16)|0,Db=hi5.Arrays.arraycopy,
Va=hi5.Arrays.fill,Sb=null,Fc="object"==typeof u?u:null;this.protocol=Fc?"":u.substring(0,u.indexOf("://")).toLowerCase();this.gateway=function(){if(Fc)return"";var a=u.lastIndexOf("/RDP?");-1==a&&(a=u.lastIndexOf("/JOIN?"));-1==a&&(a=u.lastIndexOf("/PLAY?"));a=u.substring(0,a);return a.replace(/wss\:\/\//ig,"https://").replace(/ws\:\/\//ig,"http://")}();var jb="object"==typeof u||0<u.indexOf("/PLAY?"),zf=!jb&&0<u.indexOf("invitation=");if(zf){var De=decodeURIComponent(u),Pc=De.indexOf(' USERNAME="');
if(0<Pc){var Pc=Pc+11,Af=De.substring(Pc,De.indexOf('"',Pc));u+="&novice="+Af+"&server="+Af}u+="&mapClipboard=on"}if(jb)this.mode=1,Fc?u="":(R=640,ca=480),u+="&touchpad=on",this.reconnectOnResize=!1;else if(0<u.indexOf("/JOIN?")||zf)this.mode=2,Wa=this.reconnectOnResize,this.reconnectOnResize=!1;R=void 0==Y?(x.width||window.innerWidth)|0:Y|0;ca=void 0==Yb?(x.height||Ge(window.innerHeight))|0:Yb|0;-1==R?R=screen.width|0:0==R&&(R=window.innerWidth|0);-1==ca?ca=screen.height|0:0==ca&&(ca=window.innerHeight|
0);x.symlink&&x.parameters&&hi5.tool.queryToObj(decodeURIComponent(x.parameters),x);x.gateway||(u+="&gateway="+encodeURIComponent(g.gateway));!x.minWidth&&A.minWidth&&(rdArgs.minWidth=A.minWidth);!x.minHeight&&A.minHeight&&(rdArgs.minHeight=A.minHeight);x.minWidth&&(x.minWidth=parseInt(x.minWidth));x.minHeight&&(x.minHeight=parseInt(x.minHeight));x.waWidth&&(x.waWidth=parseInt(x.waWidth));x.waHeight&&(x.waHeight=parseInt(x.waHeight));"useSSL"in x||(u+="&useSSL="+("wss"==g.protocol));hi5.storage.isAvailable&&
!Bf(x.shareClipboard)&&(za(x.shareClipboard)||x.shareClipboardId||za(x.mapClipboard)&&void 0==x.shareClipboard)&&(u+="&shareClipboardId="+(x.shareClipboardId||Cf()));A&&(void 0!=A.displayMsg?this.displayMsg=A.displayMsg:A.displayMsg=this.displayMsg,A.appTimeout&&(this.appTimeout=A.appTimeout),void 0!=A.reconnectOnResize&&(Wa=this.reconnectOnResize=A.reconnectOnResize),A.reconnectTimes&&(this.reconnectTimes=A.reconnectTimes),void 0!=A.windowState&&(this.windowState=A.windowState),void 0!=A.openLink&&
(this.openLink=A.openLink),void 0!=A.setTitle&&(this.setTitle=A.setTitle),A.audioBuffer&&(this.audioBuffer=A.audioBuffer),"boolean"==typeof A.useWSS&&(u=(A.useWSS?"wss":"ws")+u.substring(u.indexOf("://"))),"boolean"==typeof A.remoteAppLogin&&(this.remoteAppLogin=A.remoteAppLogin,rc=!A.remoteAppLogin,svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")),"boolean"==typeof A.hideLogin&&(rc=A.hideLogin));var cc=this.reconnectTimes;x.vmid&&-1==x.vmid.indexOf("EnhancedMode=1")&&
(Wa=this.reconnectOnResize=!1);this.server=x.server;this.port=parseInt(x.port,10);this.loadbalanceToken=A.loadbalanceTokenName?A.loadbalanceTokenName+"="+hi5.tool.uuid():"";this.modifyURL=function(a){g.loadbalanceToken&&(a+="&"+g.loadbalanceToken);return a};this.getURL=function(){return u};this.getColor=function(){return Qb};var Sc=hi5.graphic.Rectangle,fb=new function(){function a(a){a=(a&1431655765)<<1|a>>>1&1431655765;a=(a&858993459)<<2|a>>>2&858993459;a=(a&252645135)<<4|a>>>4&252645135;if(0==
a>>>8)return a;a=(a&16711935)<<8|a>>>8&16711935;return 0==a>>>16?a:(a&65535)<<16|a>>>16&65535}function b(a,b,e,k){var f,g=0,m=0,n,q,r,t,u=0!=(k&1),w=d;if(0==(k&32))return h=0,l=e,0;0!=(k&64)&&(c=0);if(0!=(k&128)){for(k=65536;0<=--k;)w[k]=0;c=0}l=h=0;h=r=n=k=c;if(0==e)return 0;e+=m;do{if(0==g){if(m>=e)break;k=a[b+m++]<<24;g=8}if(0<=k){if(8>g){if(m>=e){if(0!=k)return-1;break}k|=a[b+m++]<<24-g;g+=8}if(65536<=n)return-1;w[n++]=k>>>24&255;k<<=8;g-=8}else{k<<=1;if(0==--g){if(m>=e)return-1;k=a[b+m++]<<24;
g=8}if(0<=k){if(8>g){if(m>=e)return-1;k|=a[b+m++]<<24-g;g+=8}if(65536<=n)return-1;w[n++]=(k>>>24|128)&255;k<<=8;g-=8}else{k<<=1;if(--g<(u?3:2)){if(m>=e)return-1;k|=a[b+m++]<<24-g;g+=8}if(u)switch(k>>>29){case 7:for(;9>g;g+=8){if(m>=e)return-1;k|=a[b+m++]<<24-g}k<<=3;f=k>>>26;k<<=6;g-=9;break;case 6:for(;11>g;g+=8){if(m>=e)return-1;k|=a[b+m++]<<24-g}k<<=3;f=(k>>>24)+64;k<<=8;g-=11;break;case 5:case 4:for(;13>g;g+=8){if(m>=e)return-1;k|=a[b+m++]<<24-g}k<<=2;f=(k>>>21)+320;k<<=11;g-=13;break;default:for(;17>
g;g+=8){if(m>=e)return-1;k|=a[b+m++]<<24-g}k<<=1;f=(k>>>16)+2368;k<<=16;g-=17}else switch(k>>>30){case 3:if(8>g){if(m>=e)return-1;k|=a[b+m++]<<24-g;g+=8}k<<=2;f=k>>>26;k<<=6;g-=8;break;case 2:for(;10>g;g+=8){if(m>=e)return-1;k|=a[b+m++]<<24-g}k<<=2;f=(k>>>24)+64;k<<=8;g-=10;break;default:for(;14>g;g+=8){if(m>=e)return-1;k|=a[b+m++]<<24-g}f=(k>>>18)+320;k<<=14;g-=14}if(0==g){if(m>=e)return-1;k=a[b+m++]<<24;g=8}if(0<=k)q=3,k<<=1,g--;else{t=u?14:11;do{k<<=1;if(0==--g){if(m>=e)return-1;k=a[b+m++]<<24;
g=8}if(0<=k)break;if(0==--t)return-1}while(1);q=(u?16:13)-t;k<<=1;if(--g<q)for(;g<q;g+=8){if(m>=e)return-1;k|=a[b+m++]<<24-g}t=q;q=k>>>32-t&~(-1<<t)|1<<t;k<<=t;g-=t}if(65536<=n+q)return-1;f=n-f&(u?65535:8191);do w[n++]=w[f++];while(0!=--q)}}}while(1);c=n;h=r;l=n-r;return 0}var c=0,d="Uint8Array"in window?new Uint8Array(65536):Array(65536);d[0]=0;d.buffer||Va(d,0,65536,0);var e=Array(8);Va(e,0,8,0);var h=0,l=0,k=[6,6,6,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,9,8,9,9,9,9,8,8,9,9,9,9,9,9,8,9,9,10,9,9,9,9,9,9,
9,10,9,10,10,10,9,9,10,9,10,9,10,9,9,9,10,10,9,10,9,9,8,9,9,9,9,10,10,10,9,9,10,10,10,10,10,10,9,9,10,10,10,10,10,10,10,9,10,10,10,10,10,10,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,10,10,10,10,10,10,9,10,10,10,10,10,10,9,7,9,9,10,9,10,10,10,9,10,10,10,10,10,10,10,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,13,10,10,10,10,10,10,11,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,10,10,10,10,9,10,10,10,10,10,9,10,10,10,9,10,10,10,10,10,10,10,10,10,10,10,10,
10,10,10,9,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,8,9,9,10,9,10,10,10,9,10,10,10,9,9,8,7,13,13,7,7,10,7,7,6,6,6,6,5,6,6,6,5,6,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,8,5,6,7,7],g=[123,65311,65293,65063,65024,65285,65303,65128,197,65031,65299,65216,65288,65048,65307,65203,65027,162,65090,65296,65035,65026,65169,65305,65152,233,65082,65301,65042,87,65239,65309,65294,65077,65129,65314,65304,65146,65025,65315,65300,65268,65204,65033,65308,65220,65289,65120,65136,65298,65029,65170,65185,65306,65039,65287,65110,
65302,65282,65240,65256,65310,65053,59,65535,65286,65535,65137,65161,65535,65535,65068,65067,65056,65535,65211,65231,65032,65535,65248,65037,65535,65177,65535,65028,65194,65097,65535,65047,65121,65247,65535,65279,65270,65100,65535,65535,65159,65535,65316,65535,65084,65138,65535,65535,65230,65535,65278,65535,65059,65212,65034,65193,65535,65041,65535,65154,65535,65030,65178,65269,65535,65058,65101,65119,65535,65283,65249,65535,65226,65228,65535,65049,65535,65207,65535,65535,65155,65065,65535,65535,
65535,65132,65535,65261,65535,65535,65094,65116,65045,65535,65243,65190,65535,65535,65092,65535,65036,65535,65173,65276,65535,65535,65208,5833,65535,65264,65535,65080,65535,65535,65133,65150,65535,65535,65535,65535,65115,65244,65535,65535,65260,65095,65055,65535,65151,65174,65535,65535,65189,65535,65040,65088,65074,65215,65535,65535,65236,65265,65535,65535,65535,65141,65535,65535,65165,65073,65535,65125,65051,65535,65252,65275,65535,65535,65106,65535,65038,65535,65181,65199,65535,65535,65105,65235,
65535,65312,65535,65071,65535,65535,65217,65164,65535,65535,65535,65087,65535,65535,65142,65535,65274,65107,65061,65535,65124,65253,65535,65535,65198,65535,65043,65535,65160,65182,65535,65091,65535,65535,65188,65171,65535,65535,65535,65085,65535,65535,65259,65241,65535,65044,65114,65535,65064,65149,65535,65535,65130,65535,65535,65281,65222,65224,65535,65535,65205,65535,65535,65535,65172,65144,65535,65535,65535,65187,65535,65535,65242,65112,65535,65054,65093,65258,65535,65131,65535,65535,65079,65535,
65535,65535,65148,65206,65535,65535,65272,65535,65535,65535,65223,65179,65535,65535,65535,65104,65535,65535,65197,65250,65535,65050,65123,65102,65535,65535,65273,65535,65139,65535,65535,65535,65072,65163,65535,65535,65213,65070,256,65535,65262,65234,65535,65535,65535,65196,65535,65535,65180,65156,65535,65060,65103,65271,65535,65535,65251,65122,65535,65535,65535,65535,65162,65140,65535,65535,65086,65535,65535,65535,65233,65214,65535,65535,65069,65535,65098,65267,65535,65535,65245,65118,65046,65535,
65096,65192,65535,65195,65175,65535,65535,65232,65535,65535,65229,65209,65535,65535,65535,65066,65535,65535,65158,65134,65535,65535,65535,65246,65535,65535,65117,65099,65057,65535,65263,65176,65535,65535,65153,65535,65535,65535,65191,65535,65210,65277,65535,65535,65535,65227,65535,65535,65135,65081,65535,65535,65535,65157,65535,268,65254,65127,65052,65535,65108,65202,65535,65535,65183,65535,65535,65535,65113,65201,65535,65218,65535,65535,65078,65266,65535,65535,65238,65143,65535,65535,65535,65075,
65535,65535,65167,65109,65062,266,65284,65255,65535,289,65126,65535,65535,65535,65200,65184,65535,271,65168,65535,65535,65237,65535,65535,65219,65076,65535,65535,65535,65166,65535,273,65145,65089,267],q=[511,0,508,448,494,347,486,482],r=[4,2,3,4,3,4,4,5,4,5,5,6,6,7,7,8,7,8,8,9,9,8,9,9,9,9,9,9,9,9,9,9],m=[4065,4064,4066,4072,14,4069,4068,4074,4081,4067,21,4071,4079,70,4080,4077,4095,4087,4091,25,4093,4084,300,4075,4094,4086,4090,137,4092,4083,4088,4082],u=[0,4,10,19],w=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,
6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,14,14,15],y=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,32769,49153,65537],z=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,6,6,8,8,14,14],t=[2,3,4,5,6,7,8,9,10,12,14,16,18,22,26,30,34,42,50,58,66,82,98,114,130,194,258,514,2,2],v=new RdpBuffer(d,0,1);this.reset=function(){c=0;d=Array(65536);l=h=d[0]=0;v=new RdpBuffer(d,0,1)};this.release=function(){d=v=e=null};this.getData=function(){v.setPosition(h);
v.markEnd(h+l);return v};this.getDecompressedLength=function(){return l};this.dec=function(B,v,H,C){if(2==(C&15)){var f=v,x=H;H=d;v=e;var D=c,da=0,F=0,K=0,A=0,L=f,R=0,O=0,ja=0,P,Q=0;l=0;h=D;0!=(C&64)&&(Db(H,D-32768,H,0,32768),h=c=D=32768);0!=(C&128)&&(D=0,Va(H,0,65536,0),Va(v,0,v.length,0),h=0);if(32!=(C&32))Db(B,0,H,D,x),D+=x,l=D-c;else{P=0;for(f+=x;L<f&&!(Q=B[L++]&255,da|=Q<<P,O+=8,P+=8,32<=P););da=a(da);L<f?(R=a(B[L++]&255)&255,ja=8):ja=0;for(;8<=O;){F=0;for(P=5;13>=P&&(12==P||(Q=a(da&4294967295<<
32-P),x=g[Q&511^Q>>>9^Q>>>4^Q>>>7],0!=(x^Q)>>>9?Q=x&511:(x=void 0,x=(Q>>>8^Q&255)>>>2&15,0!=Q>>>9&&(x=~x),x&=65535,Q=x%12,Q=g[q[Q]]),P!=k[Q]));P++);da<<=P;O-=P;if(256>Q)H[D++]=Q&255;else if(256<Q&&289>Q){x=Q-257;P=w[x];F=y[x]-1;0!=P&&(F+=a(da&4294967295<<32-P));x=v;K=F;A=x[2]|x[3]<<16;A<<=16;x[2]=A&65535;x[3]=A>>>16&65535;var Ca=x[0]|x[1]<<16,A=A|Ca>>>16;x[2]=A&65535;x[3]=A>>>16&65535;Ca=Ca<<16|K;x[0]=Ca&65535;x[1]=Ca>>>16&65535;da<<=P;O-=P}else if(288<Q&&293>Q)x=Q-289,F=v[x],0!=x&&(P=v,K=P[0],P[0]=
P[x],P[x]=K);else if(256==Q)break;for(P=32-O;0<P;)if(ja<P)Q=R>>>8-ja,da|=Q<<32-O-ja,O+=ja,P-=ja,L<f?(R=a(B[L++]&255)&255,ja=8):ja=P=0;else{ja>P?(da|=R>>>8-P,R<<=P,R&=255,ja-=P,O=32):(da|=R>>>8-P,O=32,L<f?(R=a(B[L++]&255)&255,ja=8):ja=0);break}if(0!=F){for(P=2;9>=P&&(Q=a(da&4294967295<<32-P),x=m[Q&31^Q>>>5^Q>>>9],0!=(x^Q)>>>5?Q=x&31:(x=void 0,x=Q>>>4&15,Q=(x^x>>>2^x>>>3)&3,Q=m[u[Q]]),P!=r[Q]);P++);da<<=P;O-=P;P=z[Q];K=t[Q];0!=P&&(K+=a(da&4294967295<<32-P));da<<=P;O-=P;A=D-F;P=K>F?F:K;for(Q=0;0<P;)H[D++]=
H[A++],P--;for(;K>F;)Q=Q>=F?0:Q,H[D++]=H[A+Q++],K--;for(P=32-O;0<P;)if(ja<P)Q=R>>>8-ja,da|=Q<<32-O-ja,O+=ja,P-=ja,L<f?(R=a(B[L++]&255)&255,ja=8):ja=P=0;else{ja>P?(da|=R>>>8-P,R<<=P,R&=255,ja-=P,O=32):(da|=R>>>8-P,O=32,L<f?(R=a(B[L++]&255)&255,ja=8):ja=0);break}}}l=0!=(C&128)?D:D-c}c=D;return 0}return b(B,v,H,C)}},ug=0<u.indexOf("nocurosr=on"),oa=0<u.indexOf("startProgram=app"),ge=0<u.indexOf("mapDisk=on"),Da=null;oa&&(Wa=this.reconnectOnResize=!1);hi5.browser.isTouch&&Math.max(R,ca)>Math.max(window.innerWidth,
window.innerHeight)&&(Wa=this.reconnectOnResize=!1);this.isRemoteApp=function(){return oa};Ke();var sa=null,ka=!1,eb=!1,ta=new ig(g.audioBuffer),D=new Ie(R,ca);this.setVolume=function(a){ta&&ta.setVolume(a)};this.setAudioBuffer=function(a){g.audioBuffer=a;ta.delay=a;bc&&(bc.delay=a)};for(var bc=null,Dc=Array(12),Za=0;12>Za;Za++)Dc[Za]=Array(256);var Uc=Array(256),ma=0,ga=0,fa=R-1,ha=ca-1,Ga=null,Zb=null,de=0;window.$rdp=this;var $a=null,pb=Le,kd=Me;Bc(Qb);this.running=function(){return ka};var ib=
new function(){function a(){if(ka&&0<c){if(h&&g.onnoresponse&&d-e>h){if(g.onnoresponse()){c=0;return}e=d}g.sendPing(null);d++;b=setTimeout(a,c)}}var b=0,c=x.pingInterval||0,d=0,e=0,h=0;0<c&&(c*=1E3);this.setInterval=function(a,b){c=1E3*a;h=b||0};this.getInterval=function(){return c};this.processPong=function(a){e++;if(g.onpong)g.onpong(a)};this.sendPing=function(){0<c&&(b&&clearTimeout(b),b=setTimeout(a,c))}};this.setJoinMode=function(a){ka&&K("8E1"+a)};this.setJoinCloseMode=function(a){ka&&K("8EB3\t"+
a)};this.refuseControl=function(a){ka&&K("8E3"+a)};this.giveControl=function(a){ka&&K("8E4"+a)};this.pauseSession=function(a,b){ka&&K("8EB"+(b?1:0)+"\t"+a)};this.closeSession=function(a){ka&&K("8EB2\t"+a)};this.requestControl=function(){ka&&K("8E2")};this.saveSession=function(a){ka&&K("8E9"+(a.save?1:0)+"\t"+(a.timeout||0)+"\t"+(a.id||0))};this.allowJoin=function(a,b){ka&&K("8EA"+a+"\t"+(b?1:0))};var Ee=new function(){function a(){if(c&&0<c.length){var b=c.shift();Ee.sendSingleKey(b.down,b.key);0<
c.length?setTimeout(a,d):c=null}}var b={" ":57,space:57,pageup:201,pagedown:209,end:207,home:199,left:203,up:200,right:205,down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.sendSingleKey=function(a,c){var d=b[c.toLowerCase()];d?g.writeScancode(a,
d):(d=c.length,0!=d&&(1==d?g.writeKeyCode(a,c.toUpperCase().charCodeAt(0)):a&&g.writeText(c)))};var c=null,d=0;this.sendKeyComb=function(b,h){if(Pa){var l=b.split("+"),k=l.length,g=0;if(0!=k){for(var q=null,r=[],g=0;g<k;g++){var m=l[g];""==m&&""==q&&(m="Add");""!=m&&r.push({key:m,down:!0});q=m}k=r.length;for(g=k-1;0<=g;g--)r.push({key:r[g].key,down:!1});if(h)c=r,d=h,a();else for(g=0,k=r.length;g<k;g++)Ee.sendSingleKey(r[g].down,r[g].key)}}}};this.writeKeyComb=function(a,b){Pa&&Ee.sendKeyComb(a,b)};
var Rb=new function(){this.capsLock=this.numLock=!1;this.setJoinMode=g.setJoinMode;this.requestControl=g.requestControl;this.writeKeyComb=g.writeKeyComb;this.getAppMode=function(){return g.mode};this.send=function(a){ka&&K(a)};this.saveSession=function(a){g.saveSession(a)};this.sendInput=function(a){if(Pa&&!D.isPaused()){var c=a,d=c.substring(0,2),c=c.substring(2);if($a&&("80"==d||"81"==d||"82"==d||"83"==d)){var c=c.split("\t"),e=new Uint8Array(7),h=0,l=0,k=0,l=parseInt(c[0]),k=parseInt(c[1]),d=parseInt(d,
16);switch(d){case 128:h=("0"==c[2]?4096:8192)|32768;break;case 129:h="0"==c[2]?4096:8192;break;case 130:h=2048;break;case 131:h="0"==c[2]?33408:33664}e[0]=32;e[1]=h&255;e[2]=h>>8;e[3]=l&255;e[4]=l>>8;e[5]=k&255;e[6]=k>>8;$a.add(new RecordingObj(e,0,7,60))}K(a);if(g.onactivity)g.onactivity(a)}};var a=null;this.getAppInfo=function(){return g.sessionInfo.appInfo};this.onresize=function(b){if(b=b.target.svSurface){var c=b.getFreeSpace(),d=c.width,e=c.height;oa?((b=b.railWin)&&(b=b.getMain(F.zOrders)),
b&&b.resize(0,0,d,e)):g.reconnectOnResize&&ka&&(b=function(){svGlobal.logger.warn("w:"+d+" ww:"+R+" h:"+e+" hh:"+ca);g.reconnect(d,e,A.forceReconnect)},a&&(clearTimeout(a),a=0),a=setTimeout(b,700))}};this.onorientationchange=function(a){var c=Ge(a.innerHeight);if(g.reconnectOnResize)g.reconnect(a.innerWidth,c);else if(oa&&a.svSurface){var d=a.svSurface.railWin;d&&(d=d.getMain(F.zOrders));d&&d.resize(0,0,a.innerWidth,c)}};this.getClipData=Wf;this.onfocus=function(a){var c=a.target;oa&&c.svSurface&&
c.svSurface.railWin&&(a=c.svSurface.railWin.getTopWin(F.zOrders))&&sa&&(c=c.svSurface.context)&&c!=D.getContext()&&(D.setContext(null),a.activate(1),svGlobal.logger.info("Activate win:"+a.id))};this.getShareFiles=function(a,c){eb&&Da&&Da.list(a,c)};this.getFile=function(a){g.reconnectOnResize=!1;window.open(g.getFileUrl(a))};this.getFileLink=function(a){return g.modifyURL(Cb()+"/DOWNLOAD?s="+Zb+"&f="+a)};this.getGateway=function(){return u};this.reconnect=function(a,c,d){x.symlink?(a="user="+a+"&pwd="+
c,d&&(a+="&domain="+d),u=hi5.tool.replaceQuery(u,"parameters",a)):(u=hi5.tool.replaceQuery(u,"user",a),u=hi5.tool.replaceQuery(u,"pwd",c),u=hi5.tool.replaceQuery(u,"domain",d));"sessionStorage"in window&&sessionStorage.clear();g.run()};this.sendKeyboardSynchronize=function(a,c,d){if(!jb){var e=0;d&&(e|=4);c&&(e|=2);a&&(e|=1);K("8E5"+e);Rb.capsLock=d;Rb.numLock=c}};this.hasSurfaceBlurIn=function(a){return F.hasSurfaceBlurIn(a)}},F=function(){var a=[];a.addSurface=function(b){a.push(b)};a.hasSurface=
function(b){for(var c=a.length,d=0;d<c;d++)if(a[d].equals(b))return!0;return!1};a.hasSurfaceBlurIn=function(b){for(var c=a.length,d=Date.now(),e=0;e<c;e++)if(d-a[e].blurTime<b)return!0;return!1};a.setSize=function(b,c,d){for(var e=0,h=a.length;e<h;e++)a[e].setSize(b,c,d)};a.zOrders=[];a.drawLicense=function(b){for(var c=0,d=a.length;c<d;c++)a[c].drawLicense(b)};a.setReadOnly=function(b){for(var c=0,d=a.length;c<d;c++)a[c].setReadOnly(b)};a.setVisible=function(a,c){svGlobal.logger.info("TODO: setVisible")};
a.copyToClip=function(b){1>a.length||a[0].copyToClip(b)};a.setCursor=function(b){!oa&&a[0]&&a[0].setCursor(b);var c=a.getFocused();c&&c.setCursor(b)};a.hide=function(b){if(oa){b=0;for(var c=a.length;b<c;b++)a[b].getWindow().close()}else a[0].hide()};a.execute=function(b,c){for(var d=0,e=a.length;d<e;d++)a[d][b].apply(a[d],c)};a.addWin=function(b){var c=a.getFocused();c||(svGlobal.logger.warn("Focused surface not found!"),c=a[a.length-1]);c?(oa=!0,c.railWin||(c.railWin=new Xf,c.onunload=function(){A.closeRemoteApp&&
c.railWin&&c.railWin.close();c.remoteApp&&c.remoteApp.close();c.railWin&&(c.railWin.clear(),c.railWin=null);a.removeElm(c)}),c.context&&D.setContext(c.context),c.railWin.addWin(b),hi5.browser.isIE&&c.focus()):svGlobal.logger.warn("No surface available!")};a.delWin=function(b){for(var c,d=a.length-1;0<=d;d--){var e=a[d];c=e.railWin;var h=c.getWinById(b),l=h&&h.appId&&-1!=h.appId.toLowerCase().indexOf("runonce");if(0<=c.delWin(b)&&!c.hasApp(h.appId)){var h=function(b){return function(){svGlobal.logger.debug("Start del:"+
Date.now());b.railWin&&b.railWin.isRunning()||(b.remoteApp&&b.remoteApp.close(),a.delSurface(b))}},k=g.appTimeout;if(l||c.isNew())k*=10;svGlobal.logger.debug("Prepare del:"+Date.now());setTimeout(h(e),k)}}};a.popWins=function(b){return a[0]&&a[0].railWin?a[0].railWin.popWins(b):[]};a.getWinById=function(b){for(var c,d=0,e=a.length;d<e;d++)if(a[d].railWin&&(c=a[d].railWin.getWinById(b)))return c;return null};a.setTitle=function(b){for(var c,d=0,e=a.length;d<e;d++)if(a[d].railWin&&(c=a[d].railWin.getWinById(b))&&
c.titleInfo&&c.isVisible()){hd(c.titleInfo+" - "+(x.displayName||g.server),a[d].getWindow());break}};a.hasApp=function(b){for(var c=0,d=a.length;c<d;c++)if(a[c].railWin.hasApp(b))return!0;return!1};a.delSurface=function(b){b.railWin.isRunning()||(svGlobal.logger.info("delete surface..."),a.removeElm(b),b.close(),0==a.length&&hb())};a.getOwnerSurface=function(b){for(var c=0,d=a.length;c<d;c++)if(a[c].railWin&&a[c].railWin.hasWin(b))return a[c];return null};a.getFocused=function(){if(!oa)return a[0];
for(var b=a.length,c=0;c<b;c++)if(a[c].focused)return a[c];return a[b-1]};a.close=function(){for(var b=0,c=a.length;b<c;b++)a[b]&&(a[b].remoteApp&&a[b].remoteApp.close(),a[b].close())};return a}();this.getSurfaces=function(){return F};this.hide=function(){F&&F.hide()};var pa={count:0,names:[],close:function(){for(var a=pa.names,b=0,c=a.length;b<c;b++)pa[a[b]].close&&pa[a[b]].close()},init:function(a,b,c){pa.count=0;pa.names.length=0;var d=new g.DynamicChannel;d.name="ECHO";d.process=function(a){var b=
a.getPositon(),c=a.getEnd(),e=new Uint8Array(c-b);e.set(a.getData().subarray(b,c));d.send(e)};g.addDynamicChannel(d);if(a){var e=new g.DynamicChannel;e.name="Microsoft::Windows::RDS::Input";e.process=function(a){var b=a.getLittleEndian16();a.getLittleEndian32();switch(b){case 1:a.skipPosition(4),a=new RdpBuffer(new Uint8Array(16),0,16),a.setLittleEndian16(2),a.setLittleEndian32(16),a.setLittleEndian32(3),a.setLittleEndian32(65536),a.setLittleEndian16(256),a.markEnd(),e.send(a);case 5:F.execute("setTouchRemoting",
[!0]);pa.isTouchReady=!0;svGlobal.logger.info("Touch remoting start");break;case 4:F.execute("setTouchRemoting",[!1]),pa.isTouchReady=!1,svGlobal.logger.info("Touch remoting suspend")}};g.addDynamicChannel(e)}if(c){svGlobal.logger.warn("Audio input on");var h=new g.DynamicChannel;(function(){function a(b){var c=new RdpBuffer(new Uint8Array(5),0,5);c.setByte(7);c.setLittleEndian32(b);c.markEnd();h.send(c)}function b(d){d.getLittleEndian32();var e=d.getLittleEndian32(),k=new c;k.fromBuffer(d);w=!0;
y=g.reconnectOnResize;g.reconnectOnResize=!1;v.start();v.onopen||(v.onopen=function(b){m=b;g.reconnectOnResize=y;a(e);var c=new RdpBuffer(new Uint8Array(5),0,5);c.setByte(4);c.setLittleEndian32(b?0:1);c.markEnd();h.send(c)});v.ondata||(v.ondata=function(a,b){m&&(x.length!=b+1&&(x=new Uint8Array(b+1),x[0]=6),h.send(u),x.set(a,1),h.send(x))})}function c(){this.WAVE_FORMAT_PCM=1;this.WAVE_FORMAT_ADPCM=2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=
85;this.WAVE_FORMAT_AAC=41222;this.bitsPerSample=this.nBlockAlign=this.nAvgBytesPerSec=this.nSamplesPerSec=this.nChannels=this.formatTag=0;this.hasLocalSupport=!1;this.cbSize=0;this.extenstion=null;var a=this;this.fromBuffer=function(b){a.formatTag=b.getLittleEndian16();a.nChannels=b.getLittleEndian16();a.nSamplesPerSec=b.getLittleEndian32();a.nAvgBytesPerSec=b.getLittleEndian32();a.nBlockAlign=b.getLittleEndian16();a.bitsPerSample=b.getLittleEndian16();var c=b.getLittleEndian16();a.cbSize=c;0<c&&
(a.extenstion=Array(c),b.copyToByteArray(a.extenstion,0,b.getPosition(),c),b.skipPosition(c))};this.toBuffer=function(b){b.setLittleEndian16(a.formatTag);b.setLittleEndian16(a.nChannels);b.setLittleEndian32(a.nSamplesPerSec);b.setLittleEndian32(a.nAvgBytesPerSec);b.setLittleEndian16(a.nBlockAlign);b.setLittleEndian16(a.bitsPerSample);b.setLittleEndian16(a.cbSize);0<a.cbSize&&b.setBytes(a.extenstion)};this.getSize=function(){return 18+a.cbSize};this.toString=function(){return"Audio Format, tag="+a.formatTag+
" nChannels="+a.nChannels+" nSamplesPerSec="+a.nSamplesPerSec+" nAvgBytesPerSec"+a.nAvgBytesPerSec+" nBlockAlign"+a.nBlockAlign+" bitsPerSample"+a.bitsPerSample+" cbSize="+a.cbSize}}function d(a){function b(c){u=!0;if(l.onopen)l.onopen(!0);t=new e;f=c;k=a.createMediaStreamSource(c);c=l.directInput?1024:4096;g=a.createJavaScriptNode?a.createJavaScriptNode(c,1,1):a.createScriptProcessor(c,1,1);l.directInput&&!w&&(w=new Int16Array(2048));g.onaudioprocess=function(a){if(h){a=a.inputBuffer.getChannelData(0);
if(l.directInput){for(var b=0,c=0,d=0;1024>d;d++)c=32767*a[d],w[b++]=c,w[b++]=c;v.ondata(new Uint8Array(w.buffer),4196)}else x.addData(a,q);a.fill(0)}};c=a.createBiquadFilter();c.frequency.value=n/2;k.connect(c);c.connect(g);g.connect(a.destination)}function c(){if(!h){if(f.getTracks){var a=f.getTracks()[0];a.stop()}g&&g.disconnect();k&&k.disconnect();u=!1}}var h=!1,f=null,k=null,g=null,l=this,m=a.sampleRate,n=22050,q=m/n,u=!1;this.directInput=!1;var l=this,w;this.start=function(){if(!u)navigator.getUserMedia({audio:!0},
b,function(a){h=u=!1;if(l.onopen)l.onopen(!1);svGlobal.logger.warn("Error on getUserMedia: "+a)});else if(l.onopen)l.onopen(!0);h=!0};this.stop=function(){h=!1};this.close=function(){h=!1;x.reset();t=new e;setTimeout(c,8E3)};var x=new function(){function a(g){for(var m=f/c|0,n=0;n<m;n++){var q=t.encode(g,d,k,e);e+=q;e==h&&(e=0,l.ondata(k,h));d+=c;f-=c}b=0<f?g:null}var b=null,c=160,d=0,f=0,e=0,h=65*Math.floor(Math.floor(Math.floor(4096/q)/160)/2),k=new Uint8Array(h);this.reset=function(){f=d=e=0;b=
null};this.addData=function(c,e){var h=c,k=e;if(1==k)c=h;else if(1>k)console.error("rate must be smaller than the original rate"),c=void 0;else{for(var g=Math.round(h.length/k),g=new Float32Array(g),l=0,m=0;l<g.length;){for(var n=Math.round((l+1)*k),q=0,r=0;m<n&&m<h.length;m++)q+=h[m],r++;g[l]=q/r;l++;m=n}c=g}0==f?(f=c.length,d=0,a(c)):(h=c,k=f+h.length,g=new Float32Array(k),g.set(b.subarray(d)),g.set(h,f),d=0,f=k,a(g))}}}function e(){function a(b,c){return-32768==b&&-32768==c?32767:b*c>>15<<16>>
16}function b(a,c){if(-32768==a&&-32768==c)return 32767;var d;d=a*c+16384>>15;return d<<16>>16}function c(a,b){var d=0;if(0>=a){if(0<=b)return a+b;d=-(a+1)-(b+1);return 2147483647<=d?-2147483648:-d-2}if(0>=b)return a+b;d=a+b;return 2147483647<d?2147483647:d}function d(a){if(0>a){if(-1073741824>=a)return 0;a=~a}return(0!=(a&4294901760)?0!=(a&4278190080)?-1+Y[255&a>>24]:7+Y[255&a>>16]:0!=(a&65280)?15+Y[255&a>>8]:23+Y[255&a])<<16>>16}function f(a,b){return 16<=b?0>a?-1:-0:-16>=b?0:0>b?a<<-b<<16>>16:
a>>b<<16>>16}function h(a,b,c,d,f){for(var e=0;e<f;e++)c[d+e]=a[b+e]}function k(b,c,d,f,e,h){var g=0,g=a(b<<16>>16,e[h]);b=g+(c<<16>>16);b=(-32768>b?-32768:32767<b?32767:b)+256;g=(-32768>b?-32768:32767<b?32767:b)>>9<<16>>16;e[h]=(g>d?d-f:g<f?0:g-f)<<16>>16}function g(a,b){var c;c=ma[a+3*b]>>2<<16>>16;return c*c}function l(a,c,d,f,e,g,h){a=a[d]+g;e=((-32768>a?-32768:32767<a?32767:a)<<26>>16)-(e<<17>>16);f=b(h,-32768>e?-32768:32767<e?32767:e);h=f+f;c[d]=-32768>h?-32768:32767<h?32767:h}function m(a){for(var b=
0,c=0,d=0;8>d;d++)0>a[d]?(b=(-32768==a[d]?32767:-a[d])<<16>>16,c=(b>>2<<16>>16)+26112,a[d]=-(11059>b?b<<1:20070>b?b+11059:-32768>c?-32768:32767<c?32767:c)<<16>>16):(b=a[d],c=(b>>2<<16>>16)+26112,a[d]=(11059>b?b<<1:20070>b?b+11059:-32768>c?-32768:32767<c?32767:c)<<16>>16)}function n(a,c,d,f,e){for(var h=a.u,g=0,k=0,l=0,m=0,q=0,r=0,g=m=0;0!=d;){d--;g=m=f[e];for(r=0;8>r;r++)l=h[r],q=c[r],h[r]=m,k=b(q,g),m=l+k,m=-32768>m?-32768:32767<m?32767:m,k=b(q,l),g+=k,g=-32768>g?-32768:32767<g?32767:g;f[e++]=g}a.u=
h}function q(){this.dp0=new Int16Array(280);this.mp=this.l_z2=this.z1=0;this.u=new Int16Array(8);this.larpp=[new Int16Array(8),new Int16Array(8)];this.j=0;this.nrp=40;this.v=new Int16Array(9);this.msr=0}var r=33,t=[6554,16384,26214,32767],u=[29128,26215,23832,21846,20165,18725,17476,16384],w=[18431,20479,22527,24575,26623,28671,30719,32767],x=new q,v=new Int16Array(8),y=new Int16Array(4),z=new Int16Array(4),D=new Int16Array(4),F=new Int16Array(4),E=new Int16Array(52),K=new Int16Array(160),A=new Uint8Array(r),
L=0;this.encode=function(e,q,r,Y){for(var sa=e,ta=q,pa=0,xa=0;160>xa;xa++)pa=sa[ta++],K[xa]=0>pa?32768*pa:32767*pa;R=!R;for(var M=0,ya=0,La=0,Oa=0,za=120,Ga=new Int16Array(50),Da=new Int16Array(160),Ha=Da,Qa=0,Ua=0,Ja=x.z1,Fa=x.l_z2,Na=x.mp,Va=0,Ma=0,Za=0,Wa=0,Pa=0,$a=0,jb=160;0!=jb;){jb--;var Wa=K[Qa++]>>3<<2<<16>>16,Va=Wa-Ja<<16>>16,Ja=Wa,Pa=Va,Pa=Pa<<15,Ma=Fa>>15<<16>>16,Za=Fa-(Ma<<15)<<16>>16,Pa=Pa+b(Za,32735),$a=32735*Ma,Fa=c($a,Pa),$a=c(Fa,16384),Ma=b(Na,-28180),Na=$a>>15<<16>>16,Ra=Na+Ma;Ha[Ua++]=
-32768>Ra?-32768:32767<Ra?32767:Ra}x.z1=Ja;x.l_z2=Fa;x.mp=Na;for(var vb=v,Xa=Da,kb=0,V=0,gb=0,eb=0,wb=0,ba=0,fb=0,ba=0;159>=ba;ba++)fb=Xa[ba]+0,gb=-32768>fb?-32768:32767<fb?32767:fb,gb>eb&&(eb=gb);wb=0==eb?0:4-d(eb<<16)<<16>>16;if(0<wb)switch(wb){case 1:for(ba=0;159>=ba;ba++)Xa[ba]=b(Xa[ba],16384);break;case 2:for(ba=0;159>=ba;ba++)Xa[ba]=b(Xa[ba],8192);break;case 3:for(ba=0;159>=ba;ba++)Xa[ba]=b(Xa[ba],4096);break;case 4:for(ba=0;159>=ba;ba++)Xa[ba]=b(Xa[ba],2048)}var S=Xa,T=S[V],Db=[0,0,0,0,0,0,
0,0,0];h(Db,0,G,0,G.length);G[0]+=T*S[V-0];T=S[++V];G[0]+=T*S[V-0];G[1]+=T*S[V-1];T=S[++V];G[0]+=T*S[V-0];G[1]+=T*S[V-1];G[2]+=T*S[V-2];T=S[++V];G[0]+=T*S[V-0];G[1]+=T*S[V-1];G[2]+=T*S[V-2];G[3]+=T*S[V-3];T=S[++V];G[0]+=T*S[V-0];G[1]+=T*S[V-1];G[2]+=T*S[V-2];G[3]+=T*S[V-3];G[4]+=T*S[V-4];T=S[++V];G[0]+=T*S[V-0];G[1]+=T*S[V-1];G[2]+=T*S[V-2];G[3]+=T*S[V-3];G[4]+=T*S[V-4];G[5]+=T*S[V-5];T=S[++V];G[0]+=T*S[V-0];G[1]+=T*S[V-1];G[2]+=T*S[V-2];G[3]+=T*S[V-3];G[4]+=T*S[V-4];G[5]+=T*S[V-5];G[6]+=T*S[V-6];
T=S[++V];G[0]+=T*S[V-0];G[1]+=T*S[V-1];G[2]+=T*S[V-2];G[3]+=T*S[V-3];G[4]+=T*S[V-4];G[5]+=T*S[V-5];G[6]+=T*S[V-6];G[7]+=T*S[V-7];++V;for(kb=V;160>kb;++kb)T=S[kb],G[0]+=T*S[kb-0],G[1]+=T*S[kb-1],G[2]+=T*S[kb-2],G[3]+=T*S[kb-3],G[4]+=T*S[kb-4],G[5]+=T*S[kb-5],G[6]+=T*S[kb-6],G[7]+=T*S[kb-7],G[8]+=T*S[kb-8];for(ba=0;9>ba;ba++)G[ba]<<=1;if(0<wb)for(ba=0;160>ba;ba++)Xa[ba]<<=wb;var ab=vb,na=new Int16Array(1),xb=0,bb=0,pb=new Int16Array(9),Ia=new Int16Array(9),hb=new Int16Array(9);if(0==G[0])for(bb=0;8>
bb;bb++)ab[bb]=0;else{na[0]=d(G[0]);for(bb=0;8>=bb;bb++)pb[bb]=G[bb]<<na[0]>>16;h(pb,0,hb,0,7);h(pb,0,Ia,0,8);for(var ib=1;8>=ib;ib++,xb++){na[0]=Ia[1];na[0]=(0>na[0]?-32768==na[0]?32767:-na[0]:na[0])<<16>>16;if(Ia[0]<na[0]){for(bb=ib;8>bb;bb++)ab[bb]=0;break}var Eb=xb,Cb;var Yb=na[0],fc=Yb,Zb=Ia[0],gc=0,bc=15;if(0==Yb)Cb=0;else{for(;0!=bc;)bc--,gc=gc<<17>>16,fc<<=1,fc>=Zb&&(fc-=Zb,gc++);Cb=gc<<16>>16}ab[Eb]=Cb;0<Ia[1]&&(ab[xb]=-ab[xb]);if(8==ib)break;na[0]=b(Ia[1],ab[xb]);var Rb=Ia[0]+na[0];Ia[0]=
-32768>Rb?-32768:32767<Rb?32767:Rb;for(var Nb=1;Nb<=8-ib;Nb++){na[0]=b(hb[Nb],ab[xb]);var Sb=Ia[Nb+1]+na[0];Ia[Nb]=-32768>Sb?-32768:32767<Sb?32767:Sb;na[0]=b(Ia[Nb+1],ab[xb]);var qb=hb[Nb]+na[0];hb[Nb]=-32768>qb?-32768:32767<qb?32767:qb}}}for(var qa=vb,Aa,hc=0;8>hc;hc++)Aa=qa[hc],Aa=(0>Aa?-32768==Aa?32767:-Aa:Aa)<<16>>16,22118>Aa?Aa>>=1:31130>Aa?Aa-=11059:(Aa-=26112,Aa<<=2),qa[hc]=0>qa[hc]?-Aa:Aa;var rb=vb,sb=0;k(20480,0,31,-32,rb,sb++);k(20480,0,31,-32,rb,sb++);k(20480,2048,15,-16,rb,sb++);k(20480,
-2560,15,-16,rb,sb++);k(13964,94,7,-8,rb,sb++);k(15360,-1792,7,-8,rb,sb++);k(8534,-341,3,-4,rb,sb++);k(9036,-1144,3,-4,rb,sb++);var Fb=x,Ac=v,ad=Da,yb=new Int16Array(8),lc=Fb.j,Qb=lc,Qb=Qb^1;Fb.j=Qb;var tc=Fb.larpp[lc],bd=Fb.larpp[Qb],uc=Ac,Gb=tc,lb=0,Jb=0;l(uc,Gb,Jb++,lb,0,-32,13107);l(uc,Gb,Jb++,lb,0,-32,13107);l(uc,Gb,Jb++,lb,2048,-16,13107);l(uc,Gb,Jb++,lb,-2560,-16,13107);l(uc,Gb,Jb++,lb,94,-8,19223);l(uc,Gb,Jb++,lb,-1792,-8,17476);l(uc,Gb,Jb++,lb,-341,-4,31454);l(uc,Gb,Jb++,lb,-1144,-4,29708);
for(var nc=bd,Cc=tc,vc=yb,Ub=0;8>Ub;Ub++){var $b=(nc[Ub]>>2<<16>>16)+(Cc[Ub]>>2<<16>>16);vc[Ub]=-32768>$b?-32768:32767<$b?32767:$b;var ac=vc[Ub]+(nc[Ub]>>1<<16>>16);vc[Ub]=-32768>ac?-32768:32767<ac?32767:ac}m(yb);n(Fb,yb,13,ad,0);for(var Pc=bd,Qc=tc,Rc=yb,Kc=0;8>Kc;Kc++){var ic=(Pc[Kc]>>1<<16>>16)+(Qc[Kc]>>1<<16>>16);Rc[Kc]=-32768>ic?-32768:32767<ic?32767:ic}m(yb);n(Fb,yb,14,ad,13);for(var Uc=bd,Fc=tc,oc=yb,Lc=0;8>Lc;Lc++){var pc=(Uc[Lc]>>2<<16>>16)+(Fc[Lc]>>2<<16>>16);oc[Lc]=-32768>pc?-32768:32767<
pc?32767:pc;var Ea=oc[Lc]+(Fc[Lc]>>1<<16>>16);oc[Lc]=-32768>Ea?-32768:32767<Ea?32767:Ea}m(yb);n(Fb,yb,13,ad,27);for(var la=tc,Sa=yb,cc=0;8>cc;cc++)Sa[cc]=la[cc];m(yb);n(Fb,yb,120,ad,40);for(var cd=x.dp0,Ya=0,pd=0,rc=0;3>=rc;rc++,ya+=13){for(var Gc=Da,Hc=40*rc,Wc=Ga,Oc=cd,hd=cd,qd=za,Sc=y,Tc=D,Bc=La++,mb=Gc,Kb=Hc,W=Oc,U=qd,Gd=Tc,ld=Sc,wc=Bc,Z=0,cb=0,X=new Int16Array(40),va=0,Mc=0,ua=0,Hd=0,mc=0,Dc=0,nb=0,Ob=0;39>=Ob;Ob++)nb=mb[Ob+Kb],nb=(0>nb?-32768==nb?32767:-nb:nb)<<16>>16,nb>mc&&(mc=nb);nb=0;0!=
mc&&(nb=d(mc<<16));Dc=6<nb?0:6-nb<<16>>16;for(Ob=0;39>=Ob;Ob++)X[Ob]=mb[Ob+Kb]>>Dc;va=0;for(Z=cb=40;120>=Z;Z++){var I=0,J=1,I=X[0]*W[U-Z],I=I+X[1]*W[J+U-Z];J++;I+=X[2]*W[J+U-Z];J++;I+=X[3]*W[J+U-Z];J++;I+=X[4]*W[J+U-Z];J++;I+=X[5]*W[J+U-Z];J++;I+=X[6]*W[J+U-Z];J++;I+=X[7]*W[J+U-Z];J++;I+=X[8]*W[J+U-Z];J++;I+=X[9]*W[J+U-Z];J++;I+=X[10]*W[J+U-Z];J++;I+=X[11]*W[J+U-Z];J++;I+=X[12]*W[J+U-Z];J++;I+=X[13]*W[J+U-Z];J++;I+=X[14]*W[J+U-Z];J++;I+=X[15]*W[J+U-Z];J++;I+=X[16]*W[J+U-Z];J++;I+=X[17]*W[J+U-Z];J++;
I+=X[18]*W[J+U-Z];J++;I+=X[19]*W[J+U-Z];J++;I+=X[20]*W[J+U-Z];J++;I+=X[21]*W[J+U-Z];J++;I+=X[22]*W[J+U-Z];J++;I+=X[23]*W[J+U-Z];J++;I+=X[24]*W[J+U-Z];J++;I+=X[25]*W[J+U-Z];J++;I+=X[26]*W[J+U-Z];J++;I+=X[27]*W[J+U-Z];J++;I+=X[28]*W[J+U-Z];J++;I+=X[29]*W[J+U-Z];J++;I+=X[30]*W[J+U-Z];J++;I+=X[31]*W[J+U-Z];J++;I+=X[32]*W[J+U-Z];J++;I+=X[33]*W[J+U-Z];J++;I+=X[34]*W[J+U-Z];J++;I+=X[35]*W[J+U-Z];J++;I+=X[36]*W[J+U-Z];J++;I+=X[37]*W[J+U-Z];J++;I+=X[38]*W[J+U-Z];J++;I+=X[39]*W[J+U-Z];I>va&&(cb=Z<<16>>16,va=
I)}ld[wc]=cb;va<<=1;va>>=6-Dc;for(Ob=Mc=0;39>=Ob;Ob++)var Ec=0,Ec=W[Ob-cb+U]>>3<<16>>16,Mc=Mc+Ec*Ec;Mc<<=1;if(0>=va)Gd[wc]=0;else if(va>=Mc)Gd[wc]=3;else for(var nb=d(Mc),ua=va<<nb>>16<<16>>16,Hd=Mc<<nb>>16<<16>>16,rd=0;2>=rd&&!(ua<=a(Hd,t[rd]));rd++)Gd[wc]=rd;var Vb=Sc[Bc],qc=Oc,Lb=Gc,Id=Hc,xc=hd,yc=Wc,Pb=qd,Hb=0,ra=0,db=0;switch(Tc[Bc]){case 0:Hb=3277;for(ra=0;39>=ra;ra++)xc[ra+Pb]=b(Hb,qc[ra-Vb+Pb]),db=Lb[ra+Id]-xc[ra+Pb],yc[ra+5]=-32768>db?-32768:32767<db?32767:db;break;case 1:Hb=11469;for(ra=
0;39>=ra;ra++)xc[ra+Pb]=b(Hb,qc[ra-Vb+Pb]),db=Lb[ra+Id]-xc[ra+Pb],yc[ra+5]=-32768>db?-32768:32767<db?32767:db;break;case 2:Hb=21299;for(ra=0;39>=ra;ra++)xc[ra+Pb]=b(Hb,qc[ra-Vb+Pb]),db=Lb[ra+Id]-xc[ra+Pb],yc[ra+5]=-32768>db?-32768:32767<db?32767:db;break;case 3:for(Hb=32767,ra=0;39>=ra;ra++)xc[ra+Pb]=b(Hb,qc[ra-Vb+Pb]),db=Lb[ra+Id]-xc[ra+Pb],yc[ra+5]=-32768>db?-32768:32767<db?32767:db}for(var Vc=Ga,wd=F,id=z,Nc=Oa++,Td=E,jd=ya,kd=new Int16Array(13),Ud=new Int16Array(13),Wb=Vc,Xb=0,Ta=0;39>=Ta;Ta++)Xb=
4096,Xb+=-134*Wb[Ta+0]+-374*Wb[Ta+1]+2054*Wb[Ta+3]+5741*Wb[Ta+4]+8192*Wb[Ta+5]+5741*Wb[Ta+6]+2054*Wb[Ta+7]+-374*Wb[Ta+9]+-134*Wb[Ta+10],Xb=Xb>>13<<16>>16,ma[Ta]=-32768>Xb?-32768:32767<Xb?32767:Xb;var zd=kd,ie=id,Jd=Nc,wa=0,zb=0,Kd=0,Vd=void 0,wa=0,Vd=wa+=g(0,1)+g(0,2)+g(0,3)+g(0,4)+g(0,5)+g(0,6)+g(0,7)+g(0,8)+g(0,9)+g(0,10)+g(0,11)+g(0,12),wa=wa+g(0,0),zb=wa<<=1,wa=0,wa=wa+(g(1,0)+g(1,1)+g(1,2)+g(1,3)+g(1,4)+g(1,5)+g(1,6)+g(1,7)+g(1,8)+g(1,9)+g(1,10)+g(1,11)+g(1,12)),wa=wa<<1;wa>zb&&(Kd=1,zb=wa);
wa=0;wa+=g(2,0)+g(2,1)+g(2,2)+g(2,3)+g(2,4)+g(2,5)+g(2,6)+g(2,7)+g(2,8)+g(2,9)+g(2,10)+g(2,11)+g(2,12);wa<<=1;wa>zb&&(Kd=2,zb=wa);wa=Vd;wa+=g(3,12);wa<<=1;wa>zb&&(Kd=3);for(var dd=0;12>=dd;dd++)zd[dd]=ma[Kd+3*dd];ie[Jd]=Kd;for(var yd=kd,Wd=Td,Xd=jd,ce=wd,de=Nc,ed=0,Ld=0,fd=0,Ka=0,ob=0,Qd=0,gd=0,Md=0,Ib=0,Ib=0;12>=Ib;Ib++)Ka=yd[Ib],Ka=0>Ka?-32768==Ka?32767:-Ka:Ka,Ka>Ld&&(Ld=Ka);gd=0;Ka=Ld>>9<<16>>16;for(Ib=ed=0;5>=Ib;Ib++)ed=0>=Ka?ed|1:ed|0,Ka=Ka>>1<<16>>16,0==ed&&gd++;var Ka=gd+5<<16>>16,Yd=(Ld>>
Ka<<16>>16)+(gd<<3<<16>>16),fd=-32768>Yd?-32768:32767<Yd?32767:Yd,sd=0,jc=0;15<fd&&(sd=(fd>>3<<16>>16)-1<<16>>16);jc=fd-(sd<<3)<<16>>16;if(0==jc)sd=-4,jc=7;else{for(;7>=jc;)jc=(jc<<1|1)<<16>>16,sd--;jc-=8}ga==ga?(ca=sd,fa=jc):(ha=sd,ka=jc);gd=ca;Md=fa;ob=6-gd<<16>>16;Qd=u[Md];for(Ib=0;12>=Ib;Ib++)Ka=yd[Ib]<<ob<<16>>16,Ka=a(Ka,Qd),Ka=Ka>>12<<16>>16,Wd[Ib+Xd]=Ka+4<<16>>16;fa=Md;ca=gd;ce[de]=fd;var ee=Td,Nd=Ud,fe=jd,Ab=0,je=0,Zd=0,ke=0,kc=0,Od=0;ga==ga?(je=w[fa],kc=6-ca<<16>>16):(je=w[ka],kc=6-ha<<16>>
16);for(var Zd=-32768>kc?-32768:32767<kc?32767:kc,kc=Zd-1,td=-32768>kc?-32768:32767<kc?32767:kc,ke=16<=td?0:-16>=td?-0:0>td?f(1,-td):1<<td<<16>>16,$d=oa=0;13>$d;$d++)Ab=(ee[fe++]<<1)-7<<16>>16,Ab=Ab<<28>>16,Ab=b(je,Ab),Od=Ab+ke,Ab=-32768>Od?-32768:32767<Od?32767:Od,Nd[oa++]=f(Ab,Zd);var ud=Ud,Bb=Vc,le=ga,tb=13,Pd=0,Ba=0,Ba=le==ga?5:0;switch(id[Nc]){case 3:Bb[Ba++]=0;do Bb[Ba++]=0,Bb[Ba++]=0,Bb[Ba++]=ud[Pd++],--tb;while(0!=tb);break;case 2:do Bb[Ba++]=0,Bb[Ba++]=0,Bb[Ba++]=ud[Pd++],--tb;while(0!=tb);
break;case 1:do Bb[Ba++]=0,Bb[Ba++]=ud[Pd++],Bb[Ba++]=0,--tb;while(0!=tb);break;case 0:do Bb[Ba++]=ud[Pd++],Bb[Ba++]=0,Bb[Ba++]=0,--tb;while(0!=tb)}le==ga&&(Bb[Ba++]=0);for(Ya=0;39>=Ya;Ya++)pd=Ga[5+Ya]+cd[Ya+za],cd[Ya+za]=-32768>pd?-32768:32767<pd?32767:pd;za+=40}for(Ya=0;120>Ya;Ya++)cd[Ya]=cd[160+Ya];var p=0;R?(p=v[0]<<4|v[1]<<10,A[M++]=p>>4,p=p>>5|v[2]<<11,A[M++]=p>>7,p=p>>5|v[3]<<11,p=p>>4|v[4]<<12,A[M++]=p>>6,p=p>>4|v[5]<<12,p=p>>3|v[6]<<13,A[M++]=p>>7,p=p>>3|v[7]<<13,p=p>>7|y[0]<<9,A[M++]=p>>
5,p=p>>2|D[0]<<14,p=p>>2|z[0]<<14,p=p>>6|F[0]<<10,A[M++]=p>>3,p=p>>3|E[0]<<13,A[M++]=p>>8,p=p>>3|E[1]<<13,p=p>>3|E[2]<<13,p=p>>3|E[3]<<13,A[M++]=p>>7,p=p>>3|E[4]<<13,p=p>>3|E[5]<<13,p=p>>3|E[6]<<13,A[M++]=p>>6,p=p>>3|E[7]<<13,p=p>>3|E[8]<<13,A[M++]=p>>8,p=p>>3|E[9]<<13,p=p>>3|E[10]<<13,p=p>>3|E[11]<<13,A[M++]=p>>7,p=p>>3|E[12]<<13,p=p>>7|y[1]<<9,A[M++]=p>>5,p=p>>2|D[1]<<14,p=p>>2|z[1]<<14,p=p>>6|F[1]<<10,A[M++]=p>>3,p=p>>3|E[13]<<13,A[M++]=p>>8,p=p>>3|E[14]<<13,p=p>>3|E[15]<<13,p=p>>3|E[16]<<13,A[M++]=
p>>7,p=p>>3|E[17]<<13,p=p>>3|E[18]<<13,p=p>>3|E[19]<<13,A[M++]=p>>6,p=p>>3|E[20]<<13,p=p>>3|E[21]<<13,A[M++]=p>>8,p=p>>3|E[22]<<13,p=p>>3|E[23]<<13,p=p>>3|E[24]<<13,A[M++]=p>>7,p=p>>3|E[25]<<13,p=p>>7|y[2]<<9,A[M++]=p>>5,p=p>>2|D[2]<<14,p=p>>2|z[2]<<14,p=p>>6|F[2]<<10,A[M++]=p>>3,p=p>>3|E[26]<<13,A[M++]=p>>8,p=p>>3|E[27]<<13,p=p>>3|E[28]<<13,p=p>>3|E[29]<<13,A[M++]=p>>7,p=p>>3|E[30]<<13,p=p>>3|E[31]<<13,p=p>>3|E[32]<<13,A[M++]=p>>6,p=p>>3|E[33]<<13,p=p>>3|E[34]<<13,A[M++]=p>>8,p=p>>3|E[35]<<13,p=
p>>3|E[36]<<13,p=p>>3|E[37]<<13,A[M++]=p>>7,p=p>>3|E[38]<<13,p=p>>7|y[3]<<9,A[M++]=p>>5,p=p>>2|D[3]<<14,p=p>>2|z[3]<<14,p=p>>6|F[3]<<10,A[M++]=p>>3,p=p>>3|E[39]<<13,A[M++]=p>>8,p=p>>3|E[40]<<13,p=p>>3|E[41]<<13,p=p>>3|E[42]<<13,A[M++]=p>>7,p=p>>3|E[43]<<13,p=p>>3|E[44]<<13,p=p>>3|E[45]<<13,A[M++]=p>>6,p=p>>3|E[46]<<13,p=p>>3|E[47]<<13,A[M++]=p>>8,p=p>>3|E[48]<<13,p=p>>3|E[49]<<13,p=p>>3|E[50]<<13,A[M++]=p>>7,p=p>>3|E[51]<<13,A[M]=p>>12,L=A[M]):(p=L<<6|v[0]<<10,A[M++]=p>>6,p=p>>6|v[1]<<10,A[M++]=p>>
8,p=p>>5|v[2]<<11,p=p>>5|v[3]<<11,A[M++]=p>>6,p=p>>4|v[4]<<12,p=p>>4|v[5]<<12,A[M++]=p>>6,p=p>>3|v[6]<<13,p=p>>3|v[7]<<13,A[M++]=p>>8,p=p>>7|y[0]<<9,p=p>>2|D[0]<<14,A[M++]=p>>7,p=p>>2|z[0]<<14,p=p>>6|F[0]<<10,A[M++]=p>>7,p=p>>3|E[0]<<13,p=p>>3|E[1]<<13,p=p>>3|E[2]<<13,A[M++]=p>>6,p=p>>3|E[3]<<13,p=p>>3|E[4]<<13,A[M++]=p>>8,p=p>>3|E[5]<<13,p=p>>3|E[6]<<13,p=p>>3|E[7]<<13,A[M++]=p>>7,p=p>>3|E[8]<<13,p=p>>3|E[9]<<13,p=p>>3|E[10]<<13,A[M++]=p>>6,p=p>>3|E[11]<<13,p=p>>3|E[12]<<13,A[M++]=p>>8,p=p>>7|y[1]<<
9,p=p>>2|D[1]<<14,A[M++]=p>>7,p=p>>2|z[1]<<14,p=p>>6|F[1]<<10,A[M++]=p>>7,p=p>>3|E[13]<<13,p=p>>3|E[14]<<13,p=p>>3|E[15]<<13,A[M++]=p>>6,p=p>>3|E[16]<<13,p=p>>3|E[17]<<13,A[M++]=p>>8,p=p>>3|E[18]<<13,p=p>>3|E[19]<<13,p=p>>3|E[20]<<13,A[M++]=p>>7,p=p>>3|E[21]<<13,p=p>>3|E[22]<<13,p=p>>3|E[23]<<13,A[M++]=p>>6,p=p>>3|E[24]<<13,p=p>>3|E[25]<<13,A[M++]=p>>8,p=p>>7|y[2]<<9,p=p>>2|D[2]<<14,A[M++]=p>>7,p=p>>2|z[2]<<14,p=p>>6|F[2]<<10,A[M++]=p>>7,p=p>>3|E[26]<<13,p=p>>3|E[27]<<13,p=p>>3|E[28]<<13,A[M++]=p>>
6,p=p>>3|E[29]<<13,p=p>>3|E[30]<<13,A[M++]=p>>8,p=p>>3|E[31]<<13,p=p>>3|E[32]<<13,p=p>>3|E[33]<<13,A[M++]=p>>7,p=p>>3|E[34]<<13,p=p>>3|E[35]<<13,p=p>>3|E[36]<<13,A[M++]=p>>6,p=p>>3|E[37]<<13,p=p>>3|E[38]<<13,A[M++]=p>>8,p=p>>7|y[3]<<9,p=p>>2|D[3]<<14,A[M++]=p>>7,p=p>>2|z[3]<<14,p=p>>6|F[3]<<10,A[M++]=p>>7,p=p>>3|E[39]<<13,p=p>>3|E[40]<<13,p=p>>3|E[41]<<13,A[M++]=p>>6,p=p>>3|E[42]<<13,p=p>>3|E[43]<<13,A[M++]=p>>8,p=p>>3|E[44]<<13,p=p>>3|E[45]<<13,p=p>>3|E[46]<<13,A[M++]=p>>7,p=p>>3|E[47]<<13,p=p>>
3|E[48]<<13,p=p>>3|E[49]<<13,A[M++]=p>>6,p=p>>3|E[50]<<13,p=p>>3|E[51]<<13,A[M++]=p>>8);for(var ge,he=r,me=Y,zc=0,vd=R?32:33,zc=0;zc<vd;zc++)he[zc+me]=A[zc];return ge=vd};var R=!1,Y=[8,7,6,6,5,5,5,5,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],G=new Int32Array(9),ca=0,fa=0,ha=0,ka=0,oa=0,ga=0,ma=new Int16Array(40)}h.name="AUDIO_INPUT";h.process=function(d){var e=d.getByte(),g=null;switch(e){case 1:d=d.getLittleEndian32();g=new RdpBuffer(new Uint8Array(5),0,5);g.setByte(1);g.setLittleEndian32(d);g.markEnd();h.send(g);break;case 2:var m=d,f=m.getLittleEndian32(),
q=m.getLittleEndian32(),g=[],e=[];d=0;q=hi5.audio.getAudioContext().sampleRate;for(d=0;d<f;d++){var r=new c;r.fromBuffer(m);49==r.formatTag&&22050==r.nSamplesPerSec?(r.hasLocalSupport=!0,g.push(r)):1==r.formatTag&&r.nSamplesPerSec==q&&2==r.nChannels&&e.push(r)}h.send(u);m=0;q=g.length;0==q&&(g=e,q=e.length,v.directInput=!0);for(d=0;d<q;d++)m+=g[d].getSize();e=new RdpBuffer(new Uint8Array(1024),0,1024);e.setByte(2);e.setLittleEndian32(q);e.setLittleEndian32(m+9);for(d=0;d<q;d++)g[d].toBuffer(e);e.skipPosition(1024-
m-9);e.markEnd();h.send(e);break;case 3:b(d);break;case 7:g=d.getLittleEndian32();w||(a(g),w=!1);break;default:svGlobal.logger.warn("audioInpt: invalid tag:"+e)}};var m=!1;h.onclose=function(){m=!1;v&&v.close()};var u=new Uint8Array(1);u[0]=5;var w=!1,y=g.reconnectOnResize,x=new Uint8Array(0),t=null,v=new d(hi5.audio.getAudioContext())})();g.addDynamicChannel(h)}}},Cc=new Ne,Ua=new Qd,xe=new Vf,Ec=Array(20),nc=0;this.getFileUrl=function(a){return g.modifyURL(Cb()+"/DOWNLOAD?s="+Zb+"&f="+a)};this.reconnect=
function(a,b,c){c=c||!1;if(!(ka&&eb||c))return!1;x.minWidth&&a<x.minWidth&&(a=x.minWidth);x.minHeight&&b<x.minHeight&&(b=x.minHeight);a&=-4;b&=-4;if(!c&&4>Math.abs(a-R)&&4>Math.abs(b-ca))return!1;eb=!1;svGlobal.logger.info("reconnecting...");K("8E0"+a+"\t"+b);return!0};this.notify=function(a,b){a="8E6"+a;b&&(a+="\t"+b.join(";"));K(a)};this.getUploadManager=function(){return Da};this.addSurface=function(a){F.hasSurface(a)||(rc||D.setContext(a.context),-1!=F.indexOf(a)&&a.railWin)||(jb&&a.setPlayerMode(),
x.mouseMoveEmu&&(a.mouseMoveEmu=za(x.mouseMoveEmu)),a.setConfig(A),F.addSurface(a),a.setSize(R,ca,oa?"hidden":null),a.setController(Rb),a.setFastCopy(za(x.fastCopy)),a.setTouchpad(za(x.touchpad)),a.setClipboard(za(x.mapClipboard)),ge&&Re(a),x.invitation&&(F.setReadOnly(!0),btn=hi5.$("requestControl"))&&(btn.disabled=!1),a.run(parseInt(x.keyboard||1033,10)))};this.getRunninApps=this.getRunningApps=function(){for(var a=[],b=0,c=F.length;b<c;b++)F[b].railWin.getMain(F.zOrders)&&a.push(F[b].railWin.getMain(F.zOrders).titleInfo);
return a};this.startApp=function(a,b,c){K("8C2"+a+"\t"+b+"\t"+c);var d=F[F.length-1];d&&(d.remoteApp=new Se(a,b,c))};this.startExitingApp=function(a){a=F.popWins(a);for(var b=a.length,b=b-1;0<=b;b--)F.addWin(a[b])};this.VirtualChannel=function(){return new ee(143)};this.GatewayChannel=function(){return new ee(28)};this.DynamicChannel=function(){return new ee(64)};this.addChannel=function(a){$b[a.name]=a};this.addGatewayChannel=function(a){ac[a.name]=a};this.addDynamicChannel=function(a){pa.names.push(a.name);
pa[a.name]=a;pa.count++};if(za(x.smartCard)){var Qc=new g.GatewayChannel,Fe=null;Qc.name="SCARDSTB";Qc.onopen=function(){Fe=document.getElementById(hi5.appcfg.clientAppletId||"clientApplet")};Qc.process=function(a){var b=null;if(Fe){var c=a.getPosition();a=hi5.Base64.enc(a.getData(),a.getEnd()-c,c);try{a=Fe.deviceControl(a),b=hi5.Base64.dec(a,0)}catch(d){svGlobal.logger.warn(d)}}b||(b=[0]);a=new hi5.DataBuffer(b);a.markEnd(b.length);Qc.send(a)};g.addGatewayChannel(Qc)}this.run=function(){Te();ta.supportWebAudio&&
ta.iOSFix()};this.getDesktop=function(){return D};this.mouseDown=function(a,b,c){Pa&&K("80"+a+"\t"+b+"\t"+c)};this.mouseMove=function(a,b){Pa&&K("82"+a+"\t"+b)};this.mouseUp=function(a,b,c){Pa&&K("81"+a+"\t"+b+"\t"+c)};this.writeKeyCode=function(a,b){Pa&&K("8B"+(a?0:49152)+"\t"+b)};this.writeScancode=function(a,b){Pa&&("number"==typeof a?(K("840\t"+a),K("8449152\t"+a)):K("84"+(a?0:49152)+"\t"+b))};this.writeText=function(a){Pa&&K("86"+a)};this.writeRawInput=function(a){Pa&&K(a)};var Ja=new RdpBuffer([],
0,0);this.sendPing=function(a){if(ka){var b=a?2+a.length:2,b=new Uint8Array(b);b[0]=146;b[1]=0;a&&b.set(a,2);sa.send(b.buffer)}};this.startPing=function(a,b){ib.setInterval(a,b)};this.stopPing=function(){ib.setInterval(0)};var Qa=null,bf=0;this.play=function(){K("F3")};this.pause=function(){K("F2")};this.scan=function(a){K("F4"+(a?"1":"0"))};this.seek=function(a){var b=F.getFocused();b&&ka&&(K("F4"+(a?"1":"0")+"\t"+(a/b.getScale()|0)),D.pause(!0))};Oa=Ma=Fa=0;Na=22050;var af=!1;this.showMessage=function(a,
b,c){g.displayMsg&&a&&((b=b||F.getFocused())?b.showMessage(a,c):hi5.notifications.notify({msg:a,timeout:c||0}))};var Gc=new mg,Hc=new ng,gf=new sg,wf=new og,re=wf.process,kf=new function(){var a=[{d:507,c:"text"}];this.distance=function(a,c){for(var d=0,e=0,g=a.length;e<g;e++)0!=a[e]&&(d+=e%c+(e/c|0));return d};this.getName=function(b,c){for(var d=kf.distance(b,c),e=0,g=a.length;e<g;e++)if(128>Math.abs(d-a[e].d))return a[e].c;return null}},wg=[1,2,1,0,0,0,0,1,1,2,1,1,0,2,3,1,2,2,2,2,1,2,1,0,2,1,2,
3],Ac={readVar4Bytes:function(a){var b=a.getByte(),c=0;switch((b&192)>>6){case 0:c=b&63;break;case 1:c=(b&63)<<8|a.getByte();break;case 2:c=(b&63)<<16;b=a.getByte();c|=b<<8;b=a.getByte();c|=b;break;case 3:c=(b&63)<<24,b=a.getByte(),c|=b<<16,b=a.getByte(),c|=b<<8,b=a.getByte(),c|=b}return c},readVar2Bytes:function(a){var b=a.getByte();return 0!=(b&128)?(b&127)<<8|a.getByte():b}};this.close=function(){if(sa&&sa.readyState!=WebSocket.CLOSING&&sa.readyState!=WebSocket.CLOSED)try{for(;sa&&sa.readyState!=
WebSocket.CLOSING&&sa.readyState!=WebSocket.CLOSED;)jb||sa.readyState!=WebSocket.OPEN||K("85-1"),sa.close()}catch(a){hb()}else hb()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(hb):window.addEventListener("unload",hb,!1);var xa=16777215}svGlobal.Rdp=Rdp;var RdpBuffer=hi5.DataBuffer;
