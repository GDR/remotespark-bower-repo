var svManager={getInstance:function(){var r=window.$rdp;return r&&r.running&&r.running()?r:null}};svGlobal.getInstance=svManager.getInstance;
function connvertServer(r){var M={};M.id=r.id;M.server=r.id;M.displayName=r.displayName||r.id;if(r=r.rdp){for(var Ua in r)M[Ua]=r[Ua];M.user=r.username||"";M.pwd=r.password||"";M.useConsole=r.console||!1;M.legacyMode=r.leagacyMode||r.legacyMode||!1;M.server_bpp=r.color||16;M.exe=r.remoteProgram||"";M.args=r.remoteArgs||"";M.startProgram=0<M.exe.length?"app":M.command&&0<M.command.length?"shell":"noapp"}return M}
hi5.browser.isChromeApp||window.addEventListener("beforeunload",function(r){var M=svManager.getInstance();if(M&&M.isRemoteApp()&&2!=M.mode&&M.displayMsg&&__svi18n.remoteApp.warn){var M=M.getRunninApps(),Ua=M.length;if(0<Ua){for(var ib=__svi18n.remoteApp.warn+"<br>",Ia=0;Ia<Ua;Ia++)ib+=M[Ia]+" ";ib+="<br>"+__svi18n.remoteApp.close;hi5.notifications.notify({msg:ib});r&&(r.returnValue=ib);return ib}}},!1);
function Rdp2(r){if(!r){var M=window.opener;try{M&&M.__sparkUser&&M.__sparkUser.server&&(r=M.__sparkUser.server),!r&&M.sparkServer&&(r=M.sparkServer)}catch(Ua){}r||(r=hi5.browser.cookie2Obj());if(!r||!r.gateway)return hi5.notifications.notify({msg:__svi18n.noauth}),null}var M="",ib=r.gateway||"",Ia=window.innerWidth,$a=window.innerHeight,wa=16,Fa=null;r.width&&(Ia=parseInt(r.width,10));r.height&&($a=parseInt(r.height,10));r.color&&(wa=parseInt(r.color,10));r.server_bpp&&(wa=parseInt(r.server_bpp,
10));for(var Va in r){svGlobal.logger.debug("** p:"+Va+" v="+r[Va]);var pa=r[Va];if("useSSL"==Va)Fa="true"==pa||1==pa;else{if("boolean"==typeof pa)if(pa)pa="on";else continue;""!=M&&(M+="&");M+=Va+"="+encodeURIComponent(pa)}}null===Fa&&(Fa="https:"==location.protocol);M=(Fa?"wss://":"ws://")+ib+"/RDP?"+M;return new Rdp(M,Ia,$a,wa)}svGlobal.Rdp2=Rdp2;
function Rdp(r,M,Ua,ib){var Ia,$a,wa,Fa;function Va(a){return nc?new Uint32Array(a):Array(a)}function pa(a){return nc?new Int32Array(a):Array(a)}function yb(a){return nc?new Uint8Array(a):Array(a)}function Fb(a){return"on"==a||"true"==a}function jb(){var a=p.gateway;p.ongetgatewayaddress&&(a=p.ongetgatewayaddress(a));return a}function ce(a){if(hi5.browser.isiOS){var b=a-hi5.browser.innerHeight;10<b&&22>b&&(a=hi5.browser.innerHeight)}return a}function af(){var a=hi5.storage.get("SV_CONN_SHARE_ID");
a||(a=hi5.tool.uuid(),hi5.storage.set("SV_CONN_SHARE_ID",a));return a}function oc(a,b){p.setTitle&&(b=b||window,p.ontitlechange&&(a=p.ontitlechange(a)),b.document.title=a)}function de(){function a(a,k,t,x,f,u,p,r){var V=0,D=pa(160);ab(D,0,160,0);var Jd=pa(40);ab(Jd,0,40,0);for(var B=0;3>=B;B++,V+=13){var T=f[B],S=t[B],N=V,U=u,A=Jd,F=pa(13);ab(F,0,13,0);var z=void 0,M=z=0;15<T&&(z=(T>>3)-1);M=T-(z<<3);if(0==M)z=-4,M=7;else{for(;7>=M;)M=M<<1|1,z--;M-=8}T=Array(2);T[0]=z;T[1]=M;for(var z=T,T=F,H=void 0,
O=M=void 0,L=void 0,M=m[z[1]],O=l(6,z[0]),z=l(O,1),L=16<=z?0:-16>=z?-0:0>z?n(1,-z):1<<z,X=z=0;13>X;X++)H=(U[N++]<<1)-7,H<<=12,H=e(M,H),H+=L,-32768>H?H=-32768:32767<H&&(H=32767),T[z++]=n(H,O);U=13;z=T=0;switch(S){case 3:A[z++]=0;case 2:A[z++]=0;case 1:A[z++]=0;case 0:A[z++]=F[T++],U--}do A[z++]=0,A[z++]=0,A[z++]=F[T++];while(0<--U);for(;4>++S;)A[z++]=0;T=k[B];z=x[B];A=Jd;U=S=F=void 0;y=U=40>T||120<T?y:T;F=h[z];for(T=0;39>=T;T++)S=e(F,g[T-U+120]),S+=A[T],-32768>S?S=-32768:32767<S&&(S=32767),g[T+120]=
S;bb(g,40,g,0,120);bb(g,120,D,40*B,39)}k=pa(8);t=w[vd];x=w[vd^=1];f=0;b(a,t,f++,0,0,-32,13107);b(a,t,f++,0,0,-32,13107);b(a,t,f++,0,2048,-16,13107);b(a,t,f++,0,-2560,-16,13107);b(a,t,f++,0,94,-8,19223);b(a,t,f++,0,-1792,-8,17476);b(a,t,f++,0,-341,-4,31454);b(a,t,f++,0,-1144,-4,29708);for(f=a=0;8>f;f++)a=(x[f]>>2)+(t[f]>>2),-32768>a?a=-32768:32767<a&&(a=32767),a+=x[f]>>1,-32768>a?a=-32768:32767<a&&(a=32767),k[f]=a;c(k);d(k,13,D,p,0,r);for(f=a=0;8>f;f++)a=(x[f]>>1)+(t[f]>>1),-32768>a?a=-32768:32767<
a&&(a=32767),k[f]=a;c(k);d(k,14,D,p,13,r);for(f=a=0;8>f;f++)a=(x[f]>>2)+(t[f]>>2),-32768>a?a=-32768:32767<a&&(a=32767),a+=t[f]>>1,-32768>a?a=-32768:32767<a&&(a=32767),k[f]=a;c(k);d(k,13,D,p,27,r);for(a=0;8>a;a++)k[a]=t[a];c(k);d(k,120,D,p,40,r);D=0;a=r;for(k=r+160;k-- >r;a++)D=e(v,28180),v=p[a]+D,-32768>v?v=-32768:32767<v&&(v=32767),D=v<<1,-32768>D?D=-32768:32767<D&&(D=32767),p[a]=D}function b(a,b,c,d,f,k,m){d=a[c]+k;-32768>d?d=-32768:32767<d&&(d=32767);d=l(d<<10,f<<1);d=e(m,d);d+=d;-32768>d?d=-32768:
32767<d&&(d=32767);b[c]=d}function c(a){for(var b=0,c=0;8>c;c++)0>a[c]?(b=-32768==a[c]?32767:-a[c],a[c]=-(11059>b?b<<1:20070>b?b+11059:k(b>>2,26112))):(b=a[c],a[c]=11059>b?b<<1:20070>b?b+11059:k(b>>2,26112))}function d(a,b,c,d,f,e){for(var k=0,m=0,g=0;0!=b;){b--;for(var k=c[f],n=7;0<=n;n--)m=a[n],g=u[n],g=((-32768==m&&-32768==g?32767:65535&m*g+16384>>15)&65535)<<16>>16,k=l(k,g),m=((-32768==m&&-32768==k?32767:65535&m*k+16384>>15)&65535)<<16>>16,m=u[n]+m,-32768>m?m=-32768:32767<m&&(m=32767),u[n+1]=
m;d[e+f++]=u[0]=k}}function e(a,b){if(-32768==a&&-32768==b)return 32767;var c;return c=(a*b+16384>>15&65535)<<16>>16}function k(a,b){var c=a+b;return-32768>c?-32768:32767<c?32767:c}function l(a,b){var c=a-b;return-32768>c?-32768:32767<c?32767:c}function n(a,b){return 16<=b?0>a?-1:0:-16>=b?0:0>b?a<<-b:a>>b}var m=[18431,20479,22527,24575,26623,28671,30719,32767],h=[3277,11469,21299,32767],g=pa(280);g[0]=0;var w=[pa(8),pa(8)],vd=0,y=40,u=pa(9),v=0,t=pa(320);t[0]=0;var x=[.1];this.decode=function(b,c,
d){for(var l=0,f=0,f=0,e=pa(8),k=pa(4),m=pa(4),g=pa(4),n=pa(4),h=pa(52);c<d;){f=b[c++]&255;e[0]=f&63;f>>>=6;f|=b[c++]<<2&1023;e[1]=f&63;f>>>=6;f|=b[c++]<<4&4095;e[2]=f&31;f>>>=5;e[3]=f&31;f>>>=5;f|=b[c++]<<2&1023;e[4]=f&15;f>>>=4;e[5]=f&15;f>>>=4;f|=b[c++]<<2&1023;e[6]=f&7;f>>>=3;e[7]=f&7;f>>>=3;f|=b[c++]<<4&4095;k[0]=f&127;f>>>=7;g[0]=f&3;f>>>=2;m[0]=f&3;f>>>=2;f|=b[c++]<<1&511;n[0]=f&63;f>>>=6;h[0]=f&7;f=b[c++]&255;h[1]=f&7;f>>>=3;h[2]=f&7;f>>>=3;f|=b[c++]<<2&1023;h[3]=f&7;f>>>=3;h[4]=f&7;f>>>=
3;h[5]=f&7;f>>>=3;f|=b[c++]<<1&511;h[6]=f&7;f>>>=3;h[7]=f&7;f>>>=3;h[8]=f&7;f=b[c++]&255;h[9]=f&7;f>>>=3;h[10]=f&7;f>>>=3;f|=b[c++]<<2&1023;h[11]=f&7;f>>>=3;h[12]=f&7;f>>>=3;f|=b[c++]<<4&4095;k[1]=f&127;f>>>=7;g[1]=f&3;f>>>=2;m[1]=f&3;f>>>=2;f|=b[c++]<<1&511;n[1]=f&63;f>>>=6;h[13]=f&7;f=b[c++]&255;h[14]=f&7;f>>>=3;h[15]=f&7;f>>>=3;f|=b[c++]<<2&1023;h[16]=f&7;f>>>=3;h[17]=f&7;f>>>=3;h[18]=f&7;f>>>=3;f|=b[c++]<<1&511;h[19]=f&7;f>>>=3;h[20]=f&7;f>>>=3;h[21]=f&7;f=b[c++]&255;h[22]=f&7;f>>>=3;h[23]=f&
7;f>>>=3;f|=b[c++]<<2&1023;h[24]=f&7;f>>>=3;h[25]=f&7;f>>>=3;f|=b[c++]<<4&4095;k[2]=f&127;f>>>=7;g[2]=f&3;f>>>=2;m[2]=f&3;f>>>=2;f|=b[c++]<<1&511;n[2]=f&63;f>>>=6;h[26]=f&7;f=b[c++]&255;h[27]=f&7;f>>>=3;h[28]=f&7;f>>>=3;f|=b[c++]<<2&1023;h[29]=f&7;f>>>=3;h[30]=f&7;f>>>=3;h[31]=f&7;f>>>=3;f|=b[c++]<<1&511;h[32]=f&7;f>>>=3;h[33]=f&7;f>>>=3;h[34]=f&7;f=b[c++]&255;h[35]=f&7;f>>>=3;h[36]=f&7;f>>>=3;f|=b[c++]<<2&1023;h[37]=f&7;f>>>=3;h[38]=f&7;f>>>=3;f|=b[c++]<<4&4095;k[3]=f&127;f>>>=7;g[3]=f&3;f>>>=2;
m[3]=f&3;f>>>=2;f|=b[c++]<<1&511;n[3]=f&63;f>>>=6;h[39]=f&7;f=b[c++]&255;h[40]=f&7;f>>>=3;h[41]=f&7;f>>>=3;f|=b[c++]<<2&1023;h[42]=f&7;f>>>=3;h[43]=f&7;f>>>=3;h[44]=f&7;f>>>=3;f|=b[c++]<<1&511;h[45]=f&7;f>>>=3;h[46]=f&7;f>>>=3;h[47]=f&7;f=b[c++]&255;h[48]=f&7;f>>>=3;h[49]=f&7;f>>>=3;f|=b[c++]<<2&1023;h[50]=f&7;f>>>=3;h[51]=f&7;f>>>=3;a(e,k,m,g,n,h,t,0);f&=15;f|=b[c++]<<4&4095;e[0]=f&63;f>>>=6;e[1]=f&63;f=b[c++]&255;e[2]=f&31;f>>>=5;f|=b[c++]<<3&2047;e[3]=f&31;f>>>=5;e[4]=f&15;f>>>=4;f|=b[c++]<<2&
1023;e[5]=f&15;f>>>=4;e[6]=f&7;f>>>=3;e[7]=f&7;f=b[c++]&255;k[0]=f&127;f>>>=7;f|=b[c++]<<1&511;g[0]=f&3;f>>>=2;m[0]=f&3;f>>>=2;f|=b[c++]<<5&8191;n[0]=f&63;f>>>=6;h[0]=f&7;f>>>=3;h[1]=f&7;f>>>=3;f|=b[c++]<<1&511;h[2]=f&7;f>>>=3;h[3]=f&7;f>>>=3;h[4]=f&7;f=b[c++]&255;h[5]=f&7;f>>>=3;h[6]=f&7;f>>>=3;f|=b[c++]<<2&1023;h[7]=f&7;f>>>=3;h[8]=f&7;f>>>=3;h[9]=f&7;f>>>=3;f|=b[c++]<<1&511;h[10]=f&7;f>>>=3;h[11]=f&7;f>>>=3;h[12]=f&7;f=b[c++]&255;k[1]=f&127;f>>>=7;f|=b[c++]<<1&511;g[1]=f&3;f>>>=2;m[1]=f&3;f>>>=
2;f|=b[c++]<<5&8191;n[1]=f&63;f>>>=6;h[13]=f&7;f>>>=3;h[14]=f&7;f>>>=3;f|=b[c++]<<1&511;h[15]=f&7;f>>>=3;h[16]=f&7;f>>>=3;h[17]=f&7;f=b[c++]&255;h[18]=f&7;f>>>=3;h[19]=f&7;f>>>=3;f|=b[c++]<<2&1023;h[20]=f&7;f>>>=3;h[21]=f&7;f>>>=3;h[22]=f&7;f>>>=3;f|=b[c++]<<1&511;h[23]=f&7;f>>>=3;h[24]=f&7;f>>>=3;h[25]=f&7;f=b[c++]&255;k[2]=f&127;f>>>=7;f|=b[c++]<<1&511;g[2]=f&3;f>>>=2;m[2]=f&3;f>>>=2;f|=b[c++]<<5&8191;n[2]=f&63;f>>>=6;h[26]=f&7;f>>>=3;h[27]=f&7;f>>>=3;f|=b[c++]<<1&511;h[28]=f&7;f>>>=3;h[29]=f&7;
f>>>=3;h[30]=f&7;f=b[c++]&255;h[31]=f&7;f>>>=3;h[32]=f&7;f>>>=3;f|=b[c++]<<2&1023;h[33]=f&7;f>>>=3;h[34]=f&7;f>>>=3;h[35]=f&7;f>>>=3;f|=b[c++]<<1&511;h[36]=f&7;f>>>=3;h[37]=f&7;f>>>=3;h[38]=f&7;f=b[c++]&255;k[3]=f&127;f>>>=7;f|=b[c++]<<1&511;g[3]=f&3;f>>>=2;m[3]=f&3;f>>>=2;f|=b[c++]<<5&8191;n[3]=f&63;f>>>=6;h[39]=f&7;f>>>=3;h[40]=f&7;f>>>=3;f|=b[c++]<<1&511;h[41]=f&7;f>>>=3;h[42]=f&7;f>>>=3;h[43]=f&7;f=b[c++]&255;h[44]=f&7;f>>>=3;h[45]=f&7;f>>>=3;f|=b[c++]<<2&1023;h[46]=f&7;f>>>=3;h[47]=f&7;f>>>=
3;h[48]=f&7;f>>>=3;f|=b[c++]<<1&511;h[49]=f&7;f>>>=3;h[50]=f&7;f>>>=3;h[51]=f&7;a(e,k,m,g,n,h,t,160);for(var f=320*l++,w=0;320>w;w++)x[f++]=t[w]/32768}x.length=320*l;return x}}function ee(a,b){var c=[],d=null,e=new pc(0,0,0,0),k="Uint8ClampedArray"in window;this.width=a;this.height=b;var l=!1,n=this;this.getData=function(){return c};this.pause=function(a){l=a};this.isPaused=function(){return l};this.setContext=function(a){a!=d&&(d||!a||a.createImageData(1,1).data.buffer||(k=!1),d=a)};this.getContext=
function(){return d};this.resize=function(d,l){if(nc)for(var e=0;e<l;e++)c[e]=new Uint32Array(d);else if(l>c.length)for(e=c.length;e<l;e++)c[e]=[0];n.width=a=d;n.height=b=l};n.resize(a,b);this.getBuffer=function(){return c};this.setRGB=function(a,b,d){c[b][a]=d|4278190080};this.getRGB=function(a,b){return c[b][a]};this.setRGBs=function(a,d,e,l,k,n,u){var v=0,t=0;e=a+e;l=d+l;l>b&&(l=b);for(var x=d;x<l;x++,n+=u)for(t=n,d=c[x],v=a;v<e;v++)d[v]=k[t++]};this.moveArea=function(a,b,d,l,e,k){if(0<k){e=a+
e;k=b+k;for(var n=0,v=0,t,v=l-1;0<=v;v--)for(l=c[k+v],t=c[b+v],n=0;n<d;n++)l[e+n]=t[a+n]}else if(0>k){e=a+e;k=b+k;for(var v=n=0,x;v<l;v++)for(t=c[k+v],x=c[b+v],n=0;n<d;n++)t[e+n]=x[a+n]}else if(0<e)for(e=a+e,k=b+k,x=t=v=n=0,n=d-1;0<=n;n--)for(t=e+n,x=a+n,v=0;v<l;v++)c[k+v][t]=c[b+v][x];else for(e=a+e,k=b+k,x=t=v=n=0;n<d;n++)for(t=e+n,x=a+n,v=0;v<l;v++)c[k+v][t]=c[b+v][x]};this.getRGBs=function(a,b,d,e){var l=Va(d*e);l[0]=0;d=a+d;e=b+e;for(var k=0,n=b;n<e;n++)for(b=a;b<d;b++)l[k++]=c[n][b];return l};
this.repaint=function(e,h,g,n){if(d&&!l){0>e&&(g+=e,e=0);0>h&&(n+=h,h=0);e+g>a&&(g=a-e);h+n>b&&(n=b-h);var p=d.createImageData(g,n),y=p.data;g=e+g;n=h+n;var u=0;if(k)for(var y=new Uint32Array(y.buffer),v,t=h;t<n;t++)for(v=e;v<g;v++)y[u++]=c[t][v];else for(var x,R,t=h;t<n;t++)for(v=e;v<g;v++)x=c[t][v],R=u<<2,y[R]=x&255,y[R+1]=x>>8&255,y[R+2]=x>>16&255,y[R+3]=255,u++;d.putImageData(p,e,h)}};this.postPaint=function(a,b,c,d){0<e.width?e.union(a,b,c,d):(e.x=a,e.y=b,e.width=c,e.height=d)};this.commitPaint=
function(){0<e.width&&(n.repaint(e.x,e.y,e.width,e.height),e.width=0)};this.paintTo=function(c,d){0==c&&0==d?n.repaint(0,0,a,b):console.log("xx paintTo, x:"+c+" y:"+d)};this.fillRect=function(a,b,d,e,l){d=a+d;e=b+e;for(var k=b;k<e;k++)for(b=a;b<d;b++)c[k][b]=l};this.drawLine=function(a,b,d,e,l){var k=0,k=0;if(b==e)for(a>d&&(k=a,a=d,d=k),b=c[b],d++,k=a;k<d;k++)b[k]=l;else if(a==d)for(b>e&&(k=b,b=e,e=k),e++,k=b;k<e;k++)c[k][a]=l;else{var n=Math.abs(d-a),p=Math.abs(e-b),k=a,t=b,x=0,R=0,P=0,C=0,Z=0,f=
0,gc=0,r=0;R=d>=a?x=1:x=-1;C=e>=b?P=1:P=-1;n>=p?(C=x=0,f=n,Z=n/2|0,gc=p,r=n):(P=R=0,f=p,Z=p/2|0,gc=n,r=p);if(!(1>r))for(r++,a=0;a<r;a++)c[t][k]=l,Z+=gc,Z>=f&&(Z-=f,k+=x,t+=P),k+=R,t+=C}}}function fe(){var a="SI_"+p.server;B.domain&&(a+=B.domain);B.user&&(a+=B.user);return a}function bf(){if(!qa&&"sessionStorage"in window&&!B.pwd){var a=sessionStorage[fe()];if(a){a=JSON.parse(a);if(!("random"in a))return"";for(var b=a.random,c=0;16>c;c++)b[c]&=255;svGlobal.logger.info("load session, id="+a.logId+" server="+
p.server);return"&logId="+a.logId+"&random="+encodeURIComponent(hi5.Base64.enc(b))}}return""}function ge(){qa?(X=(B.waWidth||screen.width)|0,fa=(B.waHeight||screen.height)|0,768>fa&&767<screen.height&&(fa=768)):(X&=-4,fa&=-4);B.minWidth&&X<B.minWidth&&(X=B.minWidth|0);B.minHeight&&fa<B.minHeight&&(fa=B.minHeight|0);B.waWidth=B.waWidth||X;B.waHeight=B.waHeight||fa}function qc(a,b){D?D.resize(a,b):D=new ee(a,b);return D}function he(a){return 4278190080|(a<<3&248|a>>2&7)<<16|(a>>3&252|a>>9&3)<<8|a>>
8&248|a>>13&7}function cf(a){return 4278190080|Ja[2][a]<<16|Ja[1][a]<<8|Ja[0][a]}function df(a){return 4278190080|a}function Ec(a,b,c,d,e,k){for(var l=0,n=0,m=0,h=m=0,g=0,w=0,p=w=0,y=0,u=b,v=k;n<d;){k=v+c*d*4-(n+1)*c*4;g=0;y=k;l=0;if(0==p)for(;l<c;){m=a[b++];h=m&15;m=m>>4&15;w=h<<4|m;47>=w&&16<=w&&(h=w,m=0);for(;0<m;)g=a[b++],e[k]=g,k+=4,l++,m--;for(;0<h;)e[k]=g,k+=4,l++,h--}else for(;l<c;){m=a[b++];h=m&15;m=m>>4&15;w=h<<4|m;47>=w&&16<=w&&(h=w,m=0);for(;0<m;)w=a[b++],0!=(w&1)?(w>>=1,w+=1,g=-w):g=
w>>=1,w=e[p+4*l]+g,e[k]=w,k+=4,l++,m--;for(;0<h;)w=e[p+4*l]+g,e[k]=w,k+=4,l++,h--}n++;p=y}return b-u}function Ld(a,b,c){b||(b=a.length);c||(c=0);b=Math.floor(b/4);for(var d=Va(b),e=d[0]=0,k=0;k<b;k++)e=(k<<2)+c,d[k]=(a[e+3]&255)<<24|a[e+2]&255|(a[e+1]&255)<<8|(a[e+0]&255)<<16;return d}function Fc(a,b,c,d,e,k){var l,n;for(n=0;n<d;n++)for(l=0;l<c;l++)e[k+4*((d-n-1)*c+l)]=a[b+(n*c+l)]}function ef(a,b,c,d,e){c=d[e];var k=0;e+=1;var k=a*b,l=Va(4*k);l[0]=0;if(0==(c&32)){for(var n=e,m,h=0,g=0,w=0,p=w=0,
y=0,u=n,v=3;g<b;){m=v+a*b*4-(g+1)*a*4;for(h=0;h<a;){w=d[n++];p=w&15;w=w>>4&15;y=p<<4|w;47>=y&&16<=y&&(p=y,w=0);for(;0<w;)n++,l[m]=255,m+=4,h++,w--;for(;0<p;)l[m]=255,m+=4,h++,p--}g++}e+=n-u}else for(m=n=0;m<k;m++)n=m<<2,l[n+3]=255;0!=(c&16)?(k=Ec(d,e,a,b,l,2),e+=k,k=Ec(d,e,a,b,l,1),e+=k,Ec(d,e,a,b,l,0)):(Fc(d,e,a,b,l,2),e+=k,Fc(d,e,a,b,l,1),Fc(d,e+k,a,b,l,0));return Ld(l)}function ie(a,b,c,d,e){var k=-1,l=-1;c=e+c;var n=0,m=0,h=0,g=a,w=-1,p=0,y=m=0,u=0,v=h=0,t=4294967295,x=0,R=!1,P=!1,x=!1,C=Va(a*
b);for(C[0]=0;e<c;){p=0;m=d[e++];n=m>>4;switch(n){case 12:case 13:case 14:n-=6;m&=15;h=16;break;case 15:n=m&15;9>n?(m=d[e++],m|=d[e++]<<8):m=11>n?8:1;h=0;break;default:n>>=1,m&=31,h=32}0!=h&&(x=2==n||7==n,0==m?m=x?d[e++]+1:d[e++]+h:x&&(m<<=3));switch(n){case 0:w!=n||g==a&&-1==k||(R=!0);break;case 8:x=d[e++]|d[e++]<<8,y=4278190080|x>>8&248|x>>13&7|(x>>3&252|x>>9&3)<<8|(x<<3&248|x>>2&7)<<16;case 3:x=d[e++]|d[e++]<<8;u=4278190080|x>>8&248|x>>13&7|(x>>3&252|x>>9&3)<<8|(x<<3&248|x>>2&7)<<16;break;case 6:case 7:x=
d[e++]|d[e++]<<8;t=4278190080|x>>8&248|x>>13&7|(x>>3&252|x>>9&3)<<8|(x<<3&248|x>>2&7)<<16;n-=5;break;case 9:v=3;n=2;p=3;break;case 10:v=5,n=2,p=5}w=n;for(h=0;0<m;)switch(g>=a&&(g=0,b--,k=l,l=0+b*a),n){case 0:R&&(C[l+g]=-1==k?t:C[k+g]^t|4278190080,R=!1,m--,g++);if(-1==k){for(;0!=(m&-8)&&g+8<a;)for(var Z=0;8>Z;Z++)C[l+g]=4278190080,m--,g++;for(;0<m&&g<a;)C[l+g]=4278190080,m--,g++}else{for(;0!=(m&-8)&&g+8<a;)for(Z=0;8>Z;Z++)C[l+g]=C[k+g],m--,g++;for(;0<m&&g<a;)C[l+g]=C[k+g],m--,g++}break;case 1:if(-1==
k){for(;0!=(m&-8)&&g+8<a;)for(Z=0;8>Z;Z++)C[l+g]=t,m--,g++;for(;0<m&&g<a;)C[l+g]=t,m--,g++}else{for(;0!=(m&-8)&&g+8<a;)for(Z=0;8>Z;Z++)C[l+g]=C[k+g]^t|4278190080,m--,g++;for(;0<m&&g<a;)C[l+g]=C[k+g]^t|4278190080,m--,g++}break;case 2:if(-1==k){for(;0!=(m&-8)&&g+8<a;)for(Z=0;8>Z;Z++)h<<=1,h&=255,0==h&&(v=0!=p?p&255:d[e++],h=1),C[l+g]=0!=(v&h)?t:4278190080,m--,g++;for(;0<m&&g<a;)h<<=1,h&=255,0==h&&(v=0!=p?p&255:d[e++],h=1),C[l+g]=0!=(v&h)?t:4278190080,m--,g++}else{for(;0!=(m&-8)&&g+8<a;)for(Z=0;8>Z;Z++)h<<=
1,h&=255,0==h&&(v=0!=p?p&255:d[e++],h=1),C[l+g]=0!=(v&h)?C[k+g]^t|4278190080:C[k+g],m--,g++;for(;0<m&&g<a;)h<<=1,h&=255,0==h&&(v=0!=p?p&255:d[e++],h=1),C[l+g]=0!=(v&h)?C[k+g]^t|4278190080:C[k+g],m--,g++}break;case 3:for(;0!=(m&-8)&&g+8<a;)for(Z=0;8>Z;Z++)C[l+g]=u,m--,g++;for(;0<m&&g<a;)C[l+g]=u,m--,g++;break;case 4:for(;0!=(m&-8)&&g+8<a;)for(Z=0;8>Z;Z++)x=d[e++]|d[e++]<<8,C[l+g]=4278190080|x>>8&248|x>>13&7|(x>>3&252|x>>9&3)<<8|(x<<3&248|x>>2&7)<<16,m--,g++;for(;0<m&&g<a;)x=d[e++]|d[e++]<<8,C[l+g]=
4278190080|x>>8&248|x>>13&7|(x>>3&252|x>>9&3)<<8|(x<<3&248|x>>2&7)<<16,m--,g++;break;case 8:for(;0!=(m&-8)&&g+8<a;)for(Z=0;8>Z;Z++)P?(C[l+g]=u,P=!1):(C[l+g]=y,P=!0,m++),m--,g++;for(;0<m&&g<a;)P?(C[l+g]=u,P=!1):(C[l+g]=y,P=!0,m++),m--,g++;break;case 13:for(;0!=(m&-8)&&g+8<a;)for(Z=0;8>Z;Z++)C[l+g]=4294967295,m--,g++;for(;0<m&&g<a;)C[l+g]=4294967295,m--,g++;break;case 14:for(;0!=(m&-8)&&g+8<a;)for(Z=0;8>Z;Z++)C[l+g]=4278190080,m--,g++;for(;0<m&&g<a;)C[l+g]=4278190080,m--,g++;break;default:m--,g++}}return C}
function Vc(a){Qb=a;Md=(a+7)/8>>0;switch(a){case 16:lb=he;fd=ie;break;case 8:lb=cf;break;case 32:lb=df;fd=ef;break;default:B.invitation||p.showMessage(a+" bit color is not supported anymore.")}}function gd(a,b){X=a;fa=b;ra=ma=0;ia=X-1;ja=fa-1;svGlobal.logger.warn("resolution changed, w:"+a+" h:"+b);if(p.onresolutionchange)p.onresolutionchange(a,b)}function Wc(a,b,c,d,e,k){this.data=a;this.left=d;this.top=e;this.width=b;this.height=c;this.bitsperpixel=k;this.bytesperpixel=Math.floor((k+7)/8)}function je(){var a,
b=Array(5),c=Array(5);c[0]=null;for(var d=0;5>d;d++)a=Array(600),a[0]=null,b[d]=a;this.putBitmap=function(a,d,l){32767==d?(c[a]&&(c[a].data=null,c[a]=null),c[a]=l):(a=b[a],a[d]&&(a[d].data=null,a[d]=null),a[d]=l)};this.getBitmap=function(a,d){return 32767==d?c[a]:b[a][d]}}function ke(a){var b=__svi18n.errorCode[a];b||(b="error "+a);if(p.onerror)p.onerror({name:a,message:b});p.displayMsg&&hi5.notifications.notify({msg:b});0<svGlobal.log&&console.error&&console.error(b)}function ff(){this.style=this.yOrigin=
this.xOrigin=0;this.pattern=Array(8)}function gf(){this.bottom=this.top=this.right=this.left=0}function hf(){this.action=this.offset=this.bottom=this.top=this.right=this.left=0}function jf(){this.opcode=this.cy=this.cx=this.y=this.x=0}function kf(a,b){this.size=a;this.data=b}function lf(a,b,c,d,e,k,l){this.font=a;this.character=b;this.offset=c;this.baseLine=d;this.width=e;this.height=k;this.fontData=l}function mf(){this.opcode=this.backgroundColor=this.endY=this.endX=this.startY=this.startX=this.mixmode=
0;this.pen=new nf}function of(){this.cacheIDX=this.cacheID=this.colorTable=this.srcY=this.srcX=this.opcode=this.cy=this.cx=this.y=this.x=0}function pf(){this.foregroundColor=this.backgroundColor=this.opcode=this.cy=this.cx=this.y=this.x=0;this.brush=new ff}function nf(){this.color=this.width=this.style=0}function qf(){this.dataSize=this.opcode=this.lines=this.foregroundColor=this.flags=this.y=this.x=0;this.data=Array(256)}function rf(){this.color=this.cy=this.cx=this.y=this.x=0}function sf(){this.srcY=
this.srcX=this.opcode=this.cy=this.cx=this.y=this.x=0}function tf(){this.length=this.opcode=this.boxBottom=this.boxRight=this.boxTop=this.boxLeft=this.clipBottom=this.clipRight=this.clipTop=this.clipLeft=this.font=this.unknown=this.y=this.x=this.backgroundColor=this.foregroundColor=this.mixmode=this.flags=0;this.text=null;this.textPos=0}function Gc(){this.orderType=0;this.bounds=new gf;this.destBlt=new jf;this.patBlt=new pf;this.screenBlt=new sf;this.line=new mf;this.rectangle=new rf;this.deskSave=
new hf;this.memBlt=new of;this.polyLine=new qf;this.text2=new tf;this._line=new hi5.graphic.Line}function le(){mb=ka=!1;Ja=null;me();Qa=new Gc;Rb=0;Xc=Array(256);rc=new je;for(var a=0;12>a;a++)Yc[a]=Array(256);Hc=Array(20);Sb.reset()}function uf(a){if(!sc)return"";a=p.modifyURL(jb()+"/CLIP?s="+sc+"&t="+(new Date).getTime());var b=new XMLHttpRequest;b.open("GET",a,!1);b.setRequestHeader("Content-Type","text/plain;charset=UTF-8");b.send(null);return b.responseText}function vf(){function a(a){if(!(a.winWidth&&
a.winHeight&&a.showState&&45<a.winHeight&&45<a.winWidth))return!1;var b=1>a.ownerWinid;if(!b)return b;if(0==a.showState)return!1;var c=a.style;if(0!=(c&4194304))return!0;a=0!=(a.extStyle&128);(b=b&&!a)&&0!=(c&2147483648)&&0==(c&2156396544)&&(b=!1);return b}function b(a){for(;0<a.ownerWinid;){var b=k.getWinById(a.ownerWinid);if(b&&b.isVisible())a=b;else break}return a}function c(a){for(var b="";a;)a.titleInfo&&(b=a.titleInfo),a=k.getWinById(a.ownerWinid);return b}var d=[],e=0,k=this;this.mainWin=null;
this.addWin=function(b){for(var c=d.length,m=!1,h=0;h<c;h++)if(b.id==d[h].id){d[h]=b;m=!0;break}m||d.push(b);1==d.length&&(e=(new Date).getTime());0<p.windowState&&(a(b)&&!k.mainWin?(k.mainWin=b,0<p.windowState&&(b.fillBrowser(),b.activate(1),svGlobal.logger.info("MainWin:"+b.id),k.getOtherApps(A.zOrders,function(a){if(0<a.length&&p.onexistingapp)p.onexistingapp(a)},5E3))):0<p.windowState&&b.checkBound())};this.popWins=function(a){a=k.getWinById(a);var b=[];if(a){a=0<a.ownerWinid?a.ownerWinid:a.id;
for(var c=d.length-1;0<=c;c--)if(d[c].ownerWinid==a||d[c].id==a)b.push(d[c]),d.splice(c,1)}return b};this.hasApp=function(a){for(var b=0,c=d.length;b<c;b++)if(d[b].appId==a)return!0;return!1};this.isNew=function(){return 3E4>(new Date).getTime()-e};this.getAll=function(){return d};this.hasWin=function(a){return 0<=d.indexOf(a)};this.close=function(){for(var a=0,b=d.length;a<b;a++)d[a].close()};this.clear=function(){d.length=0};this.delWin=function(a){for(var b=0,c=d.length;b<c;b++)if(d[b].id==a)return d.splice(b,
1),b;return-1};this.isRunning=function(){var a,b=d.length;if(1>b)return!1;for(var c=0,b=d.length;c<b;c++)if(a=d[c],a.isVisible())return!0;return!1};this.getWinById=function(a){var b,c=d.length;if(1>c)return null;for(var e=0;e<c;e++)if(b=d[e],b.id==a)return b;return null};this.getTopWin=function(a){var b=null,c,e=a.length;for(c=0;c<e&&(!(b=k.getWinById(a[c]))||!b.isVisible());c++)b=null;if(!b)for(svGlobal.logger.warn("No win found"),e=d.length,c=e-1;0<=c&&(b=d[c],!b.isVisible());c--)b=null;return b};
this.getMain=function(a){return(a=k.getTopWin(a))?b(a):null};this.getOtherApps=function(a,e,m){var h=d.length;if(0!=h&&d[h-1])if(h=d[h-1].appId,m||!h)setTimeout(function(){k.getOtherApps(a,e)},m||3E3);else{m=[];if(h=k.getTopWin(a)){for(var g=0<h.ownerWinid?h.ownerWinid:h.id,w=[],p=0,h=d.length;p<h;p++)d[p].ownerWinid!=g&&d[p].id!=g&&d[p].isVisible()&&w.push(d[p]);p=0;for(h=w.length;p<h;p++)w[p].ownerWinid!=g&&w[p].id!=g&&(m.push({title:c(w[p]),win:b(w[p])}),g=0<w[p].ownerWinid?w[p].ownerWinid:w[p].id)}e(m)}}}
function wf(a){var b={},c=0;this.enabled=!1;hi5.EventControl(this);var d=this,e=null;this.read=function(e,l,n){function m(b){b.target.readyState==FileReader.DONE&&(b=new Uint8Array(b.target.result),a.send(e,l,n,b),c+=n,d.fireEvent("progress",[c]))}var h=b[b[e]];if("undefined"!=typeof h){var g=h.name;1>h.size?p.showMessage(__svi18n.file.zero+g,null,3E3):(h=h.slice(l,l+n),g=new FileReader,g.onloadend=m,g.readAsArrayBuffer(h))}};this.addFile=function(c,e){if(d.enabled){if(!("slice"in c||(c.slice=c.webkitSlice||
c.mozSlice,"slice"in c))){p.showMessage(__svi18n.file.slice);return}var n=e||c.name;p.beforeupload&&p.beforeupload(c,e)||(d.fireEvent("beforeupload",[c,e]),n=encodeURIComponent(n),b[n]=c,a.start(n,c.size))}};this.addFiles=function(a){if(d.enabled)for(var b=0,c=a.length;b<c;b++)d.addFile(a[b])};this.removeFile=function(b){a.remove(b)};this.confirmId=function(a,d,e){b[a]=d;e&&(c+=parseInt(e))};this.close=function(a){if(a){var e=b[a];if(e){delete b[a];delete b[e];a=decodeURIComponent(e);if(p.onfileuploaded)p.onfileuploaded(a);
d.fireEvent("fileuploaded",[a])}for(var n in b)return}else b={};c=0;d.fireEvent("uploaded");if(p.onuploaded)p.onuploaded()};this.cancelAll=function(){a.cancelAll();if(p.onuploadingCancelled)p.onuploadingCancelled();d.fireEvent("uploadingCancelled");d.close()};this.list=function(b,c){e=c;a.list(b)};this.notifyFiles=function(a){e&&e(a);d.fireEvent("files")}}function xf(){function a(a,c){var d=c.length,e=new Uint8Array(2+2*d);e[0]=58;e[1]=a;for(var k=0,l=2,n=0;n<d;n++)k=c.charCodeAt(n),e[l++]=k&255,
e[l++]=k>>8&255;F.send(e.buffer)}this.start=function(a,c){var d=a.length,e=new Uint8Array(10+2*d);e[0]=58;e[1]=0;e[2]=c&255;e[3]=c>>8&255;e[4]=c>>16&255;e[5]=c>>24&255;for(var k=0,l=10,n=0;n<d;n++)k=a.charCodeAt(n),e[l++]=k&255,e[l++]=k>>8&255;F.send(e.buffer)};this.send=function(a,c,d,e){var k=new Uint8Array(22+d);k[0]=58;k[1]=3;var l=2;k[l++]=a&255;k[l++]=a>>8&255;k[l++]=a>>16&255;k[l++]=a>>24&255;k[l++]=c&255;k[l++]=c>>8&255;k[l++]=c>>16&255;k[l++]=c>>24&255;l+=4;k[l++]=d&255;k[l++]=d>>8&255;k[l++]=
d>>16&255;k[l++]=d>>24&255;k.set(e,l+4);F.send(k.buffer)};this.remove=function(b){a(6,b)};this.list=function(b){a(5,b)};this.cancelAll=function(){a(7,"")}}function ne(a){Na||(Na=new wf(new xf));a.setFileHandler(Na)}function oe(a,b,c){var d=!1;this.exe=a;this.args=b||"";this._dir=c||"";var e=this;this.close=function(){!d&&ka&&(d=!0,F.send("8C5"+e.exe+"\t"+e.args+"\t"+p.sessionInfo.appInfo.session))}}function Zc(a){var b=this;a||(a=143);this.send=function(c){var d=!!c.buffer,e=d?c:c.getData(),k=64==
a;c=d?e.length:c.getEnd()||e.length;c<e.length&&(e=d?e.subarray(0,c):e.slice(0,c));d=k?5:9;c=new Uint8Array(d+c);c[0]=a;if(k)c[1]=b.id,c[2]=b.id>>8,c[3]=b.id>>16,c[4]=b.id>>24;else for(var k=b.name,l=Math.min(k.length,8),n=0;n<l;n++)c[1+n]=k.charCodeAt(n);c.set(e,d);F.send(c.buffer);zb.sendPing()};this.name="";this.count=this.id=this.flags=0}function yf(){var a=window.opener;if(a)try{return a.__sparkUser}catch(b){}return null}function pe(){function a(a){Ka=new RecordingManager;Ka.setHeader({name:0<
a.user.length?a.server+"_"+a.user:a.server,width:X,height:fa,color:Qb,namesuffix:".rdpv",filetag:"RDPV",duration:0})}if(!ka){mb=!1;if(tc)F=tc;else{var b=r+"&width="+X+"&height="+fa+"&server_bpp="+Qb+"&audio="+sa.available+bf();0>r.indexOf("waWidth")&&(b+="&waWidth="+B.waWidth+"&waHeight="+B.waHeight);var c=new Date,b=b+("&tzOffset="+c.getTimezoneOffset()+"&time="+c.getTime()),d=c="",e="";for(e in Tb){var k=Tb[e];"flags"in k&&(c&&(c+=",",d+=","),c+=k.name,d+=k.flags)}c&&(b=b+("&channelName="+c)+("&channelFlags="+
d));c="";for(e in Gb)k=Gb[e],"flags"in k&&(c&&(c+=","),c+=k.name);c&&(b+="&gwChannelName="+c);if(d=yf())c=d.account,d=d.session,c&&(b+="&account="+c),d&&(b+="&session="+d);c=hi5.browser.isTouch&&(1024<=window.innerWidth||768<=window.innerHeight);B.audioRecord=Fb(B.audioRecord)&&hi5.audio.recordable;ea.init(c,!!B.remotefx,B.audioRecord);B.audioRecord&&(b+="&audioRecord=on");0<ea.count&&(b+="&dvcChannels="+ea.names.join(","));hi5.browser.binaryWS()&&(b+="&binary=on");O.existingFile&&(b+="&existingFile="+
O.existingFile);b+="&isTouch="+c+"&gatewayAddr="+encodeURIComponent(jb());r=b=p.modifyURL(b);b=0==p.mode&&O.wsPost?r.substring(0,r.indexOf("?"))+"?_METHOD=post":r;F=p.oncreatewebsocket?p.oncreatewebsocket(b):new hi5.WebSocket(b);"binaryType"in F&&(F.binaryType="arraybuffer")}qe.ws=F;svGlobal.logger.info(r);F.onopen=function(a){ka=!0;if(p.onopen)p.onopen();F.send("87"+navigator.userAgent);O.joinCloseMode&&p.setJoinCloseMode(O.joinCloseMode)};void 0!=B.recording&&"on"==B.recording&&a(B);F.onmessage=
zf;F.onclose=function(a){svGlobal.logger.warn("closed, code="+a.code+" reason="+a.reason);a=0==p.mode;!ka&&a&&ke("connection");a=a&&(ka||Ic<p.reconnectTimes)&&0<Ic&&!$c;Aa=ka=!1;if(a)Ic--,p.showMessage(__svi18n.info.reconnecting+" "+(p.reconnectTimes-Ic)+"/"+p.reconnectTimes,null,3E3),setTimeout(pe,5);else{ea&&ea.close();Oa&&Oa.stop();sa&&sa.close();try{null!=Ka&&(Ka.exit(),Ka=null),A&&A.close()}catch(b){}window&&window.$rdp&&(window.$rdp=null);if(p&&p.onclose&&!ad)p.onclose()}};F.onerror=Af;if(b=
A[A.length-1])qa?b&&(b.remoteApp=new oe(B.exe,B.args,"")):oc(B.displayName||p.server,b.getWindow());if(B.invitation){var l=null;b&&(l=b.initChat(B.expert));Ub=new p.GatewayChannel;Ub.name="C_H_A_T";Ub.process=function(a){a=a.getUnicodeString(a.getEnd()-a.getPosition(),!0);l&&l.add(a,B.novice)};l&&(l.onchat=function(a){if(ka){var b=Array(2*a.length),b=new hi5.DataBuffer(b,0,b.length);b.setUnicodeString(a);b.markEnd();Ub.send(b)}});p.addGatewayChannel(Ub)}}}function Af(a){svGlobal.logger.warn(a)}function Ab(a){a=
hi5.Base64.dec(a,0);ua.attach(a,0,a.length);return ua}function zf(a){var b,c=a.data;if("string"!=typeof c)switch(a=new Uint8Array(c),null!=Ka&&Ka.add(new RecordingObj(a,0,c.byteLength,-1)),ua.attach(a,0,c.byteLength),b=ua.getLittleEndian16(),b){case 28:re(ua);break;case 48:se(ua);break;case 49:te(ua);break;case 55:a=ua;switch(a.getByte()){case 0:Ia=a.getLittleEndian16();$a=a.getLittleEndian16();wa=a.getLittleEndian32();a.skipPosition(6);Fa=a.getLittleEndian16();svGlobal.logger.info("Audio Format, tag="+
Ia+" channels="+$a+" bitsPerSample="+Fa+" samplePerSec="+wa);sa.supportAudioData&&(kb=new ue(p.audioBuffer));break;case 1:Bf(a)}break;case 60:ve(ua);break;case 62:we(ua.getUnicodeString(ua.getEnd()-ua.getPosition(),!1));break;case 63:xe(ua);break;case 64:c=ua;b=c.getByte();a=c.getLittleEndian32();switch(b){case 1:c=c.getAscllString();ea[c].id=a;ea[a]=ea[c];if(ea[a].onopen)ea[a].onopen();break;case 3:ea[a].process(c);break;case 4:if(ea[a]&&ea[a].onclose)ea[a].onclose()}break;case 146:a=ua;switch(a.getByte()){case 1:zb.processPong(a)}break;
default:if(p.onunknownmessage)p.onunknownmessage(b,ua);else svGlobal.logger.warn("@TODO:"+b+"\n")}else switch(b=parseInt(c.substring(0,2),16),a=c.substring(2),b){case 0:a=r.substring(r.indexOf("?")+1);F.send("00"+a);F.send("87"+navigator.userAgent);break;case 15:Aa=!0;ad=$c=!1;Ic=p.reconnectTimes;Qa=new Gc;if(p.onready)p.onready();a="";for(a in Tb)if((c=Tb[a])&&c.onopen)c.onopen();for(a in Gb)if((c=Gb[a])&&c.onopen)c.onopen();break;case 26:c=JSON.parse(a);if(p.onnotify)p.onnotify(c);if(c.name){svGlobal.logger.info("msg="+
a);if(c.type&&p.onerror)p.onerror(c);a=__svi18n.errorCode["S"+c.name]||"";a+=c.message;p.showMessage(a,null);$c=!0}else 0<svGlobal.log&&console.erro("No error code for message:"+a);break;case 27:A.drawLicense(a);break;case 28:re(Ab(a));break;case 48:se(Ab(a));break;case 49:te(Ab(a));break;case 50:c=parseInt(a.substring(0,1),10);a=a.substring(1);switch(c){case 1:Cf(a);break;case 2:!(c=A.getFocused())||c.processClipReq(a)||!O.clipWarnAlways&&ye||!B||B.leagacyMode||(p.showMessage(__svi18n.info.menucopy,
null,5E3),ye=!0)}break;case 51:A.setReadOnly("1"==a);break;case 54:c=a.split("\t");a=jb()+c[0];a=p.modifyURL(a);svGlobal.logger.info("Downloading file:"+a+" name:"+c[1]+" driver:"+c[2]);p.onprintingready&&p.onprintingready({link:a,printerName:c[1],pinterDriver:c[2]})||(c=A.getFocused())&&c.showPDF(a);break;case 55:c=parseInt(a.substring(0,1),16);a=a.substring(1);switch(c){case 0:a=a.split("\t");Ia=parseInt(a[0],10);$a=parseInt(a[1],10);Fa=parseInt(a[2],10);wa=parseInt(a[3],10);svGlobal.logger.debug("Audio Format, tag="+
Ia+" channels="+$a+" bitsPerSample="+Fa+" samplePerSec="+wa);sa.supportAudioData&&(kb||(kb=new ue(p.audioBuffer)));break;case 1:Df(a)}break;case 56:a=JSON.parse(a);sc=a.session;a.server||(a.server=p.server);if(c=hi5.$("joinSelect"))c.value=a.joinMode;if(c=hi5.$("requestControl"))c.disabled=a.hasControl;a.joined?A.execute("setAutoScale",[!0]):Fb(B.connectif)&&(p.mode=0,p.reconnectOnResize=Hb,A.setSize(X,fa));var c=O.page&&O.page.join||"join.html",d=jb(),c=d+"/"+c+"?id="+(a.joined||a.numericId);(b=
a.webAddress)&&0<b.length&&b.toLowerCase()!=d.toLowerCase()&&(d=b.indexOf("://"),p.protocol="http"==b.substring(0,d)?"ws":"wss",p.gateway=b,c+="&gateway="+encodeURIComponent(b));c=p.modifyURL(c);a.joinLink=c;p.sessionInfo.appInfo=a;"isApp"in a&&qa!==a.isApp&&(qa=a.isApp,ge(),A.setSize(X,fa,qa?"hidden":null),D=qc(X,fa),mb||A.execute("setAutoScale",[!0]));a.ver&&a.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);if(p.onsessionstart)p.onsessionstart(p.sessionInfo);
break;case 57:c=a.split("\t");svGlobal.logger.debug(a);if(a=A.getWinById(parseInt(c[0]))){if(!A.hasApp(c[1])&&p.onremoteappstart)p.onremoteappstart({id:c[1]});a.appId=c[1]}break;case 58:c=a;if(Na)if(a=parseInt(c.charAt(0),10),c=c.substring(1),5==a)Na.notifyFiles(JSON.parse(c));else switch(c=c.split("\t"),a){case 1:Na.confirmId(c[0],c[1],c[2]);break;case 2:Na.read(c[0],parseInt(c[1],10),parseInt(c[2],10));break;case 4:Na.close(c[0])}break;case 59:a=hi5.Base64.dec(a,0);a=(new RdpBuffer(a,0,a.length)).getLittleEndian32();
!cb&&a&16?a&128&&(Na=null):(bd=!1,Na=null);a&64&&p.showMessage(__svi18n.info.recording);A.execute("setFeature",[a]);break;case 60:ve(Ab(a));break;case 61:a=JSON.parse(a);switch(a.type){case 0:gd(a.width,a.height);D=qc(X,fa);Vc(a.color);if(c=a.server)p.server=a.server;ze=a.length;b=A.getFocused();qa=1==a.isRail;b&&(b.setSize(X,fa,qa?"hidden":null),b.setAutoScale(!qa),c&&oc(B.displayName||p.server,b.getWindow()),c=a.keyboard,"undefined"!=typeof c&&0==c&&b.setUnicode(!0),c=a.mapDisk)&&(bd=!0,ne(b));
if(p.onopened)p.onopened(a);break;case 1:a=a.duration;if(p.onprogress)p.onprogress(a,ze);break;case 2:if(2==a.status)le(),ka=!0;else if(c=0==a.status,c!=D.isPaused()){if(p.onsessionpause&&p.onsessionpause(c,a))break;D.pause(c);c||D.repaint(0,0,D.width,D.height);a.warn&&p.showMessage(c?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)}}break;case 62:we(a);break;case 63:xe(Ab(a));break;default:if(p.onunknownmessage)p.onunknownmessage(b,a);else svGlobal.logger.warn("@TODO:"+c+"\n")}zb.sendPing()}
function re(a){var b=a.getAscllString(8),c=Gb[b];null!=c?c.process(a):svGlobal.logger.warn("Channel "+b+" not found")}function Ef(a,b){var c=0,d=!1;this.width=a;this.interval=b;var e=this,k=0;this.start=function(){d||(d=!0,c=setInterval(function(){var a=A.getFocused();a&&ka&&(a=a.getThumbnail(e.width))&&a.length!=k&&(F.send("8E7"+a),k=a.length)},e.interval))};this.stop=function(){clearInterval(c)}}function Ff(a,b){!Oa||Oa.width==a&&Oa.interval==b||(Oa.stop(),Oa=null);Oa||(Oa=new Ef(a,b));Oa.start()}
function xe(a){var b=a.getAscllString(8);(b=Tb[b])&&b.process&&b.process(a)}function we(a){var b=parseInt(a.substring(0,1),16),c,d=a.substring(1);a=!1;var e=p.sessionInfo.appInfo;switch(b){case 0:c=JSON.parse(d);le();ka=!0;a=c.width;b=c.height;if(a==X&&b==fa)break;gd(a,b);A.setSize(a,b,qa?"hidden":null);D=qc(a,b);break;case 1:Hb=p.reconnectOnResize;p.reconnectOnResize=!1;c=JSON.parse(d);p.sessionInfo.joinedSessions.push(c.numericId);p.onsessionjoin&&(a=p.onsessionjoin(c));if(a)break;p.showMessage(__svi18n.info.joinsession.applyArgs([c.numericId,
c.__ip,c.name]));break;case 2:c=JSON.parse(d);p.sessionInfo.joinedSessions.removeElm(c.numericId);0==p.sessionInfo.joinedSessions.length&&(p.reconnectOnResize=Hb);p.onsessionexit&&(a=p.onsessionexit(c));if(a)break;p.showMessage(__svi18n.info.exitsession.applyArgs([c.numericId,c.__ip,c.name]));break;case 3:c=JSON.parse(d);e.joinMode!=c.mode&&(e.joinMode=c.mode,b=hi5.$("joinSelect"))&&(b.value=c.mode);if(e.hasControl)break;A.setReadOnly(!1);if(b=hi5.$("requestControl"))b.disabled=!0;p.ongivecontrol&&
(a=p.ongivecontrol());if(a)break;p.showMessage(__svi18n.info.givecontrol,null,5E3);break;case 4:A.setReadOnly(!0);e.hasControl=!1;if(b=hi5.$("requestControl"))b.disabled=!1;p.ontakebackcontrol&&(a=p.ontakebackcontrol());if(a)break;p.showMessage(__svi18n.info.nocontrol,null,5E3);break;case 5:c=JSON.parse(d);p.onrequirecontrol&&(a=p.onrequirecontrol(c));if(a)break;a=__svi18n.info.title.applyArgs([c.name,c.numericId,c.__ip]);b=__svi18n.info.recontrol;D.isPaused&&(b+="<br><br>"+(__svi18n.info.autoresume||
""));hi5.notifications.notify({title:a,msg:b,cbYes:function(){p.giveControl(c.numericId);this.destroy();D.isPaused()&&p.pauseSession(p.sessionInfo.appInfo.numericId,!1)},cbNo:function(){p.refuseControl(c.numericId);this.destroy()}});break;case 6:A.execute("setTouchRemoting",[!0]);break;case 7:c=JSON.parse(d);c.width&&c.height&&(p.reconnectOnResize=!1,D=qc(c.width,c.height),gd(c.width,c.height),A.setSize(c.width,c.height));c.color&&(Vc(c.color),svGlobal.logger.warn("Color depth changed to:"+c.color));
break;case 8:c=JSON.parse(d);ad=!0;if(p.onrequestcredential&&p.onrequestcredential(c))break;A.getFocused().requestCredential(c);break;case 9:c=JSON.parse(d);0<c.interval&&0<c.width?Ff(c.width,c.interval):Oa&&Oa.stop();break;case 11:c=JSON.parse(d);p.onrequirejoin&&(a=p.onrequirejoin(c));if(a)break;a=__svi18n.info.title.applyArgs([c.name,c.numericId,c.__ip]);hi5.notifications.notify({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){p.allowJoin(c.numericId,!0);this.destroy()},cbNo:function(){p.allowJoin(c.numericId,
!1);this.destroy()}})}}function ve(a){switch(a.getByte()){case 32:if(!D.isPaused()){a.getLittleEndian16();var b=a.getLittleEndian16();a=a.getLittleEndian16();A.getFocused().moveCursor(b,a,!0)}}}function Df(a){function b(a){var b=0;a*=l;for(m=0;m<l;m++)b|=(k[a+m]&255)<<8*m;b>h?(b-=w,b/=-g):b/=h;return b}function c(a){return function(){F.send("8A"+a)}}if(sa.available&&!D.isPaused()){var d=a.indexOf("\t"),e=a.substring(0,d),k=hi5.Base64.dec(a,d+1);1!=Ia&&(Vb||(Vb=new de),k=Vb.decode(k,0,k.length));a=
Fa;var l=a>>3,n=Math.floor(k.length/l),m=0,h=Math.pow(2,a-1)-1,g=-h-1,w=Math.pow(2,a);a=0;if(sa.supportAudioData){d=Array(n);d[0]=.1;for(a=0;a<n;a++)d[a]=b(a);a=kb.add(d);setTimeout(c(e),a-1E3*sa.delay)}else{var d=$a,n=Math.floor(n/d),p=sa.getBuffer(n),y=p.getChannelData(0),u=p.getChannelData(1);for(a=0;a<n;){var v=2*a,t=b(v);1==d?(y[a]=t,u[a]=t):(y[a]=t,u[a]=b(v+1));a++}a=sa.playBuffer(p);setTimeout(c(e),1E3*(a-sa.delay))}}}function Bf(a){function b(a){return function(){F.send("8A"+a)}}if(sa.available&&
!D.isPaused()){var c=a.getByte()+","+a.getLittleEndian16()+","+a.getLittleEndian64(),d=a.getPosition(),e=a.getData(),k=a.getEnd()-d;if(41222==Ia)(a=hi5.audio.getAudioContext())&&a.decodeAudioData(e.buffer.slice(d),function(a){a=sa.playBuffer(a);cb||setTimeout(b(c),1E3*(a-sa.delay))},function(a){console.log(a)});else{if(a=1!=Ia)Vb||(Vb=new de),e=Vb.decode(e,d,k),d=0,k=e.length;var l=Fa,n=Math.floor(k/(l>>3)),m=k=0,h=0;a||(k=Math.pow(2,l-1)-1,m=-k-1,h=Math.pow(2,l));var g=l=0;if(sa.supportAudioData){var w=
Array(n);w[0]=.1;if(a)for(l=0;l<n;l++)w[l]=e[d++];else for(l=0;l<n;l++)g=e[d++]|e[d++]<<8,g>k?(g-=h,g/=-m):g/=k,w[l]=g;e=kb.add(w);setTimeout(b(c),e-1E3*sa.delay)}else{var w=$a,n=Math.floor(n/w),p=sa.getBuffer(n),y=p.getChannelData(0),u=p.getChannelData(1),l=0;if(a)for(;l<n;)1==w?u[l]=y[l]=e[d++]:(y[l]=e[d++],u[l]=e[d++]),l++;else for(;l<n;)g=e[d++]|e[d++]<<8,g>k?(g-=h,g/=-m):g/=k,1==w?y[l]=g:(y[l]=g,g=e[d++]|e[d++]<<8,g>k?(g-=h,g/=-m):g/=k),u[l]=g,l++;e=sa.playBuffer(p);cb||setTimeout(b(c),1E3*(e-
sa.delay))}}}}function ue(a){var b=[],c,d,e,k=new Gf($a,wa,function(b){var c=b.length,e=c>l.size();if(d||e)l.stop(),setTimeout(function(){l.start()},1E3*a);else for(e=0;e<c;e++)b[e]=l.pull()}),l=this;this.delay=a;this.reset=function(){c=b.length=0;d=!0;k.stop();e=0};this.reset();this.start=function(){d&&(k.start(),d=!1)};this.stop=function(){k.stop();d=!0};this.size=function(){for(var a=b.length,c=0,d=0;d<a;d++)c+=b[d].length;return c};this.add=function(c){var d=(new Date).getTime();e<d&&(e=d);e+=
c.length/(wa*$a)*1E3;var l=b.length;b[l]=c;0==l&&(d=(new Date).getTime(),setTimeout(function(){k.start()},1E3*a));return e-d};this.pull=function(){if(0==b.length)return null;var a=b[0];if(c<a.length)return a[c++];b.shift();c=0;return this.pull()}}function Gf(a,b,c){function d(){var a;if(n){a=e.mozWriteAudio(n.subarray(m));k+=a;m+=a;if(m<n.length)return;n=null}a=e.mozCurrentSampleOffset()+l-k;if(0<a){var b=new Float32Array(a);c(b);a=e.mozWriteAudio(b);a<b.length&&(n=b,m=a);k+=a}}var e=new Audio;e.mozSetup(a,
b);var k=0,l=a*Math.floor(b/2),n=null,m=0,h=null;this.start=function(){h=setInterval(d,100)};this.stop=function(){h&&clearInterval(h)}}function Hf(a){if(!p.openLink)return!1;var b=a.indexOf(";");0<b&&(a=a.substring(b+1));b=a;a=a.toLowerCase();var c=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");c||(0==a.indexOf("www.")?(c=!0,a="http://"+a):0==a.indexOf("ftp.")&&(c=!0,a="ftp://"+a));if(c){if(0<a.indexOf("\r")||
0<a.indexOf("\n"))return!1;if(p.onurlredirection&&p.onurlredirection(c))return!0;a=A.getFocused();if(!a)return!1;a.processLink(b);return!0}return!1}function Cf(a){p.onservercopy&&p.onservercopy(a)||(Hf(a)||A.copyToClip(a),setTimeout(function(){F.send("883")},999))}function se(a){a.getLittleEndian16();var b=a.getByte(),c=a.getByte(),d=a.getLittleEndian16(),e=null;0!=(c&32)?(d-=18,Sb.dec(a.getData(),a.getPosition(),d,c),e=Sb.getData()):e=a;switch(b){case 2:a=e;b=a.getLittleEndian16();switch(b){case 0:a.skipPosition(2);
b=a.getLittleEndian16();a.skipPosition(2);Ae(a,b);break;case 1:Be(a);break;case 2:Ce(a);break;case 3:break;default:svGlobal.logger.warn("Unimplemented Update type "+b)}break;case 20:break;case 31:break;case 27:a=e;c=b=b=0;b=a.getLittleEndian16();a.skipPosition(2);switch(b){case 3:b=a.getLittleEndian16();c=a.getLittleEndian16();if(D.isPaused())break;A.getFocused().moveCursor(b,c,!0);break;case 6:Jc(a,24);break;case 7:Nd(a.getLittleEndian16());break;case 1:a=a.getLittleEndian16();switch(a){case 0:A.setCursor("default");
break;default:svGlobal.logger.warn("XXX system pointer message "+a)}break;case 8:b=a.getLittleEndian16(),Jc(a,b)}break;case 34:break;case 38:If(e);break;case 40:cb||F.send("8E50");break;case 47:$c=!0;a=e.getLittleEndian32();cb||F.send("85"+a);svGlobal.logger.info("Disconnect:"+a);(b=11==a&&qa)&&A.close();1>a||b||ke(a.toString(16).toUpperCase());break;case 50:e.skipPosition(4);break;case 54:a=e.getLittleEndian32().toString(16).toUpperCase();a=__svi18n.serverStatus[a];p.displayMsg&&svGlobal.logger.info(a);
break;case 55:break;default:svGlobal.logger.warn("Unimplemented Data PDU type "+b)}}function Jf(a,b){var c,d,e=p.sessionInfo;switch(b){case 0:a.skipPosition(4);e.domain=a.getUnicodeString(52,!0);a.skipPosition(4);e.userName=a.getUnicodeString(512,!0);e.sessionId=a.getLittleEndian32();break;case 1:e.version=a.getLittleEndian16(),a.skipPosition(4),e.sessionId=a.getLittleEndian32(),c=a.getLittleEndian32(),d=a.getLittleEndian32(),a.skipPosition(558),e.domain=a.getUnicodeString(c,!0),e.userName=a.getUnicodeString(d,
!0)}return e}function De(){if(!mb&&p.onloggedin)p.onloggedin();mb=!0;qa&&A.execute("setAutoScale",[!1]);Na&&(Na.enabled=!0);uc&&!qa&&(D.setContext(A.getFocused().context),D.repaint(0,0,D.width,D.height))}function If(a){var b=a.getLittleEndian32();if(3>b)Jf(a,b),De();else if(3==b&&(a.skipPosition(2),b=a.getLittleEndian32(),a.skipPosition(4),2!=b)){a.getLittleEndian32();a.skipPosition(4);var c={};c.logId=a.getLittleEndian32();c.time=(new Date).getTime();p.sessionInfo.sessionId=c.logId;De();a=a.getBytes(16);
for(var b=Array(16),d=0;16>d;d++)b[d]=a[d]&255;c.random=b;a="8D"+c.logId+"\t"+hi5.Base64.enc(b);p.sessionInfo.userName&&(a+="\t"+p.sessionInfo.userName,p.sessionInfo.domain&&(a+="\t"+p.sessionInfo.domain));cb||F.send(a);"sessionStorage"in window&&setTimeout(function(){sessionStorage[fe()]=JSON.stringify(c)},300)}}function te(a){var b=a.getByte(),c=b&15,d=b>>4&3,e,k=0;2==(b>>6&3)&&(k=a.getByte());e=a.getLittleEndian16();b=null;0!=(k&32)?(Sb.dec(a.getData(),a.getPosition(),e,k),b=Sb.getData(),e=Sb.getDecompressedLength()):
b=a;if(0!=d)switch(d){case 2:case 3:Od.addFragement(b,e);return;case 1:Od.addFragement(b,e),b=Od.clearFragements()}switch(c){case 0:a=b.getLittleEndian16();Ae(b,a);break;case 1:b.skipPosition(2);Be(b);break;case 2:b.skipPosition(2);Ce(b);break;case 3:break;case 4:a=b;for(c=a.getEnd();a.getPosition()<c;)switch(d=a.getLittleEndian16(),d){case 1:case 6:k=a.getLittleEndian16();b=a.getLittleEndian16();a.getLittleEndian16();a.getBigEndian16();var d=a,l=d.getByte();d.skipPosition(2);var n=d.getByte(),m=
d.getLittleEndian16(),h=d.getLittleEndian16(),g=d.getLittleEndian32(),w=void 0;e=d.getPosition()+g;switch(n){case 0:l=Ld(d.getData(),g,d.getPosition());w=Array(l.length);Ad(l,0,w,m,h,1);D.setRGBs(k,b,m,h,w,0,m);D.postPaint(k,b,m,h);break;case 1:Ee(d,l,m,h,vc);l=vc.getData();w=vc.getDataSize();w=Array(w);Ad(l,0,w,m,h,1);D.setRGBs(k,b,m,h,w,0,m);D.postPaint(k,b,m,h);break;case 3:for(var n=Kf.decode(d,g),m=new pc(0,0,0,0),h=n.getRects(),w=n.getTiles(),l=n.getTileSize(),n=n.getRectSize(),p=g=0;p<l;p++)for(var y=
w[p],u=0;u<n;u++)h[u].intersection(y.x,y.y,64,64,m),m.isEmpty()||(g=64*(m.y-y.y)+(m.x-y.x),m.x+=k,m.y+=b,D.setRGBs(m.x,m.y,m.width,m.height,y.data,g,64),D.postPaint(m.x,m.y,m.width,m.height))}d.setPosition(e);break;case 4:k=a;d=k.getLittleEndian16();k=k.getLittleEndian32();1==d&&F.send("91"+k);break;default:svGlobal.logger.warn("Invalid surface cmd:"+d)}D.commitPaint();break;case 5:A.setCursor("default");break;case 6:break;case 8:break;case 9:Jc(b,24);break;case 10:Nd(b.getLittleEndian16());break;
case 11:a=b;c=a.getLittleEndian16();Jc(a,c);break;default:svGlobal.logger.warn("XXX RDP5 opcode "+c)}}function Ad(a,b,c,d,e,k){k*=d;for(var l=0;l<e;l++)d=b+(e-l-1)*k,bb(a,d,c,l*k,k)}function Fe(a,b,c){var d=a,e=c,k=0,l=8,n=b;this.attach=function(a,b,c){d=a;e=c;k=0;l=8;n=b};this.getBits=function(a){for(var b=0,c=0;k<e&&0<a;)b=a,b>l&&(b=l),0!=c&&(c<<=b),c|=d[k+n]>>l-b&(1<<b)-1,l-=b,a-=b,0==l&&(l=8,k++);return c};this.putBits=function(a,b){for(var c=b,w=0;k<e&&0<c;)w=c,w>l&&(w=l),d[k+n]|=(a>>c-w&(1<<
w)-1)<<l-w,l-=w,c-=w,0==l&&(l=8,k++)};this.eos=function(){return k>e};this.left=function(){return k>=e?0:8*(e-k-1)+l};this.getProcessBytes=function(){return 8>l?k+1:k}}function Ge(){this.y=this.x=this.CrLen=this.CbLen=this.YLen=this.quantIdxCr=this.quantIdxCb=this.quantIdxY=0;this.data=Va(4096);this.data[0]=0;var a=this;this.readHeaderfromStream=function(b){b.skipPosition(6);a.quantIdxY=b.getByte();a.quantIdxCb=b.getByte();a.quantIdxCr=b.getByte();a.x=64*b.getLittleEndian16();a.y=64*b.getLittleEndian16();
a.YLen=b.getLittleEndian16();a.CbLen=b.getLittleEndian16();a.CrLen=b.getLittleEndian16()}}function Lf(){function a(a,e,k,l,n,m,h){k=a.et;var g=4096,w=a.bitStream,p=1,y=p<<3,u=1,v=u<<3,t=0,x=0,R=0,t=0;for(null==w?w=new Fe(l,n,m):w.attach(l,n,m);!w.eos()&&0<g;)if(0!=p){for(;!w.eos();){t=w.getBits(1);if(0!=t)break;l=p=1<<p;l>g&&(l=g);0<l&&(ab(h,x,x+l,0),x+=l);g-=p;y+=4;80<y&&(y=80);0>y&&(y=0);p=y>>3}l=p=w.getBits(p);l>g&&(l=g);0<l&&(ab(h,x,x+l,0),x+=l);g-=p;p=w.getBits(1);R=0;do if(t=w.getBits(1),1==
t)R++;else break;while(1);t=w.getBits(u);t|=R<<u;0==R?(v+=-2,80<v&&(v=80),0>v&&(v=0),u=v>>3):1!=R&&(v+=R,80<v&&(v=80),0>v&&(v=0),u=v>>3);l=t+1;0<g&&(h[x++]=0!=p?-l:l);g--;y+=-6;80<y&&(y=80);0>y&&(y=0);p=y>>3}else{R=0;do if(t=w.getBits(1),1==t)R++;else break;while(1);t=w.getBits(u);t|=R<<u;0==R?(v+=-2,80<v&&(v=80),0>v&&(v=0),u=v>>3):1!=R&&(v+=R,80<v&&(v=80),0>v&&(v=0),u=v>>3);l=t;if(1!=k){m=l;for(n=0;0!=m;)m>>=1,n++;n=w.getBits(n);l-=n;0!=n&&0!=l?(y+=-6,80<y&&(y=80),0>y&&(y=0),p=y>>3):0==n&&0==l&&
(y+=6,80<y&&(y=80),0>y&&(y=0),p=y>>3);0<g&&(h[x++]=0!=(n&1)?-1*(n+1>>1):n>>1);g--;0<g&&(h[x++]=0!=(l&1)?-1*(l+1>>1):l>>1);g--}else 0==l?(0<g&&(h[x++]=0),g--,y+=3):(0<g&&(h[x++]=0!=(l&1)?-1*(l+1>>1):l>>1),g--,y+=-3),80<y&&(y=80),0>y&&(y=0),p=y>>3}k=64;g=4032;for(w=4033;1<k;g++,w++,k--)h[w]+=h[g];c(h,0,4096,5);c(h,0,1024,e[8]-6);c(h,1024,1024,e[7]-6);c(h,2048,1024,e[9]-6);c(h,3072,256,e[5]-6);c(h,3328,256,e[4]-6);c(h,3584,256,e[6]-6);c(h,3840,64,e[2]-6);c(h,3904,64,e[1]-6);c(h,3968,64,e[3]-6);c(h,4032,
64,e[0]-6);a=a.dwtBuffer;b(h,3840,a,8);b(h,3072,a,16);b(h,0,a,32)}function b(a,b,c,l){for(var n=0,m=0,h=0,g=h=m=n=0,p=0,r=0,y=0,u=0,v=0,t=0,y=l<<1,r=b+l*l*3,h=b,n=0,g=b+l*l,p=b+l*l*2,m=l*l*2,v=0;v<l;v++){c[n]=a[r]-(a[h]+a[h]+1>>1)<<16>>16;c[m]=a[g]-(a[p]+a[p]+1>>1)<<16>>16;for(t=1;t<l;t++)u=t<<1,c[n+u]=a[r+t]-(a[h+t-1]+a[h+t]+1>>1)<<16>>16,c[m+u]=a[g+t]-(a[p+t-1]+a[p+t]+1>>1)<<16>>16;for(t=0;t<l-1;t++)u=t<<1,c[n+u+1]=(a[h+t]<<1)+(c[n+u]+c[n+u+2]>>1)<<16>>16,c[m+u+1]=(a[p+t]<<1)+(c[m+u]+c[m+u+2]>>
1)<<16>>16;u=t<<1;c[n+u+1]=(a[h+t]<<1)+c[n+u]<<16>>16;c[m+u+1]=(a[p+t]<<1)+c[m+u]<<16>>16;r+=l;h+=l;n+=y;g+=l;p+=l;m+=y}for(u=0;u<y;u++){for(t=0;t<l;t++)v=t<<1,n=b+v*y+u,m=t*y+u,h=m+l*y,a[n]=c[m]-((0<t?c[h-y]:c[h])+c[h]+1>>1)<<16>>16;for(t=0;t<l;t++)v=t<<1,n=b+v*y+u,m=t*y+u,h=m+l*y,a[n+y]=(c[h]<<1)+(a[n]+a[n+(t<l-1?2*y:0)]>>1)<<16>>16}}function c(a,b,c,l){if(0!=l)for(;0<c;b++,c--)a[b]<<=l}this.decodeRgb=function(b,c,k,l,n,m,h,g,p,r){a(b,k,n,c.getData(),c.getPosition(),l,b.yrBuffer);c.skipPosition(l);
a(b,k,h,c.getData(),c.getPosition(),m,b.cbgBuffer);c.skipPosition(m);a(b,k,p,c.getData(),c.getPosition(),g,b.crbBuffer);c.skipPosition(g);c=b.yrBuffer;k=b.cbgBuffer;l=b.crbBuffer;for(m=m=h=p=n=p=g=h=0;4096>m;m++)h=c[m],g=k[m],p=l[m],h=h+4096<<16,n=h+91947*p,p=h-22544*g-46792*p,h+=115998*g,n>>=21,p>>=21,h>>=21,c[m]=0>n?0:255<n?255:n,k[m]=0>p?0:255<p?255:p,l[m]=0>h?0:255<h?255:h;c=b.yrBuffer;k=b.cbgBuffer;b=b.crbBuffer;for(l=0;4096>l;l++)r[l]=4278190080|b[l]<<16|k[l]<<8|c[l]}}function Mf(){var a=[new pc],
b=[new Ge],c=0,d=0;this.resetRects=function(b){if(a.length<b){var d=a.length;for(a.length=b;d<b;d++)a[d]=new pc}c=b;return a};this.resetTiles=function(a){if(b.length<a){var c=b.length;for(b.length=a;c<a;c++)b[c]=new Ge}d=a;return b};this.getRectSize=function(){return c};this.getTileSize=function(){return d};this.getRects=function(){return a};this.getTiles=function(){return b}}function Nf(){this.ctxId=0;this.tileSize=64;this.qt=this.et=this.xft=this.cct=this.flags=0;this.yrBuffer=pa(4096);this.yrBuffer[0]=
0;this.cbgBuffer=pa(4096);this.cbgBuffer[0]=0;this.crbBuffer=pa(4096);this.crbBuffer[0]=0;this.dwtBuffer=pa(4096);this.dwtBuffer[0]=0;var a=this;this.setProperties=function(b){a.flags=b&7;a.cct=b>>3&3;a.xft=b>>5&15;a.et=b>>9&15};this.bitStream=new Fe}function Of(a,b,c,d,e,k,l,n){this.x=a;this.y=b;this.width=c;this.height=d;this.mask=e;this.pixel=k;this.bpp=l;this.cache_idx=n}function Jc(a,b){if(!Pf){var c=0,d=0,e=0,k=0,l=0,n=0,m=0,l=a.getLittleEndian16(),c=a.getLittleEndian16(),d=a.getLittleEndian16(),
e=a.getLittleEndian16(),k=a.getLittleEndian16(),n=a.getLittleEndian16(),m=a.getLittleEndian16(),h=a.getBytes(m),n=a.getBytes(n);if(0>c||c>=e-1)c=0;0>d?d=0:d>=k&&(d=k-1);for(var g=!0,w=0;w<m;w++)if(0!=h[w]){g=!1;break}var c=new Of(c,d,e,k,n,h,b,l),d=c.x,e=c.y,k=c.width,m=c.height,h=c.mask,n=c.pixel,r=c.bpp,c=c.cache_idx;if(g)d={data:null,hotX:d,hotY:e,url:null,rawData:null,width:k,height:m,none:!0};else{for(var g=Array(k*m),w=g[0]=0,y=!0,u=h.length,v=0;v<u;v++)if(0!=h[v]){y=!1;break}for(var t=0,v=
0;v<m;v++)for(u=0;u<k;u++){g[w]=Qf(u,v,k,m,r,n);if(!y){var t=v,x=k;1!=r&&(t=m-t-1);x=8*((x+7)/8|0);t=t*x+u;t=0==(h[t/8>>0]&128>>t%8)?1:0;if(0==t&&0!=g[w])g[w]=~g[w],g[w]|=4278190080;else if(1==t||0!=g[w])g[w]|=4278190080;32==r&&-1==g[w]&&0==t&&(g[w]=0)}w++}w="";1==r&&(w=He.getName(g,k));v="";if(!w){var R=k*m*4,u=n.length,t=h.length,y=62+R+u+t,r=new Uint8Array(y);r[0]=0;x=new RdpBuffer(r,0,y);x.setLittleEndian16(0);x.setLittleEndian16(2);x.setLittleEndian16(1);x.setByte(k);x.setByte(m);x.setByte(0);
x.setByte(0);x.setLittleEndian16(d);x.setLittleEndian16(e);x.setLittleEndian32(40+R+u+t);x.setLittleEndian32(22);x.setLittleEndian32(40);x.setLittleEndian32(k);x.setLittleEndian32(2*m);x.setLittleEndian16(1);x.setLittleEndian16(32);x.setLittleEndian32(0);x.setLittleEndian32(u+t);x.setLittleEndian32(0);x.setLittleEndian32(0);x.setLittleEndian32(0);x.setLittleEndian32(0);for(var P,R=m-1;0<=R;R--)for(P=0;P<k;P++){var C=g[k*R+P];x.setByte(C&255);x.setByte(C>>8&255);x.setByte(C>>16&255);x.setByte(C>>24&
255)}for(R=0;R<u;R++)x.setByte(n[R]);for(R=0;R<t;R++)x.setByte(h[R]);hi5.browser.isIE?(h=hi5.Arrays.hashCode(r),n=new Uint8Array(y+6),n[0]=142,n[1]=56,n[2]=h&255,n[3]=h>>8&255,n[4]=h>>16&255,n[5]=h>>24&255,n.set(r,6),F.send(n.buffer),v=p.modifyURL(jb()+"/CURSOR?"+h)):w="data:image/x-icon;base64,"+hi5.Base64.enc(x.getData())}d={data:w,hotX:d,hotY:e,url:v,rawData:g,width:k,height:m,none:!1}}20>c&&(Hc[c]=d);Nd(l)}}function Qf(a,b,c,d,e,k){1!=e&&(b=d-b-1);b=(b*c+a)*e;c=b/8>>0;a=k[c]&255;switch(e){case 1:return 0==
(a&128>>b%8)?0:4294967295;case 8:return 0==a?0:4294967295;case 15:return a|=(k[c+1]&255)<<8,e=Array(4),Ie(a,15,e,0),e[0]<<16|e[1]<<8|e[2];case 16:return a|=(k[c+1]&255)<<8,e=Array(4),Ie(a,16,e,0),e[0]<<16|e[1]<<8|e[2];case 24:return(k[c+2]&255)<<16|(k[c+1]&255)<<8|a;case 32:return(k[c+3]&255)<<24|(k[c+2]&255)<<16|(k[c+1]&255)<<8|a}svGlobal.logger.warn("invalid bpp value for Xor Mask.");return 0}function Nd(a){if(!D.isPaused()){a:{if(20>a&&(a=Hc[a]))break a;a=null}a&&A.setCursor(a)}}function Ce(a){var b=
0,c=null,d=null,e=null,k=0;a.skipPosition(2);b=a.getLittleEndian16();a.skipPosition(2);c=Array(b);d=Array(b);e=Array(b);a=a.getBytes(3*b);for(var l=0;l<b;l++)c[l]=a[k],d[l]=a[k+1],e[l]=a[k+2],k+=3;256==b&&(Ja||(Ja=Array(3)),Ja[0]=c,Ja[1]=d,Ja[2]=e)}function Ae(a,b){for(var c=0,d=0,e=0;c<b;){d=a.getByte();e=d&3;switch(e){case 1:var k=a,l=d,n=0,m=0,h=!1;0!=(l&8)&&(Qa.orderType=k.getByte());var m=Rf[Qa.orderType],g=k,p=m,r=0,y=0;0!=(l&64)&&p--;0!=(l&128)&&(p=2>p?0:p-2);for(var u=0;u<p;u++)y=g.getByte(),
r|=y<<8*u;n=r;if(0!=(l&4)){if(0==(l&32)){var v=k,t=Qa.bounds,x=v.getByte();0!=(x&1)?t.left=L(v,t.left,!1):0!=(x&16)&&(t.left=L(v,t.left,!0));0!=(x&2)?t.top=L(v,t.top,!1):0!=(x&32)&&(t.top=L(v,t.top,!0));0!=(x&4)?t.right=L(v,t.right,!1):0!=(x&64)&&(t.right=L(v,t.right,!0));0!=(x&8)?t.bottom=L(v,t.bottom,!1):0!=(x&128)&&(t.bottom=L(v,t.bottom,!0))}var R=Qa.bounds;ma=R.left;0>ma&&(ma=0);ra=R.top;0>ra&&(ra=0);ia=R.right;ia>=X&&(ia=X-1);ja=R.bottom;ja>=fa&&(ja=fa-1)}h=0!=(l&16);switch(Qa.orderType){case 0:var P=
k,C=Qa.destBlt,Z=n,f=h;0!=(Z&1)&&(C.x=L(P,C.x,f));0!=(Z&2)&&(C.y=L(P,C.y,f));0!=(Z&4)&&(C.cx=L(P,C.cx,f));0!=(Z&8)&&(C.cy=L(P,C.cy,f));0!=(Z&16)&&(C.opcode=P.getByte()&15);var gc=C.x,B=C.y,F=C.cx,V=C.cy,M=C.opcode;if(!(gc>X||B>fa)){var O=gc+F-1;O>ia&&(O=ia);gc<ma&&(gc=ma);var F=O-gc+1,Kd=B+V-1;Kd>ja&&(Kd=ja);B<ra&&(B=ra);V=Kd-B+1;1>F||1>V||(wd(M,D,X,gc,B,F,V,null,0,0,0),D.postPaint(gc,B,F,V))}break;case 1:var T=k,S=Qa.patBlt,N=n,U=h;0!=(N&1)&&(S.x=L(T,S.x,U));0!=(N&2)&&(S.y=L(T,S.y,U));0!=(N&4)&&
(S.cx=L(T,S.cx,U));0!=(N&8)&&(S.cy=L(T,S.cy,U));0!=(N&16)&&(S.opcode=T.getByte(),S.opcode=S.opcode&3|(S.opcode&48)>>2);0!=(N&32)&&(S.backgroundColor=Wb(T));0!=(N&64)&&(S.foregroundColor=Wb(T));var ud=S.brush,ka=N>>7;0!=(ka&1)&&(ud.xOrigin=T.getByte());0!=(ka&2)&&(ud.yOrigin=T.getByte());0!=(ka&4)&&(ud.style=T.getByte());var z=ud.pattern;0!=(ka&8)&&(z[0]=T.getByte());if(0!=(ka&16))for(var pa=1;8>pa;pa++)z[pa]=T.getByte();ud.pattern=z;var H=S.x,qa=S.y;if(!(H>ia||qa>ja)){var sa=S.opcode,ea=H,E=qa,da=
S.cx,ua=S.cy,Ia=S.foregroundColor,Na=S.backgroundColor,Va=S.brush.xOrigin,ib=S.brush.yOrigin,$a=S.brush.style,Sf=S.brush.pattern,Ia=lb(Ia),Na=lb(Na),Pd=ea+da-1;Pd>ia&&(Pd=ia);ea<ma&&(ea=ma);var da=Pd-ea+1,Qd=E+ua-1;Qd>ja&&(Qd=ja);E<ra&&(E=ra);ua=Qd-E+1;if(!(1>da||1>ua)){var Kc=null;switch($a){case 0:for(var Kc=Array(da*ua),hd=Kc[0]=0;hd<Kc.length;hd++)Kc[hd]=Ia;wd(sa,D,X,ea,E,da,ua,Kc,da,0,0);D.postPaint(ea,E,da,ua);1==da&&A.execute("setCaretPos",[ea,E]);break;case 2:svGlobal.logger.warn("hatch");
break;case 3:for(var Kc=Array(da*ua),Je=Kc[0]=0,hd=0;hd<ua;hd++)for(var Rd=0;Rd<da;Rd++)Kc[Je]=0==(Sf[(hd+ib)%8]&1<<(Rd+Va)%8)?Ia:Na,Je++;wd(sa,D,X,ea,E,da,ua,Kc,da,0,0);D.postPaint(ea,E,da,ua);break;default:svGlobal.logger.warn("Unsupported brush style "+$a)}}}break;case 2:var K=k,La=Qa.screenBlt,id=n,wa=h;0!=(id&1)&&(La.x=L(K,La.x,wa));0!=(id&2)&&(La.y=L(K,La.y,wa));0!=(id&4)&&(La.cx=L(K,La.cx,wa));0!=(id&8)&&(La.cy=L(K,La.cy,wa));0!=(id&16)&&(La.opcode=K.getByte()&15);0!=(id&32)&&(La.srcX=L(K,
La.srcX,wa));0!=(id&64)&&(La.srcY=L(K,La.srcY,wa));var Lc=La.x,Mc=La.y;if(!(Lc>ia||Mc>ja)){var J=La.cx,Fa=La.cy,Ja=La.opcode,Ka=La.srcX,Aa=La.srcY,Oa=Lc+J-1;Oa>ia&&(Oa=ia);Lc<ma&&(Lc=ma);var J=Oa-Lc+1,Ua=Mc+Fa-1;Ua>ja&&(Ua=ja);Mc<ra&&(Mc=ra);Fa=Ua-Mc+1;Ka+=Lc-La.x;Aa+=Mc-La.y;1>J||1>Fa||(12==Ja?D.moveArea(Ka,Aa,J,Fa,Lc-Ka,Mc-Aa):wd(Ja,D,J,Lc,Mc,J,Fa,null,J,Ka,Aa),D.postPaint(Lc,Mc,J,Fa))}break;case 9:var nb=k,Pa=Qa.line,cd=n,Bd=h;0!=(cd&1)&&(Pa.mixmode=nb.getLittleEndian16());0!=(cd&2)&&(Pa.startX=
L(nb,Pa.startX,Bd));0!=(cd&4)&&(Pa.startY=L(nb,Pa.startY,Bd));0!=(cd&8)&&(Pa.endX=L(nb,Pa.endX,Bd));0!=(cd&16)&&(Pa.endY=L(nb,Pa.endY,Bd));0!=(cd&32)&&(Pa.backgroundColor=Wb(nb));0!=(cd&64)&&(Pa.opcode=nb.getByte());var ab=Pa.pen,cb=cd>>7;0!=(cb&1)&&(ab.style=nb.getByte());0!=(cb&2)&&(ab.width=nb.getByte());0!=(cb&4)&&(ab.color=Wb(nb));var jd=Pa.startX,Ga=Pa.startY,W=Pa.endX,xd=Pa.endY,yb=Pa.pen.color,Fb=Pa.opcode-1;if(Ga==xd){if(jd>W)var ha=jd,jd=W,W=ha;jd<ma&&(jd=ma);W>ia&&(W=ia)}else jd==W&&(Ga>
xd&&(ha=Ga,Ga=xd,xd=ha),Ga<ra&&(Ga=ra),Ga>ja&&(Ga=ja));Ke(jd,Ga,W,xd,yb,Fb);break;case 10:var Xb=k,Q=Qa.rectangle,Ba=n,Yb=h;0!=(Ba&1)&&(Q.x=L(Xb,Q.x,Yb));0!=(Ba&2)&&(Q.y=L(Xb,Q.y,Yb));0!=(Ba&4)&&(Q.cx=L(Xb,Q.cx,Yb));0!=(Ba&8)&&(Q.cy=L(Xb,Q.cy,Yb));0!=(Ba&16)&&(Rb=Rb&4294967040|Xb.getByte());0!=(Ba&32)&&(Rb=Rb&4294902015|Xb.getByte()<<8);0!=(Ba&64)&&(Rb=Rb&4278255615|Xb.getByte()<<16);Q.color=Rb;Sd(Q.x,Q.y,Q.cx,Q.cy,Q.color,!0);break;case 11:var Ra=k,xa=Qa.deskSave,db=n,Cd=h;0!=(db&1)&&(xa.offset=
Ra.getLittleEndian32());0!=(db&2)&&(xa.left=L(Ra,xa.left,Cd));0!=(db&4)&&(xa.top=L(Ra,xa.top,Cd));0!=(db&8)&&(xa.right=L(Ra,xa.right,Cd));0!=(db&16)&&(xa.bottom=L(Ra,xa.bottom,Cd));0!=(db&32)&&(xa.action=Ra.getByte());var Dd=xa.right-xa.left+1,bb=xa.bottom-xa.top+1;if(0==xa.action){var mb=xa.left,Hb=xa.top;1>Dd||1>bb||Le.save(mb,Hb,Dd,bb,xa.offset,D.getRGBs(mb,Hb,Dd,bb))}else{var Ed=Dd,jb=bb,Td=xa.left,kb=xa.top,Sb=Le.restore(Td,kb,Ed,jb,xa.offset);Sb?(D.setRGBs(Td,kb,Ed,jb,Sb,0,Ed),D.postPaint(Td,
kb,Ed,jb)):svGlobal.logger.warn("XXX no matched desktop save.")}break;case 13:var Wa=k,na=Qa.memBlt,Ib=n,ya=h;0!=(Ib&1)&&(na.cacheID=Wa.getByte(),na.colorTable=Wa.getByte());0!=(Ib&2)&&(na.x=L(Wa,na.x,ya));0!=(Ib&4)&&(na.y=L(Wa,na.y,ya));0!=(Ib&8)&&(na.cx=L(Wa,na.cx,ya));0!=(Ib&16)&&(na.cy=L(Wa,na.cy,ya));0!=(Ib&32)&&(na.opcode=Wa.getByte()&15);0!=(Ib&64)&&(na.srcX=L(Wa,na.srcX,ya));0!=(Ib&128)&&(na.srcY=L(Wa,na.srcY,ya));0!=(Ib&256)&&(na.cacheIDX=Wa.getLittleEndian16());var ub=na.x,eb=na.y;if(!(ub>
ia||eb>ja)){var Ca=na.cx,wc=na.cy,Fd=na.srcX,fb=na.srcY,Ud=ub+Ca-1;Ud>ia&&(Ud=ia);ub<ma&&(ub=ma);var Ca=Ud-ub+1,Zb=eb+wc-1;Zb>ja&&(Zb=ja);eb<ra&&(eb=ra);var wc=Zb-eb+1,Fd=Fd+(ub-na.x),fb=fb+(eb-na.y),Bb=rc.getBitmap(na.cacheID,na.cacheIDX);if(Bb){var Nc=Bb.width,zb=Bb.height;Ca>Nc&&(Ca=Nc);wc>zb&&(wc=zb);12==na.opcode?D.setRGBs(ub,eb,Ca,wc,Bb.data,fb*Nc+Fd,Nc):wd(na.opcode,D,X,ub,eb,Ca,wc,Bb.data,Nc,Fd,fb);D.postPaint(ub,eb,Ca,wc)}else svGlobal.logger.warn("Failed to get bitmap from cache, id:"+na.cacheID+
" idx="+na.cacheIDX)}break;case 22:var Jb=k,Sa=Qa.polyLine,vb=n,Tb=h;0!=(vb&1)&&(Sa.x=L(Jb,Sa.x,Tb));0!=(vb&2)&&(Sa.y=L(Jb,Sa.y,Tb));0!=(vb&4)&&(Sa.opcode=Jb.getByte());0!=(vb&16)&&(Sa.foregroundColor=Wb(Jb));0!=(vb&32)&&(Sa.lines=Jb.getByte());if(0!=(vb&64)){var Gb=Jb.getByte();Sa.dataSize=Gb;Sa.data=Jb.getBytes(Gb)}var Oc=Sa.x,hc=Sa.y,Kb=Sa.foregroundColor,Me=Sa.lines,Vb=Sa.dataSize,Vd=Sa.data,Gd=Array(1);Gd[0]=Math.floor((Me-1)/4)+1;for(var xc=0,sc=0,tc=Sa.opcode-1,Wd=0;Wd<Me&&Gd[0]<Vb;Wd++){var Ic=
Oc,Ub=hc;0==Wd%4&&(xc=Vd[sc++]);0==(xc&192)&&(xc|=192);0!=(xc&64)&&(Oc+=Ne(Vd,Gd));0!=(xc&128)&&(hc+=Ne(Vd,Gd));Ke(Ic,Ub,Oc,hc,Kb,tc);xc<<=2}break;case 27:var va=k,ga=Qa.text2,za=n;0!=(za&1)&&(ga.font=va.getByte());0!=(za&2)&&(ga.flags=va.getByte());0!=(za&4)&&(ga.opcode=va.getByte());0!=(za&8)&&(ga.mixmode=va.getByte());0!=(za&16)&&(ga.foregroundColor=Wb(va));0!=(za&32)&&(ga.backgroundColor=Wb(va));0!=(za&64)&&(ga.clipLeft=va.getLittleEndian16());0!=(za&128)&&(ga.clipTop=va.getLittleEndian16());
0!=(za&256)&&(ga.clipRight=va.getLittleEndian16());0!=(za&512)&&(ga.clipBottom=va.getLittleEndian16());0!=(za&1024)&&(ga.boxLeft=va.getLittleEndian16());0!=(za&2048)&&(ga.boxTop=va.getLittleEndian16());0!=(za&4096)&&(ga.boxRight=va.getLittleEndian16());0!=(za&8192)&&(ga.boxBottom=va.getLittleEndian16());0!=(za&16384)&&va.skipPosition(1);0!=(za&32768)&&va.skipPosition(1);0!=(za&65536)&&va.skipPosition(1);0!=(za&131072)&&va.skipPosition(1);0!=(za&262144)&&va.skipPosition(7);0!=(za&524288)&&(ga.x=va.getLittleEndian16());
0!=(za&1048576)&&(ga.y=va.getLittleEndian16());if(0!=(za&2097152)){var ba=va.getByte();ga.length=ba;ga.text=va.getBytes(ba);ga.textPos=0}var ca=ga.font,Cb=ga.flags,Ab=ga.mixmode,Oe=ga.foregroundColor,Y=ga.backgroundColor,dd=ga.clipLeft,aa=ga.clipTop,ob=ga.boxLeft,$b=ga.boxTop,Xa=ga.x,wb=ga.y,Lb=ga.length,Ya=ga.text,Za=ga.clipRight-dd,pb=ga.clipBottom-aa,G=ga.boxRight-ob,I=ga.boxBottom-$b,Ta=null,Mb=0,Da=0;ob+G>X&&(G=X-ob);1<G?Sd(ob,$b,G,I,Y,!1):1==Ab&&Sd(dd,aa,Za,pb,Y,!1);for(var Tf=Lb,oa=0;oa<Lb;)switch(Ya[Da+
oa]){case 255:var Pc=Ya[Da+oa+2];if(Pc>Tf-Da){oa=Lb=0;break}var yc=Ya.slice?Ya.slice(Da,Da+Pc):Ya.subarray(Da,Da+Pc),Uf=new kf(Pc,yc),qb=Ya[Da+oa+1],zc=Uf;if(qb<Xc.length){var la=Xc[qb];la&&(la.data=null);Xc[qb]=zc}oa+=3;Lb-=oa;Da=oa;oa=0;break;case 254:var Ha;a:{var Pb=Ya[Da+oa+1],Eb=null;if(Pb<Xc.length&&(Eb=Xc[Pb])&&Eb.data){Ha=Eb;break a}Ha=null}var ic=Ha?Ha.data:null;ic&&0==ic[1]&&0==(Cb&32)&&(0!=(Cb&4)?wb+=Ya[Da+oa+2]:Xa+=Ya[Da+oa+2]);oa=oa+2<Lb?oa+3:oa+2;Lb-=oa;Da=oa;oa=0;if(!Ha)break;for(var Uc=
Ha.size,Nb=0;Nb<Uc;Nb++)Ta=Pe(ca,ic[Nb]),0==(Cb&32)&&(Mb=ic[++Nb],0!=(Mb&128)?(0!=(Cb&4)?wb+=ic[Nb+1]|ic[Nb+2]<<8:Xa+=ic[Nb+1]|ic[Nb+2]<<8,Nb+=2):0!=(Cb&4)?wb+=Mb:Xa+=Mb),Ta&&(Qe(Ab,Xa+Ta.offset&65535,wb+Ta.baseLine&65535,Ta.width,Ta.height,Ta.fontData,Y,Oe,Md,Qb),0!=(Cb&32)&&(Xa+=Ta.width));break;default:Ta=Pe(ca,Ya[Da+oa]),0==(Cb&32)&&(Mb=Ya[Da+ ++oa],0!=(Mb&128)?(0!=(Cb&4)?wb+=Ya[Da+oa+1]|Ya[Da+oa+2]<<8:Xa+=Ya[Da+oa+1]|Ya[Da+oa+2]<<8,oa+=2):0!=(Cb&4)?wb+=Mb:Xa+=Mb),Ta&&(Qe(Ab,Xa+Ta.offset&65535,
wb+Ta.baseLine&65535,Ta.width,Ta.height,Ta.fontData,Y,Oe,Md,Qb),0!=(Cb&32)&&(Xa+=Ta.width)),oa++}1<G?0<I&&D.postPaint(ob,$b,G,I):0<Za&&0<pb&&D.postPaint(dd,aa,Za,pb);break;default:svGlobal.logger.warn("XXX Order type "+Qa.orderType)}0!=(l&4)&&me();break;case 2:var fc=a,Re=d>>2;switch(Re){case 11:var ac=fc,jc=ac.getLittleEndian16(),Ea=ac.getLittleEndian32(),Db=ac.getPosition()+(jc-7);if(0!=(Ea&16777216)){var Hd=ac.getLittleEndian32();if(0!=(Ea&1073741824))svGlobal.logger.info("XXX rail icon, winId="+
Hd);else if(0!=(Ea&2147483648))svGlobal.logger.info("XXX rail cache icon, winId="+Hd);else if(0!=(Ea&536870912)){var nc=Hd;svGlobal.logger.info("***** delete winId="+nc);A.delWin(nc)}else Vf(ac,Ea,Hd)}else if(0!=(Ea&33554432))svGlobal.logger.info("XXX Alt Sec window Notify="+Ea);else if(0!=(Ea&67108864))if(svGlobal.logger.info("*** -- Alt Sec window Desktop="+Ea),0!=(Ea&1))svGlobal.logger.info("Desktop non monitored flags="+Ea);else{if(0!=(Ea&32)){var pc=ac.getLittleEndian32();svGlobal.logger.info("Desktop monitored flags="+
Ea+" winId="+pc);A.setTitle(pc);if(!D.getContext()){var ta=A.getFocused();ta&&D.setContext(ta.context)}if(0!=(Ea&16)){var Ac=ac.getByte();if(0<Ac){var Qc=A.zOrders;Qc.length=Ac;for(var kd=0;kd<Ac;kd++)Qc[kd]=ac.getLittleEndian32(),svGlobal.logger.info("---zorders:"+Qc[kd])}}}}else svGlobal.logger.info("XXX Alt Sec window order flgas="+Ea);ac.setPosition(Db);break;case 13:fc.getLittleEndian32();break;default:svGlobal.logger.warn("XXX Alt Sec order not implemented:"+Re)}break;case 3:var rb=a,Se=void 0,
Xd=void 0,ld=void 0,qc=void 0,Se=rb.getLittleEndian16(),ld=rb.getLittleEndian16(),Xd=rb.getByte(),qc=rb.getPosition()+Se+7;switch(Xd){case 0:var bc=rb,md=bc.getByte();bc.skipPosition(1);var ed=bc.getByte(),Bc=bc.getByte(),Ma=bc.getByte(),nd=Math.floor((Ma+7)/8),Vc=bc.getLittleEndian16(),Rc=bc.getLittleEndian16(),Wf=bc.getPosition();bc.skipPosition(Vc);for(var sb=Array(ed*Bc*nd),Te=sb[0]=0,Cc=ed*nd,xb=0;xb<Bc;xb++)Te=Wf+(Bc-xb-1)*Cc,bc.copyToByteArray(sb,xb*Cc,Te,Cc);rc.putBitmap(md,Rc,new Wc(Id(sb,
nd),ed,Bc,0,0,8*nd));break;case 1:svGlobal.logger.info("TODO: color cache");break;case 2:var gb=rb,$c=ld,Jc=gb.getByte();gb.getByte();var cc=gb.getByte(),od=gb.getByte(),qd=gb.getByte(),uc=Math.floor((qd+7)/8),kc=gb.getLittleEndian16(),rd=gb.getLittleEndian16(),lc=0;0!=($c&1024)?lc=kc:(gb.skipPosition(2),lc=gb.getLittleEndian16(),gb.skipPosition(2),gb.skipPosition(2));var Ue=void 0,Ue=1==uc?Yd(cc,od,lc,gb.getData(),gb.getPosition()):fd(cc,od,lc,gb.getData(),gb.getPosition());gb.skipPosition(lc);rc.putBitmap(Jc,
rd,new Wc(Ue,cc,od,0,0,qd));break;case 3:for(var Ob=rb,tb=null,Ve=0,mc=0,pd=0,hb=0,q=0,Sc=0,sd=0,ec=0,Ve=Ob.getByte(),mc=Ob.getByte(),Dc=0;Dc<mc;Dc++){var pd=Ob.getLittleEndian16(),hb=Ob.getLittleEndian16(),q=Ob.getLittleEndian16(),Sc=Ob.getLittleEndian16(),sd=Ob.getLittleEndian16(),ec=sd*Math.floor((Sc+7)/8)+3&-4,Tc=tb=new lf(Ve,pd,hb,q,Sc,sd,Ob.getBytes(ec));if(12>Tc.font&&256>Tc.character){var oc=Yc[Tc.font][Tc.character];oc&&(oc.fontData=null);Yc[Tc.font][Tc.character]=Tc}else svGlobal.logger.warn("put font: font="+
Tc.font+" c="+Tc.character)}break;case 4:We(rb,ld,!1);break;case 5:We(rb,ld,!0);break;case 8:var dc=rb,Ec=ld&7,Fc=dc.getLittleEndian16();dc.skipPosition(8);var gd=dc.getByte();dc.skipPosition(2);var Gc=dc.getByte(),yd=dc.getLittleEndian16(),zd=dc.getLittleEndian16(),Hc=dc.getLittleEndian32(),td=[0];if(1==Gc){Ee(dc,gd,yd,zd,vc);var Zc=vc.getData(),ad=vc.getDataSize();td.length=ad;Ad(Zc,0,td,yd,zd,1);rc.putBitmap(Ec,Fc,new Wc(td,yd,zd,0,0,32))}else if(0==Gc){var bd=Ld(dc.getData(),Hc,dc.getPosition());
td.length=bd.length;Ad(bd,0,td,yd,zd,1);rc.putBitmap(Ec,Fc,new Wc(td,yd,zd,0,0,32))}else svGlobal.logger.warn("XXX invalid codec id:"+Gc);dc.skipPosition(Hc);break;default:svGlobal.logger.info("XXX second Order, type="+Xd)}rb.setPosition(qc)}c++}D.commitPaint()}function Xf(a){this.id=a;this.appId="";var b=this;this.resizable=function(){return 0!=(b.style&262144)||0!=(b.style&65536)||0!=(b.style&16777216)||3==b.showState};this.fillBrowser=function(){if((!O.disableJoinedAppResize||2!=p.mode)&&b.resizable()){var c=
A.getOwnerSurface(b);c?(c=c.getWindow())&&b.resize(0,0,c.innerWidth,c.innerHeight):svGlobal.logger.warn("XXX No browser for "+a)}};this.parent=function(){return A.getWinById(b.ownerWinid)};this.resize=function(a,d,e,k){O.disableJoinedAppResize&&2==p.mode||F.send("8C1"+b.id+"\t"+a+"\t"+d+"\t"+e+"\t"+k)};this.checkBound=function(){var a=A.getOwnerSurface(b);if(a){var a=a.getWindow(),d=b.winWidth,e=b.winHeight,k=b.winOffsetX,l=b.winOffsetY;if(a&&!(1>d||1>e)){var n=!1;d>a.innerWidth&&(d=a.innerWidth,
n=!0);b.resizable()&&e>a.innerHeight&&(e=a.innerHeight,n=!0);k>a.innerWidth&&(k=(a.innerWidth-d)/2|0,0>k&&(k=0),n=!0);l>a.innerHeight&&(l=(a.innerHeight-e)/2|0,0>l&&(l=0),n=!0);n&&b.resize(k,l,d,e)}}else svGlobal.logger.warn("no surface for checkBound")};this.exeCommand=function(b){F.send("8C4"+a+"\t"+b)};this.activate=function(b){F.send("8C3"+a+"\t"+b)};this.close=function(){b.exeCommand(61536)};this.getAppId=function(){F.send("8C0"+a)};this.isVisible=function(){return b.winWidth&&b.winHeight&&b.showState&&
45<b.winHeight&&45<b.winWidth};this.getAppId()}function Vf(a,b,c){qa||(qa=!0);var d=0==(b&268435456);svGlobal.logger.info("\n\n=========== winId="+c+" existed="+d);var e=d?A.getWinById(c):new Xf(c);if(e){0!=(b&2)&&(e.ownerWinid=a.getLittleEndian32(),svGlobal.logger.info("***** ownerWinid="+e.ownerWinid));0!=(b&8)&&(e.style=a.getLittleEndian32(),e.extStyle=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" style="+e.style+" extStyle="+e.extStyle),svGlobal.logger.info("*****--- WS_POPUP="+
(0!=(e.style&2147483648))),svGlobal.logger.info("*****--- WS_DLGFRAME="+(0!=(e.style&4194304))),svGlobal.logger.info("*****--- DS_MODALFRAME="+(0!=(e.style&128))),svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+(0!=(e.extStyle&1))),svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+(0!=(e.extStyle&128))),svGlobal.logger.info("*****--- WS_BORDER="+(0!=(e.style&8388608))),svGlobal.logger.info("*****--- WS_CAPTION="+(0!=(e.style&12582912))),svGlobal.logger.info("*****--- WS_OVERLAPPED="+(0!=(e.style&
0))),svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+(0!=(e.style&13565952))),svGlobal.logger.info("*****--- WS_POPUPWINDOW="+(0!=(e.style&2156396544))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(e.style&262144))),svGlobal.logger.info("*****--- WS_CHILD="+(0!=(e.style&1073741824))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(e.style&262144))),svGlobal.logger.info("*****--- WS_EX_MDICHILD="+(0!=(e.extStyle&64))),svGlobal.logger.info("*****--- WS_EX_LAYERED="+(0!=(e.extStyle&524288))));
if(0!=(b&16))switch(e.showState=a.getByte(),svGlobal.logger.info("***** winId="+c+" showState="+e.showState),e.showState){case 2:3==p.windowState&&setTimeout(function(){return function(){e.exeCommand(61728)}}(),50);break;case 3:e.fillBrowser()}var k=0!=(b&4);if(k){var l=a.getLittleEndian16();e.titleInfo=a.getUnicodeString(l,!1);svGlobal.logger.info("***** winId="+c+" title="+e.titleInfo)}0!=(b&16384)&&(e.clientOffsetX=a.getLittleEndian32(),e.clientOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+
c+" coffX"+e.clientOffsetX+" coffY="+e.clientOffsetY));0!=(b&65536)&&(e.clientAreaWidth=a.getLittleEndian32(),e.clientAreaHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" cw"+e.clientAreaWidth+" ch="+e.clientAreaHeight));0!=(b&131072)&&(e.rpContent=a.getLittleEndian32());0!=(b&262144)&&(e.rootParentHandle=a.getLittleEndian32());0!=(b&2048)&&(e.winOffsetX=a.getLittleEndian32(),e.winOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" offX"+e.winOffsetX+" offY="+
e.winOffsetY));0!=(b&32768)&&(e.winClientDeltaX=a.getLittleEndian32(),e.winClientDeltaY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" dX"+e.winClientDeltaX+" dY="+e.winClientDeltaY));0!=(b&1024)&&(e.winWidth=a.getLittleEndian32(),e.winHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" w"+e.winWidth+" h="+e.winHeight));0!=(b&256)&&(l=a.getLittleEndian16(),0<l&&a.skipPosition(8*l));0!=(b&4096)&&(e.visibleOffsetX=a.getLittleEndian32(),e.visibleOffsetY=a.getLittleEndian32());
0!=(b&512)&&(b=a.getLittleEndian16(),e.numVisibilityRects=b,0<b&&a.skipPosition(8*b));d||A.addWin(e);k&&A.setTitle(c)}else svGlobal.logger.warn("XXX, No win with id:"+c)}function We(a,b,c){var d,e,k,l,n,m;d=0;e=b&7;n=((b&120)>>3)-2;b=(b&65408)>>7;0!=(b&2)&&a.skipPosition(8);0!=(b&1)?l=k=Pb.readVar2Bytes(a):(k=Pb.readVar2Bytes(a),l=Pb.readVar2Bytes(a));d=Pb.readVar4Bytes(a);m=Pb.readVar2Bytes(a);c&&0==(b&8)&&a.skipPosition(8);if(c){c=1==n?Yd(k,l,d,a.getData(),a.getPosition()):fd(k,l,d,a.getData(),
a.getPosition());a.skipPosition(d);if(!c){svGlobal.logger.warn("Failed to decompress bitmap data");return}a=new Wc(c,k,l,0,0,8*n)}else{c=Array(k*l*n);c[0]=0;var h=a.getPosition(),g=0,p=k*n;for(d=0;d<l;d++)g=h+(l-d-1)*p,a.copyToByteArray(c,d*p,g,p);a=new Wc(Id(c,n),k,l,0,0,8*n)}rc.putBitmap(e,m,a);0!=(b&2)&&svGlobal.logger.warn("XXX:TODO, persistent")}function L(a,b,c){var d=0;c?(d=a.getByte()<<24>>24,b+=d):b=a.getLittleEndian16()<<16>>16;return b}function Wb(a){var b=0,c=0,b=c=a.getByte(),c=a.getByte(),
b=b|c<<8,c=a.getByte();return b|c<<16}function Be(a){var b=0,c=0,d=0,e=0,k=0,l=0,n=0,m=0,h=0,g=0,p=0,r=0,e=0,y,u,v,t;v=t=0;y=X;u=fa;for(var b=a.getLittleEndian16(),x=0;x<b;x++){var c=a.getLittleEndian16(),d=a.getLittleEndian16(),e=a.getLittleEndian16(),k=a.getLittleEndian16(),l=a.getLittleEndian16(),n=a.getLittleEndian16(),g=a.getLittleEndian16(),R=Math.floor((g+7)/8),p=a.getLittleEndian16(),r=a.getLittleEndian16(),m=e-c+1,h=k-d+1;y>c&&(y=c);u>d&&(u=d);v<e&&(v=e);t<k&&(t=k);Qb!=g&&(svGlobal.logger.warn("Server limited colour depth to "+
g+" bits"),Vc(g));if(0==p){k=l*R;g=n*k;e=Array(g);e[0]=0;p=a.getPosition();for(r=0;r<n;r++)bb(a.getData(),p,e,(n-r-1)*k,k),p+=k;a.skipPosition(g);n=void 0;n=0;R=Id(e,R);D.setRGBs(c,d,m,h,R,n,l);D.postPaint(c,d,m,h)}else 0!=(p&1024)?e=r:(a.skipPosition(2),e=a.getLittleEndian16(),a.skipPosition(4)),k=a.getData(),g=e,p=a.getPosition(),1==R?(n=Yd(l,n,g,k,p),k=void 0,k=0,R=Id(n,R),D.setRGBs(c,d,m,h,R,k,l),D.postPaint(c,d,m,h)):(R=fd(l,n,g,k,p),1>m||1>h||(D.setRGBs(c,d,m,h,R,0,l),D.postPaint(c,d,m,h))),
a.skipPosition(e)}D.commitPaint()}function me(){ma=0;ia=X-1;ra=0;ja=fa-1}function Ke(a,b,c,d,e,k){var l=Math.min(a,c),n=Math.max(a,c),m=Math.min(b,d),h=Math.max(b,d);e=lb(e);if(!(l>=ma&&n<=ia&&m>=ra&&h<=ja)){if(l>ia||n<ma||m>ja||h<ra)return;l=0;if(a==c)b>d&&(l=b,b=d,d=l),b<ra&&(b=ra),d>ja&&(d=ja);else if(b==d)a>c&&(l=a,a=c,c=l),a<ma&&(a=ma),c>ia&&(c=ia);else{l=Qa._line;l.set(a,b,c,d);n=l.intersection(ma,ra,ia,ra);m=[];n.onLine1&&n.onLine2&&m.push(n.x,n.y);n=l.intersection(ia,ra,ia,ja);n.onLine1&&
n.onLine2&&m.push(n.x,n.y);n=l.intersection(ma,ja,ia,ja);n.onLine1&&n.onLine2&&m.push(n.x,n.y);n=l.intersection(ma,ra,ma,ja);n.onLine1&&n.onLine2&&m.push(n.x,n.y);2==m.length&&(a>=ma&&a<=ia&&b>=ra&&b<=ja?m.push(a,b):c>=ma&&c<=ia&&d>=ra&&d<=ja&&m.push(c,d));if(4!=m.length)return;a=m[0];b=m[1];c=m[2];d=m[3]}}if(12==k)D.drawLine(a,b,c,d,e);else if(a==c||b==d){var l=a,n=b,m=c,h=d,g,p;if(n==h)if(m>l){if(p=m-l,!(1>p)){for(g=0;g<p;g++)Eb(k,D,l+g,n,e);D.postPaint(l,n,p+1,1)}}else{if(p=l-m,!(1>p)){for(g=0;g<
p;g++)Eb(k,D,m+g,n,e);D.postPaint(m,n,p+1,1)}}else if(h>n){if(p=h-n,!(1>p)){for(g=0;g<p;g++)Eb(k,D,l,n+g,e);D.postPaint(l,n,1,p+1)}}else if(p=n-h,!(1>p)){for(g=0;g<p;g++)Eb(k,D,l,h+g,e);D.postPaint(l,h,1,p+1)}}else{var r=Math.abs(c-a),y=Math.abs(d-b),l=a,n=b,u,v,t;h=c>=a?m=1:m=-1;p=d>=b?g=1:g=-1;r>=y?(p=m=0,v=r,u=r/2>>0,t=y):(g=h=0,v=y,u=y/2>>0,t=r,r=y);if(1>r)return;for(y=0;y<=r;y++)Eb(k,D,l,n,e),u+=t,u>=v&&(u-=v,l+=m,n+=g),l+=h,n+=p}l=Math.min(a,c);n=Math.max(a,c);m=Math.min(b,d);h=Math.max(b,d);
0>n-l||0>h-m||D.postPaint(l,m,n-l+1,h-m+1)}function Qe(a,b,c,d,e,k,l,n,m,h){m=128;n=lb(n);l=lb(l);if(!(b>ia||c>ja)){var g=b+d-1;g>ia&&(g=ia);h=b<ma?ma:b;var g=g-b+1,p=c+e-1;p>ja&&(p=ja);var r=c<ra?ra:c,p=p-c+1;if(!(1>g||1>p)){var y=0,u=0,v=D.setRGB;if(r==c&&g==d&&p==e&&h==b)if(0==a)for(a=0;a<e;a++){for(var y=c+a,t=0;t<d;t++)0==m&&(u++,m=128),0!=(k[u]&m)&&v(b+t,y,n),m>>=1;u++;m=128;u==k.length&&(u=0)}else for(a=0;a<e;a++){y=c+a;for(t=0;t<d;t++)0==m&&(u++,m=128),0!=(k[u]&m)?v(b+t,y,n):v(b+t,y,l),m>>=
1;u++;m=128;u==k.length&&(u=0)}else if(0==a)for(a=0;a<p;a++){y=c+a;for(t=0;t<g;t++)0==m&&(u++,m=128),b+t>=h&&y>=r&&0!=(k[u]&m)&&v(b+t,y,n),m>>=1;u++;m=128;u==k.length&&(u=0)}else for(a=0;a<p;a++){y=c+a;for(t=0;t<g;t++)0==m&&(u++,m=128),b+t>=h&&c+a>=r&&(0!=(k[u]&m)?v(b+t,y,n):v(b+t,y,l)),m>>=1;u++;m=128;u==k.length&&(u=0)}}}}function Ne(a,b){var c=a[b[0]++]&255,d=c&128,c=0!=(c&64)?c|-64:c&63;0!=d&&(c=c<<8|a[b[0]++]&255);return c}function Sd(a,b,c,d,e,k){a>ia||b>ja||(c=a+c-1,c>ia&&(c=ia),a<ma&&(a=ma),
c=c-a+1,d=b+d-1,d>ja&&(d=ja),b<ra&&(b=ra),d=d-b+1,1>c||1>d||(D.fillRect(a,b,c,d,lb(e)),D.postPaint(a,b,c,d)))}function ec(a){if(F&&ka)try{A.close(),cb||F.send("85-1"),F.close()}catch(b){}null!=Ka&&(Ka.exit(),Ka=null)}function Dc(a,b,c,d,e,k,l){for(var n=e*c+d,m=a.setRGB,h=a.getRGB,g=0;g<l;g++){for(var p=0;p<k;p++){if(a){var r=h(d+p,e+g);m(d+p,e+g,~r&da)}else b[n]=~b[n]&da;n++}n+=c-k}}function wd(a,b,c,d,e,k,l,n,m,h,g){if(!(0>k|0>l|0>c|0>m))switch(a){case 0:n=b.setRGB;for(m=d;m<d+k;m++)for(b=e;b<e+
l;b++)n(m,b,0);break;case 1:a=g*m+h;c=b.setRGB;b=b.getRGB;for(h=0;h<l;h++){for(g=0;g<k;g++)c(d+k,e+l,~(b(d+k,e+l)|n[a])&da);a+=m-k}break;case 2:a=g*m+h;c=b.setRGB;b=b.getRGB;for(h=0;h<l;h++){for(g=0;g<k;g++){var p=b(d+k,e+l);c(d+k,e+l,p&~n[a]&da);a++}a+=m-k}break;case 3:Dc(b,n,m,h,g,k,l);n?b.setRGBs(d,e,k,l,n,g*m+h,m):b.moveArea(h,g,k,l,d-h,e-g);break;case 4:Dc(b,null,c,d,e,k,l);Xe(b,c,d,e,k,l,n,m,h,g);break;case 5:Dc(b,null,c,d,e,k,l);break;case 6:a=g*m+h;c=b.setRGB;b=b.getRGB;for(h=0;h<l;h++){for(g=
0;g<k;g++)p=b(d+g,e+h),c(d+g,e+h,p^n[a]&da),a++;a+=m-k}break;case 7:a=g*m+h;c=b.setRGB;b=b.getRGB;for(h=0;h<l;h++){for(g=0;g<k;g++)p=b(d+g,e+h),c(d+g,e+h,~(p&n[a])&da),a++;a+=m-k}break;case 8:Xe(b,c,d,e,k,l,n,m,h,g);break;case 9:a=g*m+h;c=b.setRGB;b=b.getRGB;for(h=0;h<l;h++){for(g=0;g<k;g++)p=b(d+g,e+h),c(d+g,e+h,p^~n[a]&da),a++;a+=m-k}break;case 10:break;case 11:a=g*m+h;c=b.setRGB;b=b.getRGB;for(h=0;h<l;h++){for(g=0;g<k;g++)p=b(d+g,e+h),c(d+g,e+h,p|~n[a]&da),a++;a+=m-k}break;case 12:n?b.setRGBs(d,
e,k,l,n,g*m+h,m):b.moveArea(h,g,k,l,d-h,e-g);break;case 13:Dc(b,null,c,d,e,k,l);Ye(b,c,d,e,k,l,n,m,h,g);break;case 14:Ye(b,c,d,e,k,l,n,m,h,g);break;case 15:n=b.setRGB;for(m=d;m<d+k;m++)for(b=e;b<e+l;b++)n(m,b,da);break;default:svGlobal.logger.warn("unsupported opcode: "+a)}}function Eb(a,b,c,d,e){if(b){var k=b.getRGB(c,d);switch(a){case 0:b.setRGB(c,d,0);break;case 1:b.setRGB(c,d,~(k|e)&da);break;case 2:b.setRGB(c,d,k&~e&da);break;case 3:b.setRGB(c,d,~e&da);break;case 4:b.setRGB(c,d,(~k&e)*da);break;
case 5:b.setRGB(c,d,~k&da);break;case 6:b.setRGB(c,d,k^e&da);break;case 7:b.setRGB(c,d,~k&e&da);break;case 8:b.setRGB(c,d,k&e&da);break;case 9:b.setRGB(c,d,k^~e&da);break;case 10:break;case 11:b.setRGB(c,d,k|~e&da);break;case 12:b.setRGB(c,d,e);break;case 13:b.setRGB(c,d,(~k|e)&da);break;case 14:b.setRGB(c,d,k|e&da);break;case 15:b.setRGB(c,d,da);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+a),b.setRGB(c,d,e)}}}function Xe(a,b,c,d,e,k,l,n,m,h){b=h*n+m;m=a.setRGB;a=a.getRGB;for(h=
0;h<k;h++){for(var g=0;g<e;g++){var p=a(c+g,d+h);m(c+g,d+h,p&l[b]&da);b++}b+=n-e}}function Ye(a,b,c,d,e,k,l,n,m,h){b=h*n+m;m=a.setRGB;a=a.getRGB;for(h=0;h<k;h++){for(var g=0;g<e;g++){var p=a(c+g,d+h);m(c+g,d+h,p|l[b]&da);b++}b+=n-e}}function Pe(a,b){if(12>a&&256>b){var c=Yc[a][b];if(c)return c}return null}function Ie(a,b,c,d){switch(b){case 16:b=a>>8&248;var e=a>>3&252;a=a<<3&255;c[d]=b|b>>5;c[d+1]=e|e>>6;c[d+2]=a|a>>5;c[d+3]=255;break;case 15:b=a>>7&248;e=a>>2&248;a=a<<3&255;c[d]=b|b>>5;c[d+1]=e|
e>>5;c[d+2]=a|a>>5;c[d+3]=255;break;case 8:c[d]=Ja[0][a];c[d+1]=Ja[1][a];c[d+2]=Ja[2][a];c[d+3]=255;break;case 32:c[d]=a&255,c[d+1]=a>>8&255,c[d+2]=a>>16&255,c[d+3]=a>>24&255;default:c[d]=a&255,c[d+1]=a>>8&255,c[d+2]=a>>16&255,c[d+3]=255}}function Id(a,b){var c=a.length/b>>0,d=Array(c);d[0]=0;var e=lb;switch(b){case 1:for(var k=0;k<c;k++)d[k]=e(a[k]);break;case 2:for(k=0;k<c;k++)d[k]=e(a[2*k+1]<<8|a[2*k]);break;default:for(k=0;k<c;k++)d[k]=e(a[k*b+2]<<16)|a[k*b+1]<<8|a[k*b]}return d}function Yd(a,
b,c,d,e){var k=-1,l=0;c+=e;var n=0,m=0,h=0,g=a,p=-1,r=0,y=m=0,u=0,v=h=0,t=4294967295,x=!1,R=!1,P=!1,C=Array(a*b);for(C[0]=0;e<c;){r=0;m=d[e++];n=m>>4;switch(n){case 12:case 13:case 14:n-=6;m&=15;h=16;break;case 15:n=m&15;9>n?(m=d[e++],m|=d[e++]<<8):m=11>n?8:1;h=0;break;default:n>>=1,m&=31,h=32}0!=h&&(P=2==n||7==n,0==m?m=P?d[e++]+1:d[e++]+h:P&&(m<<=3));switch(n){case 0:p!=n||g==a&&-1==k||(x=!0);break;case 8:y=d[e++];case 3:u=d[e++];break;case 6:case 7:t=d[e++];n-=5;break;case 9:v=3;n=2;r=3;break;case 10:v=
5,n=2,r=5}p=n;for(h=0;0<m;)switch(g>=a&&(g=0,b--,k=l,l=0+b*a),n){case 0:x&&(C[l+g]=-1==k?t:C[k+g]^t,x=!1,m--,g++);if(-1==k){for(;0!=(m&-8)&&g+8<a;)for(P=0;8>P;P++)C[l+g]=0,m--,g++;for(;0<m&&g<a;)C[l+g]=0,m--,g++}else{for(;0!=(m&-8)&&g+8<a;)for(P=0;8>P;P++)C[l+g]=C[k+g],m--,g++;for(;0<m&&g<a;)C[l+g]=C[k+g],m--,g++}break;case 1:if(-1==k){for(;0!=(m&-8)&&g+8<a;)for(P=0;8>P;P++)C[l+g]=t,m--,g++;for(;0<m&&g<a;)C[l+g]=t,m--,g++}else{for(;0!=(m&-8)&&g+8<a;)for(P=0;8>P;P++)C[l+g]=C[k+g]^t,m--,g++;for(;0<
m&&g<a;)C[l+g]=C[k+g]^t,m--,g++}break;case 2:if(-1==k){for(;0!=(m&-8)&&g+8<a;)for(P=0;8>P;P++)h<<=1,h&=255,0==h&&(v=0!=r?r:d[e++],h=1),C[l+g]=0!=(v&h)?t:0,m--,g++;for(;0<m&&g<a;)h<<=1,h&=255,0==h&&(v=0!=r?r:d[e++],h=1),C[l+g]=0!=(v&h)?t:0,m--,g++}else{for(;0!=(m&-8)&&g+8<a;)for(P=0;8>P;P++)h<<=1,h&=255,0==h&&(v=0!=r?r:d[e++],h=1),C[l+g]=0!=(v&h)?C[k+g]^t:C[k+g],m--,g++;for(;0<m&&g<a;)h<<=1,h&=255,0==h&&(v=0!=r?r:d[e++],h=1),C[l+g]=0!=(v&h)?C[k+g]^t:C[k+g],m--,g++}break;case 3:for(;0!=(m&-8)&&g+8<
a;)for(P=0;8>P;P++)C[l+g]=u,m--,g++;for(;0<m&&g<a;)C[l+g]=u,m--,g++;break;case 4:for(;0!=(m&-8)&&g+8<a;)for(P=0;8>P;P++)C[l+g]=d[e++],m--,g++;for(;0<m&&g<a;)C[l+g]=d[e++],m--,g++;break;case 8:for(;0!=(m&-8)&&g+8<a;)for(P=0;8>P;P++)R?(C[l+g]=u,R=!1):(C[l+g]=y,R=!0,m++),m--,g++;for(;0<m&&g<a;)R?(C[l+g]=u,R=!1):(C[l+g]=y,R=!0,m++),m--,g++;break;case 13:for(;0!=(m&-8)&&g+8<a;)for(P=0;8>P;P++)C[l+g]=255,m--,g++;for(;0<m&&g<a;)C[l+g]=255,m--,g++;break;case 14:for(;0!=(m&-8)&&g+8<a;)for(P=0;8>P;P++)C[l+
g]=0,m--,g++;for(;0<m&&g<a;)C[l+g]=0,m--,g++;break;default:m--,g++}}return C}sessionStorage&&sessionStorage.clear();this.displayMsg=this.reconnectOnResize=!0;this.appTimeout=1600;this.reconnectTimes=0;this.windowState=3;this.setTitle=this.openLink=!0;this.audioBuffer=0;this.sessionInfo={domain:"",userName:"",sessionId:0,joinedSessions:[]};this.mode=0;this.remoteAppLogin=!0;var uc=!1,Tb={},Gb={},Ub=null,p=this,Hb=!0,$c=!1,ad=!1,Aa=!1,O=hi5.appcfg||{img:{},toolbar:{fadable:!0}};this.setConfig=function(a){O=
a};var X=0,fa=0,Qb=(ib?parseInt(ib,10):16)|0,bb=hi5.Arrays.arraycopy,ab=hi5.Arrays.fill,Vb=null,nc=!hi5.browser.isIE,tc="object"==typeof r?r:null;this.protocol=tc?"":r.substring(0,r.indexOf("://")).toLowerCase();this.gateway=function(){if(tc)return"";var a=r.lastIndexOf("/RDP?");-1==a&&(a=r.lastIndexOf("/JOIN?"));-1==a&&(a=r.lastIndexOf("/PLAY?"));return r.substring(0,a).replace(/wss\:\/\//ig,"https://").replace(/ws\:\/\//ig,"http://")}();var cb="object"==typeof r||0<r.indexOf("/PLAY?"),Ze=!cb&&0<
r.indexOf("invitation=");if(Ze){var Zd=decodeURIComponent(r),Uc=Zd.indexOf(' USERNAME="');if(0<Uc){var Uc=Uc+11,$e=Zd.substring(Uc,Zd.indexOf('"',Uc));r+="&novice="+$e+"&server="+$e}r+="&mapClipboard=on"}if(cb)this.mode=1,tc?r="":(X=640,fa=480),r+="&touchpad=on",this.reconnectOnResize=!1;else if(0<r.indexOf("/JOIN?")||Ze)this.mode=2,Hb=this.reconnectOnResize,this.reconnectOnResize=!1;X=M&&0!=M?M|0:window.innerWidth|0;Ua&&0!=Ua?fa=Ua|0:(fa=window.innerHeight|0,fa=ce(fa)|0);-1==X&&(X=screen.width|0);
-1==fa&&(fa=screen.height|0);var B=hi5.tool.queryToObj(r.substring(r.indexOf("?")+1));B.gateway||(r+="&gateway="+encodeURIComponent(p.gateway));!B.minWidth&&O.minWidth&&(rdArgs.minWidth=O.minWidth);!B.minHeight&&O.minHeight&&(rdArgs.minHeight=O.minHeight);B.minWidth&&(B.minWidth=parseInt(B.minWidth));B.minHeight&&(B.minHeight=parseInt(B.minHeight));B.waWidth&&(B.waWidth=parseInt(B.waWidth));B.waHeight&&(B.waHeight=parseInt(B.waHeight));"useSSL"in B||(r+="&useSSL="+("wss"==p.protocol));Fb(B.mapClipboard)&&
hi5.storage.isAvailable&&(r+="&shareClipboardId="+af());O&&(void 0!=O.displayMsg?this.displayMsg=O.displayMsg:O.displayMsg=this.displayMsg,O.appTimeout&&(this.appTimeout=O.appTimeout),void 0!=O.reconnectOnResize&&(Hb=this.reconnectOnResize=O.reconnectOnResize),O.reconnectTimes&&(this.reconnectTimes=O.reconnectTimes),void 0!=O.windowState&&(this.windowState=O.windowState),void 0!=O.openLink&&(this.openLink=O.openLink),void 0!=O.setTitle&&(this.setTitle=O.setTitle),O.audioBuffer&&(this.audioBuffer=
O.audioBuffer),"boolean"==typeof O.useWSS&&(r=(O.useWSS?"wss":"ws")+r.substring(r.indexOf("://"))),"boolean"==typeof O.remoteAppLogin&&(this.remoteAppLogin=O.remoteAppLogin,uc=!O.remoteAppLogin,svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")),"boolean"==typeof O.hideLogin&&(uc=O.hideLogin));var Ic=this.reconnectTimes;B.vmid&&-1==B.vmid.indexOf("EnhancedMode=1")&&(Hb=this.reconnectOnResize=!1);this.server=B.server;this.port=parseInt(B.port,10);this.loadbalanceToken=
O.loadbalanceTokenName?O.loadbalanceTokenName+"="+hi5.tool.uuid():"";this.modifyURL=function(a){p.loadbalanceToken&&(a+="&"+p.loadbalanceToken);return a};this.getURL=function(){return r};this.getColor=function(){return Qb};var pc=hi5.graphic.Rectangle,Sb=new function(){function a(a){a=(a&1431655765)<<1|a>>>1&1431655765;a=(a&858993459)<<2|a>>>2&858993459;a=(a&252645135)<<4|a>>>4&252645135;if(0==a>>>8)return a;a=(a&16711935)<<8|a>>>8&16711935;return 0==a>>>16?a:(a&65535)<<16|a>>>16&65535}function b(a,
b,e,g){var f,h=0,m=0,n,p,t,x,v=0!=(g&1),r=d;if(0==(g&32))return k=0,l=e,0;0!=(g&64)&&(c=0);if(0!=(g&128)){for(g=65536;0<=--g;)r[g]=0;c=0}l=k=0;k=t=n=g=c;if(0==e)return 0;e+=m;do{if(0==h){if(m>=e)break;g=a[b+m++]<<24;h=8}if(0<=g){if(8>h){if(m>=e){if(0!=g)return-1;break}g|=a[b+m++]<<24-h;h+=8}if(65536<=n)return-1;r[n++]=g>>>24&255;g<<=8;h-=8}else{g<<=1;if(0==--h){if(m>=e)return-1;g=a[b+m++]<<24;h=8}if(0<=g){if(8>h){if(m>=e)return-1;g|=a[b+m++]<<24-h;h+=8}if(65536<=n)return-1;r[n++]=(g>>>24|128)&255;
g<<=8;h-=8}else{g<<=1;if(--h<(v?3:2)){if(m>=e)return-1;g|=a[b+m++]<<24-h;h+=8}if(v)switch(g>>>29){case 7:for(;9>h;h+=8){if(m>=e)return-1;g|=a[b+m++]<<24-h}g<<=3;f=g>>>26;g<<=6;h-=9;break;case 6:for(;11>h;h+=8){if(m>=e)return-1;g|=a[b+m++]<<24-h}g<<=3;f=(g>>>24)+64;g<<=8;h-=11;break;case 5:case 4:for(;13>h;h+=8){if(m>=e)return-1;g|=a[b+m++]<<24-h}g<<=2;f=(g>>>21)+320;g<<=11;h-=13;break;default:for(;17>h;h+=8){if(m>=e)return-1;g|=a[b+m++]<<24-h}g<<=1;f=(g>>>16)+2368;g<<=16;h-=17}else switch(g>>>30){case 3:if(8>
h){if(m>=e)return-1;g|=a[b+m++]<<24-h;h+=8}g<<=2;f=g>>>26;g<<=6;h-=8;break;case 2:for(;10>h;h+=8){if(m>=e)return-1;g|=a[b+m++]<<24-h}g<<=2;f=(g>>>24)+64;g<<=8;h-=10;break;default:for(;14>h;h+=8){if(m>=e)return-1;g|=a[b+m++]<<24-h}f=(g>>>18)+320;g<<=14;h-=14}if(0==h){if(m>=e)return-1;g=a[b+m++]<<24;h=8}if(0<=g)p=3,g<<=1,h--;else{x=v?14:11;do{g<<=1;if(0==--h){if(m>=e)return-1;g=a[b+m++]<<24;h=8}if(0<=g)break;if(0==--x)return-1}while(1);p=(v?16:13)-x;g<<=1;if(--h<p)for(;h<p;h+=8){if(m>=e)return-1;g|=
a[b+m++]<<24-h}x=p;p=g>>>32-x&~(-1<<x)|1<<x;g<<=x;h-=x}if(65536<=n+p)return-1;f=n-f&(v?65535:8191);do r[n++]=r[f++];while(0!=--p)}}}while(1);c=n;k=t;l=n-t;return 0}var c=0,d=Array(65536);d[0]=0;ab(d,0,65536,0);var e=Array(8);ab(e,0,8,0);var k=0,l=0,n=[6,6,6,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,9,8,9,9,9,9,8,8,9,9,9,9,9,9,8,9,9,10,9,9,9,9,9,9,9,10,9,10,10,10,9,9,10,9,10,9,10,9,9,9,10,10,9,10,9,9,8,9,9,9,9,10,10,10,9,9,10,10,10,10,10,10,9,9,10,10,10,10,10,10,10,9,10,10,10,10,10,10,8,10,10,10,10,10,10,10,10,
10,10,10,10,10,10,10,9,10,10,10,10,10,10,10,9,10,10,10,10,10,10,9,7,9,9,10,9,10,10,10,9,10,10,10,10,10,10,10,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,13,10,10,10,10,10,10,11,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,10,10,10,10,9,10,10,10,10,10,9,10,10,10,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,8,9,9,10,9,10,10,10,9,10,10,10,9,9,8,7,13,13,7,7,10,7,7,6,6,6,6,5,6,6,6,5,6,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,8,5,6,
7,7],m=[123,65311,65293,65063,65024,65285,65303,65128,197,65031,65299,65216,65288,65048,65307,65203,65027,162,65090,65296,65035,65026,65169,65305,65152,233,65082,65301,65042,87,65239,65309,65294,65077,65129,65314,65304,65146,65025,65315,65300,65268,65204,65033,65308,65220,65289,65120,65136,65298,65029,65170,65185,65306,65039,65287,65110,65302,65282,65240,65256,65310,65053,59,65535,65286,65535,65137,65161,65535,65535,65068,65067,65056,65535,65211,65231,65032,65535,65248,65037,65535,65177,65535,65028,
65194,65097,65535,65047,65121,65247,65535,65279,65270,65100,65535,65535,65159,65535,65316,65535,65084,65138,65535,65535,65230,65535,65278,65535,65059,65212,65034,65193,65535,65041,65535,65154,65535,65030,65178,65269,65535,65058,65101,65119,65535,65283,65249,65535,65226,65228,65535,65049,65535,65207,65535,65535,65155,65065,65535,65535,65535,65132,65535,65261,65535,65535,65094,65116,65045,65535,65243,65190,65535,65535,65092,65535,65036,65535,65173,65276,65535,65535,65208,5833,65535,65264,65535,65080,
65535,65535,65133,65150,65535,65535,65535,65535,65115,65244,65535,65535,65260,65095,65055,65535,65151,65174,65535,65535,65189,65535,65040,65088,65074,65215,65535,65535,65236,65265,65535,65535,65535,65141,65535,65535,65165,65073,65535,65125,65051,65535,65252,65275,65535,65535,65106,65535,65038,65535,65181,65199,65535,65535,65105,65235,65535,65312,65535,65071,65535,65535,65217,65164,65535,65535,65535,65087,65535,65535,65142,65535,65274,65107,65061,65535,65124,65253,65535,65535,65198,65535,65043,65535,
65160,65182,65535,65091,65535,65535,65188,65171,65535,65535,65535,65085,65535,65535,65259,65241,65535,65044,65114,65535,65064,65149,65535,65535,65130,65535,65535,65281,65222,65224,65535,65535,65205,65535,65535,65535,65172,65144,65535,65535,65535,65187,65535,65535,65242,65112,65535,65054,65093,65258,65535,65131,65535,65535,65079,65535,65535,65535,65148,65206,65535,65535,65272,65535,65535,65535,65223,65179,65535,65535,65535,65104,65535,65535,65197,65250,65535,65050,65123,65102,65535,65535,65273,65535,
65139,65535,65535,65535,65072,65163,65535,65535,65213,65070,256,65535,65262,65234,65535,65535,65535,65196,65535,65535,65180,65156,65535,65060,65103,65271,65535,65535,65251,65122,65535,65535,65535,65535,65162,65140,65535,65535,65086,65535,65535,65535,65233,65214,65535,65535,65069,65535,65098,65267,65535,65535,65245,65118,65046,65535,65096,65192,65535,65195,65175,65535,65535,65232,65535,65535,65229,65209,65535,65535,65535,65066,65535,65535,65158,65134,65535,65535,65535,65246,65535,65535,65117,65099,
65057,65535,65263,65176,65535,65535,65153,65535,65535,65535,65191,65535,65210,65277,65535,65535,65535,65227,65535,65535,65135,65081,65535,65535,65535,65157,65535,268,65254,65127,65052,65535,65108,65202,65535,65535,65183,65535,65535,65535,65113,65201,65535,65218,65535,65535,65078,65266,65535,65535,65238,65143,65535,65535,65535,65075,65535,65535,65167,65109,65062,266,65284,65255,65535,289,65126,65535,65535,65535,65200,65184,65535,271,65168,65535,65535,65237,65535,65535,65219,65076,65535,65535,65535,
65166,65535,273,65145,65089,267],h=[511,0,508,448,494,347,486,482],g=[4,2,3,4,3,4,4,5,4,5,5,6,6,7,7,8,7,8,8,9,9,8,9,9,9,9,9,9,9,9,9,9],p=[4065,4064,4066,4072,14,4069,4068,4074,4081,4067,21,4071,4079,70,4080,4077,4095,4087,4091,25,4093,4084,300,4075,4094,4086,4090,137,4092,4083,4088,4082],r=[0,4,10,19],y=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,14,14,15],u=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,32769,
49153,65537],v=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,6,6,8,8,14,14],t=[2,3,4,5,6,7,8,9,10,12,14,16,18,22,26,30,34,42,50,58,66,82,98,114,130,194,258,514,2,2],x=new RdpBuffer(d,0,1);this.reset=function(){c=0;d=Array(65536);l=k=d[0]=0;x=new RdpBuffer(d,0,1)};this.getData=function(){x.setPosition(k);x.markEnd(k+l);return x};this.getDecompressedLength=function(){return l};this.dec=function(x,P,C,D){if(2==(D&15)){var f=d,B=c,A=0,F=0,V=0,M=0,O=P,L=0,T=0,S=0,N,U=0;l=0;k=B;0!=(D&64)&&(bb(f,B-32768,
f,0,32768),k=c=B=32768);0!=(D&128)&&(B=0,ab(f,0,65536,0),e.fill(0),k=0);if(32!=(D&32))bb(x,0,f,B,C),B+=C,l=B-c;else{N=0;for(P+=C;O<P&&!(U=x[O++]&255,A|=U<<N,T+=8,N+=8,32<=N););A=a(A);O<P?(L=a(x[O++]&255)&255,S=8):S=0;for(;8<=T;){F=0;for(N=5;13>=N&&(12==N||(U=a(A&4294967295<<32-N),V=m[U&511^U>>>9^U>>>4^U>>>7],0!=(V^U)>>>9?U=V&511:(V=void 0,V=(U>>>8^U&255)>>>2&15,0!=U>>>9&&(V=~V),V&=65535,U=m[h[V%12]]),N!=n[U]));N++);A<<=N;T-=N;if(256>U)f[B++]=U&255;else if(256<U&&289>U){V=U-257;N=y[V];F=u[V]-1;0!=
N&&(F+=a(A&4294967295<<32-N));V=e;M=F;C=V[2]|V[3]<<16;C<<=16;V[2]=C&65535;V[3]=C>>>16&65535;var X=V[0]|V[1]<<16;C|=X>>>16;V[2]=C&65535;V[3]=C>>>16&65535;X=X<<16|M;V[0]=X&65535;V[1]=X>>>16&65535;A<<=N;T-=N}else if(288<U&&293>U)V=U-289,F=e[V],0!=V&&(N=e,M=N[0],N[0]=N[V],N[V]=M);else if(256==U)break;for(N=32-T;0<N;)if(S<N)U=L>>>8-S,A|=U<<32-T-S,T+=S,N-=S,O<P?(L=a(x[O++]&255)&255,S=8):S=N=0;else{S>N?(A|=L>>>8-N,L<<=N,L&=255,S-=N,T=32):(A|=L>>>8-N,T=32,O<P?(L=a(x[O++]&255)&255,S=8):S=0);break}if(0!=F){for(N=
2;9>=N&&(U=a(A&4294967295<<32-N),V=p[U&31^U>>>5^U>>>9],0!=(V^U)>>>5?U=V&31:(V=void 0,V=U>>>4&15,U=p[r[(V^V>>>2^V>>>3)&3]]),N!=g[U]);N++);A<<=N;T-=N;N=v[U];V=t[U];0!=N&&(V+=a(A&4294967295<<32-N));A<<=N;T-=N;M=B-F;N=V>F?F:V;for(U=0;0<N;)f[B++]=f[M++],N--;for(;V>F;)U=U>=F?0:U,f[B++]=f[M+U++],V--;for(N=32-T;0<N;)if(S<N)U=L>>>8-S,A|=U<<32-T-S,T+=S,N-=S,O<P?(L=a(x[O++]&255)&255,S=8):S=N=0;else{S>N?(A|=L>>>8-N,L<<=N,L&=255,S-=N,T=32):(A|=L>>>8-N,T=32,O<P?(L=a(x[O++]&255)&255,S=8):S=0);break}}}l=0!=(D&128)?
B:B-c}c=B;return 0}return b(x,P,C,D)}},Pf=0<r.indexOf("nocurosr=on"),qa=0<r.indexOf("startProgram=app"),bd=0<r.indexOf("mapDisk=on"),Na=null;qa&&(Hb=this.reconnectOnResize=!1);hi5.browser.isTouch&&Math.max(X,fa)>Math.max(window.innerWidth,window.innerHeight)&&(Hb=this.reconnectOnResize=!1);this.isRemoteApp=function(){return qa};ge();var F=null,ka=!1,mb=!1,sa=new function(a){var b=null;this.available=!1;this.delay=a;this.supportAudioData=this.supportWebAudio=!1;if(0==B.playSound||0<p.mode)(b=hi5.audio.getAudioContext())?
this.supportWebAudio=this.available=!0:"AudioDataDestination"in window&&(this.available=this.supportAudioData=!0);this.getBuffer=function(a){return b.createBuffer(2,a,wa)};var c=0,d=null;this.setVolume=function(a){1==a?d=null:(d||(d=b.createGain()),d.gain.value=a)};this.playBuffer=function(e){var k=b.createBufferSource();k.buffer=e;d?(k.connect(d),d.connect(b.destination)):k.connect(b.destination);var l=b.currentTime,n=0<c?c:l+a;n<l&&(n=l);c=n+e.duration;k.start?k.start(n):k.noteOn(n);return c-l};
this.iOSFix=function(){if(b&&hi5.browser.isTouch&&hi5.browser.isSafari){var a=this.getBuffer(1024),c=b.createBufferSource();c.buffer=a;c.connect(b.destination);c.start?c.start(0):c.noteOn(0)}};this.close=function(){b=null}}(p.audioBuffer),D=new ee(X,fa);this.setVolume=function(a){sa&&sa.setVolume(a)};this.setAudioBuffer=function(a){p.audioBuffer=a;sa.delay=a;kb&&(kb.delay=a)};for(var kb=null,Yc=Array(12),$d=0;12>$d;$d++)Yc[$d]=Array(256);var Xc=Array(256),ma=0,ra=0,ia=X-1,ja=fa-1,Ja=null,sc=null,
Md=0;window.$rdp=this;var Ka=null,lb=he,fd=ie;Vc(Qb);this.running=function(){return ka};var zb=new function(){function a(){p.sendPing(null);b=setTimeout(a,c)}var b=0,c=B.pingInterval||0;0<c&&(c*=1E3);this.setInterval=function(a){c=1E3*a};this.getInterval=function(){return c};this.processPong=function(a){if(p.onpong)p.onpong(a)};this.sendPing=function(){0<c&&(b&&clearTimeout(b),b=setTimeout(a,c))}};this.setJoinMode=function(a){ka&&F.send("8E1"+a)};this.setJoinCloseMode=function(a){ka&&F.send("8EB3\t"+
a)};this.refuseControl=function(a){ka&&F.send("8E3"+a)};this.giveControl=function(a){ka&&F.send("8E4"+a)};this.pauseSession=function(a,b){ka&&F.send("8EB"+(b?1:0)+"\t"+a)};this.closeSession=function(a){ka&&F.send("8EB2\t"+a)};this.requestControl=function(){ka&&F.send("8E2")};this.saveSession=function(a){ka&&F.send("8E9"+(a.save?1:0)+"\t"+(a.timeout||0)+"\t"+(a.id||0))};this.allowJoin=function(a,b){ka&&F.send("8EA"+a+"\t"+(b?1:0))};var ae=new function(){function a(){if(c&&0<c.length){var b=c.shift();
ae.sendSingleKey(b.down,b.key);0<c.length?setTimeout(a,d):c=null}}var b={" ":57,space:57,pageup:201,pagedown:209,end:207,home:199,left:203,up:200,right:205,down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.sendSingleKey=function(a,c){var d=
b[c.toLowerCase()];d?p.writeScancode(a,d):(d=c.length,0!=d&&(1==d?p.writeKeyCode(a,c.toUpperCase().charCodeAt(0)):a&&p.writeText(c)))};var c=null,d=0;this.sendKeyComb=function(b,k){if(Aa){var l=b.split("+"),n=l.length,m=0;if(0!=n){for(var h=null,g=[],m=0;m<n;m++){var p=l[m];""==p&&""==h&&(p="Add");""!=p&&g.push({key:p,down:!0});h=p}n=g.length;for(m=n-1;0<=m;m--)g.push({key:g[m].key,down:!1});if(k)c=g,d=k,a();else for(m=0,n=g.length;m<n;m++)ae.sendSingleKey(g[m].down,g[m].key)}}}};this.writeKeyComb=
function(a,b){Aa&&ae.sendKeyComb(a,b)};var qe=new function(){this.ws=null;this.setJoinMode=p.setJoinMode;this.requestControl=p.requestControl;this.writeKeyComb=p.writeKeyComb;this.getAppMode=function(){return p.mode};this.send=function(a){ka&&(F.send(a),zb.sendPing())};this.saveSession=function(a){p.saveSession(a)};this.sendInput=function(a){if(Aa&&!D.isPaused()){var c=a.substring(0,2),d=a.substring(2);if(Ka&&("80"==c||"81"==c||"82"==c||"83"==c)){var d=d.split("\t"),e=new Uint8Array(7),k=0,l=0,n=
0,l=parseInt(d[0]),n=parseInt(d[1]);switch(parseInt(c,16)){case 128:k=("0"==d[2]?4096:8192)|32768;break;case 129:k="0"==d[2]?4096:8192;break;case 130:k=2048;break;case 131:k="0"==d[2]?33408:33664}e[0]=32;e[1]=k&255;e[2]=k>>8;e[3]=l&255;e[4]=l>>8;e[5]=n&255;e[6]=n>>8;Ka.add(new RecordingObj(e,0,7,60))}F.send(a);zb.sendPing();if(p.onactivity)p.onactivity(a)}};var a=null;this.getAppInfo=function(){return p.sessionInfo.appInfo};this.onresize=function(b){if(b=b.target.svSurface){var c=b.getFreeSpace(),
d=c.width,e=c.height;qa?((b=b.railWin)&&(b=b.getMain(A.zOrders)),b&&b.resize(0,0,d,e)):p.reconnectOnResize&&ka&&(a&&(clearTimeout(a),a=0),a=setTimeout(function(){svGlobal.logger.warn("w:"+d+" ww:"+X+" h:"+e+" hh:"+fa);p.reconnect(d,e,O.forceReconnect)},700))}};this.onorientationchange=function(a){var c=ce(a.innerHeight);if(p.reconnectOnResize)p.reconnect(a.innerWidth,c);else if(qa&&a.svSurface){var d=a.svSurface.railWin;d&&(d=d.getMain(A.zOrders));d&&d.resize(0,0,a.innerWidth,c)}};this.getClipData=
uf;this.onfocus=function(a){var c=a.target;qa&&c.svSurface&&c.svSurface.railWin&&(a=c.svSurface.railWin.getTopWin(A.zOrders))&&F&&(c=c.svSurface.context)&&c!=D.getContext()&&(D.setContext(null),a.activate(1),svGlobal.logger.info("Activate win:"+a.id))};this.getShareFiles=function(a,c){mb&&Na&&Na.list(a,c)};this.getFile=function(a){p.reconnectOnResize=!1;window.open(p.getFileUrl(a))};this.getFileLink=function(a){return p.modifyURL(jb()+"/DOWNLOAD?s="+sc+"&f="+a)};this.getGateway=function(){return r};
this.reconnect=function(a,c,d){r=hi5.tool.replaceQuery(r,"user",a);r=hi5.tool.replaceQuery(r,"pwd",c);r=hi5.tool.replaceQuery(r,"domain",d);"sessionStorage"in window&&sessionStorage.clear();window.$rdp=this;a=A.getFocused();A.removeElm(a);p.addSurface(a);p.run()}},A=function(){var a=[];a.addSurface=function(b){a.push(b)};a.hasSurface=function(b){for(var c=a.length,d=0;d<c;d++)if(a[d].equals(b))return!0;return!1};a.setSize=function(b,c,d){for(var e=0,k=a.length;e<k;e++)a[e].setSize(b,c,d)};a.zOrders=
[];a.drawLicense=function(b){for(var c=0,d=a.length;c<d;c++)a[c].drawLicense(b)};a.setReadOnly=function(b){for(var c=0,d=a.length;c<d;c++)a[c].setReadOnly(b)};a.setVisible=function(a,c){svGlobal.logger.info("TODO: setVisible")};a.copyToClip=function(b){1>a.length||a[0].copyToClip(b)};a.setCursor=function(b){!qa&&a[0]&&a[0].setCursor(b);var c=a.getFocused();c&&c.setCursor(b)};a.hide=function(b){if(qa){b=0;for(var c=a.length;b<c;b++)a[b].getWindow().close()}else a[0].hide()};a.execute=function(b,c){for(var d=
0,e=a.length;d<e;d++)a[d][b].apply(a[d],c)};a.addWin=function(b){var c=a.getFocused();c||(svGlobal.logger.warn("Focused surface not found!"),c=a[a.length-1]);c?(qa=!0,c.railWin||(c.railWin=new vf,c.onunload=function(){O.closeRemoteApp&&c.railWin&&c.railWin.close();c.remoteApp&&c.remoteApp.close();c.railWin&&(c.railWin.clear(),c.railWin=null);a.removeElm(c)}),c.context&&D.setContext(c.context),c.railWin.addWin(b),hi5.browser.isIE&&c.focus()):svGlobal.logger.warn("No surface available!")};a.delWin=
function(b){for(var c,d=a.length-1;0<=d;d--){var e=a[d];c=e.railWin;var k=c.getWinById(b),l=k&&k.appId&&-1!=k.appId.toLowerCase().indexOf("runonce");if(0<=c.delWin(b)&&!c.hasApp(k.appId)){k=p.appTimeout;if(l||c.isNew())k*=10;svGlobal.logger.debug("Prepare del:"+(new Date).getTime());setTimeout(function(b){return function(){svGlobal.logger.debug("Start del:"+(new Date).getTime());b.railWin&&b.railWin.isRunning()||(b.remoteApp&&b.remoteApp.close(),a.delSurface(b))}}(e),k)}}};a.popWins=function(b){return a[0]&&
a[0].railWin?a[0].railWin.popWins(b):[]};a.getWinById=function(b){for(var c,d=0,e=a.length;d<e;d++)if(a[d].railWin&&(c=a[d].railWin.getWinById(b)))return c;return null};a.setTitle=function(b){for(var c,d=0,e=a.length;d<e;d++)if(a[d].railWin&&(c=a[d].railWin.getWinById(b))&&c.titleInfo&&c.isVisible()){oc(c.titleInfo+" - "+(B.displayName||p.server),a[d].getWindow());break}};a.hasApp=function(b){for(var c=0,d=a.length;c<d;c++)if(a[c].railWin.hasApp(b))return!0;return!1};a.delSurface=function(b){b.railWin.isRunning()||
(svGlobal.logger.info("delete surface..."),a.removeElm(b),b.close(),0==a.length&&ec())};a.getOwnerSurface=function(b){for(var c=0,d=a.length;c<d;c++)if(a[c].railWin&&a[c].railWin.hasWin(b))return a[c];return null};a.getFocused=function(){if(!qa)return a[0];for(var b=a.length,c=0;c<b;c++)if(a[c].focused)return a[c];return a[b-1]};a.close=function(){for(var b=0,c=a.length;b<c;b++)a[b]&&(a[b].remoteApp&&a[b].remoteApp.close(),a[b].close())};return a}();this.getSurfaces=function(){return A};this.hide=
function(){A&&A.hide()};var ea={count:0,names:[],close:function(){for(var a=ea.names,b=0,c=a.length;b<c;b++)ea[a[b]].close&&ea[a[b]].close()},init:function(a,b,c){ea.count=0;ea.names.length=0;var d=new p.DynamicChannel;d.name="ECHO";d.process=function(a){var b=a.getPositon(),c=a.getEnd(),e=new Uint8Array(c-b);e.set(a.getData().subarray(b,c));d.send(e)};p.addDynamicChannel(d);if(a){var e=new p.DynamicChannel;e.name="Microsoft::Windows::RDS::Input";e.process=function(a){var b=a.getLittleEndian16();
a.getLittleEndian32();switch(b){case 1:a.skipPosition(4),a=new RdpBuffer(new Uint8Array(16),0,16),a.setLittleEndian16(2),a.setLittleEndian32(16),a.setLittleEndian32(3),a.setLittleEndian32(65536),a.setLittleEndian16(256),a.markEnd(),e.send(a);case 5:A.execute("setTouchRemoting",[!0]);ea.isTouchReady=!0;console.log("Touch remoting start");break;case 4:A.execute("setTouchRemoting",[!1]),ea.isTouchReady=!1,console.log("Touch remoting suspend")}};p.addDynamicChannel(e)}if(c){svGlobal.logger.warn("Audio input on");
var k=new p.DynamicChannel;(function(){function a(b){var c=new RdpBuffer(new Uint8Array(5),0,5);c.setByte(7);c.setLittleEndian32(b);c.markEnd();k.send(c)}function b(d){d.getLittleEndian32();var h=d.getLittleEndian32();(new c).fromBuffer(d);A=!0;y=p.reconnectOnResize;p.reconnectOnResize=!1;v.start();v.onopen||(v.onopen=function(b){e=b;p.reconnectOnResize=y;a(h);var c=new RdpBuffer(new Uint8Array(5),0,5);c.setByte(4);c.setLittleEndian32(b?0:1);c.markEnd();k.send(c)});v.ondata||(v.ondata=function(a,
b){if(e){k.send(r);b++;var c=new Uint8Array(b);c[0]=6;c.set(a,1);k.send(c)}})}function c(){this.WAVE_FORMAT_PCM=1;this.WAVE_FORMAT_ADPCM=2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=85;this.WAVE_FORMAT_AAC=41222;this.bitsPerSample=this.nBlockAlign=this.nAvgBytesPerSec=this.nSamplesPerSec=this.nChannels=this.formatTag=0;this.hasLocalSupport=!1;this.cbSize=0;this.extenstion=null;var a=this;this.fromBuffer=function(b){a.formatTag=b.getLittleEndian16();
a.nChannels=b.getLittleEndian16();a.nSamplesPerSec=b.getLittleEndian32();a.nAvgBytesPerSec=b.getLittleEndian32();a.nBlockAlign=b.getLittleEndian16();a.bitsPerSample=b.getLittleEndian16();var c=b.getLittleEndian16();a.cbSize=c;0<c&&(a.extenstion=Array(c),b.copyToByteArray(a.extenstion,0,b.getPosition(),c),b.skipPosition(c))};this.toBuffer=function(b){b.setLittleEndian16(a.formatTag);b.setLittleEndian16(a.nChannels);b.setLittleEndian32(a.nSamplesPerSec);b.setLittleEndian32(a.nAvgBytesPerSec);b.setLittleEndian16(a.nBlockAlign);
b.setLittleEndian16(a.bitsPerSample);b.setLittleEndian16(a.cbSize);0<a.cbSize&&b.setBytes(a.extenstion)};this.getSize=function(){return 18+a.cbSize};this.toString=function(){return"Audio Format, tag="+a.formatTag+" nChannels="+a.nChannels+" nSamplesPerSec="+a.nSamplesPerSec+" nAvgBytesPerSec"+a.nAvgBytesPerSec+" nBlockAlign"+a.nBlockAlign+" bitsPerSample"+a.bitsPerSample+" cbSize="+a.cbSize}}function d(){function a(b,c){return-32768==b&&-32768==c?32767:b*c>>15<<16>>16}function b(a,c){if(-32768==a&&
-32768==c)return 32767;var d;d=a*c+16384>>15;return d<<16>>16}function c(a,b){var d=0;if(0>=a){if(0<=b)return a+b;d=-(a+1)-(b+1);return 2147483647<=d?-2147483648:-d-2}if(0>=b)return a+b;d=a+b;return 2147483647<d?2147483647:d}function e(a){if(0>a){if(-1073741824>=a)return 0;a=~a}return(0!=(a&4294901760)?0!=(a&4278190080)?-1+L[255&a>>24]:7+L[255&a>>16]:0!=(a&65280)?15+L[255&a>>8]:23+L[255&a])<<16>>16}function g(a,b){return 16<=b?0>a?-1:-0:-16>=b?0:0>b?a<<-b<<16>>16:a>>b<<16>>16}function k(a,b,c,d,e){for(var f=
0;f<e;f++)c[d+f]=a[b+f]}function f(b,c,d,e,f,h){var g=0,g=a(b<<16>>16,f[h]);b=g+(c<<16>>16);b=(-32768>b?-32768:32767<b?32767:b)+256;g=(-32768>b?-32768:32767<b?32767:b)>>9<<16>>16;f[h]=(g>d?d-e:g<e?0:g-e)<<16>>16}function h(a,b){var c;c=ka[a+3*b]>>2<<16>>16;return c*c}function l(a,c,d,e,f,g,h){a=a[d]+g;f=((-32768>a?-32768:32767<a?32767:a)<<26>>16)-(f<<17>>16);e=b(h,-32768>f?-32768:32767<f?32767:f);h=e+e;c[d]=-32768>h?-32768:32767<h?32767:h}function m(a){for(var b=0,c=0,d=0;8>d;d++)0>a[d]?(b=(-32768==
a[d]?32767:-a[d])<<16>>16,c=(b>>2<<16>>16)+26112,a[d]=-(11059>b?b<<1:20070>b?b+11059:-32768>c?-32768:32767<c?32767:c)<<16>>16):(b=a[d],c=(b>>2<<16>>16)+26112,a[d]=(11059>b?b<<1:20070>b?b+11059:-32768>c?-32768:32767<c?32767:c)<<16>>16)}function n(a,c,d,e,f){for(var h=a.u,g=0,k=0,l=0,m=0,p=0,t=0,g=m=0;0!=d;){d--;g=m=e[f];for(t=0;8>t;t++)l=h[t],p=c[t],h[t]=m,k=b(p,g),m=l+k,m=-32768>m?-32768:32767<m?32767:m,k=b(p,l),g+=k,g=-32768>g?-32768:32767<g?32767:g;e[f++]=g}a.u=h}var p=[6554,16384,26214,32767],
v=[29128,26215,23832,21846,20165,18725,17476,16384],r=[18431,20479,22527,24575,26623,28671,30719,32767],u=new function(){this.dp0=new Int16Array(280);this.mp=this.l_z2=this.z1=0;this.u=new Int16Array(8);this.larpp=[new Int16Array(8),new Int16Array(8)];this.j=0;this.nrp=40;this.v=new Int16Array(9);this.msr=0},w=new Int16Array(8),y=new Int16Array(4),A=new Int16Array(4),B=new Int16Array(4),D=new Int16Array(4),z=new Int16Array(52),F=new Int16Array(160),H=new Uint8Array(33),M=0;this.encode=function(d,
L,pa,vd){for(var ra=L,ma=0,qa=0;160>qa;qa++)ma=d[ra++],F[qa]=0>ma?32768*ma:32767*ma;O=!O;for(var K=0,sa=0,ua=0,Ia=0,wa=120,Fa=new Int16Array(50),J=new Int16Array(160),Na=0,Qa=0,Ka=u.z1,Aa=u.l_z2,Oa=u.mp,$a=0,nb=0,Pa=0,Va=0,Ja=0,Ua=0,ib=160;0!=ib;){ib--;var Va=F[Na++]>>3<<2<<16>>16,$a=Va-Ka<<16>>16,Ka=Va,Ja=$a,Ja=Ja<<15,nb=Aa>>15<<16>>16,Pa=Aa-(nb<<15)<<16>>16,Ja=Ja+b(Pa,32735),Ua=32735*nb,Aa=c(Ua,Ja),Ua=c(Aa,16384),nb=b(Oa,-28180),Oa=Ua>>15<<16>>16,ab=Oa+nb;J[Qa++]=-32768>ab?-32768:32767<ab?32767:
ab}u.z1=Ka;u.l_z2=Aa;u.mp=Oa;for(var Ga=0,W=0,cb=0,bb=0,jb=0,ha=0,Xb=0,ha=0;159>=ha;ha++)Xb=J[ha]+0,cb=-32768>Xb?-32768:32767<Xb?32767:Xb,cb>bb&&(bb=cb);jb=0==bb?0:4-e(bb<<16)<<16>>16;if(0<jb)switch(jb){case 1:for(ha=0;159>=ha;ha++)J[ha]=b(J[ha],16384);break;case 2:for(ha=0;159>=ha;ha++)J[ha]=b(J[ha],8192);break;case 3:for(ha=0;159>=ha;ha++)J[ha]=b(J[ha],4096);break;case 4:for(ha=0;159>=ha;ha++)J[ha]=b(J[ha],2048)}var Q=J[W];k([0,0,0,0,0,0,0,0,0],0,E,0,E.length);E[0]+=Q*J[W-0];Q=J[++W];E[0]+=Q*J[W-
0];E[1]+=Q*J[W-1];Q=J[++W];E[0]+=Q*J[W-0];E[1]+=Q*J[W-1];E[2]+=Q*J[W-2];Q=J[++W];E[0]+=Q*J[W-0];E[1]+=Q*J[W-1];E[2]+=Q*J[W-2];E[3]+=Q*J[W-3];Q=J[++W];E[0]+=Q*J[W-0];E[1]+=Q*J[W-1];E[2]+=Q*J[W-2];E[3]+=Q*J[W-3];E[4]+=Q*J[W-4];Q=J[++W];E[0]+=Q*J[W-0];E[1]+=Q*J[W-1];E[2]+=Q*J[W-2];E[3]+=Q*J[W-3];E[4]+=Q*J[W-4];E[5]+=Q*J[W-5];Q=J[++W];E[0]+=Q*J[W-0];E[1]+=Q*J[W-1];E[2]+=Q*J[W-2];E[3]+=Q*J[W-3];E[4]+=Q*J[W-4];E[5]+=Q*J[W-5];E[6]+=Q*J[W-6];Q=J[++W];E[0]+=Q*J[W-0];E[1]+=Q*J[W-1];E[2]+=Q*J[W-2];E[3]+=Q*J[W-
3];E[4]+=Q*J[W-4];E[5]+=Q*J[W-5];E[6]+=Q*J[W-6];E[7]+=Q*J[W-7];++W;for(Ga=W;160>Ga;++Ga)Q=J[Ga],E[0]+=Q*J[Ga-0],E[1]+=Q*J[Ga-1],E[2]+=Q*J[Ga-2],E[3]+=Q*J[Ga-3],E[4]+=Q*J[Ga-4],E[5]+=Q*J[Ga-5],E[6]+=Q*J[Ga-6],E[7]+=Q*J[Ga-7],E[8]+=Q*J[Ga-8];for(ha=0;9>ha;ha++)E[ha]<<=1;if(0<jb)for(ha=0;160>ha;ha++)J[ha]<<=jb;var Ba=new Int16Array(1),Yb=0,Ra=0,xa=new Int16Array(9),db=new Int16Array(9),mb=new Int16Array(9);if(0==E[0])for(Ra=0;8>Ra;Ra++)w[Ra]=0;else{Ba[0]=e(E[0]);for(Ra=0;8>=Ra;Ra++)xa[Ra]=E[Ra]<<Ba[0]>>
16;k(xa,0,mb,0,7);k(xa,0,db,0,8);for(var kb=1;8>=kb;kb++,Yb++){Ba[0]=db[1];Ba[0]=(0>Ba[0]?-32768==Ba[0]?32767:-Ba[0]:Ba[0])<<16>>16;if(db[0]<Ba[0]){for(Ra=kb;8>Ra;Ra++)w[Ra]=0;break}var Hb=Yb,yb;var Fb=Ba[0],lb=Fb,Sb=db[0],zb=0,Tb=15;if(0==Fb)yb=0;else{for(;0!=Tb;)Tb--,zb=zb<<17>>16,lb<<=1,lb>=Sb&&(lb-=Sb,zb++);yb=zb<<16>>16}w[Hb]=yb;0<db[1]&&(w[Yb]=-w[Yb]);if(8==kb)break;Ba[0]=b(db[1],w[Yb]);var Gb=db[0]+Ba[0];db[0]=-32768>Gb?-32768:32767<Gb?32767:Gb;for(var Wa=1;Wa<=8-kb;Wa++){Ba[0]=b(mb[Wa],w[Yb]);
var na=db[Wa+1]+Ba[0];db[Wa]=-32768>na?-32768:32767<na?32767:na;Ba[0]=b(db[Wa+1],w[Yb]);var Ib=mb[Wa]+Ba[0];mb[Wa]=-32768>Ib?-32768:32767<Ib?32767:Ib}}}for(var ya,ub=0;8>ub;ub++)ya=w[ub],ya=(0>ya?-32768==ya?32767:-ya:ya)<<16>>16,22118>ya?ya>>=1:31130>ya?ya-=11059:(ya-=26112,ya<<=2),w[ub]=0>w[ub]?-ya:ya;var eb=0;f(20480,0,31,-32,w,eb++);f(20480,0,31,-32,w,eb++);f(20480,2048,15,-16,w,eb++);f(20480,-2560,15,-16,w,eb++);f(13964,94,7,-8,w,eb++);f(15360,-1792,7,-8,w,eb++);f(8534,-341,3,-4,w,eb++);f(9036,
-1144,3,-4,w,eb++);var Ca=new Int16Array(8),wc=u.j,Ab=wc,Ab=Ab^1;u.j=Ab;var fb=u.larpp[wc],Eb=u.larpp[Ab],Zb=0;l(w,fb,Zb++,0,0,-32,13107);l(w,fb,Zb++,0,0,-32,13107);l(w,fb,Zb++,0,2048,-16,13107);l(w,fb,Zb++,0,-2560,-16,13107);l(w,fb,Zb++,0,94,-8,19223);l(w,fb,Zb++,0,-1792,-8,17476);l(w,fb,Zb++,0,-341,-4,31454);l(w,fb,Zb++,0,-1144,-4,29708);for(var Bb=0;8>Bb;Bb++){var Nc=(Eb[Bb]>>2<<16>>16)+(fb[Bb]>>2<<16>>16);Ca[Bb]=-32768>Nc?-32768:32767<Nc?32767:Nc;var Qb=Ca[Bb]+(Eb[Bb]>>1<<16>>16);Ca[Bb]=-32768>
Qb?-32768:32767<Qb?32767:Qb}m(Ca);n(u,Ca,13,J,0);for(var Jb=0;8>Jb;Jb++){var Sa=(Eb[Jb]>>1<<16>>16)+(fb[Jb]>>1<<16>>16);Ca[Jb]=-32768>Sa?-32768:32767<Sa?32767:Sa}m(Ca);n(u,Ca,14,J,13);for(var vb=0;8>vb;vb++){var Rb=(Eb[vb]>>2<<16>>16)+(fb[vb]>>2<<16>>16);Ca[vb]=-32768>Rb?-32768:32767<Rb?32767:Rb;var Vb=Ca[vb]+(fb[vb]>>1<<16>>16);Ca[vb]=-32768>Vb?-32768:32767<Vb?32767:Vb}m(Ca);n(u,Ca,13,J,27);for(var Oc=0;8>Oc;Oc++)Ca[Oc]=fb[Oc];m(Ca);n(u,Ca,120,J,40);for(var hc=u.dp0,Kb=0,Pb=0,fc=0;3>=fc;fc++,sa+=
13){for(var nc=J,pc=40*fc,xc=Fa,qc=hc,Gc=hc,rc=wa,sc=y,tc=B,va=ua++,ga=nc,za=pc,ba=qc,ca=rc,Cb=tc,Ic=sc,Ub=va,Y=0,dd=0,aa=new Int16Array(40),ob=0,$b=0,Xa=0,wb=0,Lb=0,Ya=0,Za=0,pb=0;39>=pb;pb++)Za=ga[pb+za],Za=(0>Za?-32768==Za?32767:-Za:Za)<<16>>16,Za>Lb&&(Lb=Za);Za=0;0!=Lb&&(Za=e(Lb<<16));Ya=6<Za?0:6-Za<<16>>16;for(pb=0;39>=pb;pb++)aa[pb]=ga[pb+za]>>Ya;ob=0;for(Y=dd=40;120>=Y;Y++){var G=0,I=1,G=aa[0]*ba[ca-Y],G=G+aa[1]*ba[I+ca-Y];I++;G+=aa[2]*ba[I+ca-Y];I++;G+=aa[3]*ba[I+ca-Y];I++;G+=aa[4]*ba[I+ca-
Y];I++;G+=aa[5]*ba[I+ca-Y];I++;G+=aa[6]*ba[I+ca-Y];I++;G+=aa[7]*ba[I+ca-Y];I++;G+=aa[8]*ba[I+ca-Y];I++;G+=aa[9]*ba[I+ca-Y];I++;G+=aa[10]*ba[I+ca-Y];I++;G+=aa[11]*ba[I+ca-Y];I++;G+=aa[12]*ba[I+ca-Y];I++;G+=aa[13]*ba[I+ca-Y];I++;G+=aa[14]*ba[I+ca-Y];I++;G+=aa[15]*ba[I+ca-Y];I++;G+=aa[16]*ba[I+ca-Y];I++;G+=aa[17]*ba[I+ca-Y];I++;G+=aa[18]*ba[I+ca-Y];I++;G+=aa[19]*ba[I+ca-Y];I++;G+=aa[20]*ba[I+ca-Y];I++;G+=aa[21]*ba[I+ca-Y];I++;G+=aa[22]*ba[I+ca-Y];I++;G+=aa[23]*ba[I+ca-Y];I++;G+=aa[24]*ba[I+ca-Y];I++;
G+=aa[25]*ba[I+ca-Y];I++;G+=aa[26]*ba[I+ca-Y];I++;G+=aa[27]*ba[I+ca-Y];I++;G+=aa[28]*ba[I+ca-Y];I++;G+=aa[29]*ba[I+ca-Y];I++;G+=aa[30]*ba[I+ca-Y];I++;G+=aa[31]*ba[I+ca-Y];I++;G+=aa[32]*ba[I+ca-Y];I++;G+=aa[33]*ba[I+ca-Y];I++;G+=aa[34]*ba[I+ca-Y];I++;G+=aa[35]*ba[I+ca-Y];I++;G+=aa[36]*ba[I+ca-Y];I++;G+=aa[37]*ba[I+ca-Y];I++;G+=aa[38]*ba[I+ca-Y];I++;G+=aa[39]*ba[I+ca-Y];G>ob&&(dd=Y<<16>>16,ob=G)}Ic[Ub]=dd;ob<<=1;ob>>=6-Ya;for(pb=$b=0;39>=pb;pb++)var Ta=0,Ta=ba[pb-dd+ca]>>3<<16>>16,$b=$b+Ta*Ta;$b<<=
1;if(0>=ob)Cb[Ub]=0;else if(ob>=$b)Cb[Ub]=3;else for(var Za=e($b),Xa=ob<<Za>>16<<16>>16,wb=$b<<Za>>16<<16>>16,Mb=0;2>=Mb&&!(Xa<=a(wb,p[Mb]));Mb++)Cb[Ub]=Mb;var Da=sc[va],Wb=qc,oa=nc,Pc=pc,yc=Gc,ec=xc,qb=rc,zc=0,la=0,Ha=0;switch(tc[va]){case 0:zc=3277;for(la=0;39>=la;la++)yc[la+qb]=b(zc,Wb[la-Da+qb]),Ha=oa[la+Pc]-yc[la+qb],ec[la+5]=-32768>Ha?-32768:32767<Ha?32767:Ha;break;case 1:zc=11469;for(la=0;39>=la;la++)yc[la+qb]=b(zc,Wb[la-Da+qb]),Ha=oa[la+Pc]-yc[la+qb],ec[la+5]=-32768>Ha?-32768:32767<Ha?32767:
Ha;break;case 2:zc=21299;for(la=0;39>=la;la++)yc[la+qb]=b(zc,Wb[la-Da+qb]),Ha=oa[la+Pc]-yc[la+qb],ec[la+5]=-32768>Ha?-32768:32767<Ha?32767:Ha;break;case 3:for(zc=32767,la=0;39>=la;la++)yc[la+qb]=b(zc,Wb[la-Da+qb]),Ha=oa[la+Pc]-yc[la+qb],ec[la+5]=-32768>Ha?-32768:32767<Ha?32767:Ha}for(var Dc=Fa,Uc=D,ic=A,oc=Ia++,Nb=z,Ec=sa,Fc=new Int16Array(13),ac=new Int16Array(13),jc=Dc,Ea=0,Db=0;39>=Db;Db++)Ea=4096,Ea+=-134*jc[Db+0]+-374*jc[Db+1]+2054*jc[Db+3]+5741*jc[Db+4]+8192*jc[Db+5]+5741*jc[Db+6]+2054*jc[Db+
7]+-374*jc[Db+9]+-134*jc[Db+10],Ea=Ea>>13<<16>>16,ka[Db]=-32768>Ea?-32768:32767<Ea?32767:Ea;var Vc=Fc,Wc=ic,Xc=oc,ta=0,Ac=0,Qc=0,kd=void 0,ta=0,kd=ta+=h(0,1)+h(0,2)+h(0,3)+h(0,4)+h(0,5)+h(0,6)+h(0,7)+h(0,8)+h(0,9)+h(0,10)+h(0,11)+h(0,12),ta=ta+h(0,0),Ac=ta<<=1,ta=0,ta=ta+(h(1,0)+h(1,1)+h(1,2)+h(1,3)+h(1,4)+h(1,5)+h(1,6)+h(1,7)+h(1,8)+h(1,9)+h(1,10)+h(1,11)+h(1,12)),ta=ta<<1;ta>Ac&&(Qc=1,Ac=ta);ta=0;ta+=h(2,0)+h(2,1)+h(2,2)+h(2,3)+h(2,4)+h(2,5)+h(2,6)+h(2,7)+h(2,8)+h(2,9)+h(2,10)+h(2,11)+h(2,12);ta<<=
1;ta>Ac&&(Qc=2,Ac=ta);ta=kd;ta+=h(3,12);ta<<=1;ta>Ac&&(Qc=3);for(var rb=0;12>=rb;rb++)Vc[rb]=ka[Qc+3*rb];Wc[Xc]=Qc;for(var Hc=Fc,$c=Nb,ld=Ec,bd=Uc,bc=oc,md=0,ed=0,Bc=0,Ma=0,nd=0,Jc=0,Rc=0,uc=0,sb=0,sb=0;12>=sb;sb++)Ma=Hc[sb],Ma=0>Ma?-32768==Ma?32767:-Ma:Ma,Ma>ed&&(ed=Ma);Rc=0;Ma=ed>>9<<16>>16;for(sb=md=0;5>=sb;sb++)md=0>=Ma?md|1:md|0,Ma=Ma>>1<<16>>16,0==md&&Rc++;var Ma=Rc+5<<16>>16,vc=(ed>>Ma<<16>>16)+(Rc<<3<<16>>16),Bc=-32768>vc?-32768:32767<vc?32767:vc,Cc=0,xb=0;15<Bc&&(Cc=(Bc>>3<<16>>16)-1<<16>>
16);xb=Bc-(Cc<<3)<<16>>16;if(0==xb)Cc=-4,xb=7;else{for(;7>=xb;)xb=(xb<<1|1)<<16>>16,Cc--;xb-=8}ea==ea?(X=Cc,da=xb):(fa=Cc,ia=xb);Rc=X;uc=da;nd=6-Rc<<16>>16;Jc=v[uc];for(sb=0;12>=sb;sb++)Ma=Hc[sb]<<nd<<16>>16,Ma=a(Ma,Jc),Ma=Ma>>12<<16>>16,$c[sb+ld]=Ma+4<<16>>16;da=uc;X=Rc;bd[bc]=Bc;var gb=Nb,fd=ac,gd=Ec,cc=0,od=0,qd=0,Yc=0,kc=0,rd=0;ea==ea?(od=r[da],kc=6-X<<16>>16):(od=r[ia],kc=6-fa<<16>>16);for(var qd=-32768>kc?-32768:32767<kc?32767:kc,kc=qd-1,lc=-32768>kc?-32768:32767<kc?32767:kc,Yc=16<=lc?0:-16>=
lc?-0:0>lc?g(1,-lc):1<<lc<<16>>16,Zc=ja=0;13>Zc;Zc++)cc=(gb[gd++]<<1)-7<<16>>16,cc=cc<<28>>16,cc=b(od,cc),rd=cc+Yc,cc=-32768>rd?-32768:32767<rd?32767:rd,fd[ja++]=g(cc,qd);var Ob=ac,tb=Dc,ad=ea,mc=13,pd=0,hb=0,hb=ad==ea?5:0;switch(ic[oc]){case 3:tb[hb++]=0;do tb[hb++]=0,tb[hb++]=0,tb[hb++]=Ob[pd++],--mc;while(0!=mc);break;case 2:do tb[hb++]=0,tb[hb++]=0,tb[hb++]=Ob[pd++],--mc;while(0!=mc);break;case 1:do tb[hb++]=0,tb[hb++]=Ob[pd++],tb[hb++]=0,--mc;while(0!=mc);break;case 0:do tb[hb++]=Ob[pd++],tb[hb++]=
0,tb[hb++]=0,--mc;while(0!=mc)}ad==ea&&(tb[hb++]=0);for(Kb=0;39>=Kb;Kb++)Pb=Fa[5+Kb]+hc[Kb+wa],hc[Kb+wa]=-32768>Pb?-32768:32767<Pb?32767:Pb;wa+=40}for(Kb=0;120>Kb;Kb++)hc[Kb]=hc[160+Kb];var q=0;O?(q=w[0]<<4|w[1]<<10,H[K++]=q>>4,q=q>>5|w[2]<<11,H[K++]=q>>7,q=q>>5|w[3]<<11,q=q>>4|w[4]<<12,H[K++]=q>>6,q=q>>4|w[5]<<12,q=q>>3|w[6]<<13,H[K++]=q>>7,q=q>>3|w[7]<<13,q=q>>7|y[0]<<9,H[K++]=q>>5,q=q>>2|B[0]<<14,q=q>>2|A[0]<<14,q=q>>6|D[0]<<10,H[K++]=q>>3,q=q>>3|z[0]<<13,H[K++]=q>>8,q=q>>3|z[1]<<13,q=q>>3|z[2]<<
13,q=q>>3|z[3]<<13,H[K++]=q>>7,q=q>>3|z[4]<<13,q=q>>3|z[5]<<13,q=q>>3|z[6]<<13,H[K++]=q>>6,q=q>>3|z[7]<<13,q=q>>3|z[8]<<13,H[K++]=q>>8,q=q>>3|z[9]<<13,q=q>>3|z[10]<<13,q=q>>3|z[11]<<13,H[K++]=q>>7,q=q>>3|z[12]<<13,q=q>>7|y[1]<<9,H[K++]=q>>5,q=q>>2|B[1]<<14,q=q>>2|A[1]<<14,q=q>>6|D[1]<<10,H[K++]=q>>3,q=q>>3|z[13]<<13,H[K++]=q>>8,q=q>>3|z[14]<<13,q=q>>3|z[15]<<13,q=q>>3|z[16]<<13,H[K++]=q>>7,q=q>>3|z[17]<<13,q=q>>3|z[18]<<13,q=q>>3|z[19]<<13,H[K++]=q>>6,q=q>>3|z[20]<<13,q=q>>3|z[21]<<13,H[K++]=q>>8,
q=q>>3|z[22]<<13,q=q>>3|z[23]<<13,q=q>>3|z[24]<<13,H[K++]=q>>7,q=q>>3|z[25]<<13,q=q>>7|y[2]<<9,H[K++]=q>>5,q=q>>2|B[2]<<14,q=q>>2|A[2]<<14,q=q>>6|D[2]<<10,H[K++]=q>>3,q=q>>3|z[26]<<13,H[K++]=q>>8,q=q>>3|z[27]<<13,q=q>>3|z[28]<<13,q=q>>3|z[29]<<13,H[K++]=q>>7,q=q>>3|z[30]<<13,q=q>>3|z[31]<<13,q=q>>3|z[32]<<13,H[K++]=q>>6,q=q>>3|z[33]<<13,q=q>>3|z[34]<<13,H[K++]=q>>8,q=q>>3|z[35]<<13,q=q>>3|z[36]<<13,q=q>>3|z[37]<<13,H[K++]=q>>7,q=q>>3|z[38]<<13,q=q>>7|y[3]<<9,H[K++]=q>>5,q=q>>2|B[3]<<14,q=q>>2|A[3]<<
14,q=q>>6|D[3]<<10,H[K++]=q>>3,q=q>>3|z[39]<<13,H[K++]=q>>8,q=q>>3|z[40]<<13,q=q>>3|z[41]<<13,q=q>>3|z[42]<<13,H[K++]=q>>7,q=q>>3|z[43]<<13,q=q>>3|z[44]<<13,q=q>>3|z[45]<<13,H[K++]=q>>6,q=q>>3|z[46]<<13,q=q>>3|z[47]<<13,H[K++]=q>>8,q=q>>3|z[48]<<13,q=q>>3|z[49]<<13,q=q>>3|z[50]<<13,H[K++]=q>>7,q=q>>3|z[51]<<13,H[K]=q>>12,M=H[K]):(q=M<<6|w[0]<<10,H[K++]=q>>6,q=q>>6|w[1]<<10,H[K++]=q>>8,q=q>>5|w[2]<<11,q=q>>5|w[3]<<11,H[K++]=q>>6,q=q>>4|w[4]<<12,q=q>>4|w[5]<<12,H[K++]=q>>6,q=q>>3|w[6]<<13,q=q>>3|w[7]<<
13,H[K++]=q>>8,q=q>>7|y[0]<<9,q=q>>2|B[0]<<14,H[K++]=q>>7,q=q>>2|A[0]<<14,q=q>>6|D[0]<<10,H[K++]=q>>7,q=q>>3|z[0]<<13,q=q>>3|z[1]<<13,q=q>>3|z[2]<<13,H[K++]=q>>6,q=q>>3|z[3]<<13,q=q>>3|z[4]<<13,H[K++]=q>>8,q=q>>3|z[5]<<13,q=q>>3|z[6]<<13,q=q>>3|z[7]<<13,H[K++]=q>>7,q=q>>3|z[8]<<13,q=q>>3|z[9]<<13,q=q>>3|z[10]<<13,H[K++]=q>>6,q=q>>3|z[11]<<13,q=q>>3|z[12]<<13,H[K++]=q>>8,q=q>>7|y[1]<<9,q=q>>2|B[1]<<14,H[K++]=q>>7,q=q>>2|A[1]<<14,q=q>>6|D[1]<<10,H[K++]=q>>7,q=q>>3|z[13]<<13,q=q>>3|z[14]<<13,q=q>>3|
z[15]<<13,H[K++]=q>>6,q=q>>3|z[16]<<13,q=q>>3|z[17]<<13,H[K++]=q>>8,q=q>>3|z[18]<<13,q=q>>3|z[19]<<13,q=q>>3|z[20]<<13,H[K++]=q>>7,q=q>>3|z[21]<<13,q=q>>3|z[22]<<13,q=q>>3|z[23]<<13,H[K++]=q>>6,q=q>>3|z[24]<<13,q=q>>3|z[25]<<13,H[K++]=q>>8,q=q>>7|y[2]<<9,q=q>>2|B[2]<<14,H[K++]=q>>7,q=q>>2|A[2]<<14,q=q>>6|D[2]<<10,H[K++]=q>>7,q=q>>3|z[26]<<13,q=q>>3|z[27]<<13,q=q>>3|z[28]<<13,H[K++]=q>>6,q=q>>3|z[29]<<13,q=q>>3|z[30]<<13,H[K++]=q>>8,q=q>>3|z[31]<<13,q=q>>3|z[32]<<13,q=q>>3|z[33]<<13,H[K++]=q>>7,q=
q>>3|z[34]<<13,q=q>>3|z[35]<<13,q=q>>3|z[36]<<13,H[K++]=q>>6,q=q>>3|z[37]<<13,q=q>>3|z[38]<<13,H[K++]=q>>8,q=q>>7|y[3]<<9,q=q>>2|B[3]<<14,H[K++]=q>>7,q=q>>2|A[3]<<14,q=q>>6|D[3]<<10,H[K++]=q>>7,q=q>>3|z[39]<<13,q=q>>3|z[40]<<13,q=q>>3|z[41]<<13,H[K++]=q>>6,q=q>>3|z[42]<<13,q=q>>3|z[43]<<13,H[K++]=q>>8,q=q>>3|z[44]<<13,q=q>>3|z[45]<<13,q=q>>3|z[46]<<13,H[K++]=q>>7,q=q>>3|z[47]<<13,q=q>>3|z[48]<<13,q=q>>3|z[49]<<13,H[K++]=q>>6,q=q>>3|z[50]<<13,q=q>>3|z[51]<<13,H[K++]=q>>8);for(var Sc=0,sd=O?32:33,Sc=
0;Sc<sd;Sc++)pa[Sc+vd]=H[Sc];return sd};var O=!1,L=[8,7,6,6,5,5,5,5,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],E=new Int32Array(9),X=0,da=0,fa=0,ia=0,ja=0,ea=0,ka=new Int16Array(40)}k.name="AUDIO_INPUT";k.process=function(d){var e=d.getByte(),g=null;switch(e){case 1:d=d.getLittleEndian32();g=new RdpBuffer(new Uint8Array(5),0,5);g.setByte(1);g.setLittleEndian32(d);g.markEnd();k.send(g);break;case 2:for(var h=d.getLittleEndian32(),p=d.getLittleEndian32(),g=[],u=[],e=0,p=hi5.audio.getAudioContext().sampleRate,e=0;e<h;e++){var f=new c;f.fromBuffer(d);
49==f.formatTag&&22050==f.nSamplesPerSec?(f.hasLocalSupport=!0,g.push(f)):1==f.formatTag&&f.nSamplesPerSec==p&&2==f.nChannels&&u.push(f)}k.send(r);d=0;p=g.length;0==p&&(g=u,p=u.length,v.directInput=!0);for(e=0;e<p;e++)d+=g[e].getSize();u=new RdpBuffer(new Uint8Array(1024),0,1024);u.setByte(2);u.setLittleEndian32(p);u.setLittleEndian32(d+9);for(e=0;e<p;e++)g[e].toBuffer(u);u.skipPosition(1024-d-9);u.markEnd();k.send(u);break;case 3:b(d);break;case 7:d=d.getLittleEndian32();A||(a(d),A=!1);break;default:console.log("audioInpt: invalid tag:"+
e)}};var e=!1;k.onclose=function(){e=!1;v&&v.close()};var r=new Uint8Array(1);r[0]=5;var A=!1,y=p.reconnectOnResize,u=null,v=new function(a){function b(c){n=!0;if(l.onopen)l.onopen(!0);u=new d;g=c;k=a.createMediaStreamSource(c);f=a.createJavaScriptNode?a.createJavaScriptNode(4096,1,1):a.createScriptProcessor(4096,1,1);f.onaudioprocess=function(a){if(e){a=a.inputBuffer.getChannelData(0);if(l.directInput){for(var b=new ArrayBuffer(16384),c=new Int16Array(b),d=0,f=0,g=0;4096>g;g++)f=0>a[g]?32768*a[g]:
32767*a[g],c[d++]=f,c[d++]=f;v.ondata(new Uint8Array(b),16384)}else p.addData(a,m);a.fill(0)}};c=a.createBiquadFilter();c.frequency.value=11025;k.connect(c);c.connect(f);f.connect(a.destination)}function c(){e||(g.getTracks&&g.getTracks()[0].stop(),f&&f.disconnect(),k&&k.disconnect(),n=!1)}var e=!1,g=null,k=null,f=null,l=this,m=a.sampleRate/22050,n=!1;this.directInput=!1;l=this;this.start=function(){if(!n)navigator.getUserMedia({audio:!0},b,function(a){e=n=!1;if(l.onopen)l.onopen(!1);console.log("Error on getUserMedia: "+
a)});else if(l.onopen)l.onopen(!0);e=!0};this.stop=function(){e=!1};this.close=function(){e=!1;p.reset();u=new d;setTimeout(c,8E3)};var p=new function(){function a(h){for(var k=d/160|0,m=0;m<k;m++){var n=u.encode(h,c,g,e);e+=n;e==f&&(e=0,l.ondata(g,f));c+=160;d-=160}b=0<d?h:null}var b=null,c=0,d=0,e=0,f=65*Math.floor(Math.floor(Math.floor(4096/m)/160)/2),g=new Uint8Array(f);this.reset=function(){d=c=e=0;b=null};this.addData=function(e,f){var g=e;if(1==f)e=g;else if(1>f)console.error("rate must be smaller than the original rate"),
e=void 0;else{for(var h=Math.round(g.length/f),h=new Float32Array(h),k=0,l=0;k<h.length;){for(var m=Math.round((k+1)*f),n=0,p=0;l<m&&l<g.length;l++)n+=g[l],p++;h[k]=n/p;k++;l=m}e=h}0==d?(d=e.length,c=0,a(e)):(g=e,h=d+g.length,k=new Float32Array(h),k.set(b.subarray(c)),k.set(g,d),c=0,d=h,a(k))}}}(hi5.audio.getAudioContext())})();p.addDynamicChannel(k)}}},rc=new je,Qa=new Gc,Le=new function(){function a(a,b,e,k,l,n){this.x=a;this.y=b;this.cx=e;this.cy=k;this.offset=l;this.data=n}var b=[];this.save=
function(c,d,e,k,l,n){c=new a(c,d,e,k,l,n);d=0;for(e=b.length;d<e;d++)if(!b[d]){b[d]=c;return}b.push(c)};this.restore=function(a,d,e,k,l){for(var n,m=0,h=b.length;m<h;m++)if((n=b[m])&&n.x==a&&n.y==d&&n.cx==e&&n.cy==k){if(n.offset==l)return a=n.data,b[m]=null,a;svGlobal.logger.warn("TODO: offset")}return null}},Hc=Array(20),Rb=0;this.getFileUrl=function(a){return p.modifyURL(jb()+"/DOWNLOAD?s="+sc+"&f="+a)};this.reconnect=function(a,b,c){c=c||!1;if(!(ka&&mb||c))return!1;B.minWidth&&a<B.minWidth&&(a=
B.minWidth);B.minHeight&&b<B.minHeight&&(b=B.minHeight);a&=-4;b&=-4;if(!c&&4>Math.abs(a-X)&&4>Math.abs(b-fa))return!1;mb=!1;svGlobal.logger.info("reconnecting...");F.send("8E0"+a+"\t"+b);return!0};this.notify=function(a,b){a="8E6"+a;b&&(a+="\t"+b.join(";"));F.send(a)};this.getUploadManager=function(){return Na};this.addSurface=function(a){A.hasSurface(a)||(uc||D.setContext(a.context),-1!=A.indexOf(a)&&a.railWin)||(cb&&a.setPlayerMode(),B.mouseMoveEmu&&(a.mouseMoveEmu=Fb(B.mouseMoveEmu)),a.setConfig(O),
A.addSurface(a),a.setSize(X,fa,qa?"hidden":null),a.setController(qe),a.setFastCopy(Fb(B.fastCopy)),a.setTouchpad(Fb(B.touchpad)),a.setClipboard(Fb(B.mapClipboard)),bd&&ne(a),B.invitation&&(A.setReadOnly(!0),btn=hi5.$("requestControl"))&&(btn.disabled=!1),a.run(parseInt(B.keyboard||1033,10)))};this.getRunninApps=function(){for(var a=[],b=0,c=A.length;b<c;b++)A[b].railWin.getMain(A.zOrders)&&a.push(A[b].railWin.getMain(A.zOrders).titleInfo);return a};this.startApp=function(a,b,c){F.send("8C2"+a+"\t"+
b+"\t"+c);var d=A[A.length-1];d&&(d.remoteApp=new oe(a,b,c))};this.startExitingApp=function(a){a=A.popWins(a);for(var b=a.length-1;0<=b;b--)A.addWin(a[b])};this.VirtualChannel=function(){return new Zc(143)};this.GatewayChannel=function(){return new Zc(28)};this.DynamicChannel=function(){return new Zc(64)};this.addChannel=function(a){Tb[a.name]=a};this.addGatewayChannel=function(a){Gb[a.name]=a};this.addDynamicChannel=function(a){ea.names.push(a.name);ea[a.name]=a;ea.count++};if(Fb(B.smartCard)){var fc=
new p.GatewayChannel,be=null;fc.name="SCARDSTB";fc.onopen=function(){be=document.getElementById(hi5.appcfg.clientAppletId||"clientApplet")};fc.process=function(a){var b=null;if(be){var c=a.getPosition();a=hi5.Base64.enc(a.getData(),a.getEnd()-c,c);try{a=be.deviceControl(a),b=hi5.Base64.dec(a,0)}catch(d){console.log(d)}}b||(b=[0]);a=new hi5.DataBuffer(b);a.markEnd(b.length);fc.send(a)};p.addGatewayChannel(fc)}this.run=function(){setTimeout(pe,5);sa.supportWebAudio&&sa.iOSFix()};this.getDesktop=function(){return D};
this.mouseDown=function(a,b,c){Aa&&F.send("80"+a+"\t"+b+"\t"+c)};this.mouseMove=function(a,b){Aa&&F.send("82"+a+"\t"+b)};this.mouseUp=function(a,b,c){Aa&&F.send("81"+a+"\t"+b+"\t"+c)};this.writeKeyCode=function(a,b){Aa&&F.send("8B"+(a?0:49152)+"\t"+b)};this.writeScancode=function(a,b){Aa&&("number"==typeof a?(F.send("840\t"+a),F.send("8449152\t"+a)):F.send("84"+(a?0:49152)+"\t"+b))};this.writeText=function(a){Aa&&F.send("86"+a)};this.writeRawInput=function(a){Aa&&F.send(a)};var ua=new RdpBuffer([],
0,0);this.sendPing=function(a){if(ka){var b=new Uint8Array(a?2+a.length:2);b[0]=146;b[1]=0;a&&b.set(a,2);F.send(b.buffer)}};this.startPing=function(a){zb.setInterval(a)};var Oa=null,ze=0;this.play=function(){F.send("F3")};this.pause=function(){F.send("F2")};this.scan=function(a){F.send("F4"+(a?"1":"0"))};this.seek=function(a){var b=A.getFocused();b&&ka&&(F.send("F4"+(a?"1":"0")+"\t"+(a/b.getScale()|0)),D.pause(!0))};Fa=$a=Ia=0;wa=22050;var ye=!1;this.showMessage=function(a,b,c){p.displayMsg&&a&&((b=
b||A.getFocused())?b.showMessage(a,c):hi5.notifications.notify({msg:a,timeout:c||0}))};var Od=new function(){var a=0,b=0,c=[0],d=new RdpBuffer(c,0,0);this.addFragement=function(d,k){bb(d.getData(),d.getPosition(),c,b,k);b+=k;a+=k};this.clearFragements=function(){d.setPosition(0);d.markEnd(a);b=a=0;return d}},vc=new function(){var a=Va(10240),b=0,c=yb(10240),d=0,e=yb(10240),k=0,l=yb(10240),n=0,m=yb(0),h=0;this.getData=function(){return a};this.getDataSize=function(){return b};this.resetData=function(c){a.length<
c&&(a=Va(c));b=c;return a};this.resetLumaPlane=function(a){c.length<a&&(c=yb(a));d=a;return c};this.getLumaPlanceSize=function(){return d};this.resetOrangeChromaPlane=function(a){e.length<a&&(e=yb(a));k=a;return e};this.getOrangeChromaPlane=function(){return k};this.resetGreenChromaPlane=function(a){l.length<a&&(l=yb(a));n=a;return l};this.getGreenChromaPlane=function(){return n};this.resetAlphaPlane=function(a){m.length<a&&(m=yb(a));h=a;return m};this.getAlphaPlane=function(){return h}},Kf=new function(){var a=
new Mf,b=new Lf,c=new Nf;this.decode=function(b,k){for(var l=0,n=0,n=0,m=b.getPosition()+k;b.getPosition()<m;){l=b.getLittleEndian16();n=b.getLittleEndian32();if(0==n)break;n=b.getPosition()-6+n;switch(l){case 52416:l=b;l.getLittleEndian32();l.getLittleEndian16();break;case 52417:b.skipPosition(4);break;case 52418:for(var l=b,h=l.getByte(),g=0;g<h;g++){var p=l.getByte(),r=l.getLittleEndian16(),y=l.getLittleEndian16();svGlobal.logger.info("Channel, id:"+p+" width:"+r+" height:"+y)}break;case 52419:l=
b;l.skipPosition(2);c.ctxId=l.getByte();c.tileSize=l.getLittleEndian16();c.setProperties(l.getLittleEndian16());break;case 52420:b.skipPosition(10);break;case 52421:b.skipPosition(2);break;case 52422:l=b;l.skipPosition(2);l.skipPosition(1);h=l.getLittleEndian16();g=a.resetRects(h);for(p=0;p<h;p++)r=g[p],r.x=l.getLittleEndian16(),r.y=l.getLittleEndian16(),r.width=l.getLittleEndian16(),r.height=l.getLittleEndian16();l.skipPosition(4);break;case 52423:l=b;h=c;l.skipPosition(6);g=l.getLittleEndian16();
h.cct=g>>>4&3;h.xft=g>>>6&15;h.et=g>>>10&15;h.qt=g>>>14&3;y=l.getByte();l.skipPosition(1);g=l.getLittleEndian16();l.skipPosition(4);for(var p=Array(10*y),u=0,v=void 0,r=void 0,r=0;r<y;r++)v=l.getByte(),p[u++]=v&15,p[u++]=v>>>4,v=l.getByte(),p[u++]=v&15,p[u++]=v>>>4,v=l.getByte(),p[u++]=v&15,p[u++]=v>>>4,v=l.getByte(),p[u++]=v&15,p[u++]=v>>>4,v=l.getByte(),p[u++]=v&15,p[u++]=v>>>4;y=a.resetTiles(g);for(r=0;r<g;r++)u=y[r],u.readHeaderfromStream(l),d(h,l,p,u.YLen,10*u.quantIdxY,u.CbLen,10*u.quantIdxCb,
u.CrLen,10*u.quantIdxCr,u.data);break;default:System.out.println("unknown blockType 0x%X"+l)}b.setPosition(n)}return a};var d=b.decodeRgb;this.getResult=function(){return a}},Ee=(new function(){function a(a,c,d,e,k){if(0==d)ab(e,0,k,255);else if(d<k){var l=d=0,n=0,l=k;for(k=0;4<l;)n=a[c++],5==l?(e[k++]=n,l--):n==a[c]?(c++,255>(a[c]&255)?(d=a[c++]&255,d+=2):(c++,d=(a[c+3]&255)<<24|(a[c+2]&255)<<16|(a[c+1]&255)<<8|a[c]&255,c+=4),ab(e,k,k+d,n),k+=d,l-=d):(e[k++]=n,l--);for(d=0;4>d;d++)e[k++]=a[c++]}else bb(a,
c,e,0,k)}this.process=function(b,c,d,e,k){var l=b.getLittleEndian32(),n=b.getLittleEndian32(),m=b.getLittleEndian32();b.skipPosition(4);var h=b.getByte();c=b.getByte();b.skipPosition(2);var g=b.getData(),p=b.getPosition();b=d*e;var r=4*b;b=k.resetData(b);var y=d+(~(d&7)+1&7),u=e+(~(e&1)+1&1),r=y*u,v=k.resetLumaPlane(r),t=k.resetOrangeChromaPlane(r);k=k.resetGreenChromaPlane(r);var r=d*e,u=0<c?(y>>1)*(u>>1):r,x=0<c?u:r;a(g,p,l,v,0<c?y*e:r);p+=l;a(g,p,n,t,u);a(g,p+n,m,k,x);for(var A=p=g=m=n=l=0,B=0,
C=0,r=A=u=y=0,x=d+(~(d&7)+1&7),h=h-1,n=0;n<e;n++)for(0<c?(m=n*x,g=(n>>1)*(x>>1),p=(n>>1)*(x>>1)):(m=n*d,g=n*d,p=n*d),l=0;l<d;l++)A=v[m]&255,B=(t[g]&255)<<h<<24>>24,C=k[p]<<h<<24>>24,y=A+B-C,u=A+C,A=A-B-C,A=0>A?0:255<A?255:A,u=0>u?0:255<u?255:u,y=0>y?0:255<y?255:y,b[r++]=4278190080|A<<16|u<<8|y,m++,g+=0<c?l%2:1,p+=0<c?l%2:1}}).process,He=new function(){var a=[{d:507,c:"text"}];this.distance=function(a,c){for(var d=0,e=0,k=a.length;e<k;e++)0!=a[e]&&(d+=e%c+(e/c|0));return d};this.getName=function(b,
c){for(var d=He.distance(b,c),e=0,k=a.length;e<k;e++)if(128>Math.abs(d-a[e].d))return a[e].c;return null}},Rf=[1,2,1,0,0,0,0,1,1,2,1,1,0,2,3,1,2,2,2,2,1,2,1,0,2,1,2,3],Pb={readVar4Bytes:function(a){var b=a.getByte(),c=0;switch((b&192)>>6){case 0:c=b&63;break;case 1:c=(b&63)<<8|a.getByte();break;case 2:c=(b&63)<<16;b=a.getByte();c|=b<<8;b=a.getByte();c|=b;break;case 3:c=(b&63)<<24,b=a.getByte(),c|=b<<16,b=a.getByte(),c|=b<<8,b=a.getByte(),c|=b}return c},readVar2Bytes:function(a){var b=a.getByte();
return 0!=(b&128)?(b&127)<<8|a.getByte():b}};this.close=ec;hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(ec):window.addEventListener("unload",ec,!1);var da=16777215}svGlobal.Rdp=Rdp;var RdpBuffer=hi5.DataBuffer;
