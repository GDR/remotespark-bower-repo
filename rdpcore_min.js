function RdpGeneral(z,I,Q,m,w,ea,n){function P(){var d=0;var a=0;var c=0;var W=0;var ia=0;var b=0;this.on=false;this.verify=function(b,y,f,e){if(b==d&&y==a&&f==c&&e==W){if(!this.on){ia++;if(ia>3)this.on=true}}else{ia=0;this.on=false;d=b;a=y;c=f;W=e}}}function x(d){return d=="on"||d=="true"}function h(d){return d=="off"||d=="false"}function g(){var d=O.gateway;if(O.ongetgatewayaddress)d=O.ongetgatewayaddress(d);return d}function B(){return la.displayName||la.server||la.symlink||la.id||"undefined"}
function C(d){return d&~3}function D(d){var a=d>>8&248|d>>13&7;var c=d>>3&252|d>>9&3;var W=d<<3&248|d>>2&7;return 4278190080|W<<16|c<<8|a}function e(d){return 4278190080|da.paletteRdp[2][d]<<16|da.paletteRdp[1][d]<<8|da.paletteRdp[0][d]}function v(d){return 4278190080|d}function b(d){return 4278190080|d}function k(d,a){switch(d){case 16:sa=D;Ia=rdpBitmap.decompressInt16;break;case 8:sa=e;break;case 24:sa=b;Ia=rdpBitmap.decompressInt24;break;case 32:sa=v;Ia=rdpBitmap.decompressInt32;break;case 15:if(!la.invitation)console.log("15 bit color is not supported anymore.");
return false;default:return false}m=d;Oa=(d+7)/8>>0;if(a&&O.onColorChange)O.onColorChange(d);return true}function R(d,a,c){I=d;Q=a;fa=0,ga=0,ba=I-1,ca=Q-1;if(O.onresolutionchange&&c)O.onresolutionchange(d,a)}function u(d){if(Da)return;ha.send(d)}function S(d,a){if(a==1)return d;else if(a<1){console.error("rate must be smaller than the original rate");return}var c=Math.round(d.length/a);var W=new Float32Array(c);var ia=0;for(var b=0;ia<W.length;){var y=Math.round((ia+1)*a);var f=0;var e=0;for(var r=
b;r<y&&r<d.length;r++){f+=d[r];e++}W[ia]=f/e;ia++;b=y}return W}function Y(d,a,c,W,ia,b){this.data=d;this.left=W;this.top=ia;this.width=a;this.height=c;this.bitsperpixel=b;this.bytesperpixel=Math.floor((b+7)/8)}function G(d){if(O.onerror)O.onerror(d)}function J(d){if(O.oninfo)O.oninfo(d)}function A(){this.xOrigin=0;this.yOrigin=0;this.style=0;this.pattern=new Array(8);this.toStream=function(d){d.setByte(this.xOrigin);d.setByte(this.yOrigin);d.setByte(this.style);d.setBytes(this.pattern)};this.fromStream=
function(d){this.xOrigin=d.getByte();this.yOrigin=d.getByte();this.style=d.getByte();this.pattern=d.getBytes(8)};this.byteLength=function(){return 11}}function p(){this.left=0;this.right=0;this.top=0;this.bottom=0;this.toStream=function(d){d.setLittleEndian16(this.left);d.setLittleEndian16(this.right);d.setLittleEndian16(this.top);d.setLittleEndian16(this.bottom)};this.fromStream=function(d){this.left=d.getLittleEndian16();this.right=d.getLittleEndian16();this.top=d.getLittleEndian16();this.bottom=
d.getLittleEndian16()};this.byteLength=function(){return 8}}function L(){this.left=0;this.right=0;this.top=0;this.bottom=0;this.offset=0;this.action=0;this.toStream=function(d){d.setLittleEndian16(this.left);d.setLittleEndian16(this.right);d.setLittleEndian16(this.top);d.setLittleEndian16(this.bottom);d.setLittleEndian32(this.offset);d.setByte(this.action)};this.fromStream=function(d){this.left=d.getLittleEndian16();this.right=d.getLittleEndian16();this.top=d.getLittleEndian16();this.bottom=d.getLittleEndian16();
this.offset=d.getLittleEndian32();this.action=d.getByte()};this.byteLength=function(){return 13}}function M(){this.x=0;this.y=0;this.cx=0;this.cy=0;this.opcode=0;this.toStream=function(d){d.setLittleEndian16(this.x);d.setLittleEndian16(this.y);d.setLittleEndian16(this.cx);d.setLittleEndian16(this.cy);d.setByte(this.opcode)};this.fromStream=function(d){this.x=d.getLittleEndian16();this.y=d.getLittleEndian16();this.cx=d.getLittleEndian16();this.cy=d.getLittleEndian16();this.opcode=d.getByte()};this.byteLength=
function(){return 9}}function K(d,a,c,W,ia){this.offset=d;this.baseLine=a;this.width=c;this.height=W;this.fontData=ia}function f(){this.mixmode=0;this.startX=0;this.startY=0;this.endX=0;this.endY=0;this.backgroundColor=0;this.opcode=0;this.pen=new ma;this.toStream=function(d){d.setLittleEndian16(this.mixmode);d.setLittleEndian16(this.startX);d.setLittleEndian16(this.startY);d.setLittleEndian16(this.endX);d.setLittleEndian16(this.endY);d.setLittleEndian32(this.backgroundColor);d.setByte(this.opcode);
this.pen.toStream(d)};this.fromStream=function(d){this.mixmode=d.getLittleEndian16();this.startX=d.getLittleEndian16();this.startY=d.getLittleEndian16();this.endX=d.getLittleEndian16();this.endY=d.getLittleEndian16();this.backgroundColor=d.getLittleEndian32();this.opcode=d.getByte();this.pen.fromStream(d)};this.byteLength=function(){return 15+this.pen.byteLength()}}function H(){this.x=0;this.y=0;this.cx=0;this.cy=0;this.opcode=0;this.srcX=0;this.srcY=0;this.colorTable=0;this.cacheID=0;this.cacheIDX=
0;this.toStream=function(d){d.setLittleEndian16(this.x);d.setLittleEndian16(this.y);d.setLittleEndian16(this.cx);d.setLittleEndian16(this.cy);d.setByte(this.opcode);d.setLittleEndian16(this.srcX);d.setLittleEndian16(this.srcY);d.setByte(this.cacheID);d.setByte(this.colorTable);d.setLittleEndian16(this.cacheIDX)};this.fromStream=function(d){this.x=d.getLittleEndian16();this.y=d.getLittleEndian16();this.cx=d.getLittleEndian16();this.cy=d.getLittleEndian16();this.opcode=d.getByte();this.srcX=d.getLittleEndian16();
this.srcY=d.getLittleEndian16();this.cacheID=d.getByte();this.colorTable=d.getByte();this.cacheIDX=d.getLittleEndian16()};this.byteLength=function(){return 17}}function na(d,a,c,W,ia){this.bits=d;this.size=a;this.red=c;this.green=W;this.blue=ia}function Ea(){this.x=0;this.y=0;this.cx=0;this.cy=0;this.opcode=0;this.backgroundColor=0;this.foregroundColor=0;this.brush=new A;this.toStream=function(d){d.setLittleEndian16(this.x);d.setLittleEndian16(this.y);d.setLittleEndian16(this.cx);d.setLittleEndian16(this.cy);
d.setByte(this.opcode);d.setLittleEndian32(this.backgroundColor);d.setLittleEndian32(this.foregroundColor);this.brush.toStream(d)};this.fromStream=function(d){this.x=d.getLittleEndian16();this.y=d.getLittleEndian16();this.cx=d.getLittleEndian16();this.cy=d.getLittleEndian16();this.opcode=d.getByte();this.backgroundColor=d.getLittleEndian32();this.foregroundColor=d.getLittleEndian32();this.brush.fromStream(d)};this.byteLength=function(){return 17+this.brush.byteLength()}}function ma(){this.style=0;
this.width=0;this.color=0;this.toStream=function(d){d.setByte(this.style);d.setByte(this.width);d.setLittleEndian32(this.color)};this.fromStream=function(d){this.style=d.getByte();this.width=d.getByte();this.color=d.getLittleEndian32()};this.byteLength=function(){return 6}}function q(){this.x=0;this.y=0;this.flags=0;this.foregroundColor=0;this.lines=0;this.opcode=0;this.dataSize=0;this.data=[];this.toStream=function(d){d.setLittleEndian16(this.x);d.setLittleEndian16(this.y);d.setByte(this.opcode);
d.setLittleEndian32(this.foregroundColor);d.setByte(this.lines);d.setByte(this.dataSize);if(this.dataSize)d.setBytes(this.data)};this.fromStream=function(d){this.x=d.getLittleEndian16();this.y=d.getLittleEndian16();this.opcode=d.getByte();this.foregroundColor=d.getLittleEndian32();this.lines=d.getByte();this.dataSize=d.getByte();if(this.dataSize)this.data=d.getBytes(this.dataSize)};this.byteLength=function(){return 11+this.dataSize}}function l(){this.x=0;this.y=0;this.cx=0;this.cy=0;this.color=0;
this.toStream=function(d){d.setLittleEndian16(this.x);d.setLittleEndian16(this.y);d.setLittleEndian16(this.cx);d.setLittleEndian16(this.cy);d.setLittleEndian32(this.color)};this.fromStream=function(d){this.x=d.getLittleEndian16();this.y=d.getLittleEndian16();this.cx=d.getLittleEndian16();this.cy=d.getLittleEndian16();this.color=d.getLittleEndian32()};this.byteLength=function(){return 12}}function Z(){this.x=0;this.y=0;this.cx=0;this.cy=0;this.opcode=0;this.srcX=0;this.srcY=0;this.toStream=function(d){d.setLittleEndian16(this.x);
d.setLittleEndian16(this.y);d.setLittleEndian16(this.cx);d.setLittleEndian16(this.cy);d.setByte(this.opcode);d.setLittleEndian16(this.srcX);d.setLittleEndian16(this.srcY)};this.fromStream=function(d){this.x=d.getLittleEndian16();this.y=d.getLittleEndian16();this.cx=d.getLittleEndian16();this.cy=d.getLittleEndian16();this.opcode=d.getByte();this.srcX=d.getLittleEndian16();this.srcY=d.getLittleEndian16()};this.byteLength=function(){return 13}}function ka(){this.flags=0;this.mixmode=0;this.foregroundColor=
0;this.backgroundColor=0;this.x=0;this.y=0;this.unknown=0;this.font=0;this.clipLeft=0;this.clipTop=0;this.clipRight=0;this.clipBottom=0;this.boxLeft=0;this.boxTop=0;this.boxRight=0;this.boxBottom=0;this.opcode=0;this.length=0;this.text=null;this.toStream=function(d){d.setByte(this.font);d.setByte(this.flags);d.setByte(this.opcode);d.setByte(this.mixmode);d.setLittleEndian32(this.foregroundColor);d.setLittleEndian32(this.backgroundColor);d.setLittleEndian16(this.clipLeft);d.setLittleEndian16(this.clipTop);
d.setLittleEndian16(this.clipRight);d.setLittleEndian16(this.clipBottom);d.setLittleEndian16(this.boxLeft);d.setLittleEndian16(this.boxTop);d.setLittleEndian16(this.boxRight);d.setLittleEndian16(this.boxBottom);d.setLittleEndian16(this.x);d.setLittleEndian16(this.y);d.setByte(this.length);if(this.length)d.setBytes(this.text)};this.fromStream=function(d){this.font=d.getByte();this.flags=d.getByte();this.opcode=d.getByte();this.mixmode=d.getByte();this.foregroundColor=d.getLittleEndian32();this.backgroundColor=
d.getLittleEndian32();this.clipLeft=d.getLittleEndian16();this.clipTop=d.getLittleEndian16();this.clipRight=d.getLittleEndian16();this.clipBottom=d.getLittleEndian16();this.boxLeft=d.getLittleEndian16();this.boxTop=d.getLittleEndian16();this.boxRight=d.getLittleEndian16();this.boxBottom=d.getLittleEndian16();this.x=d.getLittleEndian16();this.y=d.getLittleEndian16();this.length=d.getByte();if(this.length)this.text=d.getBytes(this.length)};this.byteLength=function(){return 33+this.length}}function Pa(){this.orderType=
0;this.bounds=new p;this.destBlt=new M;this.patBlt=new Ea;this.screenBlt=new Z;this.line=new f;this.rectangle=new l;this.deskSave=new L;this.memBlt=new H;this.polyLine=new q;this.text2=new ka;this._line=new hi5.graphic.Line;this.paletteRdp=null;this.toPDU=function(){var d=4+this.bounds.byteLength()+this.destBlt.byteLength()+this.patBlt.byteLength()+this.screenBlt.byteLength()+this.line.byteLength()+this.rectangle.byteLength()+this.deskSave.byteLength()+this.memBlt.byteLength()+this.polyLine.byteLength()+
this.text2.byteLength()+14+10;var a=new Uint8Array(d);a[0]=29;a[2]=1;a[3]=3;var c=new hi5.DataBuffer(a,0,d);c.skipPosition(4);this.bounds.toStream(c);this.destBlt.toStream(c);this.patBlt.toStream(c);this.screenBlt.toStream(c);this.line.toStream(c);this.rectangle.toStream(c);this.deskSave.toStream(c);this.memBlt.toStream(c);this.polyLine.toStream(c);this.text2.toStream(c);c.setLittleEndian16(fa);c.setLittleEndian16(ga);c.setLittleEndian16(ba);c.setLittleEndian16(ca);c.setLittleEndian32(ua);c.setByte(this.orderType);
c.setByte(m);Ja.toStream(c);return a};this.fromStream=function(d){this.bounds.fromStream(d);this.destBlt.fromStream(d);this.patBlt.fromStream(d);this.screenBlt.fromStream(d);this.line.fromStream(d);this.rectangle.fromStream(d);this.deskSave.fromStream(d);this.memBlt.fromStream(d);this.polyLine.fromStream(d);this.text2.fromStream(d);fa=d.getLittleEndian16();ga=d.getLittleEndian16();ba=d.getLittleEndian16();ca=d.getLittleEndian16();ua=d.getLittleEndian32();this.orderType=d.getByte();k(d.getByte(),true);
Ja.fromStream(d)}}function a(){oa=false;Ua=false;jb();da=new Pa;ua=0;if(qa)qa.reset()}function kb(d,a){function c(d){a(false,d.target.responseText)}function W(d){a(true)}var ia=a?true:false;var b=new XMLHttpRequest;if(ia){b.addEventListener("load",c);b.addEventListener("error",W);b.addEventListener("abort",W)}b.open("GET",d,ia);b.setRequestHeader("Content-Type","text/plain;charset=UTF-8");b.send(null);return ia?"":b.responseText}function lb(d){var a=this;if(!d)d=143;this.send=function(c){var W=!!c.buffer;
var b=W?c:c.getData();var y=d==64;var f=W?b.length:c.getEnd()||b.length;if(f<b.length)if(W)b=b.subarray(0,f);else b=b.slice(0,f);var e=y?5:9;var r=e+f;var l=new Uint8Array(r);l[0]=d;if(y){l[1]=a.id;l[2]=a.id>>8;l[3]=a.id>>16;l[4]=a.id>>24}else{var F=a.name;var q=Math.min(F.length,8);for(var g=0;g<q;g++)l[1+g]=F.charCodeAt(g)}l.set(b,e);u(l.buffer)};this.name="";this.flags=0;this.id=0;this.count=0}function Va(){function d(d){xa=new RecordingManager;var a=d.user.length>0?d.server+"_"+d.user:d.server;
var c={name:a,width:I,height:Q,color:m,namesuffix:".rdpv",filetag:"RDPV",duration:0};xa.setHeader(c)}if(oa)return;Ua=false;if(Da)ha=Da;else{if(O.oncreatewebsocket)ha=O.oncreatewebsocket(z);else{var a=O.mode==0&&n?z.substring(0,z.indexOf("?"))+"?_METHOD=post":z;ha=new WebSocket(a,"rdp")}if("binaryType"in ha)ha.binaryType="arraybuffer"}svGlobal.logger.info(z);ha.onopen=function(d){oa=true;if(O.onopen)O.onopen();u("87"+navigator.userAgent)};if(la["recording"]=="on")d(la);ha.onmessage=X;ha.onclose=Wa;
ha.onerror=O.onerror}function ya(d){var a=Jb(d);za.attach(a,0,a.length);return za}function X(d){var a;var c=d.data;if(typeof c!="string"){var W=new Uint8Array(c);if(xa!=null)xa.add(new RecordingObj(W,0,c.byteLength,-1));za.attach(W,0,c.byteLength);a=za.getLittleEndian16();switch(a){case 29:ta(za);break;case 48:if(O.onSlowPath)O.onSlowPath();N(za);break;case 49:if(O.onFastPath)O.onFastPath();Aa(za);break;case 65:U(za);break;default:O.onmessage(d)}}else{a=parseInt(c.substring(0,2),16);var b=c.substring(2);
switch(a){case 0:E();break;case 15:Xa(b);case 26:Kb(b);default:O.onmessage(d)}}}function U(d){var a=d.getPosition();var c=d.getByte();var W=d.getByte();seqNoLow=d.getByte();seqNoHigh=d.getByte();reqType=d.getLittleEndian16,out=null,payloadLen=0,payload=null,baseRTT=0,bandwidth=0,averageRTT=0;if(W!=0){svGlobal.logger.warn("invalid msg channel data");return}switch(reqType){case 1:case 4097:out=new Uint8Array(7);out[0]=65;out.set(d.getData().subarray(a,a+4),1);out[5]=0;out[6]=0;u(out.buffer);break;case 20:case 276:case 4116:break;
case 2:if(c==8){payloadLen=d.getLittleEndian16();payload=d.getByte(payloadLen)}else svGlobal.logger.warn("Invalid payload");break;case 43:if(c==8){payloadLen=d.getLittleEndian16();payload=d.getByte(payloadLen)}else svGlobal.logger.warn("Invalid payload");break;case 1065:case 1577:break;case 2112:baseRTT=d.getLittleEndian32();averageRTT=d.getLittleEndian32();break;case 2176:bandwidth=d.getLittleEndian32();averageRTT=d.getLittleEndian32();break;case 2240:baseRTT=d.getLittleEndian32();bandwidth=d.getLittleEndian32();
averageRTT=d.getLittleEndian32();break;default:svGlobal.logger.warn("Invalid msg channel type:"+reqType)}}function va(d,a){var c=d.length+8;var W=new Uint8Array(c);var b=new hi5.DataBuffer(W,0,c);W[0]=29;W[2]=1;W[3]=a;b.skipPosition(4);b.setLittleEndian32(d.length);b.setAscllString(d);return W}function t(){if(Ka)return;if(O)if(O.onready)O.onready()}function ta(d){var a=d.getByte();var c=0;var W=0;var b=0;var y=0;var f;var e;if(a==0){svGlobal.logger.info("Send history...");e=new Uint8Array(4);e[0]=
29;e[2]=1;e[3]=1;ha.send(e.buffer);if(ja)ja.begin("his_mppc");e=qa.toPDU();if(e)ha.send(e.buffer);if(ja)ja.end("his_mppc");if(ja)ja.begin("his_order");ha.send(da.toPDU().buffer);if(ja)ja.end("his_order");w.getHistory(u)}else{a=d.getByte();switch(a){case 0:svGlobal.logger.info("Received history");if(d.has(1)&&d.getByte()==1)if(O.sessionInfo.suppressOutput);else O.refreshOutput(0,0,I-1,Q-1);if(O.onHistoryReceived)O.onHistoryReceived();break;case 1:break;case 2:if(ja)ja.begin("his_mppc_dec");qa.fromStream(d);
if(ja)ja.end("his_mppc_dec");break;case 3:if(ja)ja.begin("his_order_dec");da.fromStream(d);if(ja)ja.end("his_order_dec");break;default:w.setHistory(a,d)}}if(O.onReqHistory)O.onReqHistory()}function E(){var d=z.substring(z.indexOf("?")+1);u("00"+d);u("87"+navigator.userAgent)}function Xa(d){if(!O)return;Ba=false;mb=false;da=new Pa;t()}function N(d){var a=d.getLittleEndian16();var c=d.getByte();var b=d.getByte();var ia=d.getLittleEndian16();var y=(b&32)!=0;if(y)ia-=18;var e=null;if(y){var f=qa.dec(d.getData(),
d.getPosition(),ia,b);e=qa.getData()}else e=d;Ya(c,e)}function Ya(d,a){switch(d){case 2:La(a);break;case 20:break;case 31:Ba=false;break;case 27:Ma(a);break;case 34:break;case 38:Za(a);Ba=false;break;case 40:O.sendKeyboardSynchronize(x(la.scrollLock),x(la.numLock),x(la.capsLock));Ba=false;break;case 47:$a(a);break;case 50:a.skipPosition(4);break;case 54:nb(a);break;case 55:Qa(a);break;default:svGlobal.logger.warn("Unimplemented Data PDU type "+d)}}function Qa(d){var a=d.getLittleEndian32();var c=
0;var b=0;var ia=0;var e=0;var y=0;var f=0;var r=0;var l=0;for(var F=0;F<a;F++){c=d.getLittleEndian32();b=d.getLittleEndian32();ia=d.getLittleEndian32();e=d.getLittleEndian32();d.skipPosition(4);y=Math.min(c,y);f=Math.max(f,ia);r=Math.min(b,r);l=Math.max(l,e)}c=f-y+1;b=l-r+1;svGlobal.logger.warn("monitor, count:"+a+" w:"+c+" h:"+b);R(c,b,true)}function nb(d){var a=d.getLittleEndian32().toString(16).toUpperCase();svGlobal.logger.warn("server status code:"+a)}function La(d){var a=d.getLittleEndian16();
switch(a){case 0:d.skipPosition(2);var c=d.getLittleEndian16();d.skipPosition(2);ob(d,c);break;case 1:pb(d);break;case 2:qb(d);break;case 3:break;default:svGlobal.logger.warn("Unimplemented Update type "+a)}}function Ma(d){var a=0;var c=0;var b=0;a=d.getLittleEndian16();d.skipPosition(2);switch(a){case 3:c=d.getLittleEndian16();b=d.getLittleEndian16();O.onMoveCursor(c,b,true);break;case 6:rb(d);break;case 7:sb(d);break;case 1:T(d);break;case 8:tb(d);default:}}function T(d){var a=d.getLittleEndian16();
switch(a){case 0:ub();break;default:svGlobal.logger.warn("XXX system pointer message "+a)}}function Na(d,a){var c;var b;var y=O.sessionInfo;switch(a){case 0:d.skipPosition(4);y.domain=d.getUnicodeString(52,true);d.skipPosition(4);y.userName=d.getUnicodeString(512,true);y.sessionId=d.getLittleEndian32();break;case 1:y.version=d.getLittleEndian16();d.skipPosition(4);y.sessionId=d.getLittleEndian32();c=d.getLittleEndian32();b=d.getLittleEndian32();d.skipPosition(558);y.domain=d.getUnicodeString(c,true);
y.userName=d.getUnicodeString(b,true);case 2:}return y}function Fa(){if(!Ua){setTimeout(function(){if(oa)u("884")},999);if(O.onloggedin)O.onloggedin(O.sessionInfo)}Ua=true}function Za(d){var a=d.getLittleEndian32();if(a<3){Na(d,a);Fa();return}if(a!=3)return;d.skipPosition(2);var c=d.getLittleEndian32();d.skipPosition(4);if(c==2)return;var b=d.getLittleEndian32();d.skipPosition(4);var y=new Object;y.logId=d.getLittleEndian32();y.time=Date.now();O.sessionInfo.sessionId=y.logId;var e=d.getBytes(16);
var f=new Array(16);for(var r=0;r<16;r++)f[r]=e[r]&255;y.random=f;Fa();var l="8D"+y.logId+"\t"+hi5.Base64.enc(f);if(O.sessionInfo.userName){l+="\t"+O.sessionInfo.userName;if(O.sessionInfo.domain)l+="\t"+O.sessionInfo.domain}if(!Ka)u(l)}function $a(d){Ba=true;var a=d.getLittleEndian32();svGlobal.logger.info("Disconnect:"+a);var c=a==11&&vb;if(c)O.onCloseSurface();var b=a<1||c;if(b)return;if(!Ka&&oa)u("85"+a);G(a.toString(16).toUpperCase())}function ab(){var d=0;var a=0;var c=[0];var b=new hi5.DataBuffer(c,
0,0);this.addFragement=function(b,W){db(b.getData(),b.getPosition(),c,a,W);a+=W;d+=W};this.clearFragements=function(){b.setPosition(0);b.markEnd(d);d=0;a=0;return b}}function Aa(d){var a=d.getByte();var c=a&15;var b=a>>4&3;var y=a>>6&3;var e;var f=0;if(y==2)f=d.getByte();var r=(f&32)!=0;e=d.getLittleEndian16();var l=null;if(r){var F=qa.dec(d.getData(),d.getPosition(),e,f);l=qa.getData();e=qa.getDecompressedLength()}else l=d;if(b!=0)switch(b){case 2:case 3:bb.addFragement(l,e);return;case 1:bb.addFragement(l,
e);l=bb.clearFragements()}wb(c,l,e)}function wb(d,a,c){if(ja)ja.begin("decodeFastPath");switch(d){case 0:var b=a.getLittleEndian16();ob(a,b);break;case 1:a.skipPosition(2);pb(a);break;case 2:a.skipPosition(2);qb(a);break;case 3:break;case 4:Ra(a);break;case 5:ub(a);break;case 6:break;case 8:break;case 9:rb(a);break;case 10:sb(a);break;case 11:tb(a);break;default:svGlobal.logger.warn("XXX RDP5 opcode "+d)}if(ja)ja.end("decodeFastPath")}function Ra(d){var a=d.getEnd();var c;var b;var y;for(var e;d.getPosition()<
a;){var f=d.getLittleEndian16();switch(f){case 1:case 6:c=d.getLittleEndian16();b=d.getLittleEndian16();y=d.getLittleEndian16();e=d.getBigEndian16();F(d,c,b,y,e);break;case 4:r(d);break;default:svGlobal.logger.warn("Invalid surface cmd:"+f)}}}function r(d){var a=d.getLittleEndian16();var c=d.getLittleEndian32();if(a==1)u("91"+c)}function c(d,a,c,b,y,e){var f;var r=b*e;for(var l=0;l<y;l++){f=a+(y-l-1)*r;db(d,f,c,l*r,r)}}function y(d){function a(d,c){d.skipPosition(6);c.quantIdxY=d.getByte();c.quantIdxCb=
d.getByte();c.quantIdxCr=d.getByte();c.x=d.getLittleEndian16()*64;c.y=d.getLittleEndian16()*64;c.YLen=d.getLittleEndian16();c.CbLen=d.getLittleEndian16();c.CrLen=d.getLittleEndian16()}function c(d,b){d.skipPosition(6);var ra=d.getLittleEndian16();b.cct=ra>>>4&3;b.xft=ra>>>6&15;b.et=ra>>>10&15;b.qt=ra>>>14&3;var y=d.getByte();d.skipPosition(1);var e=d.getLittleEndian16();d.skipPosition(4);var f=new Array(y*10);var W=0;var r;var l;for(l=0;l<y;l++){r=d.getByte();f[W++]=r&15;f[W++]=r>>>4;r=d.getByte();
f[W++]=r&15;f[W++]=r>>>4;r=d.getByte();f[W++]=r&15;f[W++]=r>>>4;r=d.getByte();f[W++]=r&15;f[W++]=r>>>4;r=d.getByte();f[W++]=r&15;f[W++]=r>>>4}var ia=q.resetTiles(e);for(l=0;l<e;l++){var F=ia[l];a(d,F);V(b,d,f,F.YLen,F.quantIdxY*10,F.CbLen,F.quantIdxCb*10,F.CrLen,F.quantIdxCr*10,F.data)}}function b(d){d.skipPosition(2);d.skipPosition(1);var a=d.getLittleEndian16();var c=q.resetRects(a);for(var wa=0;wa<a;wa++){var ra=c[wa];ra.x=d.getLittleEndian16();ra.y=d.getLittleEndian16();ra.width=d.getLittleEndian16();
ra.height=d.getLittleEndian16()}d.skipPosition(4)}function y(d){d.skipPosition(2)}function e(d){d.skipPosition(10)}function f(d){d.skipPosition(2);k.ctxId=d.getByte();k.tileSize=d.getLittleEndian16();k.setProperties(d.getLittleEndian16())}function r(d){var a=d.getByte();for(var c=0;c<a;c++){var wa=d.getByte();var b=d.getLittleEndian16();var ra=d.getLittleEndian16();svGlobal.logger.info("Channel, id:"+wa+" width:"+b+" height:"+ra)}}function l(d){d.skipPosition(4)}function F(d){var a=d.getLittleEndian32();
var c=d.getLittleEndian16()}var q=new RemoteFXBitmap(!d);var g=new RemoteFXDecoder;var k=new RemoteFXContext;this.decode=function(d,a){var wa=0;var g=0;var V=0;for(var n=d.getPosition()+a;d.getPosition()<n;){wa=d.getLittleEndian16();g=d.getLittleEndian32();if(g==0)break;V=d.getPosition()-6+g;switch(wa){case 52416:F(d);break;case 52417:l(d);break;case 52418:r(d);break;case 52419:f(d);break;case 52420:e(d);break;case 52421:y(d);break;case 52422:b(d);break;case 52423:c(d,k);break;default:svGlobal.logger.warn("unknown blockType 0x%X"+
wa)}d.setPosition(V)}return q};var V=g.decodeRgb;this.getResult=function(){return q}}function F(d,a,b,y,f){var e=d.getByte();d.skipPosition(2);var r=d.getByte();var l=d.getLittleEndian16();var F=d.getLittleEndian16();var q=d.getLittleEndian32();var g;var k=d.getPosition()+q;switch(r){case 0:var V=rdpBitmap.byte2int(d.getData(),q,d.getPosition());g=new Uint32Array(V.length);c(V,0,g,l,F,1);w.setRGBs(a,b,l,F,g,0,l);break;case 1:eb(d,e,l,F,Ga);var n=Ga.getData();var t=Ga.getDataSize();g=new Uint32Array(t);
c(n,0,g,l,F,1);w.setRGBs(a,b,l,F,g,0,l);break;case 3:var h=xb.decode(d,q);var B=h.getRects();var v=h.getTiles();var m=h.getTileSize();var pa=h.getRectSize();var Z=pa?new Lb(0,0,0,0):null;var D=0;for(var H=0;H<m;H++){var C=v[H];if(pa)for(var Sa=0;Sa<pa;Sa++){var x=B[Sa];x.intersection(C.x,C.y,64,64,Z);if(Z.isEmpty())continue;D=(Z.y-C.y)*64+(Z.x-C.x);Z.x+=a;Z.y+=b;w.setRGBs(Z.x,Z.y,Z.width,Z.height,C.data,D,64)}else w.setRGBs(C.x,C.y,64,64,C.data,0,64)}}d.setPosition(k)}function sb(d){yb(d.getLittleEndian16())}
function rb(d){pa(d,24)}function tb(d){var a=d.getLittleEndian16();pa(d,a)}function Sa(d,a,c,b,y,f,e,r){this.x=d;this.y=a;this.width=c;this.height=b;this.mask=y;this.pixel=f;this.bpp=e;this.cache_idx=r}function pa(d,a){if(Mb)return;var c=0;var b=0;var y=0;var f=0;var e=0;var r=0;var l=0;e=d.getLittleEndian16();c=d.getLittleEndian16();b=d.getLittleEndian16();y=d.getLittleEndian16();f=d.getLittleEndian16();r=d.getLittleEndian16();l=d.getLittleEndian16();var F=d.getBytes(l);var q=d.getBytes(r);if(c<
0||c>=y-1)c=0;if(b<0)b=0;else if(b>=f)b=f-1;var g=true;for(var k=0;k<l;k++)if(F[k]!=0){g=false;break}Nb(new Sa(c,b,y,f,q,F,a,e),g);yb(e)}function V(d,a,c,b,y,f){if(y!=1)a=b-a-1;var e=(a*c+d)*y;var r=e/8>>0;var l=f[r]&255;switch(y){case 1:l=l&128>>e%8;return l==0?0:4294967295;case 8:return l==0?0:4294967295;case 15:l=(f[r+1]&255)<<8|l;var F=new Array(4);zb(l,15,F,0);return F[0]<<16|F[1]<<8|F[2];case 16:l=(f[r+1]&255)<<8|l;F=new Array(4);zb(l,16,F,0);return F[0]<<16|F[1]<<8|F[2];case 24:return(f[r+
2]&255)<<16|(f[r+1]&255)<<8|l;case 32:return(f[r+3]&255)<<24|(f[r+2]&255)<<16|(f[r+1]&255)<<8|l}svGlobal.logger.warn("invalid bpp value for Xor Mask.");return 0}function Ob(d,a,c,b,f,y){if(f!=1)a=b-a-1;c=((c+7)/8|0)*8;var r=a*c+d;var e=r/8>>0;var l=y[e]&128>>r%8;return l==0?1:0}function Pb(d,a,c,b,f,y){var r=new Uint32Array(d*a);r[0]=0;var e=0;var l=true;var F=c.length;for(var q=0;q<F;q++)if(c[q]!=0){l=false;break}var g=0;var k;for(q=0;q<a;q++)for(k=0;k<d;k++){r[e]=V(k,q,d,a,f,b);if(!l){g=Ob(k,q,
d,a,f,c);if(g==0&&r[e]!=0){r[e]=~r[e];r[e]|=4278190080}else if(g==1||r[e]!=0)r[e]|=4278190080;if(f==32&&r[e]==-1&&g==0)r[e]=0}e++}return r}function Ab(d,a,c,b,f,r,e,y,l){function F(){var d=0|0;if(a){var c=0;for(var b=a.length;c<b;c++)if(a[c]!=0)d+=c%f+(c/f|0)}return d}function q(d){switch(d){case 507:return"text";case 2046:case 4359:return"default";default:return""}}this.cache_idx=d;this.rawData=a;this.none=!a;this.hotX=c;this.hotY=b;this.width=f;this.height=r;this.xorSize=y;this.andSize=l;this.result=
"";this.distance=0;this.bpp=e;this.system="";if(a){if(!this.distance)this.distance=F();if(!this.system)this.system=q(this.distance)}var g="";if(!this.system&&a){var k=40;var V=f*r*4;var n=22+k+V+y+l;var t=new Uint8Array(n);var h=new hi5.DataBuffer(t,0,n);h.setLittleEndian16(0);h.setLittleEndian16(2);h.setLittleEndian16(1);h.setByte(f);h.setByte(r);h.setByte(0);h.setByte(0);h.setLittleEndian16(c);h.setLittleEndian16(b);h.setLittleEndian32(k+V+y+l);h.setLittleEndian32(22);h.setLittleEndian32(k);h.setLittleEndian32(f);
h.setLittleEndian32(r*2);h.setLittleEndian16(1);h.setLittleEndian16(32);h.setLittleEndian32(0);h.setLittleEndian32(y+l);h.setLittleEndian32(0);h.setLittleEndian32(0);h.setLittleEndian32(0);h.setLittleEndian32(0);var B;var v;for(B=r-1;B>=0;B--)for(v=0;v<f;v++){var m=a[f*B+v];h.setByte(m&255);h.setByte(m>>8&255);h.setByte(m>>16&255);h.setByte(m>>24&255)}g="data:image/x-icon;base64,"+hi5.Base64.enc(h.getData())}this.url=g}function Nb(d,a){var c=d.x;var b=d.y;var f=d.width;var r=d.height;var y=d.mask;
var e=d.pixel;var l=d.bpp;var F=d.cache_idx;if(a){w.putCursor(F,new Ab(F,null,0,0,0,0,0,0,0));return}var q=Pb(f,r,y,e,l,c);var g=new Ab(F,q,c,b,f,r,l,e.length,y.length);w.putCursor(F,g)}function yb(d){w.setCursor(d)}function ub(){}function qb(d){var a=0;var c=null;var b=null;var f=null;var r=0;d.skipPosition(2);a=d.getLittleEndian16();d.skipPosition(2);c=new Array(a);b=new Array(a);f=new Array(a);var y=d.getBytes(a*3);for(var e=0;e<a;e++){c[e]=y[r];b[e]=y[r+1];f[e]=y[r+2];r+=3}if(a!=256)return;Qb(8,
a,c,b,f)}function Qb(d,a,c,b,f){if(!da.paletteRdp)da.paletteRdp=new Array(3);da.paletteRdp[0]=c;da.paletteRdp[1]=b;da.paletteRdp[2]=f}function ob(d,a){var c=0;var b=0;for(var f=0;c<a;){b=d.getByte();f=b&3;switch(f){case 1:Rb(d,b);break;case 2:Sb(d,b);break;case 3:Tb(d);if(Ca)Ca.on=false;default:}c++}}function Sb(d,a){var c=a>>2;switch(c){case 11:Ub(d);break;case 13:Vb(d);break;default:svGlobal.logger.warn("Alt Sec order:"+c)}}function Vb(d){var a=d.getLittleEndian32()}function Ub(d){var a=d.getLittleEndian16()-
3;var c=d.getPosition()+a;O.onAltSecWindows(d,a);d.setPosition(c)}function Wb(d,a,c){var b=0;var f=0;if((a&64)!=0)c--;if((a&128)!=0)if(c<2)c=0;else c-=2;for(var r=0;r<c;r++){f=d.getByte();b|=f<<r*8}return b}function Rb(d,a){var c=0;var b=0;var f=false;if((a&8)!=0)da.orderType=d.getByte();b=Xb[da.orderType];c=Wb(d,a,b);if((a&4)!=0){if((a&32)==0)Yb(d,da.bounds);Zb(da.bounds)}f=(a&16)!=0;if(Ca&&da.orderType!=13)Ca.on=false;switch(da.orderType){case 0:$b(d,da.destBlt,c,f);break;case 1:ac(d,da.patBlt,
c,f);break;case 2:bc(d,da.screenBlt,c,f);break;case 9:cc(d,da.line,c,f);break;case 10:dc(d,da.rectangle,c,f);break;case 11:ec(d,da.deskSave,c,f);break;case 13:fc(d,da.memBlt,c,f);break;case 22:gc(d,da.polyLine,c,f);break;case 27:hc(d,da.text2,c,f);break;default:svGlobal.logger.warn("XXX Order type "+da.orderType)}if((a&4)!=0)jb()}function Tb(d){var a;var c;var b;var f;a=d.getLittleEndian16();b=d.getLittleEndian16();c=d.getByte();f=d.getPosition()+a+7;if(!d.has(a+7))return;switch(c){case 0:ic(d);break;
case 1:svGlobal.logger.info("TODO: color cache");break;case 2:jc(d,b);break;case 3:kc(d);break;case 4:Bb(d,b,false);break;case 5:Bb(d,b,true);break;case 7:svGlobal.logger.info("CacheBrush...=");break;case 8:lc(d,b);break;default:svGlobal.logger.warn("invalid second Order, type="+c)}d.setPosition(f)}function lc(d,a){var b=a&7;a=(a&65408)>>7;var f=d.getLittleEndian16();d.skipPosition(8);var r=d.getByte();if(m!=r){svGlobal.logger.warn("Server limited colour depth to "+r+" bits");k(r,true)}d.skipPosition(2);
var y=d.getByte();var e=d.getLittleEndian16();var l=d.getLittleEndian16();var F=d.getLittleEndian32();var q=null;if(y==1){eb(d,r,e,l,Ga);var g=Ga.getData();var h=Ga.getDataSize();q=new Uint32Array(h);c(g,0,q,e,l,1);w.putBitmap(b,f,new Y(q,e,l,0,0,32))}else if(y==0){var V=rdpBitmap.byte2int(d.getData(),F,d.getPosition());q=new Uint32Array(V.length);c(V,0,q,e,l,1);w.putBitmap(b,f,new Y(q,e,l,0,0,32))}else svGlobal.logger.warn("XXX invalid codec id:"+y);d.skipPosition(F)}function ic(d){var a=d.getByte();
d.skipPosition(1);var c=d.getByte();var b=d.getByte();var f=d.getByte();var r=Math.floor((f+7)/8);var e=d.getLittleEndian16();var y=d.getLittleEndian16();var l=d.getPosition();d.skipPosition(e);if(m!=f){svGlobal.logger.warn("Server limited colour depth to "+f+" bits");k(f,true)}var F=new Array(c*b*r);F[0]=0;var q=0;var g=c*r;for(var h=0;h<b;h++){q=l+(b-h-1)*g;d.copyToByteArray(F,h*g,q,g)}w.putBitmap(a,y,new Y(fb(F,r),c,b,0,0,r*8))}function jc(d,a){var c=d.getByte();var b=d.getByte();var f=d.getByte();
var r=d.getByte();var e=d.getByte();var y=Math.floor((e+7)/8);var l=d.getLittleEndian16();var F=d.getLittleEndian16();if(m!=e){svGlobal.logger.warn("Server limited colour depth to "+e+" bits");k(e,true)}var q=0;if((a&1024)!=0)q=l;else{d.skipPosition(2);q=d.getLittleEndian16();d.skipPosition(2);d.skipPosition(2)}var g;if(y!=1)g=Ia(f,r,q,d.getData(),d.getPosition());else g=gb(f,r,q,d.getData(),d.getPosition());d.skipPosition(q);w.putBitmap(c,F,new Y(g,f,r,0,0,e))}function Bb(d,a,c){var b;var f;var r;
var e;var y;var l;var F;var q=0;r=a&7;l=((a&120)>>3)-2;a=(a&65408)>>7;if(Oa!=l){k(l*8,true);svGlobal.logger.warn("Server limited colour depth to "+l+" bytes")}if((a&2)!=0)d.skipPosition(8);if((a&1)!=0){e=Ta.readVar2Bytes(d);y=e}else{e=Ta.readVar2Bytes(d);y=Ta.readVar2Bytes(d)}q=Ta.readVar4Bytes(d);F=Ta.readVar2Bytes(d);var g=c&&(a&8)==0;if(g)d.skipPosition(8);if(c){var h;if(l!=1)h=Ia(e,y,q,d.getData(),d.getPosition());else h=gb(e,y,q,d.getData(),d.getPosition());d.skipPosition(q);if(!h){svGlobal.logger.warn("Failed to decompress bitmap data");
return}b=new Y(h,e,y,0,0,l*8)}else{var V=new Array(e*y*l);V[0]=0;var n=d.getPosition();var t=0;var B=e*l;for(f=0;f<y;f++){t=n+(y-f-1)*B;d.copyToByteArray(V,f*B,t,B)}b=new Y(fb(V,l),e,y,0,0,l*8)}w.putBitmap(r,F,b);if((a&2)!=0)svGlobal.logger.warn("XXX:TODO, persistent")}function kc(d){var a=null;var c=0;var b=0;var f=0;var r=0;var e=0;var y=0;var l=0;var F=0;c=d.getByte();b=d.getByte();for(var q=0;q<b;q++){f=d.getLittleEndian16();r=d.getLittleEndian16();e=d.getLittleEndian16();y=d.getLittleEndian16();
l=d.getLittleEndian16();F=l*Math.floor((y+7)/8)+3&~3;a=new K(r,e,y,l,d.getBytes(F));w.putFont(c,f,a)}}function aa(d,a,c){var b=0;if(c){b=d.getByte()<<24>>24;a+=b;return a}else{a=d.getLittleEndian16()<<16>>16;return a}}function Yb(d,a){var c=d.getByte();if((c&1)!=0)a.left=aa(d,a.left,false);else if((c&16)!=0)a.left=aa(d,a.left,true);if((c&2)!=0)a.top=aa(d,a.top,false);else if((c&32)!=0)a.top=aa(d,a.top,true);if((c&4)!=0)a.right=aa(d,a.right,false);else if((c&64)!=0)a.right=aa(d,a.right,true);if((c&
8)!=0)a.bottom=aa(d,a.bottom,false);else if((c&128)!=0)a.bottom=aa(d,a.bottom,true)}function ac(d,a,c,b){if((c&1)!=0)a.x=aa(d,a.x,b);if((c&2)!=0)a.y=aa(d,a.y,b);if((c&4)!=0)a.cx=aa(d,a.cx,b);if((c&8)!=0)a.cy=aa(d,a.cy,b);if((c&16)!=0){a.opcode=d.getByte();a.opcode=a.opcode&3|(a.opcode&48)>>2}if((c&32)!=0)a.backgroundColor=Ha(d);if((c&64)!=0)a.foregroundColor=Ha(d);mc(d,a.brush,c>>7);var f=a.x;var r=a.y;if(f>ba||r>ca)return;var e=a.cx;var y=a.cy;var l=a.opcode;var F=a.backgroundColor;var q=a.foregroundColor;
var g=a.brush.xOrigin;var h=a.brush.yOrigin;var k=a.brush.style;var V=a.brush.pattern;nc(l,f,r,e,y,q,F,g,h,k,V)}function $b(d,a,c,b){if((c&1)!=0)a.x=aa(d,a.x,b);if((c&2)!=0)a.y=aa(d,a.y,b);if((c&4)!=0)a.cx=aa(d,a.cx,b);if((c&8)!=0)a.cy=aa(d,a.cy,b);if((c&16)!=0)a.opcode=d.getByte()&15;var f=a.x;var r=a.y;var e=a.cx;var y=a.cy;var l=a.opcode;if(f>I||r>Q)return;var F=f+e-1;if(F>ba)F=ba;if(f<fa)f=fa;e=F-f+1;var q=r+y-1;if(q>ca)q=ca;if(r<ga)r=ga;y=q-r+1;if(e<1||y<1)return;w.bitBlt(l,I,f,r,e,y,null,0,
0,0)}function bc(d,a,c,b){if((c&1)!=0)a.x=aa(d,a.x,b);if((c&2)!=0)a.y=aa(d,a.y,b);if((c&4)!=0)a.cx=aa(d,a.cx,b);if((c&8)!=0)a.cy=aa(d,a.cy,b);if((c&16)!=0)a.opcode=d.getByte()&15;if((c&32)!=0)a.srcX=aa(d,a.srcX,b);if((c&64)!=0)a.srcY=aa(d,a.srcY,b);var f=a.x;var r=a.y;if(f>ba||r>ca)return;var e=a.cx;var y=a.cy;var l=a.opcode;var F=a.srcX;var q=a.srcY;var g=f+e-1;if(g>ba)g=ba;if(f<fa)f=fa;e=g-f+1;var h=r+y-1;if(h>ca)h=ca;if(r<ga)r=ga;y=h-r+1;F+=f-a.x;q+=r-a.y;if(e<1||y<1)return;if(l==12)w.moveArea(F,
q,e,y,f-F,r-q);else w.bitBlt(l,e,f,r,e,y,null,e,F,q)}function Ha(d){var a=0;var c=0;c=d.getByte();a=c;c=d.getByte();a|=c<<8;c=d.getByte();a|=c<<16;return a}function oc(d,a,c){if((c&1)!=0)a.style=d.getByte();if((c&2)!=0)a.width=d.getByte();if((c&4)!=0)a.color=Ha(d);return true}function cc(d,a,c,b){if((c&1)!=0)a.mixmode=d.getLittleEndian16();if((c&2)!=0)a.startX=aa(d,a.startX,b);if((c&4)!=0)a.startY=aa(d,a.startY,b);if((c&8)!=0)a.endX=aa(d,a.endX,b);if((c&16)!=0)a.endY=aa(d,a.endY,b);if((c&32)!=0)a.backgroundColor=
Ha(d);if((c&64)!=0)a.opcode=d.getByte();oc(d,a.pen,c>>7);var f=a.startX;var r=a.startY;var e=a.endX;var y=a.endY;var l=a.pen.color;var F=a.opcode-1;if(r==y){if(f>e){var q=f;f=e;e=q}if(f<fa)f=fa;if(e>ba)e=ba}else if(f==e){if(r>y){q=r;r=y;y=q}if(r<ga)r=ga;if(r>ca)r=ca}Cb(f,r,e,y,l,F)}function dc(d,a,c,b){if((c&1)!=0)a.x=aa(d,a.x,b);if((c&2)!=0)a.y=aa(d,a.y,b);if((c&4)!=0)a.cx=aa(d,a.cx,b);if((c&8)!=0)a.cy=aa(d,a.cy,b);if((c&16)!=0)ua=ua&4294967040|d.getByte();if((c&32)!=0)ua=ua&4294902015|d.getByte()<<
8;if((c&64)!=0)ua=ua&4278255615|d.getByte()<<16;a.color=ua;pc(a.x,a.y,a.cx,a.cy,a.color,true)}function ec(d,a,c,b){if((c&1)!=0)a.offset=d.getLittleEndian32();if((c&2)!=0)a.left=aa(d,a.left,b);if((c&4)!=0)a.top=aa(d,a.top,b);if((c&8)!=0)a.right=aa(d,a.right,b);if((c&16)!=0)a.bottom=aa(d,a.bottom,b);if((c&32)!=0)a.action=d.getByte();qc(a)}function fc(d,a,c,b){if((c&1)!=0){a.cacheID=d.getByte();a.colorTable=d.getByte()}if((c&2)!=0)a.x=aa(d,a.x,b);if((c&4)!=0)a.y=aa(d,a.y,b);if((c&8)!=0)a.cx=aa(d,a.cx,
b);if((c&16)!=0)a.cy=aa(d,a.cy,b);if((c&32)!=0)a.opcode=d.getByte()&15;if((c&64)!=0)a.srcX=aa(d,a.srcX,b);if((c&128)!=0)a.srcY=aa(d,a.srcY,b);if((c&256)!=0)a.cacheIDX=d.getLittleEndian16();var f=a.x;var r=a.y;if(f>ba||r>ca)return;var e=a.cx;var y=a.cy;var l=a.srcX;var F=a.srcY;var q=f+e-1;if(q>ba)q=ba;if(f<fa)f=fa;e=q-f+1;var g=r+y-1;if(g>ca)g=ca;if(r<ga)r=ga;y=g-r+1;l+=f-a.x;F+=r-a.y;if(Ca){Ca.verify(f,r,e,y);if(Ca.on)return}w.drawBitmap(a.cacheID,a.cacheIDX,f,r,e,y,l,F,a.opcode)}function mc(d,a,
c){if((c&1)!=0)a.xOrigin=d.getByte();if((c&2)!=0)a.yOrigin=d.getByte();if((c&4)!=0)a.style=d.getByte();var b=a.pattern;if((c&8)!=0)b[0]=d.getByte();if((c&16)!=0)for(var f=1;f<8;f++)b[f]=d.getByte();a.pattern=b}function gc(d,a,c,b){if((c&1)!=0)a.x=aa(d,a.x,b);if((c&2)!=0)a.y=aa(d,a.y,b);if((c&4)!=0)a.opcode=d.getByte();if((c&16)!=0)a.foregroundColor=Ha(d);if((c&32)!=0)a.lines=d.getByte();if((c&64)!=0){var f=d.getByte();a.dataSize=f;a.data=d.getBytes(f)}rc(a)}function hc(d,a,c,b){if((c&1)!=0)a.font=
d.getByte();if((c&2)!=0)a.flags=d.getByte();if((c&4)!=0)a.opcode=d.getByte();if((c&8)!=0)a.mixmode=d.getByte();if((c&16)!=0)a.foregroundColor=Ha(d);if((c&32)!=0)a.backgroundColor=Ha(d);if((c&64)!=0)a.clipLeft=d.getLittleEndian16();if((c&128)!=0)a.clipTop=d.getLittleEndian16();if((c&256)!=0)a.clipRight=d.getLittleEndian16();if((c&512)!=0)a.clipBottom=d.getLittleEndian16();if((c&1024)!=0)a.boxLeft=d.getLittleEndian16();if((c&2048)!=0)a.boxTop=d.getLittleEndian16();if((c&4096)!=0)a.boxRight=d.getLittleEndian16();
if((c&8192)!=0)a.boxBottom=d.getLittleEndian16();if((c&16384)!=0)d.skipPosition(1);if((c&32768)!=0)d.skipPosition(1);if((c&65536)!=0)d.skipPosition(1);if((c&131072)!=0)d.skipPosition(1);if((c&262144)!=0)d.skipPosition(7);if((c&524288)!=0)a.x=d.getLittleEndian16();if((c&1048576)!=0)a.y=d.getLittleEndian16();if((c&2097152)!=0){var f=d.getByte();a.length=f;a.text=d.getBytes(f)}sc(a)}function sc(a){var c=a.font;var b=a.flags;var f=a.mixmode;var r=sa(a.foregroundColor);var e=sa(a.backgroundColor);var y=
a.clipLeft;var l=a.clipTop;var F=a.clipRight;var q=a.clipBottom;var g=a.boxLeft;var h=a.boxTop;var k=a.boxRight;var V=a.boxBottom;var n=a.x;var t=a.y;var B=a.length;var v=a.text;var m=F-y;var Z=q-l;var pa=k-g;var C=V-h;if(g+pa>I)pa=I-g;w.drawText(c,b,f,r,e,y,l,m,Z,g,h,pa,C,n,t,B,v,fa,ga,ba,ca)}function yc(a){svGlobal.logger.warn("Server limited colour depth to "+a+" bits");if(!hb)k(a,true);else if(hb>1)return;hb++}function pb(a){var c=0;var b=0;var f=0;var r=0;var e=0;var y=0;var l=0;var F=0;var q=
0;var g=0;var h=0;var V=0;var n=a.getLittleEndian16();for(var t=0;t<n;t++){c=a.getLittleEndian16();b=a.getLittleEndian16();f=a.getLittleEndian16();r=a.getLittleEndian16();e=a.getLittleEndian16();y=a.getLittleEndian16();q=a.getLittleEndian16();g=a.getLittleEndian16();h=a.getLittleEndian16();l=f-c+1;F=r-b+1;if(m!=q){svGlobal.logger.warn("Server limited colour depth to "+q+" bits");k(q,true)}if(g==0){var B=e*Oa;var v=y*B;var Z=new Uint8Array(v);var pa=a.getPosition();for(var C=0;C<y;C++){db(a.getData(),
pa,Z,(y-C-1)*B,B);pa+=B}a.skipPosition(v);Db(Z,c,b,e,y,l,F,Oa);continue}if((g&1024)!=0)V=h;else{a.skipPosition(2);V=a.getLittleEndian16();a.skipPosition(4)}tc(a.getData(),V,a.getPosition(),e,y,c,b,l,F,Oa);a.skipPosition(V)}}function Kb(a){Ba=true}function Zb(a){fa=a.left;if(fa<0)fa=0;ga=a.top;if(ga<0)ga=0;ba=a.right;if(ba>=I)ba=I-1;ca=a.bottom;if(ca>=Q)ca=Q-1}function jb(){fa=0;ba=I-1;ga=0;ca=Q-1}function Cb(a,c,b,f,r,e){var y=Math.min(a,b);var l=Math.max(a,b);var F=Math.min(c,f);var q=Math.max(c,
f);r=sa(r);var g=y>=fa&&l<=ba&&F>=ga&&q<=ca;if(!g){if(y>ba||l<fa||F>ca||q<ga)return;var h=0;if(a==b){if(c>f){h=c;c=f;f=h}if(c<ga)c=ga;if(f>ca)f=ca}else if(c==f){if(a>b){h=a;a=b;b=h}if(a<fa)a=fa;if(b>ba)b=ba}else{var V=da._line;V.set(a,c,b,f);var k=V.intersection(fa,ga,ba,ga);var n=[];if(k)n.push(k.x,k.y);k=V.intersection(ba,ga,ba,ca);if(k)n.push(k.x,k.y);k=V.intersection(fa,ca,ba,ca);if(k)n.push(k.x,k.y);k=V.intersection(fa,ga,fa,ca);if(k)n.push(k.x,k.y);if(n.length==2)if(a>=fa&&a<=ba&&c>=ga&&c<=
ca)n.push(a,c);else if(b>=fa&&b<=ba&&f>=ga&&f<=ca)n.push(b,f);if(n.length!=4)return;a=n[0];c=n[1];b=n[2];f=n[3]}}if(e==12)w.drawLine(a,c,b,f,r);else w.drawLineExt(a,c,b,f,r,e)}function qc(a){var c=a.right-a.left+1;var b=a.bottom-a.top+1;if(a.action==0)uc(a.offset,a.left,a.top,c,b);else vc(a.offset,c,b,a.left,a.top)}function uc(a,c,b,f,r){if(f<1||r<1)return;w.saveDesktop(c,b,f,r,a)}function vc(a,c,b,f,r){w.restoreDesktop(f,r,c,b,a)}function rc(a){var c=a.x;var b=a.y;var f=a.foregroundColor;var r=a.lines;
var e=a.dataSize;var y=a.data;var l=new Array(1);l[0]=Math.floor((r-1)/4)+1;var F=0;var q=0;var g=a.opcode-1;for(var h=0;h<r&&l[0]<e;h++){var k=c;var V=b;if(h%4==0)F=y[q++];if((F&192)==0)F|=192;if((F&64)!=0)c+=Eb(y,l);if((F&128)!=0)b+=Eb(y,l);Cb(k,V,c,b,f,g);F<<=2}}function nc(a,c,b,f,r,e,y,l,F,q,g){e=sa(e);y=sa(y);var h=c+f-1;if(h>ba)h=ba;if(c<fa)c=fa;f=h-c+1;var k=b+r-1;if(k>ca)k=ca;if(b<ga)b=ga;r=k-b+1;if(f<1||r<1)return;var V=null;switch(q){case 0:V=new Uint32Array(f*r);for(var n=0;n<V.length;n++)V[n]=
e;w.bitBlt(a,I,c,b,f,r,V,f,0,0);break;case 2:svGlobal.logger.warn("hatch");break;case 3:var B=g;V=new Uint32Array(f*r);var t=0;for(n=0;n<r;n++)for(var v=0;v<f;v++){if((B[(n+F)%8]&1<<(v+l)%8)==0)V[t]=e;else V[t]=y;t++}w.bitBlt(a,I,c,b,f,r,V,f,0,0);break;default:svGlobal.logger.warn("Unsupported brush style "+q)}}function Eb(a,c){var b=a[c[0]++]&255;var f=b&128;if((b&64)!=0)b|=~63;else b&=63;if(f!=0)b=b<<8|a[c[0]++]&255;return b}function pc(a,c,b,f,r,e){if(a>ba||c>ca)return;var y=a+b-1;if(y>ba)y=ba;
if(a<fa)a=fa;b=y-a+1;var l=c+f-1;if(l>ca)l=ca;if(c<ga)c=ga;f=l-c+1;if(b<1||f<1)return;w.fillRect(a,c,b,f,sa(r))}function Db(a,c,b,f,r,e,y,l,F){if(!F)F=0;var q=fb(a,l);w.setRGBs(c,b,e,y,q,F,f)}function tc(a,c,b,f,r,e,y,l,F,q){if(l*F*f*r<1)return;if(q!=1)w.setRGBs(e,y,l,F,Ia(f,r,c,a,b),0,f);else Db(gb(f,r,c,a,b),e,y,f,r,l,F,q)}function Jb(a){return hi5.Base64.dec(a,0)}function Wa(a){if(!O)return;svGlobal.logger.warn("closed "+(O.sessionInfo.appInfo?O.sessionInfo.appInfo.numericId:0));if(O)oa=false;
if(mb){svGlobal.logger.info("Req credential");return}da=null;if(typeof rdp8bulkData!="undefined")rdp8bulkData.release();z=null;xb=null;Ga=null;eb=null;Fb=null;try{if(xa!=null){xa.exit();xa=null}if(O.onclose)O.onclose(Ba);else svGlobal.logger.info("onclose: null")}catch(c){}za=null;if(ha){ha.onopen=null;ha.onmessage=null;ha.onclose=null;ha.onerror=null;ha=null}bb=null;if(qa){qa.release();qa=null}O=null}function zb(a,c,b,f){switch(c){case 16:wc(a,b,f);break;case 15:xc(a,b,f);break;case 8:b[f]=da.paletteRdp[0][a];
b[f+1]=da.paletteRdp[1][a];b[f+2]=da.paletteRdp[2][a];b[f+3]=255;break;case 32:b[f]=a&255;b[f+1]=a>>8&255;b[f+2]=a>>16&255;b[f+3]=a>>24&255;default:b[f]=a&255;b[f+1]=a>>8&255;b[f+2]=a>>16&255;b[f+3]=255}}function xc(a,c,b){var f=a>>7&248;var r=a>>2&248;var e=a<<3&255;f|=f>>5;r|=r>>5;e|=e>>5;c[b]=f;c[b+1]=r;c[b+2]=e;c[b+3]=255}function wc(a,c,b){var f=a>>8&248;var r=a>>3&252;var e=a<<3&255;f|=f>>5;r|=r>>6;e|=e>>5;c[b]=f;c[b+1]=r;c[b+2]=e;c[b+3]=255}function fb(a,c){var b=a.length/c>>0;var f=new Uint32Array(b);
var r=sa;switch(c){case 1:for(var e=0;e<b;e++)f[e]=r(a[e]);break;case 2:for(e=0;e<b;e++)f[e]=r(a[e*2+1]<<8|a[e*2]);break;default:for(e=0;e<b;e++)f[e]=r(a[e*c+2]<<16)|a[e*c+1]<<8|a[e*c]}return f}this.sessionInfo={domain:"",userName:"",sessionId:0,joinedSessions:[],suppressOutput:false,appInfo:null};this.mode=0;this.remoteAppLogin=true;var O=this;var Ba=false;var mb=false;var hb=0;var zc=0;var Da=typeof z=="object"?z:null;var la=Da?{}:hi5.string.queryToObj(z.substring(z.indexOf("?")+1));var db=hi5.Arrays.arraycopy;
var Ac=hi5.Arrays.fill;var Bc=null;var ja=null;var qa=new BulkData;var Ca=null;this.enableUpdateFix=function(){Ca=new P;svGlobal.logger.warn("UpdateFix enabled")};this.protocol=Da?"":z.substring(0,z.indexOf("://")).toLowerCase();this.setProfiler=function(a){ja=a};this.getProfiler=function(){return ja};this.gateway=function(){if(Da)return"";var a=z.lastIndexOf("/RDP?");if(a==-1)a=z.lastIndexOf("/JOIN?");if(a==-1)a=z.lastIndexOf("/PLAY?");var c=z.substring(0,a);return c.replace(/wss\:\/\//ig,"https://").replace(/ws\:\/\//ig,
"http://")}();this.getGatewayAddr=g;var Ka=typeof z=="object"||z.indexOf("/PLAY?")>0;var Gb=!Ka&&z.indexOf("invitation=")>0;if(Gb){var ib=decodeURIComponent(z);var cb=ib.indexOf(' USERNAME="');if(cb>0){cb+=11;var Hb=ib.substring(cb,ib.indexOf('"',cb));z+="&novice="+Hb+"&server="+Hb}z+="&mapClipboard=on"}if(Ka){this.mode=1;if(Da)z="";else{I=640|0;Q=480|0}}else if(z.indexOf("/JOIN?")>0||Gb)this.mode=2;if(la.symlink&&la.parameters)hi5.string.queryToObj(la.parameters,la);if(!la.gateway)z+="&gateway="+
encodeURIComponent(O.gateway);if(!("useSSL"in la))z+="&useSSL="+(O.protocol=="wss");this.getDisplayName=B;this.server=B();this.port=parseInt(la.port,10);this.getURL=function(){return z};this.getColor=function(){return m};var Lb=hi5.graphic.Rectangle;var Mb=z.indexOf("nocurosr=on")>0;var vb=z.indexOf("startProgram=app")>0;var Cc=z.indexOf("mapDisk=on")>0;this.isRemoteApp=function(){return vb};var ha=null;var oa=false;var Ua=false;var fa=0;var ga=0;var ba=I-1;var ca=Q-1;var Dc=null;var Oa=0;var xa=
null;var sa=D;var Ia=rdpBitmap.decompressInt16;var gb=rdpBitmap.decompress;k(m,true);this.setColor=function(a){k(a,false)};this.setResolution=function(a,c){R(a,c,false)};var Ja={tag:0,channels:0,bitsPerSample:0,samplePerSec:22050,toStream:function(a){a.setLittleEndian16(this.tag);a.setLittleEndian16(this.channels);a.setLittleEndian16(this.bitsPerSample);a.setLittleEndian32(this.samplePerSec)},fromStream:function(a){this.tag=a.getLittleEndian16();this.channels=a.getLittleEndian16();this.bitsPerSample=
a.getLittleEndian16();this.samplePerSec=a.getLittleEndian32()}};this.setAudioFormat=function(a){Ja.tag=a.tag;Ja.channels=a.channels;Ja.samplePerSec=a.samplePerSec;Ja.bitsPerSample=a.bitsPerSample};this.running=function(){return oa};this.setJoinMode=function(a){if(!oa)return;u("8E1"+a)};this.setJoinCloseMode=function(a){if(!oa)return;u("8EB3\t"+a)};this.refuseControl=function(a){if(!oa)return;u("8E3"+a)};this.giveControl=function(a){if(!oa)return;u("8E4"+a)};this.pauseSession=function(a,c){if(!oa)return;
u("8EB"+(c?1:0)+"\t"+a)};this.closeSession=function(a){if(!oa)return;u("8EB2"+"\t"+a)};this.requestControl=function(){if(!oa)return;u("8E2")};this.saveSession=function(a){if(!oa)return;u("8E9"+(a.save?1:0)+"\t"+(a.timeout||0)+"\t"+(a.id||0))};this.allowJoin=function(a,c){if(!oa)return;u("8EA"+a+"\t"+(c?1:0))};var Ib=new function(){function a(){if(b&&b.length>0){var c=b.shift();Ib.sendSingleKey(c.down,c.key);if(b.length>0)setTimeout(a,f);else b=null}}var c={" ":57,"space":57,"pgup":201,"pageup":201,
"pgdn":209,"pagedown":209,"end":207,"home":199,"left":203,"up":200,"right":205,"down":208,"printscreen":183,"insert":210,"del":211,"delete":211,"altgr":184,"windows":219,"windowsright":220,"context":221,"esc":1,"backspace":14,"tab":15,"enter":28,"meta":29,"command":29,"ctrl":29,"shift":42,"alt":56,"capslock":58,"f1":59,"f2":60,"f3":61,"f4":62,"f5":63,"f6":64,"f7":65,"f8":66,"f9":67,"f10":68,"f11":87,"f12":88,"numlock":69,"scrolllock":70,"add":78};this.sendSingleKey=function(a,d){var b=c[d.toLowerCase()];
if(b)O.writeScancode(a,b);else{var f=d.length;if(f==0)return;if(f==1)O.writeKeyCode(a,d.toUpperCase().charCodeAt(0));else if(a)O.writeText(d)}};var b=null;var f=0;this.sendKeyComb=function(c,r){var e=c.split("+");var y=e.length;var l=0;if(y==0)return;var F=null;var q=new Array;for(l=0;l<y;l++){var g=e[l];if(g==""&&F=="")g="Add";if(g!="")q.push({"key":g,"down":true});F=g}y=q.length;for(l=y-1;l>=0;l--)q.push({"key":q[l].key,"down":false});if(!r)for(l=0,y=q.length;l<y;l++)Ib.sendSingleKey(q[l].down,
q[l].key);else{b=q;f=r;a()}}};this.writeRawInput=function(a){u(a);if(O.onactivity)O.onactivity(a);if(xa){var c=a.substring(0,2);var b=a.substring(2);if(c=="80"||c=="81"||c=="82"||c=="83"){var f=b.split("\t");var r=new Uint8Array(7);var e=0;var y=0;var l=0;y=parseInt(f[0]);l=parseInt(f[1]);var F=parseInt(c,16);switch(F){case 128:e=("0"==f[2]?4096:8192)|32768;break;case 129:e="0"==f[2]?4096:8192;break;case 130:e=2048;break;case 131:e="0"==f[2]?640|32768:896|32768}r[0]=1<<5;r[1]=e&255;r[2]=e>>8;r[3]=
y&255;r[4]=y>>8;r[5]=l&255;r[6]=l>>8;xa.add(new RecordingObj(r,0,7,60))}}};var da=new Pa;var ua=0;this.resetStatus=a;this.notify=function(a,c){a="8E6"+a;if(c)a+="\t"+c.join(";");u(a)};this.run=function(){Va()};this.getDesktop=function(){return w};var za=new hi5.DataBuffer([],0,0);this.suppressOutput=function(a){if(!O.sessionInfo.suppressOutput)return false;if(a==undefined)a=true;var c=new Uint8Array(a?3:11);c[0]=146;c[1]=3;c[2]=a?1:0;if(!a){c[3]=0;c[4]=0;c[5]=0;c[6]=0;c[7]=I-1;c[8]=I-1>>8;c[9]=Q-
1;c[10]=Q-1>>8}ha.send(c.buffer);return true};this.refreshOutput=function(a,c,b,f){var r=new Uint8Array(b?11:3);r[0]=146;r[1]=3;r[2]=2;if(b){r[3]=a;r[4]=a>>8;r[5]=c;r[6]=c>>8;r[7]=b;r[8]=b>>8;r[9]=f;r[10]=f>>8}ha.send(r.buffer)};this.sendKeyboardSynchronize=function(a,c,b){var f=0;if(b)f=f|4;if(c)f=f|2;if(a)f=f|1;u("8E5"+f);this.capsLock=b;this.numLock=c};var bb=new ab;var Ga=new NSCodecBitmap;var xb=new y(ea);var Fb=new NSCodec;var eb=Fb.process;var Xb=[1,2,1,0,0,0,0,1,1,2,1,1,0,2,3,1,2,2,2,2,1,
2,1,0,2,1,2,3];var Ta={readVar4Bytes:function(a){var c=a.getByte();var b=(c&192)>>6;var f=0;switch(b){case 0:f=c&63;break;case 1:f=(c&63)<<8;f|=a.getByte();break;case 2:f=(c&63)<<16;c=a.getByte();f|=c<<8;c=a.getByte();f|=c;break;case 3:f=(c&63)<<24;c=a.getByte();f|=c<<16;c=a.getByte();f|=c<<8;c=a.getByte();f|=c}return f},readVar2Bytes:function(a){var c=a.getByte();if((c&128)!=0)return(c&127)<<8|a.getByte();else return c}};this._unload=Wa;this.close=function(){Ba=true;svGlobal.logger.info("closing...");
if(ha&&ha.readyState!=WebSocket.CLOSING&&ha.readyState!=WebSocket.CLOSED)try{for(;ha&&ha.readyState!=WebSocket.CLOSING&&ha.readyState!=WebSocket.CLOSED;){if(!Ka&&ha.readyState==WebSocket.OPEN)u("85-1");ha.close()}}finally{Wa()}else Wa()}}
function BulkData(){function z(b){return b&511^b>>>9^b>>>4^b>>>7}function I(b){return b&31^b>>>5^b>>>9}function Q(b){var e;e=(b>>>8^b&255)>>>2&15;if(b>>>9!=0)e=~e;e=e&65535;return e%12}function m(b){var e;e=b>>>4&15;return(e^e>>>2^e>>>3)&3}function w(b){b=(b&1431655765)<<1|b>>>1&1431655765;b=(b&858993459)<<2|b>>>2&858993459;b=(b&252645135)<<4|b>>>4&252645135;if(b>>>8==0)return b;b=(b&16711935)<<8|b>>>8&16711935;if(b>>>16==0)return b;b=(b&65535)<<16|b>>>16&65535;return b}function ea(b){var e=k[z(b)];
if((e^b)>>>9!=0)return e&511;else return k[R[Q(b)]]}function n(b){var e=S[I(b)];if((e^b)>>>5!=0)return e&31;else return S[Y[m(b)]]}function P(b,e){var g=b[2]|b[3]<<16;g<<=16;b[2]=g&65535;b[3]=g>>>16&65535;var h=b[0]|b[1]<<16;g|=h>>>16;b[2]=g&65535;b[3]=g>>>16&65535;h=h<<16|e;b[0]=h&65535;b[1]=h>>>16&65535}function x(b,e){var g=b[0];b[0]=b[e];b[e]=g}function h(f,g,h,k){var m=C;var q=D;var l=B;var Z=0|0;var ka=0;var R=0;var a;var Y=0;var S=g;var z=0|0;var L=0;var X=0;var U=0;var I=0;var t=0|0;v=0;e=
l;if((k&64)!=0){M(m,l-32768,m,0,32768);l=32768;B=l;e=32768}if((k&128)!=0){l=0;K(m,0,65536,0);K(q,0,q.length,0);e=0}if((k&32)!=32){M(f,0,m,l,h);l+=h;v=l-B;B=l;return 0}U=0;for(var Q=g+h;S<Q;){t=f[S++];Z|=t<<U;L+=8;U+=8;if(U>=32)break}Z=w(Z);if(S<Q){z=w(f[S++])&255;X=8}else X=0;for(;L>=8;){ka=0;for(I=5;I<=13;I++){if(I==12)continue;t=w(Z&4294967295<<32-I);t=ea(t);if(I==b[t])break}Z<<=I;L-=I;if(t<256)m[l++]=t&255;else if(t>256&&t<289){a=t-257;U=G[a];ka=J[a]-1;if(U!=0)ka+=w(Z&4294967295<<32-U);P(q,ka);
Z<<=U;L-=U}else if(t>288&&t<293){a=t-289;ka=q[a];if(a!=0)x(q,a)}else if(t==256)break;for(U=32-L;U>0;)if(X<U){t=z>>>8-X;Z|=t<<32-L-X;L+=X;U-=X;if(S<Q){z=w(f[S++])&255;X=8}else{U=0;X=0}}else if(X>U){Z|=z>>>8-U;z<<=U;z&=255;X-=U;L=32;break}else{Z|=z>>>8-U;L=32;if(S<Q){z=w(f[S++])&255;X=8}else X=0;break}if(ka==0)continue;for(I=2;I<=9;I++){t=w(Z&4294967295<<32-I);t=n(t);if(I==u[t])break}Z<<=I;L-=I;U=A[t];R=p[t];if(U!=0)R+=w(Z&4294967295<<32-U);Z<<=U;L-=U;Y=l-ka;U=R>ka?ka:R;for(t=0;U>0;){m[l++]=m[Y++];
U--}for(;R>ka;){t=t>=ka?0:t;m[l++]=m[Y+t++];R--}for(U=32-L;U>0;)if(X<U){t=z>>>8-X;Z|=t<<32-L-X;L+=X;U-=X;if(S<Q){z=w(f[S++])&255;X=8}else{U=0;X=0}}else if(X>U){Z|=z>>>8-U;z<<=U;z&=255;X-=U;L=32;break}else{Z|=z>>>8-U;L=32;if(S<Q){z=w(f[S++])&255;X=8}else X=0;break}}if((k&128)!=0)v=l;else v=l-B;B=l;return 0}function g(b,g,h,k){var n;var q=0;var l;var m=0;var D;var x;var a;var u;var A;var p=(k&1)!=0;var w=C;if((k&32)==0){e=0;v=h;return 0}if((k&64)!=0)B=0;if((k&128)!=0){for(var G=65536;--G>=0;)w[G]=0;
B=0}e=0;v=0;l=B;D=l;u=D;e=u;if(h==0)return 0;h+=m;do{if(q==0){if(m>=h)break;l=b[g+m++]<<24;q=8}if(l>=0){if(q<8){if(m>=h){if(l!=0)return-1;break}l|=b[g+m++]<<24-q;q+=8}if(D>=65536)return-1;w[D++]=l>>>24&255;l<<=8;q-=8;continue}l<<=1;if(--q==0){if(m>=h)return-1;l=b[g+m++]<<24;q=8}if(l>=0){if(q<8){if(m>=h)return-1;l|=b[g+m++]<<24-q;q+=8}if(D>=65536)return-1;w[D++]=(l>>>24|128)&255;l<<=8;q-=8;continue}l<<=1;if(--q<(p?3:2)){if(m>=h)return-1;l|=b[g+m++]<<24-q;q+=8}if(p)switch(l>>>29){case 7:for(;q<9;q+=
8){if(m>=h)return-1;l|=b[g+m++]<<24-q}l<<=3;x=l>>>26;l<<=6;q-=9;break;case 6:for(;q<11;q+=8){if(m>=h)return-1;l|=b[g+m++]<<24-q}l<<=3;x=(l>>>24)+64;l<<=8;q-=11;break;case 5:case 4:for(;q<13;q+=8){if(m>=h)return-1;l|=b[g+m++]<<24-q}l<<=2;x=(l>>>21)+320;l<<=11;q-=13;break;default:for(;q<17;q+=8){if(m>=h)return-1;l|=b[g+m++]<<24-q}l<<=1;x=(l>>>16)+2368;l<<=16;q-=17}else switch(l>>>30){case 3:if(q<8){if(m>=h)return-1;l|=b[g+m++]<<24-q;q+=8}l<<=2;x=l>>>26;l<<=6;q-=8;break;case 2:for(;q<10;q+=8){if(m>=
h)return-1;l|=b[g+m++]<<24-q}l<<=2;x=(l>>>24)+64;l<<=8;q-=10;break;default:for(;q<14;q+=8){if(m>=h)return-1;l|=b[g+m++]<<24-q}x=(l>>>18)+320;l<<=14;q-=14}if(q==0){if(m>=h)return-1;l=b[g+m++]<<24;q=8}a=0;if(l>=0){a=3;l<<=1;q--}else{A=p?14:11;do{l<<=1;if(--q==0){if(m>=h)return-1;l=b[g+m++]<<24;q=8}if(l>=0)break;if(--A==0)return-1}while(true);a=(p?16:13)-A;l<<=1;if(--q<a)for(;q<a;q+=8){if(m>=h)return-1;l|=b[g+m++]<<24-q}A=a;a=l>>>32-A&~(-1<<A)|1<<A;l<<=A;q-=A}if(D+a>=65536)return-1;n=D-x&(p?65535:8191);
do w[D++]=w[n++];while(--a!=0)}while(true);B=D;e=u;v=D-u;return 0}var B=0;var C=new Uint8Array(65536);var D=new Int32Array(8);var e=0;var v=0;var b=[6,6,6,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,9,8,9,9,9,9,8,8,9,9,9,9,9,9,8,9,9,10,9,9,9,9,9,9,9,10,9,10,10,10,9,9,10,9,10,9,10,9,9,9,10,10,9,10,9,9,8,9,9,9,9,10,10,10,9,9,10,10,10,10,10,10,9,9,10,10,10,10,10,10,10,9,10,10,10,10,10,10,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,10,10,10,10,10,10,9,10,10,10,10,10,10,9,7,9,9,10,9,10,10,10,9,10,10,10,10,10,
10,10,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,13,10,10,10,10,10,10,11,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,10,10,10,10,9,10,10,10,10,10,9,10,10,10,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,8,9,9,10,9,10,10,10,9,10,10,10,9,9,8,7,13,13,7,7,10,7,7,6,6,6,6,5,6,6,6,5,6,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,8,5,6,7,7];var k=[123,65311,65293,65063,65024,65285,65303,65128,197,65031,65299,65216,65288,65048,65307,65203,
65027,162,65090,65296,65035,65026,65169,65305,65152,233,65082,65301,65042,87,65239,65309,65294,65077,65129,65314,65304,65146,65025,65315,65300,65268,65204,65033,65308,65220,65289,65120,65136,65298,65029,65170,65185,65306,65039,65287,65110,65302,65282,65240,65256,65310,65053,59,65535,65286,65535,65137,65161,65535,65535,65068,65067,65056,65535,65211,65231,65032,65535,65248,65037,65535,65177,65535,65028,65194,65097,65535,65047,65121,65247,65535,65279,65270,65100,65535,65535,65159,65535,65316,65535,65084,
65138,65535,65535,65230,65535,65278,65535,65059,65212,65034,65193,65535,65041,65535,65154,65535,65030,65178,65269,65535,65058,65101,65119,65535,65283,65249,65535,65226,65228,65535,65049,65535,65207,65535,65535,65155,65065,65535,65535,65535,65132,65535,65261,65535,65535,65094,65116,65045,65535,65243,65190,65535,65535,65092,65535,65036,65535,65173,65276,65535,65535,65208,5833,65535,65264,65535,65080,65535,65535,65133,65150,65535,65535,65535,65535,65115,65244,65535,65535,65260,65095,65055,65535,65151,
65174,65535,65535,65189,65535,65040,65088,65074,65215,65535,65535,65236,65265,65535,65535,65535,65141,65535,65535,65165,65073,65535,65125,65051,65535,65252,65275,65535,65535,65106,65535,65038,65535,65181,65199,65535,65535,65105,65235,65535,65312,65535,65071,65535,65535,65217,65164,65535,65535,65535,65087,65535,65535,65142,65535,65274,65107,65061,65535,65124,65253,65535,65535,65198,65535,65043,65535,65160,65182,65535,65091,65535,65535,65188,65171,65535,65535,65535,65085,65535,65535,65259,65241,65535,
65044,65114,65535,65064,65149,65535,65535,65130,65535,65535,65281,65222,65224,65535,65535,65205,65535,65535,65535,65172,65144,65535,65535,65535,65187,65535,65535,65242,65112,65535,65054,65093,65258,65535,65131,65535,65535,65079,65535,65535,65535,65148,65206,65535,65535,65272,65535,65535,65535,65223,65179,65535,65535,65535,65104,65535,65535,65197,65250,65535,65050,65123,65102,65535,65535,65273,65535,65139,65535,65535,65535,65072,65163,65535,65535,65213,65070,256,65535,65262,65234,65535,65535,65535,
65196,65535,65535,65180,65156,65535,65060,65103,65271,65535,65535,65251,65122,65535,65535,65535,65535,65162,65140,65535,65535,65086,65535,65535,65535,65233,65214,65535,65535,65069,65535,65098,65267,65535,65535,65245,65118,65046,65535,65096,65192,65535,65195,65175,65535,65535,65232,65535,65535,65229,65209,65535,65535,65535,65066,65535,65535,65158,65134,65535,65535,65535,65246,65535,65535,65117,65099,65057,65535,65263,65176,65535,65535,65153,65535,65535,65535,65191,65535,65210,65277,65535,65535,65535,
65227,65535,65535,65135,65081,65535,65535,65535,65157,65535,268,65254,65127,65052,65535,65108,65202,65535,65535,65183,65535,65535,65535,65113,65201,65535,65218,65535,65535,65078,65266,65535,65535,65238,65143,65535,65535,65535,65075,65535,65535,65167,65109,65062,266,65284,65255,65535,289,65126,65535,65535,65535,65200,65184,65535,271,65168,65535,65535,65237,65535,65535,65219,65076,65535,65535,65535,65166,65535,273,65145,65089,267];var R=[511,0,508,448,494,347,486,482];var u=[4,2,3,4,3,4,4,5,4,5,5,6,
6,7,7,8,7,8,8,9,9,8,9,9,9,9,9,9,9,9,9,9];var S=[4065,4064,4066,4072,14,4069,4068,4074,4081,4067,21,4071,4079,70,4080,4077,4095,4087,4091,25,4093,4084,300,4075,4094,4086,4090,137,4092,4083,4088,4082];var Y=[0,4,10,19];var G=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,14,14,15];var J=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,32769,49153,65537];var A=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,6,6,8,
8,14,14];var p=[2,3,4,5,6,7,8,9,10,12,14,16,18,22,26,30,34,42,50,58,66,82,98,114,130,194,258,514,2,2];var L=new hi5.DataBuffer(C,0,1);var M=hi5.Arrays.arraycopy;var K=hi5.Arrays.fill;this.reset=function(){B=0;C=new Uint8Array(65536);e=0;v=0;L=new hi5.DataBuffer(C,0,1)};this.release=function(){D=null;L=null;C=null};this.getArrayBuffer=function(){return C.buffer.slice(e,e+v)};this.getData=function(){L.setPosition(e);L.markEnd(e+v);return L};this.toPDU=function(){var b=new Uint8Array(65536+8+32);b[0]=
29;b[2]=1;b[3]=2;b[4]=B;b[5]=B>>8;b[6]=B>>16;b[7]=B>>24;b.set(C,8);b.set(new Uint8Array(D.buffer),65536+8);return b};this.fromStream=function(b){B=b.getLittleEndian32();var e=b.getPosition();C.set(b.getData().subarray(e,e+65536));b.skipPosition(65536);for(var g=0;g<8;g++)D[g]=b.getLittleEndian32()};this.getDecompressedLength=function(){return v};this.dec=function(b,e,k,n){if((n&15)==2)return h(b,e,k,n);else return g(b,e,k,n)}}
var rdpBitmap=new function(){function z(m,w,z,n,P,x){var h=0;var g=0;var B=0;var C=0;var D=0;var e=0;var v=0;var b=0;var k=0;var R=0;var u=w;for(var S=x;g<n;){x=S+z*n*4-(g+1)*z*4;e=0;R=x;h=0;if(k==0)for(;h<z;){B=m[w++];D=B&15;C=B>>4&15;b=D<<4|C;if(b<=47&&b>=16){D=b;C=0}for(;C>0;){e=m[w++];P[x]=e;x+=4;h++;C--}for(;D>0;){P[x]=e;x+=4;h++;D--}}else for(;h<z;){B=m[w++];D=B&15;C=B>>4&15;b=D<<4|C;if(b<=47&&b>=16){D=b;C=0}for(;C>0;){v=m[w++];if((v&1)!=0){v=v>>1;v=v+1;e=-v}else{v=v>>1;e=v}v=P[k+h*4]+e;P[x]=
v;x+=4;h++;C--}for(;D>0;){v=P[k+h*4]+e;P[x]=v;x+=4;h++;D--}}g++;k=R}return w-u}function I(m,w,z,n,P,x){var h=0;var g=0;var B=0;var C=0;var D=0;var e=0;var v=0;var b=0;var k=w;for(var R=x;g<n;){x=R+z*n*4-(g+1)*z*4;b=x;h=0;if(v==0)for(;h<z;){B=m[w++];D=B&15;C=B>>4&15;e=D<<4|C;if(e<=47&&e>=16){D=e;C=0}for(;C>0;){w++;P[x]=255;x+=4;h++;C--}for(;D>0;){P[x]=255;x+=4;h++;D--}}else for(;h<z;){B=m[w++];D=B&15;C=B>>4&15;e=D<<4|C;if(e<=47&&e>=16){D=e;C=0}for(;C>0;){w++;P[x]=255;x+=4;h++;C--}for(;D>0;){P[x]=255;
x+=4;h++;D--}}g++;v=b}return w-k}function Q(m,w,z,n,P,x){var h;var g;for(g=0;g<n;g++)for(h=0;h<z;h++)P[x+((n-g-1)*z+h)*4]=m[w+(g*z+h)]}this.decompressInt16=function(m,w,z,n,P){var x=-1;var h=-1;var g=P;var B=0;var C=g+z;var D=0;var e=0;var v=0;var b=m;var k=-1;var R=0;var u=0;var S=0;var Y=0;var G=0;var J=0;var A=4294967295;var p=0;var L=false;var M=false;var K=false;for(var f=new Uint32Array(m*w);g<C;){R=0;u=n[g++];D=u>>4;switch(D){case 12:case 13:case 14:D-=6;e=u&15;v=16;break;case 15:D=u&15;if(D<
9){e=n[g++];e|=n[g++]<<8}else e=D<11?8:1;v=0;break;default:D>>=1;e=u&31;v=32}if(v!=0){K=D==2||D==7;if(e==0)if(K)e=n[g++]+1;else e=n[g++]+v;else if(K)e<<=3}switch(D){case 0:if(k==D&&!(b==m&&x==-1))L=true;break;case 8:p=n[g++]|n[g++]<<8;S=4278190080|(p>>8&248|p>>13&7)|(p>>3&252|p>>9&3)<<8|(p<<3&248|p>>2&7)<<16;case 3:p=n[g++]|n[g++]<<8;Y=4278190080|(p>>8&248|p>>13&7)|(p>>3&252|p>>9&3)<<8|(p<<3&248|p>>2&7)<<16;break;case 6:case 7:p=n[g++]|n[g++]<<8;A=4278190080|(p>>8&248|p>>13&7)|(p>>3&252|p>>9&3)<<
8|(p<<3&248|p>>2&7)<<16;D-=5;break;case 9:J=3;D=2;R=3;break;case 10:J=5;D=2;R=5}k=D;for(G=0;e>0;){if(b>=m){b=0;w--;x=h;h=B+w*m}switch(D){case 0:if(L){if(x==-1)f[h+b]=A;else f[h+b]=f[x+b]^A|4278190080;L=false;e--;b++}if(x==-1){for(;(e&~7)!=0&&b+8<m;)for(var H=0;H<8;H++){f[h+b]=4278190080;e--;b++}for(;e>0&&b<m;){f[h+b]=4278190080;e--;b++}}else{for(;(e&~7)!=0&&b+8<m;)for(H=0;H<8;H++){f[h+b]=f[x+b];e--;b++}for(;e>0&&b<m;){f[h+b]=f[x+b];e--;b++}}break;case 1:if(x==-1){for(;(e&~7)!=0&&b+8<m;)for(H=0;H<
8;H++){f[h+b]=A;e--;b++}for(;e>0&&b<m;){f[h+b]=A;e--;b++}}else{for(;(e&~7)!=0&&b+8<m;)for(H=0;H<8;H++){f[h+b]=f[x+b]^A|4278190080;e--;b++}for(;e>0&&b<m;){f[h+b]=f[x+b]^A|4278190080;e--;b++}}break;case 2:if(x==-1){for(;(e&~7)!=0&&b+8<m;)for(H=0;H<8;H++){G<<=1;G=G&255;if(G==0){J=R!=0?R&255:n[g++];G=1}if((J&G)!=0)f[h+b]=A;else f[h+b]=4278190080;e--;b++}for(;e>0&&b<m;){G<<=1;G=G&255;if(G==0){J=R!=0?R&255:n[g++];G=1}if((J&G)!=0)f[h+b]=A;else f[h+b]=4278190080;e--;b++}}else{for(;(e&~7)!=0&&b+8<m;)for(H=
0;H<8;H++){G<<=1;G=G&255;if(G==0){J=R!=0?R&255:n[g++];G=1}if((J&G)!=0)f[h+b]=f[x+b]^A|4278190080;else f[h+b]=f[x+b];e--;b++}for(;e>0&&b<m;){G<<=1;G=G&255;if(G==0){J=R!=0?R&255:n[g++];G=1}if((J&G)!=0)f[h+b]=f[x+b]^A|4278190080;else f[h+b]=f[x+b];e--;b++}}break;case 3:for(;(e&~7)!=0&&b+8<m;)for(H=0;H<8;H++){f[h+b]=Y;e--;b++}for(;e>0&&b<m;){f[h+b]=Y;e--;b++}break;case 4:for(;(e&~7)!=0&&b+8<m;)for(H=0;H<8;H++){p=n[g++]|n[g++]<<8;f[h+b]=4278190080|(p>>8&248|p>>13&7)|(p>>3&252|p>>9&3)<<8|(p<<3&248|p>>2&
7)<<16;e--;b++}for(;e>0&&b<m;){p=n[g++]|n[g++]<<8;f[h+b]=4278190080|(p>>8&248|p>>13&7)|(p>>3&252|p>>9&3)<<8|(p<<3&248|p>>2&7)<<16;e--;b++}break;case 8:for(;(e&~7)!=0&&b+8<m;)for(H=0;H<8;H++){if(M){f[h+b]=Y;M=false}else{f[h+b]=S;M=true;e++}e--;b++}for(;e>0&&b<m;){if(M){f[h+b]=Y;M=false}else{f[h+b]=S;M=true;e++}e--;b++}break;case 13:for(;(e&~7)!=0&&b+8<m;)for(H=0;H<8;H++){f[h+b]=4294967295;e--;b++}for(;e>0&&b<m;){f[h+b]=4294967295;e--;b++}break;case 14:for(;(e&~7)!=0&&b+8<m;)for(H=0;H<8;H++){f[h+b]=
4278190080;e--;b++}for(;e>0&&b<m;){f[h+b]=4278190080;e--;b++}break;default:e--;b++}}}return f};this.byte2int=function(m,w,z){if(!w)w=m.length;if(!z)z=0;var n=Math.floor(w/4);var P=new Uint32Array(n);var x=0;for(var h=0;h<n;h++){x=(h<<2)+z;P[h]=(m[x+3]&255)<<24|m[x+2]&255|(m[x+1]&255)<<8|(m[x+0]&255)<<16}return P};this.decompressInt32=function(m,w,ea,n,P){var x=n[P];var h=0;var g=P+1;var B=m*w;var C=new Uint32Array(B*4);var D=x&16;var e=x&32;if(e==0){h=I(n,g,m,w,C,3);g+=h}else{var v=0;for(var b=0;b<
B;b++){v=b<<2;C[v+3]=255}}if(D!=0){h=z(n,g,m,w,C,2);g+=h;h=z(n,g,m,w,C,1);g+=h;h=z(n,g,m,w,C,0)}else{h=Q(n,g,m,w,C,2);g+=B;h=Q(n,g,m,w,C,1);g+=B;h=Q(n,g,m,w,C,0)}return rdpBitmap.byte2int(C)};this.decompressInt24=function(m,w,z,n,P){var x=-1;var h=-1;var g=P;var B=0;var C=g+z;var D=0;var e=0;var v=0;var b=m;var k=-1;var R=0;var u=0;var S=0;var Y=0;var G=0;var J=0;var A=4294967295;var p=false;var L=false;var M=false;for(var K=new Uint32Array(m*w);g<C;){R=0;u=n[g++];D=u>>4;switch(D){case 12:case 13:case 14:D-=
6;e=u&15;v=16;break;case 15:D=u&15;if(D<9){e=n[g++];e|=n[g++]<<8}else e=D<11?8:1;v=0;break;default:D>>=1;e=u&31;v=32}if(v!=0){M=D==2||D==7;if(e==0)if(M)e=n[g++]+1;else e=n[g++]+v;else if(M)e<<=3}switch(D){case 0:if(k==D&&!(b==m&&x==-1))p=true;break;case 8:S=4278190080|n[g++]<<16|n[g++]<<8|n[g++];case 3:Y=4278190080|n[g++]<<16|n[g++]<<8|n[g++];break;case 6:case 7:A=4278190080|n[g++]<<16|n[g++]<<8|n[g++];D-=5;break;case 9:J=3;D=2;R=3;break;case 10:J=5;D=2;R=5}k=D;for(G=0;e>0;){if(b>=m){b=0;w--;x=h;
h=B+w*m}switch(D){case 0:if(p){if(x==-1)K[h+b]=A;else K[h+b]=K[x+b]^A|4278190080;p=false;e--;b++}if(x==-1){for(;(e&~7)!=0&&b+8<m;)for(var f=0;f<8;f++){K[h+b]=4278190080;e--;b++}for(;e>0&&b<m;){K[h+b]=4278190080;e--;b++}}else{for(;(e&~7)!=0&&b+8<m;)for(f=0;f<8;f++){K[h+b]=K[x+b];e--;b++}for(;e>0&&b<m;){K[h+b]=K[x+b];e--;b++}}break;case 1:if(x==-1){for(;(e&~7)!=0&&b+8<m;)for(f=0;f<8;f++){K[h+b]=A;e--;b++}for(;e>0&&b<m;){K[h+b]=A;e--;b++}}else{for(;(e&~7)!=0&&b+8<m;)for(f=0;f<8;f++){K[h+b]=K[x+b]^A|
4278190080;e--;b++}for(;e>0&&b<m;){K[h+b]=K[x+b]^A|4278190080;e--;b++}}break;case 2:if(x==-1){for(;(e&~7)!=0&&b+8<m;)for(f=0;f<8;f++){G<<=1;G=G&255;if(G==0){J=R!=0?R&255:n[g++];G=1}if((J&G)!=0)K[h+b]=A;else K[h+b]=4278190080;e--;b++}for(;e>0&&b<m;){G<<=1;G=G&255;if(G==0){J=R!=0?R&255:n[g++];G=1}if((J&G)!=0)K[h+b]=A;else K[h+b]=4278190080;e--;b++}}else{for(;(e&~7)!=0&&b+8<m;)for(f=0;f<8;f++){G<<=1;G=G&255;if(G==0){J=R!=0?R&255:n[g++];G=1}if((J&G)!=0)K[h+b]=K[x+b]^A|4278190080;else K[h+b]=K[x+b];e--;
b++}for(;e>0&&b<m;){G<<=1;G=G&255;if(G==0){J=R!=0?R&255:n[g++];G=1}if((J&G)!=0)K[h+b]=K[x+b]^A|4278190080;else K[h+b]=K[x+b];e--;b++}}break;case 3:for(;(e&~7)!=0&&b+8<m;)for(f=0;f<8;f++){K[h+b]=Y;e--;b++}for(;e>0&&b<m;){K[h+b]=Y;e--;b++}break;case 4:for(;(e&~7)!=0&&b+8<m;)for(f=0;f<8;f++){K[h+b]=4278190080|n[g++]<<16|n[g++]<<8|n[g++];e--;b++}for(;e>0&&b<m;){K[h+b]=4278190080|n[g++]<<16|n[g++]<<8|n[g++];e--;b++}break;case 8:for(;(e&~7)!=0&&b+8<m;)for(f=0;f<8;f++){if(L){K[h+b]=Y;L=false}else{K[h+b]=
S;L=true;e++}e--;b++}for(;e>0&&b<m;){if(L){K[h+b]=Y;L=false}else{K[h+b]=S;L=true;e++}e--;b++}break;case 13:for(;(e&~7)!=0&&b+8<m;)for(f=0;f<8;f++){K[h+b]=4294967295;e--;b++}for(;e>0&&b<m;){K[h+b]=4294967295;e--;b++}break;case 14:for(;(e&~7)!=0&&b+8<m;)for(f=0;f<8;f++){K[h+b]=4278190080;e--;b++}for(;e>0&&b<m;){K[h+b]=4278190080;e--;b++}}}}return K};this.decompress=function(m,w,z,n,P){var x=n;var h=-1;var g=0;var B=P;var C=0;var D=z+B;var e=0;var v=0;var b=0;var k=m;var R=-1;var u=0;var S=0;var Y=0;
var G=0;var J=0;var A=0;var p=4294967295;var L=false;var M=false;var K=false;var f=new Array(m*w);for(f[0]=0;B<D;){u=0;S=x[B++];e=S>>4;switch(e){case 12:case 13:case 14:e-=6;v=S&15;b=16;break;case 15:e=S&15;if(e<9){v=x[B++];v|=x[B++]<<8}else v=e<11?8:1;b=0;break;default:e>>=1;v=S&31;b=32}if(b!=0){K=e==2||e==7;if(v==0)if(K)v=x[B++]+1;else v=x[B++]+b;else if(K)v<<=3}switch(e){case 0:if(R==e&&!(k==m&&h==-1))L=true;break;case 8:Y=x[B++];case 3:G=x[B++];break;case 6:case 7:p=x[B++];e-=5;break;case 9:A=
3;e=2;u=3;break;case 10:A=5;e=2;u=5}R=e;for(J=0;v>0;){if(k>=m){k=0;w--;h=g;g=C+w*m}switch(e){case 0:if(L){if(h==-1)f[g+k]=p;else f[g+k]=f[h+k]^p;L=false;v--;k++}if(h==-1){for(;(v&~7)!=0&&k+8<m;)for(var H=0;H<8;H++){f[g+k]=0;v--;k++}for(;v>0&&k<m;){f[g+k]=0;v--;k++}}else{for(;(v&~7)!=0&&k+8<m;)for(H=0;H<8;H++){f[g+k]=f[h+k];v--;k++}for(;v>0&&k<m;){f[g+k]=f[h+k];v--;k++}}break;case 1:if(h==-1){for(;(v&~7)!=0&&k+8<m;)for(H=0;H<8;H++){f[g+k]=p;v--;k++}for(;v>0&&k<m;){f[g+k]=p;v--;k++}}else{for(;(v&~7)!=
0&&k+8<m;)for(H=0;H<8;H++){f[g+k]=f[h+k]^p;v--;k++}for(;v>0&&k<m;){f[g+k]=f[h+k]^p;v--;k++}}break;case 2:if(h==-1){for(;(v&~7)!=0&&k+8<m;)for(H=0;H<8;H++){J<<=1;J=J&255;if(J==0){A=u!=0?u:x[B++];J=1}if((A&J)!=0)f[g+k]=p;else f[g+k]=0;v--;k++}for(;v>0&&k<m;){J<<=1;J=J&255;if(J==0){A=u!=0?u:x[B++];J=1}if((A&J)!=0)f[g+k]=p;else f[g+k]=0;v--;k++}}else{for(;(v&~7)!=0&&k+8<m;)for(H=0;H<8;H++){J<<=1;J=J&255;if(J==0){A=u!=0?u:x[B++];J=1}if((A&J)!=0)f[g+k]=f[h+k]^p;else f[g+k]=f[h+k];v--;k++}for(;v>0&&k<m;){J<<=
1;J=J&255;if(J==0){A=u!=0?u:x[B++];J=1}if((A&J)!=0)f[g+k]=f[h+k]^p;else f[g+k]=f[h+k];v--;k++}}break;case 3:for(;(v&~7)!=0&&k+8<m;)for(H=0;H<8;H++){f[g+k]=G;v--;k++}for(;v>0&&k<m;){f[g+k]=G;v--;k++}break;case 4:for(;(v&~7)!=0&&k+8<m;)for(H=0;H<8;H++){f[g+k]=x[B++];v--;k++}for(;v>0&&k<m;){f[g+k]=x[B++];v--;k++}break;case 8:for(;(v&~7)!=0&&k+8<m;)for(H=0;H<8;H++){if(M){f[g+k]=G;M=false}else{f[g+k]=Y;M=true;v++}v--;k++}for(;v>0&&k<m;){if(M){f[g+k]=G;M=false}else{f[g+k]=Y;M=true;v++}v--;k++}break;case 13:for(;(v&
~7)!=0&&k+8<m;)for(H=0;H<8;H++){f[g+k]=255;v--;k++}for(;v>0&&k<m;){f[g+k]=255;v--;k++}break;case 14:for(;(v&~7)!=0&&k+8<m;)for(H=0;H<8;H++){f[g+k]=0;v--;k++}for(;v>0&&k<m;){f[g+k]=0;v--;k++}break;default:v--;k++}}}return f}};
function MSGSMEncoder(){function z(a,c){var b=0;for(var e=0;e<160;e++){b=a[c++];Xa[e]=b<0?b*32768:b*32767}}function I(){La=!La;var a=0;Q();var c=0;if(La){c=X[0]<<4|X[1]<<10;N[a++]=c>>4;c=c>>5|X[2]<<11;N[a++]=c>>7;c=c>>5|X[3]<<11;c=c>>4|X[4]<<12;N[a++]=c>>6;c=c>>4|X[5]<<12;c=c>>3|X[6]<<13;N[a++]=c>>7;c=c>>3|X[7]<<13;c=c>>7|U[0]<<9;N[a++]=c>>5;c=c>>2|t[0]<<14;c=c>>2|va[0]<<14;c=c>>6|ta[0]<<10;N[a++]=c>>3;c=c>>3|E[0]<<13;N[a++]=c>>8;c=c>>3|E[1]<<13;c=c>>3|E[2]<<13;c=c>>3|E[3]<<13;N[a++]=c>>7;c=c>>3|
E[4]<<13;c=c>>3|E[5]<<13;c=c>>3|E[6]<<13;N[a++]=c>>6;c=c>>3|E[7]<<13;c=c>>3|E[8]<<13;N[a++]=c>>8;c=c>>3|E[9]<<13;c=c>>3|E[10]<<13;c=c>>3|E[11]<<13;N[a++]=c>>7;c=c>>3|E[12]<<13;c=c>>7|U[1]<<9;N[a++]=c>>5;c=c>>2|t[1]<<14;c=c>>2|va[1]<<14;c=c>>6|ta[1]<<10;N[a++]=c>>3;c=c>>3|E[13]<<13;N[a++]=c>>8;c=c>>3|E[14]<<13;c=c>>3|E[15]<<13;c=c>>3|E[16]<<13;N[a++]=c>>7;c=c>>3|E[17]<<13;c=c>>3|E[18]<<13;c=c>>3|E[19]<<13;N[a++]=c>>6;c=c>>3|E[20]<<13;c=c>>3|E[21]<<13;N[a++]=c>>8;c=c>>3|E[22]<<13;c=c>>3|E[23]<<13;c=
c>>3|E[24]<<13;N[a++]=c>>7;c=c>>3|E[25]<<13;c=c>>7|U[2]<<9;N[a++]=c>>5;c=c>>2|t[2]<<14;c=c>>2|va[2]<<14;c=c>>6|ta[2]<<10;N[a++]=c>>3;c=c>>3|E[26]<<13;N[a++]=c>>8;c=c>>3|E[27]<<13;c=c>>3|E[28]<<13;c=c>>3|E[29]<<13;N[a++]=c>>7;c=c>>3|E[30]<<13;c=c>>3|E[31]<<13;c=c>>3|E[32]<<13;N[a++]=c>>6;c=c>>3|E[33]<<13;c=c>>3|E[34]<<13;N[a++]=c>>8;c=c>>3|E[35]<<13;c=c>>3|E[36]<<13;c=c>>3|E[37]<<13;N[a++]=c>>7;c=c>>3|E[38]<<13;c=c>>7|U[3]<<9;N[a++]=c>>5;c=c>>2|t[3]<<14;c=c>>2|va[3]<<14;c=c>>6|ta[3]<<10;N[a++]=c>>
3;c=c>>3|E[39]<<13;N[a++]=c>>8;c=c>>3|E[40]<<13;c=c>>3|E[41]<<13;c=c>>3|E[42]<<13;N[a++]=c>>7;c=c>>3|E[43]<<13;c=c>>3|E[44]<<13;c=c>>3|E[45]<<13;N[a++]=c>>6;c=c>>3|E[46]<<13;c=c>>3|E[47]<<13;N[a++]=c>>8;c=c>>3|E[48]<<13;c=c>>3|E[49]<<13;c=c>>3|E[50]<<13;N[a++]=c>>7;c=c>>3|E[51]<<13;N[a]=c>>12;Ya=N[a]}else{c=Ya<<6|X[0]<<10;N[a++]=c>>6;c=c>>6|X[1]<<10;N[a++]=c>>8;c=c>>5|X[2]<<11;c=c>>5|X[3]<<11;N[a++]=c>>6;c=c>>4|X[4]<<12;c=c>>4|X[5]<<12;N[a++]=c>>6;c=c>>3|X[6]<<13;c=c>>3|X[7]<<13;N[a++]=c>>8;c=c>>
7|U[0]<<9;c=c>>2|t[0]<<14;N[a++]=c>>7;c=c>>2|va[0]<<14;c=c>>6|ta[0]<<10;N[a++]=c>>7;c=c>>3|E[0]<<13;c=c>>3|E[1]<<13;c=c>>3|E[2]<<13;N[a++]=c>>6;c=c>>3|E[3]<<13;c=c>>3|E[4]<<13;N[a++]=c>>8;c=c>>3|E[5]<<13;c=c>>3|E[6]<<13;c=c>>3|E[7]<<13;N[a++]=c>>7;c=c>>3|E[8]<<13;c=c>>3|E[9]<<13;c=c>>3|E[10]<<13;N[a++]=c>>6;c=c>>3|E[11]<<13;c=c>>3|E[12]<<13;N[a++]=c>>8;c=c>>7|U[1]<<9;c=c>>2|t[1]<<14;N[a++]=c>>7;c=c>>2|va[1]<<14;c=c>>6|ta[1]<<10;N[a++]=c>>7;c=c>>3|E[13]<<13;c=c>>3|E[14]<<13;c=c>>3|E[15]<<13;N[a++]=
c>>6;c=c>>3|E[16]<<13;c=c>>3|E[17]<<13;N[a++]=c>>8;c=c>>3|E[18]<<13;c=c>>3|E[19]<<13;c=c>>3|E[20]<<13;N[a++]=c>>7;c=c>>3|E[21]<<13;c=c>>3|E[22]<<13;c=c>>3|E[23]<<13;N[a++]=c>>6;c=c>>3|E[24]<<13;c=c>>3|E[25]<<13;N[a++]=c>>8;c=c>>7|U[2]<<9;c=c>>2|t[2]<<14;N[a++]=c>>7;c=c>>2|va[2]<<14;c=c>>6|ta[2]<<10;N[a++]=c>>7;c=c>>3|E[26]<<13;c=c>>3|E[27]<<13;c=c>>3|E[28]<<13;N[a++]=c>>6;c=c>>3|E[29]<<13;c=c>>3|E[30]<<13;N[a++]=c>>8;c=c>>3|E[31]<<13;c=c>>3|E[32]<<13;c=c>>3|E[33]<<13;N[a++]=c>>7;c=c>>3|E[34]<<13;
c=c>>3|E[35]<<13;c=c>>3|E[36]<<13;N[a++]=c>>6;c=c>>3|E[37]<<13;c=c>>3|E[38]<<13;N[a++]=c>>8;c=c>>7|U[3]<<9;c=c>>2|t[3]<<14;N[a++]=c>>7;c=c>>2|va[3]<<14;c=c>>6|ta[3]<<10;N[a++]=c>>7;c=c>>3|E[39]<<13;c=c>>3|E[40]<<13;c=c>>3|E[41]<<13;N[a++]=c>>6;c=c>>3|E[42]<<13;c=c>>3|E[43]<<13;N[a++]=c>>8;c=c>>3|E[44]<<13;c=c>>3|E[45]<<13;c=c>>3|E[46]<<13;N[a++]=c>>7;c=c>>3|E[47]<<13;c=c>>3|E[48]<<13;c=c>>3|E[49]<<13;N[a++]=c>>6;c=c>>3|E[50]<<13;c=c>>3|E[51]<<13;N[a++]=c>>8}}function Q(){var a=0;var c=0;var b=0;var e=
120;var l=new Int16Array(50);var q=new Int16Array(160);m(q);v(q,X);f(ya,X,q);var g=ya.dp0;var h=0;var k=0;for(var V=0;V<=3;V++,a+=13){C(q,V*40,l,g,g,e,U,t,c++);Y(l,ta,va,b++,E,a);for(h=0;h<=39;h++){k=l[5+h]+g[h+e];g[h+e]=k<-32768?-32768:k>32767?32767:k}e+=40}for(h=0;h<120;h++)g[h]=g[160+h]}function m(a){var c=0;var b=0;var e=ya.z1;var f=ya.l_z2;var l=ya.mp;var q=0;var g=0;var h=0;var k=0;var m=0;var t=0;for(var B=160;B!=0;){B--;k=Xa[c++]>>3<<2<<16>>16;q=k-e<<16>>16;e=k;m=q;m<<=15;g=f>>15<<16>>16;
h=f-(g<<15)<<16>>16;m+=n(h,32735);t=g*32735;f=P(t,m);t=P(f,16384);g=n(l,-28180);l=t>>15<<16>>16;var v=l+g;a[b++]=v<-32768?-32768:v>32767?32767:v}ya.z1=e;ya.l_z2=f;ya.mp=l}function w(a,c){var b=0;var e=La?32:33;for(b=0;b<e;b++)a[b+c]=N[b];return e}function ea(a,c){if(a==-32768&&c==-32768)return 32767;else return a*c>>15<<16>>16}function n(a,c){if(a==-32768&&c==-32768)return 32767;else{var b=a*c+16384;b>>=15;return b<<16>>16}}function P(a,c){var b=0;if(a<=0)if(c>=0)return a+c;else{b=-(a+1)-(c+1);return b>=
2147483647?-2147483648:-b-2}else if(c<=0)return a+c;else{b=a+c;return b>2147483647?2147483647:b}}function x(a){if(a<0){if(a<=-1073741824)return 0;a=~a}return((a&4294901760)!=0?(a&4278190080)!=0?-1+Ma[255&a>>24]:7+Ma[255&a>>16]:(a&65280)!=0?15+Ma[255&a>>8]:23+Ma[255&a])<<16>>16}function h(a,c){if(c>=16)return 0;if(c<=-16)if(a<0)return-1;else return-0;if(c<0)return g(a,-c);return a<<c<<16>>16}function g(a,c){if(c>=16)if(a<0)return-1;else return-0;if(c<=-16)return 0;if(c<0)return a<<-c<<16>>16;return a>>
c<<16>>16}function B(a,c){var b=a;var e=c;var f=0;var l=15;if(a==0)return 0;for(;l!=0;){l--;f=f<<17>>16;b<<=1;if(b>=e){b-=e;f++}}return f<<16>>16}function C(a,c,b,f,l,q,g,h,k){D(a,c,f,q,h,g,k);e(h[k],g[k],f,a,c,l,b,q)}function D(a,c,b,e,f,l,q){var g=0;var h=0;var k=new Int16Array(40);var n=0;var m=0;var t=0;var B=0;var v=0;var D=0;var C=0;for(var A=0;A<=39;A++){C=a[A+c];C=(C<0?C==-32768?32767:-C:C)<<16>>16;if(C>v)v=C}C=0;if(v==0)D=0;else C=x(v<<16);if(C>6)D=0;else D=6-C<<16>>16;for(A=0;A<=39;A++)k[A]=
a[A+c]>>D;n=0;h=40;for(g=40;g<=120;g++){var u=0;var p=1;u=k[0]*b[e-g];u+=k[1]*b[p+e-g];p++;u+=k[2]*b[p+e-g];p++;u+=k[3]*b[p+e-g];p++;u+=k[4]*b[p+e-g];p++;u+=k[5]*b[p+e-g];p++;u+=k[6]*b[p+e-g];p++;u+=k[7]*b[p+e-g];p++;u+=k[8]*b[p+e-g];p++;u+=k[9]*b[p+e-g];p++;u+=k[10]*b[p+e-g];p++;u+=k[11]*b[p+e-g];p++;u+=k[12]*b[p+e-g];p++;u+=k[13]*b[p+e-g];p++;u+=k[14]*b[p+e-g];p++;u+=k[15]*b[p+e-g];p++;u+=k[16]*b[p+e-g];p++;u+=k[17]*b[p+e-g];p++;u+=k[18]*b[p+e-g];p++;u+=k[19]*b[p+e-g];p++;u+=k[20]*b[p+e-g];p++;
u+=k[21]*b[p+e-g];p++;u+=k[22]*b[p+e-g];p++;u+=k[23]*b[p+e-g];p++;u+=k[24]*b[p+e-g];p++;u+=k[25]*b[p+e-g];p++;u+=k[26]*b[p+e-g];p++;u+=k[27]*b[p+e-g];p++;u+=k[28]*b[p+e-g];p++;u+=k[29]*b[p+e-g];p++;u+=k[30]*b[p+e-g];p++;u+=k[31]*b[p+e-g];p++;u+=k[32]*b[p+e-g];p++;u+=k[33]*b[p+e-g];p++;u+=k[34]*b[p+e-g];p++;u+=k[35]*b[p+e-g];p++;u+=k[36]*b[p+e-g];p++;u+=k[37]*b[p+e-g];p++;u+=k[38]*b[p+e-g];p++;u+=k[39]*b[p+e-g];p++;if(u>n){h=g<<16>>16;n=u}}l[q]=h;n<<=1;n=n>>6-D;m=0;for(A=0;A<=39;A++){var Z=0;Z=b[A-
h+e]>>3<<16>>16;m+=Z*Z}m<<=1;if(n<=0){f[q]=0;return}if(n>=m){f[q]=3;return}C=x(m);t=n<<C>>16<<16>>16;B=m<<C>>16<<16>>16;for(var w=0;w<=2;w++){if(t<=ea(B,kb[w]))break;f[q]=w}}function e(a,c,b,e,f,l,g,q){var k=0;var h=0;var m=0;switch(a){case 0:k=3277;for(h=0;h<=39;h++){l[h+q]=n(k,b[h-c+q]);m=e[h+f]-l[h+q];g[h+5]=m<-32768?-32768:m>32767?32767:m}break;case 1:k=11469;for(h=0;h<=39;h++){l[h+q]=n(k,b[h-c+q]);m=e[h+f]-l[h+q];g[h+5]=m<-32768?-32768:m>32767?32767:m}break;case 2:k=21299;for(h=0;h<=39;h++){l[h+
q]=n(k,b[h-c+q]);m=e[h+f]-l[h+q];g[h+5]=m<-32768?-32768:m>32767?32767:m}break;case 3:k=32767;for(h=0;h<=39;h++){l[h+q]=n(k,b[h-c+q]);m=e[h+f]-l[h+q];g[h+5]=m<-32768?-32768:m>32767?32767:m}}}function v(a,c){b(a);k(c);R(c);u(c)}function b(a){var c=0;var b=0;var e=0;var f=0;var l=0;var g=0;var q=0;for(g=0;g<=159;g++){q=a[g]+0;e=q<-32768?-32768:q>32767?32767:q;if(e>f)f=e}if(f==0)l=0;else l=4-x(f<<16)<<16>>16;if(l>0)switch(l){case 1:for(g=0;g<=159;g++)a[g]=n(a[g],16384);break;case 2:for(g=0;g<=159;g++)a[g]=
n(a[g],16384>>1);break;case 3:for(g=0;g<=159;g++)a[g]=n(a[g],16384>>2);break;case 4:for(g=0;g<=159;g++)a[g]=n(a[g],16384>>3)}var h=a;var k=h[b];var m=[0,0,0,0,0,0,0,0,0];Qa(m,0,T,0,T.length);T[0]+=k*h[b-0];k=h[++b];T[0]+=k*h[b-0];T[1]+=k*h[b-1];k=h[++b];T[0]+=k*h[b-0];T[1]+=k*h[b-1];T[2]+=k*h[b-2];k=h[++b];T[0]+=k*h[b-0];T[1]+=k*h[b-1];T[2]+=k*h[b-2];T[3]+=k*h[b-3];k=h[++b];T[0]+=k*h[b-0];T[1]+=k*h[b-1];T[2]+=k*h[b-2];T[3]+=k*h[b-3];T[4]+=k*h[b-4];k=h[++b];T[0]+=k*h[b-0];T[1]+=k*h[b-1];T[2]+=k*h[b-
2];T[3]+=k*h[b-3];T[4]+=k*h[b-4];T[5]+=k*h[b-5];k=h[++b];T[0]+=k*h[b-0];T[1]+=k*h[b-1];T[2]+=k*h[b-2];T[3]+=k*h[b-3];T[4]+=k*h[b-4];T[5]+=k*h[b-5];T[6]+=k*h[b-6];k=h[++b];T[0]+=k*h[b-0];T[1]+=k*h[b-1];T[2]+=k*h[b-2];T[3]+=k*h[b-3];T[4]+=k*h[b-4];T[5]+=k*h[b-5];T[6]+=k*h[b-6];T[7]+=k*h[b-7];k=h[++b];for(c=b;c<160;++c){k=h[c];T[0]+=k*h[c-0];T[1]+=k*h[c-1];T[2]+=k*h[c-2];T[3]+=k*h[c-3];T[4]+=k*h[c-4];T[5]+=k*h[c-5];T[6]+=k*h[c-6];T[7]+=k*h[c-7];T[8]+=k*h[c-8]}for(g=0;g<9;g++)T[g]<<=1;if(l>0)for(g=0;g<
160;g++)a[g]<<=l}function k(a){var c=new Int16Array(1);var b=0;var e=0;var f=new Int16Array(9);var l=new Int16Array(9);var g=new Int16Array(9);if(T[0]==0){for(e=0;e<8;e++)a[e]=0;return}c[0]=x(T[0]);for(e=0;e<=8;e++)f[e]=T[e]<<c[0]>>16;Qa(f,0,g,0,7);Qa(f,0,l,0,8);for(var h=1;h<=8;h++,b++){c[0]=l[1];c[0]=(c[0]<0?c[0]==-32768?32767:-c[0]:c[0])<<16>>16;if(l[0]<c[0]){for(e=h;e<8;e++)a[e]=0;return}a[b]=B(c[0],l[0]);if(l[1]>0)a[b]=-a[b];if(h==8)return;c[0]=n(l[1],a[b]);var k=l[0]+c[0];l[0]=k<-32768?-32768:
k>32767?32767:k;for(var q=1;q<=8-h;q++){c[0]=n(g[q],a[b]);var m=l[q+1]+c[0];l[q]=m<-32768?-32768:m>32767?32767:m;c[0]=n(l[q+1],a[b]);var p=g[q]+c[0];g[q]=p<-32768?-32768:p>32767?32767:p}}}function R(a){var c;for(var b=0;b<8;b++){c=a[b];c=(c<0?c==-32768?32767:-c:c)<<16>>16;if(c<22118)c>>=1;else if(c<31130)c-=11059;else{c-=26112;c<<=2}a[b]=a[b]<0?-c:c}}function u(a){var c=0;S(20480,0,31,-32,a,c++);S(20480,0,31,-32,a,c++);S(20480,2048,15,-16,a,c++);S(20480,-2560,15,-16,a,c++);S(13964,94,7,-8,a,c++);
S(15360,-1792,7,-8,a,c++);S(8534,-341,3,-4,a,c++);S(9036,-1144,3,-4,a,c++)}function S(a,c,b,e,f,l){var g=0;g=ea(a<<16>>16,f[l]);var h=g+(c<<16>>16);g=h<-32768?-32768:h>32767?32767:h;var k=g+256;g=k<-32768?-32768:k>32767?32767:k;g=g>>9<<16>>16;f[l]=(g>b?b-e:g<e?0:g-e)<<16>>16}function Y(a,c,b,e,f,l){var g=new Int16Array(13);var h=new Int16Array(13);G(a);J(g,b,e);p(g,f,l,c,e);M(f,h,l,Aa);K(b[e],h,a,Aa)}function G(a){var c=0;for(var b=0;b<=39;b++){c=8192>>1;c+=a[b+0]*-134+a[b+1]*-374+a[b+3]*2054+a[b+
4]*5741+a[b+5]*8192+a[b+6]*5741+a[b+7]*2054+a[b+9]*-374+a[b+10]*-134;c=c>>13<<16>>16;Ra[b]=c<-32768?-32768:c>32767?32767:c}}function J(a,c,b){var e=0;var f=0;var l=0;var g;e=0;e+=A(0,1)+A(0,2)+A(0,3)+A(0,4)+A(0,5)+A(0,6)+A(0,7)+A(0,8)+A(0,9)+A(0,10)+A(0,11)+A(0,12);g=e;e+=A(0,0);e<<=1;f=e;e=0;e+=A(1,0)+A(1,1)+A(1,2)+A(1,3)+A(1,4)+A(1,5)+A(1,6)+A(1,7)+A(1,8)+A(1,9)+A(1,10)+A(1,11)+A(1,12);e<<=1;if(e>f){l=1;f=e}e=0;e+=A(2,0)+A(2,1)+A(2,2)+A(2,3)+A(2,4)+A(2,5)+A(2,6)+A(2,7)+A(2,8)+A(2,9)+A(2,10)+A(2,
11)+A(2,12);e<<=1;if(e>f){l=2;f=e}e=g;e+=A(3,12);e<<=1;if(e>f){l=3;f=e}for(var h=0;h<=12;h++)a[h]=Ra[l+3*h];c[b]=l}function A(a,c){var b;b=Ra[a+3*c]>>2<<16>>16;return b*b}function p(a,c,b,e,f){var l=0;var g=0;var h=0;var k=0;var q=0;var m=0;var n=0;var p=0;var t=0;for(t=0;t<=12;t++){k=a[t];k=k<0?k==-32768?32767:-k:k;if(k>g)g=k}n=0;k=g>>9<<16>>16;l=0;for(t=0;t<=5;t++){if(k<=0)l|=1;else l|=0;k=k>>1<<16>>16;if(l==0)n++}k=n+5<<16>>16;var B=(g>>k<<16>>16)+(n<<3<<16>>16);h=B<-32768?-32768:B>32767?32767:
B;L(h,Aa);n=Na;p=Fa;q=6-n<<16>>16;m=lb[p];for(t=0;t<=12;t++){k=a[t]<<q<<16>>16;k=ea(k,m);k=k>>12<<16>>16;c[t+b]=k+4<<16>>16}Fa=p;Na=n;e[f]=h}function L(a,c){var b=0;var e=0;if(a>15)b=(a>>3<<16>>16)-1<<16>>16;e=a-(b<<3)<<16>>16;if(e==0){b=-4;e=7}else{for(;e<=7;){e=(e<<1|1)<<16>>16;b--}e-=8}if(c==Aa){Na=b;Fa=e}else{Za=b;$a=e}}function M(a,c,b,e){var f=0;var l=0;var k=0;var q=0;var m=0;var p=0;if(e==Aa){l=Va[Fa];m=6-Na<<16>>16;k=m<-32768?-32768:m>32767?32767:m}else{l=Va[$a];m=6-Za<<16>>16;k=m<-32768?
-32768:m>32767?32767:m}m=k-1;q=h(1,m<-32768?-32768:m>32767?32767:m);ab=0;for(var t=0;t<13;t++){f=(a[b++]<<1)-7<<16>>16;f=f<<28>>16;f=n(l,f);p=f+q;f=p<-32768?-32768:p>32767?32767:p;c[ab++]=g(f,k)}}function K(a,c,b,e){var f=13;var l=0;var g=0;if(e==Aa)g=5;else g=0;switch(a){case 3:b[g++]=0;do{b[g++]=0;b[g++]=0;b[g++]=c[l++];--f}while(f!=0);break;case 2:do{b[g++]=0;b[g++]=0;b[g++]=c[l++];--f}while(f!=0);break;case 1:do{b[g++]=0;b[g++]=c[l++];b[g++]=0;--f}while(f!=0);break;case 0:do{b[g++]=c[l++];b[g++]=
0;b[g++]=0;--f}while(f!=0)}if(e==Aa)b[g++]=0}function f(a,c,b){var e=new Int16Array(8);var f=a.j;var g=f;g^=1;a.j=g;var h=a.larpp[f];var k=a.larpp[g];H(c,h);Ea(k,h,e);Z(e);ka(a,e,13,b,0);ma(k,h,e);Z(e);ka(a,e,14,b,13);q(k,h,e);Z(e);ka(a,e,13,b,27);l(h,e);Z(e);ka(a,e,120,b,40)}function H(a,c){var b=0;var e=0;na(a,c,e++,b,0,-32,13107);na(a,c,e++,b,0,-32,13107);na(a,c,e++,b,2048,-16,13107);na(a,c,e++,b,-2560,-16,13107);na(a,c,e++,b,94,-8,19223);na(a,c,e++,b,-1792,-8,17476);na(a,c,e++,b,-341,-4,31454);
na(a,c,e++,b,-1144,-4,29708)}function na(a,c,b,e,f,l,g){var h=a[b]+l;e=(h<-32768?-32768:h>32767?32767:h)<<26>>16;var k=e-(f<<17>>16);e=k<-32768?-32768:k>32767?32767:k;e=n(g,e);var q=e+e;c[b]=q<-32768?-32768:q>32767?32767:q}function Ea(a,c,b){for(var e=0;e<8;e++){var f=(a[e]>>2<<16>>16)+(c[e]>>2<<16>>16);b[e]=f<-32768?-32768:f>32767?32767:f;var l=b[e]+(a[e]>>1<<16>>16);b[e]=l<-32768?-32768:l>32767?32767:l}}function ma(a,c,b){for(var e=0;e<8;e++){var f=(a[e]>>1<<16>>16)+(c[e]>>1<<16>>16);b[e]=f<-32768?
-32768:f>32767?32767:f}}function q(a,c,b){for(var e=0;e<8;e++){var f=(a[e]>>2<<16>>16)+(c[e]>>2<<16>>16);b[e]=f<-32768?-32768:f>32767?32767:f;var l=b[e]+(c[e]>>1<<16>>16);b[e]=l<-32768?-32768:l>32767?32767:l}}function l(a,c){for(var b=0;b<8;b++)c[b]=a[b]}function Z(a){var c=0;var b=0;for(var e=0;e<8;e++)if(a[e]<0){c=(a[e]==-32768?32767:-a[e])<<16>>16;b=(c>>2<<16>>16)+26112;a[e]=-(c<11059?c<<1:c<20070?c+11059:b<-32768?-32768:b>32767?32767:b)<<16>>16}else{c=a[e];b=(c>>2<<16>>16)+26112;a[e]=(c<11059?
c<<1:c<20070?c+11059:b<-32768?-32768:b>32767?32767:b)<<16>>16}}function ka(a,c,b,e,f){var l=a.u;var g=0;var h=0;var k=0;var q=0;var m=0;var p=0;var t=0;for(var B=0;b!=0;){b--;g=q=e[f];for(p=0;p<8;p++){k=l[p];m=c[p];l[p]=q;h=n(m,g);t=k+h;q=t<-32768?-32768:t>32767?32767:t;h=n(m,k);B=g+h;g=B<-32768?-32768:B>32767?32767:B}e[f++]=g}a.u=l}function Pa(){this.dp0=new Int16Array(280);this.z1=0;this.l_z2=0;this.mp=0;this.u=new Int16Array(8);this.larpp=[new Int16Array(8),new Int16Array(8)];this.j=0;this.nrp=
40;this.v=new Int16Array(9);this.msr=0}var a=33;var kb=[6554,16384,26214,32767];var lb=[29128,26215,23832,21846,20165,18725,17476,16384];var Va=[18431,20479,22527,24575,26623,28671,30719,32767];var ya=new Pa;var X=new Int16Array(8);var U=new Int16Array(4);var va=new Int16Array(4);var t=new Int16Array(4);var ta=new Int16Array(4);var E=new Int16Array(13*4);var Xa=new Int16Array(160);var N=new Uint8Array(a);var Ya=0;var Qa=hi5.Arrays.arraycopy;var nb=hi5.Arrays.fill;this.encode=function(a,c,b,e){z(a,
c);I();return w(b,e)};var La=false;var Ma=[8,7,6,6,5,5,5,5,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var T=new Int32Array(9);var Na=0;var Fa=0;var Za=0;var $a=0;var ab=0;var Aa=0;var wb=1;var Ra=new Int16Array(40)}
function MSGSM(){function z(b,l,k,m,p,a,v,u){var A=0;H(na,0,160,0);H(Ea,0,40,0);var w=120;for(var z=0;z<=3;z++,A+=13){I(p[z],k[z],A,a,Ea);ea(l[z],m[z],Ea,w);f(Y,w,na,z*40,39)}var R=G[J];var S=G[J^=1];n(b,R);x(S,R,ma);C(ma);D(ma,13,na,v,0,u);h(S,R,ma);C(ma);D(ma,14,na,v,13,u);g(S,R,ma);C(ma);D(ma,13,na,v,27,u);B(R,ma);C(ma);D(ma,120,na,v,40,u);var t=0;var P=u;for(var E=u+160;E-- >u;P++){t=e(L,28180);L=v[P]+t;if(L<-32768)L=-32768;else if(L>32767)L=32767;t=L<<1;if(t<-32768)t=-32768;else if(t>32767)t=
32767;v[P]=t}}function I(b,e,f,g,h){var a=new Int32Array(13);if(!a.buffer)H(a,0,13,0);var k;k=Q(b);m(g,a,f,k[0],k[1]);w(e,a,h)}function Q(b){var e=0;var f=0;if(b>15)e=(b>>3)-1;f=b-(e<<3);if(f==0){e=-4;f=7}else{for(;f<=7;){f=f<<1|1;e--}f-=8}var g=new Array(2);g[0]=e;g[1]=f;return g}function m(f,l,g,h,m){var a;var n;var p;var B;n=u[m];p=b(6,h);B=k(1,b(p,1));var v=0;for(var C=0;C<13;C++){a=(f[g++]<<1)-7;a<<=12;a=e(n,a);a=a+B;if(a<-32768)a=-32768;else if(a>32767)a=32767;l[v++]=R(a,p)}}function w(b,e,
f){var g=13;var h=0;var a=0;switch(b){case 3:f[a++]=0;case 2:f[a++]=0;case 1:f[a++]=0;case 0:f[a++]=e[h++];g--}do{f[a++]=0;f[a++]=0;f[a++]=e[h++]}while(--g>0);for(;++b<4;)f[a++]=0}function ea(b,l,g,h){var k;var a;var m;m=b<40||b>120?A:b;A=m;k=S[l];for(var n=0;n<=39;n++){a=e(k,Y[n-m+h]);a=a+g[n];if(a<-32768)a=-32768;else if(a>32767)a=32767;Y[n+h]=a}f(Y,h-80,Y,h-120,120)}function n(b,e){var f=0;var g=0;P(b,e,g++,f,0,-32,13107);P(b,e,g++,f,0,-32,13107);P(b,e,g++,f,2048,-16,13107);P(b,e,g++,f,-2560,-16,
13107);P(b,e,g++,f,94,-8,19223);P(b,e,g++,f,-1792,-8,17476);P(b,e,g++,f,-341,-4,31454);P(b,e,g++,f,-1144,-4,29708)}function P(f,g,h,k,m,a,n){k=f[h]+a;if(k<-32768)k=-32768;else if(k>32767)k=32767;k<<=10;k=b(k,m<<1);k=e(n,k);k=k+k;if(k<-32768)k=-32768;else if(k>32767)k=32767;g[h]=k}function x(b,e,f){var g=0;for(var k=0;k<8;k++){g=(b[k]>>2)+(e[k]>>2);if(g<-32768)g=-32768;else if(g>32767)g=32767;g=g+(b[k]>>1);if(g<-32768)g=-32768;else if(g>32767)g=32767;f[k]=g}}function h(b,e,f){var g=0;for(var k=0;k<
8;k++){g=(b[k]>>1)+(e[k]>>1);if(g<-32768)g=-32768;else if(g>32767)g=32767;f[k]=g}}function g(b,e,f){var g=0;for(var k=0;k<8;k++){g=(b[k]>>2)+(e[k]>>2);if(g<-32768)g=-32768;else if(g>32767)g=32767;g=g+(e[k]>>1);if(g<-32768)g=-32768;else if(g>32767)g=32767;f[k]=g}}function B(b,e){for(var f=0;f<8;f++)e[f]=b[f]}function C(b){var e=0;for(var f=0;f<8;f++)if(b[f]<0){e=b[f]==-32768?32767:-b[f];b[f]=-(e<11059?e<<1:e<20070?e+11059:v(e>>2,26112))}else{e=b[f];b[f]=e<11059?e<<1:e<20070?e+11059:v(e>>2,26112)}}
function D(e,f,g,k,h,a){var m=0;var n=0;for(var B=0;f!=0;){f--;m=g[h];for(var v=7;v>=0;v--){n=e[v];B=p[v];B=((n==-32768&&B==-32768?32767:65535&n*B+16384>>15)&65535)<<16>>16;m=b(m,B);n=((n==-32768&&m==-32768?32767:65535&n*m+16384>>15)&65535)<<16>>16;n=p[v]+n;if(n<-32768)n=-32768;else if(n>32767)n=32767;p[v+1]=n}k[a+h++]=p[0]=m}}function e(b,e){if(b==-32768&&e==-32768)return 32767;else{var f=b*e+16384;f=(f>>15&65535)<<16>>16;return f}}function v(b,e){var f=b+e;return f<-32768?-32768:f>32767?32767:f}
function b(b,e){var f=b-e;return f<-32768?-32768:f>32767?32767:f}function k(b,e){if(e>=16)return 0;if(e<=-16)if(b<0)return-1;else return-0;if(e<0)return R(b,-e);return b<<e}function R(b,e){if(e>=16)if(b<0)return-1;else return 0;if(e<=-16)return 0;if(e<0)return b<<-e;return b>>e}var u=[18431,20479,22527,24575,26623,28671,30719,32767];var S=[3277,11469,21299,32767];var Y=new Int32Array(280);var G=[new Int32Array(8),new Int32Array(8)];var J=0;var A=40;var p=new Int32Array(9);var L=0;var M=new Int32Array(320);
M[0]=0;var K=[.1];var f=hi5.Arrays.arraycopy;var H=hi5.Arrays.fill;this.decode=function(b,e,f){var g=0;var k=0;var a=0;var h=0;var m=e+f;var n=new Int32Array(8);var p=new Int32Array(4);var B=new Int32Array(4);var v=new Int32Array(4);var u=new Int32Array(4);for(var t=new Int32Array(52);e<m;){a=0;a=b[e++]&255;n[0]=a&63;a=a>>>6;a|=b[e++]<<2&1023;n[1]=a&63;a=a>>>6;a|=b[e++]<<4&4095;n[2]=a&31;a=a>>>5;n[3]=a&31;a=a>>>5;a|=b[e++]<<2&1023;n[4]=a&15;a=a>>>4;n[5]=a&15;a=a>>>4;a|=b[e++]<<2&1023;n[6]=a&7;a=a>>>
3;n[7]=a&7;a=a>>>3;a|=b[e++]<<4&4095;p[0]=a&127;a=a>>>7;v[0]=a&3;a=a>>>2;B[0]=a&3;a=a>>>2;a|=b[e++]<<1&511;u[0]=a&63;a=a>>>6;t[0]=a&7;a=a>>>3;a=b[e++]&255;t[1]=a&7;a=a>>>3;t[2]=a&7;a=a>>>3;a|=b[e++]<<2&1023;t[3]=a&7;a=a>>>3;t[4]=a&7;a=a>>>3;t[5]=a&7;a=a>>>3;a|=b[e++]<<1&511;t[6]=a&7;a=a>>>3;t[7]=a&7;a=a>>>3;t[8]=a&7;a=a>>>3;a=b[e++]&255;t[9]=a&7;a=a>>>3;t[10]=a&7;a=a>>>3;a|=b[e++]<<2&1023;t[11]=a&7;a=a>>>3;t[12]=a&7;a=a>>>3;a|=b[e++]<<4&4095;p[1]=a&127;a=a>>>7;v[1]=a&3;a=a>>>2;B[1]=a&3;a=a>>>2;a|=
b[e++]<<1&511;u[1]=a&63;a=a>>>6;t[13]=a&7;a=a>>>3;a=b[e++]&255;t[14]=a&7;a=a>>>3;t[15]=a&7;a=a>>>3;a|=b[e++]<<2&1023;t[16]=a&7;a=a>>>3;t[17]=a&7;a=a>>>3;t[18]=a&7;a=a>>>3;a|=b[e++]<<1&511;t[19]=a&7;a=a>>>3;t[20]=a&7;a=a>>>3;t[21]=a&7;a=a>>>3;a=b[e++]&255;t[22]=a&7;a=a>>>3;t[23]=a&7;a=a>>>3;a|=b[e++]<<2&1023;t[24]=a&7;a=a>>>3;t[25]=a&7;a=a>>>3;a|=b[e++]<<4&4095;p[2]=a&127;a=a>>>7;v[2]=a&3;a=a>>>2;B[2]=a&3;a=a>>>2;a|=b[e++]<<1&511;u[2]=a&63;a=a>>>6;t[26]=a&7;a=a>>>3;a=b[e++]&255;t[27]=a&7;a=a>>>3;t[28]=
a&7;a=a>>>3;a|=b[e++]<<2&1023;t[29]=a&7;a=a>>>3;t[30]=a&7;a=a>>>3;t[31]=a&7;a=a>>>3;a|=b[e++]<<1&511;t[32]=a&7;a=a>>>3;t[33]=a&7;a=a>>>3;t[34]=a&7;a=a>>>3;a=b[e++]&255;t[35]=a&7;a=a>>>3;t[36]=a&7;a=a>>>3;a|=b[e++]<<2&1023;t[37]=a&7;a=a>>>3;t[38]=a&7;a=a>>>3;a|=b[e++]<<4&4095;p[3]=a&127;a=a>>>7;v[3]=a&3;a=a>>>2;B[3]=a&3;a=a>>>2;a|=b[e++]<<1&511;u[3]=a&63;a=a>>>6;t[39]=a&7;a=a>>>3;a=b[e++]&255;t[40]=a&7;a=a>>>3;t[41]=a&7;a=a>>>3;a|=b[e++]<<2&1023;t[42]=a&7;a=a>>>3;t[43]=a&7;a=a>>>3;t[44]=a&7;a=a>>>
3;a|=b[e++]<<1&511;t[45]=a&7;a=a>>>3;t[46]=a&7;a=a>>>3;t[47]=a&7;a=a>>>3;a=b[e++]&255;t[48]=a&7;a=a>>>3;t[49]=a&7;a=a>>>3;a|=b[e++]<<2&1023;t[50]=a&7;a=a>>>3;t[51]=a&7;a=a>>>3;z(n,p,B,v,u,t,M,0);a=a&15;a|=b[e++]<<4&4095;n[0]=a&63;a=a>>>6;n[1]=a&63;a=a>>>6;a=b[e++]&255;n[2]=a&31;a=a>>>5;a|=b[e++]<<3&2047;n[3]=a&31;a=a>>>5;n[4]=a&15;a=a>>>4;a|=b[e++]<<2&1023;n[5]=a&15;a=a>>>4;n[6]=a&7;a=a>>>3;n[7]=a&7;a=a>>>3;a=b[e++]&255;p[0]=a&127;a=a>>>7;a|=b[e++]<<1&511;v[0]=a&3;a=a>>>2;B[0]=a&3;a=a>>>2;a|=b[e++]<<
5&8191;u[0]=a&63;a=a>>>6;t[0]=a&7;a=a>>>3;t[1]=a&7;a=a>>>3;a|=b[e++]<<1&511;t[2]=a&7;a=a>>>3;t[3]=a&7;a=a>>>3;t[4]=a&7;a=a>>>3;a=b[e++]&255;t[5]=a&7;a=a>>>3;t[6]=a&7;a=a>>>3;a|=b[e++]<<2&1023;t[7]=a&7;a=a>>>3;t[8]=a&7;a=a>>>3;t[9]=a&7;a=a>>>3;a|=b[e++]<<1&511;t[10]=a&7;a=a>>>3;t[11]=a&7;a=a>>>3;t[12]=a&7;a=a>>>3;a=b[e++]&255;p[1]=a&127;a=a>>>7;a|=b[e++]<<1&511;v[1]=a&3;a=a>>>2;B[1]=a&3;a=a>>>2;a|=b[e++]<<5&8191;u[1]=a&63;a=a>>>6;t[13]=a&7;a=a>>>3;t[14]=a&7;a=a>>>3;a|=b[e++]<<1&511;t[15]=a&7;a=a>>>
3;t[16]=a&7;a=a>>>3;t[17]=a&7;a=a>>>3;a=b[e++]&255;t[18]=a&7;a=a>>>3;t[19]=a&7;a=a>>>3;a|=b[e++]<<2&1023;t[20]=a&7;a=a>>>3;t[21]=a&7;a=a>>>3;t[22]=a&7;a=a>>>3;a|=b[e++]<<1&511;t[23]=a&7;a=a>>>3;t[24]=a&7;a=a>>>3;t[25]=a&7;a=a>>>3;a=b[e++]&255;p[2]=a&127;a=a>>>7;a|=b[e++]<<1&511;v[2]=a&3;a=a>>>2;B[2]=a&3;a=a>>>2;a|=b[e++]<<5&8191;u[2]=a&63;a=a>>>6;t[26]=a&7;a=a>>>3;t[27]=a&7;a=a>>>3;a|=b[e++]<<1&511;t[28]=a&7;a=a>>>3;t[29]=a&7;a=a>>>3;t[30]=a&7;a=a>>>3;a=b[e++]&255;t[31]=a&7;a=a>>>3;t[32]=a&7;a=a>>>
3;a|=b[e++]<<2&1023;t[33]=a&7;a=a>>>3;t[34]=a&7;a=a>>>3;t[35]=a&7;a=a>>>3;a|=b[e++]<<1&511;t[36]=a&7;a=a>>>3;t[37]=a&7;a=a>>>3;t[38]=a&7;a=a>>>3;a=b[e++]&255;p[3]=a&127;a=a>>>7;a|=b[e++]<<1&511;v[3]=a&3;a=a>>>2;B[3]=a&3;a=a>>>2;a|=b[e++]<<5&8191;u[3]=a&63;a=a>>>6;t[39]=a&7;a=a>>>3;t[40]=a&7;a=a>>>3;a|=b[e++]<<1&511;t[41]=a&7;a=a>>>3;t[42]=a&7;a=a>>>3;t[43]=a&7;a=a>>>3;a=b[e++]&255;t[44]=a&7;a=a>>>3;t[45]=a&7;a=a>>>3;a|=b[e++]<<2&1023;t[46]=a&7;a=a>>>3;t[47]=a&7;a=a>>>3;t[48]=a&7;a=a>>>3;a|=b[e++]<<
1&511;t[49]=a&7;a=a>>>3;t[50]=a&7;a=a>>>3;t[51]=a&7;a=a>>>3;z(n,p,B,v,u,t,M,160);k=g++*320;for(h=0;h<320;h++)K[k++]=M[h]/32768}K.length=g*320;return K};var na=new Int32Array(160);var Ea=new Int32Array(40);var ma=new Int32Array(8)}
function NSCodecBitmap(){var z=new Uint32Array(10240);var I=0;var Q=new Uint8Array(10240);var m=0;var w=new Uint8Array(10240);var ea=0;var n=new Uint8Array(10240);var P=0;var x=new Uint8Array(0);var h=0;this.getData=function(){return z};this.getDataSize=function(){return I};this.resetData=function(g){if(z.length<g)z=new Uint32Array(g);I=g;return z};this.resetLumaPlane=function(g){if(Q.length<g)Q=new Uint8Array(g);m=g;return Q};this.getLumaPlanceSize=function(){return m};this.resetOrangeChromaPlane=
function(g){if(w.length<g)w=new Uint8Array(g);ea=g;return w};this.getOrangeChromaPlane=function(){return ea};this.resetGreenChromaPlane=function(g){if(n.length<g)n=new Uint8Array(g);P=g;return n};this.getGreenChromaPlane=function(){return P};this.resetAlphaPlane=function(g){if(x.length<g)x=new Uint8Array(g);h=g;return x};this.getAlphaPlane=function(){return h}}
function NSCodec(){function z(n,w,x,h,g,B,C,D,e){var v=0;var b=0;var k=0;var z=0;var u=0;var S=0;var Y=0;var G=0;var J=0;var A=0;var p=0;var L=0;var M=m(g,8);var K=C-1;for(b=0;b<B;b++){if(D>0){k=b*M;z=(b>>1)*(M>>1);u=(b>>1)*(M>>1)}else{k=b*g;z=b*g;u=b*g}for(v=0;v<g;v++){S=n[k]&255;Y=(w[z]&255)<<K<<24>>24;G=x[u]<<K<<24>>24;J=S+Y-G;A=S+G;p=S-Y-G;p=p<0?0:p>255?255:p;A=A<0?0:A>255?255:A;J=J<0?0:J>255?255:J;e[L++]=4278190080|p<<16|A<<8|J;k++;z+=D>0?v%2:1;u+=D>0?v%2:1}}}function I(m,z,x,h,g){if(x==0)ea(h,
0,g,255);else if(x<g)Q(m,z,h,g);else w(m,z,h,0,g)}function Q(m,w,x,h){var g=0;var B=0;var C=0;B=h;for(var D=0;B>4;){C=m[w++];if(B==5){x[D++]=C;B--}else if(C==m[w]){w++;if((m[w]&255)<255){g=m[w++]&255;g+=2}else{w++;g=(m[w+3]&255)<<24|(m[w+2]&255)<<16|(m[w+1]&255)<<8|m[w]&255;w+=4}ea(x,D,D+g,C);D+=g;B-=g}else{x[D++]=C;B--}}for(var e=0;e<4;e++)x[D++]=m[w++]}function m(m,w){return m+(~(m&w-1)+1&w-1)}var w=hi5.Arrays.arraycopy;var ea=hi5.Arrays.fill;this.process=function(n,w,x,h,g){var B=n.getLittleEndian32();
var C=n.getLittleEndian32();var D=n.getLittleEndian32();n.skipPosition(4);var e=n.getByte();var v=n.getByte();n.skipPosition(2);var b=n.getData();var k=n.getPosition();var R=x*h;var u=R*4;var S=g.resetData(R);var Y=m(x,8);var G=m(h,2);u=Y*G;var J=g.resetLumaPlane(u);var A=g.resetOrangeChromaPlane(u);var p=g.resetGreenChromaPlane(u);var L=x*h;var M=v>0?Y*h:L;var K=v>0?(Y>>1)*(G>>1):L;var f=v>0?K:L;I(b,k,B,J,M);k+=B;I(b,k,C,A,K);k+=C;I(b,k,D,p,f);k+=D;z(J,A,p,null,x,h,e,v,S);n.skipPosition(B+C+D)}}
function RfxBitStream(z,I,Q){var m=z;var w=Q;var ea=0;var n=8;var P=I;this.attach=function(x,h,g){m=x;w=g;ea=0;n=8;P=h};this.getBits=function(x){var h=x;var g=0;for(var B=0;ea<w&&h>0;){g=h;if(g>n)g=n;if(B!=0)B<<=g;B|=m[ea+P]>>n-g&(1<<g)-1;n-=g;h-=g;if(n==0){n=8;ea++}}return B};this.putBits=function(x,h){var g=x;var B=h;for(var C=0;ea<w&&B>0;){C=B;if(C>n)C=n;m[ea+P]|=(g>>B-C&(1<<C)-1)<<n-C;n-=C;B-=C;if(n==0){n=8;ea++}}};this.eos=function(){return ea>w};this.left=function(){return ea>=w?0:(w-ea-1)*
8+n};this.getProcessBytes=function(){return n<8?ea+1:ea}}function RemoteFXTile(){this.quantIdxY=0;this.quantIdxCb=0;this.quantIdxCr=0;this.YLen=0;this.CbLen=0;this.CrLen=0;this.x=0;this.y=0;this.data=new Uint32Array(4096)}
function RemoteFXDecoder(){function z(g,h,m,e){for(var n=0;n<4096;n++)e[n]=4278190080|m[n]<<16|h[n]<<8|g[n]}function I(g,h,m){var e=0;var n=0;var b=0;var k=0;var w=0;var u=0;var x=0;for(x=0;x<4096;x++){e=g[x];n=h[x];b=m[x];e=e+4096<<16;k=e+b*91947;w=e-n*22544-b*46792;u=e+n*115998;k=k>>21;w=w>>21;u=u>>21;g[x]=k<0?0:k>255?255:k;h[x]=w<0?0:w>255?255:w;m[x]=u<0?0:u>255?255:u}}function Q(g,h,n,e,v,b,k){x(g.et,e,v,b,k,4096,g.bitStream);P(k,4032,64);ea(k,h);m(k,g.dwtBuffer)}function m(g,h){w(g,3840,h,8);
w(g,3072,h,16);w(g,0,h,32)}function w(g,h,m,e){var n=0;var b=0;var k=0;var w=0;var u=0;var x=0;var z=0;var G=0;var J=0;var A=0;var p=0;var L=0;var M=0;A=e<<1;J=h+e*e*3;x=h;w=0;z=h+e*e;G=h+e*e*2;u=e*e*2;for(L=0;L<e;L++){m[w]=g[J]-(g[x]+g[x]+1>>1)<<16>>16;m[u]=g[z]-(g[G]+g[G]+1>>1)<<16>>16;for(M=1;M<e;M++){p=M<<1;m[w+p]=g[J+M]-(g[x+M-1]+g[x+M]+1>>1)<<16>>16;m[u+p]=g[z+M]-(g[G+M-1]+g[G+M]+1>>1)<<16>>16}for(M=0;M<e-1;M++){p=M<<1;m[w+p+1]=(g[x+M]<<1)+(m[w+p]+m[w+p+2]>>1)<<16>>16;m[u+p+1]=(g[G+M]<<1)+(m[u+
p]+m[u+p+2]>>1)<<16>>16}p=M<<1;m[w+p+1]=(g[x+M]<<1)+m[w+p]<<16>>16;m[u+p+1]=(g[G+M]<<1)+m[u+p]<<16>>16;J+=e;x+=e;w+=A;z+=e;G+=e;u+=A}for(p=0;p<A;p++){for(M=0;M<e;M++){L=M<<1;n=h+L*A+p;b=M*A+p;k=b+e*A;g[n]=m[b]-((M>0?m[k-A]:m[k])+m[k]+1>>1)<<16>>16}for(M=0;M<e;M++){L=M<<1;n=h+L*A+p;b=M*A+p;k=b+e*A;g[n+A]=(m[k]<<1)+(g[n]+g[n+(M<e-1?2*A:0)]>>1)<<16>>16}}}function ea(g,h){n(g,0,4096,5);n(g,0,1024,h[8]-6);n(g,1024,1024,h[7]-6);n(g,2048,1024,h[9]-6);n(g,3072,256,h[5]-6);n(g,3328,256,h[4]-6);n(g,3584,256,
h[6]-6);n(g,3840,64,h[2]-6);n(g,3904,64,h[1]-6);n(g,3968,64,h[3]-6);n(g,4032,64,h[0]-6)}function n(g,h,m,e){if(e==0)return;for(var n=h;m>0;n++,m--)g[n]<<=e}function P(g,h,m){var e;var n;for(e=h,n=h+1;m>1;e++,n++,m--)g[n]+=g[e]}function x(h,m,n,e,v,b,k){var w=1;var u=w<<3;var x=1;var z=x<<3;var G=0;var J=v;var A=0;var p=0;var L=0;if(k==null)k=new RfxBitStream(m,n,e);else k.attach(m,n,e);for(;!k.eos()&&b>0;){var M;if(w!=0){var K;for(var f;!k.eos();){G=k.getBits(1);if(G!=0)break;var H=1<<w;var I=H;if(I>
b)I=b;if(I>0){g(J,A,A+I,0);A+=I}b-=H;u+=4;if(u>80)u=80;if(u<0)u=0;w=u>>3}M=k.getBits(w);H=M;I=H;if(I>b)I=b;if(I>0){g(J,A,A+I,0);A+=I}b-=H;f=k.getBits(1);p=0;L=0;do{G=k.getBits(1);if(G==1)p++;else break}while(true);L=k.getBits(x);L|=p<<x;if(p==0){z+=-2;if(z>80)z=80;if(z<0)z=0;x=z>>3}else if(p!=1){z+=p;if(z>80)z=80;if(z<0)z=0;x=z>>3}K=L+1;if(b>0)J[A++]=f!=0?-K:K;b--;u+=-6;if(u>80)u=80;if(u<0)u=0;w=u>>3}else{var P;var Q;var q;p=0;L=0;do{G=k.getBits(1);if(G==1)p++;else break}while(true);L=k.getBits(x);
L|=p<<x;if(p==0){z+=-2;if(z>80)z=80;if(z<0)z=0;x=z>>3}else if(p!=1){z+=p;if(z>80)z=80;if(z<0)z=0;x=z>>3}K=L;if(h!=1){var l=K;for(P=0;l!=0;){l>>=1;P++}Q=k.getBits(P);q=K-Q;if(Q!=0&&q!=0){u+=-2*3;if(u>80)u=80;if(u<0)u=0;w=u>>3}else if(Q==0&&q==0){u+=2*3;if(u>80)u=80;if(u<0)u=0;w=u>>3}if(b>0)J[A++]=(Q&1)!=0?-1*(Q+1>>1):Q>>1;b--;if(b>0)J[A++]=(q&1)!=0?-1*(q+1>>1):q>>1;b--}else if(K==0){if(b>0)J[A++]=0;b--;u+=3;if(u>80)u=80;if(u<0)u=0;w=u>>3}else{if(b>0)J[A++]=(K&1)!=0?-1*(K+1>>1):K>>1;b--;u+=-3;if(u>
80)u=80;if(u<0)u=0;w=u>>3}}}return A}var h=hi5.Arrays.arraycopy;var g=hi5.Arrays.fill;this.decodeRgb=function(g,h,m,e,n,b,k,w,u,x){Q(g,m,n,h.getData(),h.getPosition(),e,g.yrBuffer);h.skipPosition(e);Q(g,m,k,h.getData(),h.getPosition(),b,g.cbgBuffer);h.skipPosition(b);Q(g,m,u,h.getData(),h.getPosition(),w,g.crbBuffer);h.skipPosition(w);I(g.yrBuffer,g.cbgBuffer,g.crbBuffer);z(g.yrBuffer,g.cbgBuffer,g.crbBuffer,x)}}
function RemoteFXBitmap(z){var I=[new hi5.graphic.Rectangle];var Q=[new RemoteFXTile];var m=0;var w=0;this.resetRects=function(w){if(I.length<w){var n=I.length;I.length=w;for(var z=n;z<w;z++)I[z]=new hi5.graphic.Rectangle}m=w;return I};this.resetTiles=function(m){var n=0;if(z){if(Q.length<m){var I=Q.length;Q.length=m;for(n=I;n<m;n++)Q[n]=new RemoteFXTile}}else for(;n<m;n++)Q[n]=new RemoteFXTile;w=m;return Q};this.getRectSize=function(){return m};this.getTileSize=function(){return w};this.getRects=
function(){return I};this.getTiles=function(){return Q}}function RemoteFXContext(){this.ctxId=0;this.tileSize=64;this.flags=0;this.cct=0;this.xft=0;this.et=0;this.qt=0;this.yrBuffer=new Int32Array(4096);this.cbgBuffer=new Int32Array(4096);this.crbBuffer=new Int32Array(4096);this.dwtBuffer=new Int32Array(32*32*2*2);var z=this;this.setProperties=function(I){z.flags=I&7;z.cct=I>>3&3;z.xft=I>>5&15;z.et=I>>9&15};this.bitStream=new RfxBitStream};
