var svManager={getInstance:function(){var l=window.$vnc;return l&&l.running&&l.running()?l:null}};function connvertServer(l){var t={};t.id=l.id;t.server=l.id;t.displayName=l.displayName||l.id;if(l=l.vnc){for(var O in l)t[O]=l[O];t.pwd=l.password||""}return t}
svGlobal.Vnc=function(l,t,O,T){function na(a,c){var e=[],d=null,f=new hi5.graphic.Rectangle(0,0,0,0),b="Uint8ClampedArray"in window;this.width=a;this.height=c;var g=!1,l=this;this.pause=function(a){g=a};this.isPaused=function(){return g};this.setContext=function(a){a!=d&&(d||!a||a.createImageData(1,1).data.buffer||(b=!1),d=a)};this.getContext=function(){return d};this.resize=function(d,f){for(var k=0;k<f;k++)e[k]=new Uint32Array(d);l.width=a=d;l.height=c=f};l.resize(a,c);this.getBuffer=function(){return e};
this.setRGB=function(a,d,c){e[d][a]=c|4278190080};this.getRGB=function(a,d){return e[d][a]};this.setRGBs=function(a,d,c,f,b,h,r){if(b){var g=0,m=0,l=a+c;f=d+f;if(b.subarray)for(;d<f;d++,h+=r)e[d].set(b.subarray(h,h+c),a);else for(;d<f;d++,h+=r)for(m=h,c=e[d],g=a;g<l;g++)c[g]=b[m++]}else console.log("pixel null")};this.moveArea=function(a,d,c,f,b,h){if(0<h)for(b=a+b,h=d+h,--f;0<=f;f--)e[h+f].set(e[d+f].subarray(a,a+c),b);else if(0>h){b=a+b;h=d+h;for(var g=0;g<f;g++)e[h+g].set(e[d+g].subarray(a,a+c),
b)}else if(0<b){b=a+b;h=d+h;var l,m;for(--c;0<=c;c--)for(l=b+c,m=a+c,g=0;g<f;g++)e[h+g][l]=e[d+g][m]}else{b=a+b;h=d+h;for(var u,g=0;g<c;g++)for(m=b+g,u=a+g,l=0;l<f;l++)e[h+l][m]=e[d+l][u]}};this.getRGBs=function(a,d,c,f){var b=_Uint32Array(c*f);b[0]=0;c=a+c;f=d+f;for(var h=0,g=d;g<f;g++)for(d=a;d<c;d++)b[h++]=e[g][d];return b};this.repaint=function(f,g,k,q){if(d){0>f&&(k+=f,f=0);0>g&&(q+=g,g=0);f+k>a&&(k=a-f);g+q>c&&(q=c-g);var l=d.createImageData(k,q),E=l.data,r=f+k;q=g+q;var p=0;if(b)for(var E=
new Uint32Array(E.buffer),m=g;m<q;m++)E.set(e[m].subarray(f,r),p),p+=k;else for(var u,n,m=g;m<q;m++)for(k=f;k<r;k++)u=e[m][k],n=p<<2,E[n]=u&255,E[n+1]=u>>8&255,E[n+2]=u>>16&255,E[n+3]=255,p++;d.putImageData(l,f,g)}};this.postPaint=function(a,d,c,e){0<f.width?f.union(a,d,c,e):(f.x=a,f.y=d,f.width=c,f.height=e)};this.commitPaint=function(){0<f.width&&(this.repaint(f.x,f.y,f.width,f.height),f.width=0)};this.fillRect=function(a,d,c,f,b){c=a+c;f=d+f;for(var h=d;h<f;h++)if(e[h].fill)e[h].fill(b,a,c);else{var g=
e[h];for(d=a;d<c;d++)g[d]=b}}}function aa(){var a=l.indexOf("://"),c=l.substring(a+3),a=c.indexOf("/");0<a&&(c=c.substring(0,a));return location.protocol+"//"+c}function oa(a){if(!sessionId)return"";a=hi5.browser.httpGet(aa()+"/CLIP?s="+sessionId+"&t="+(new Date).getTime(),!1);setTimeout(function(){p.send("883")},999);return a}function Q(a){return"on"==a||"true"==a}function K(a,c,e){this.need=a;this.handler=c;this.repeat=e||1}function ba(a){var c=0,e=0,d=new Uint8Array(a),f=this,b=new K(0,null,0);
this.getHandler=function(){return b};this.getData=function(){return d};this.getPosition=function(){return c};this.setPosition=function(a){c=a};this.getEnd=function(){return e};this.set=function(a,f,b){d=a;c=f;e=b};this.handle=function(){b.handler(f,b)};this.setHandler=function(a){a&&1>a.need&&console.log("need < 1");(b=a)&&e-c>=a.need&&a.handler(f,a)};this.getByte=function(){return d[c++]};this.peekByte=function(){return d[c]};this.getBE32=function(){return d[c++]<<24|d[c++]<<16|d[c++]<<8|d[c++]};
this.getBE16=function(){return d[c++]<<8|d[c++]};this.skip=function(a){c+=a};this.skipBack=function(a){c-=a};this.getBytes=function(a,f){if(f)for(var e=0;e<a;e++)f[e]=d[c++];else return e=c,c+=a,d.subarray(e,c)};this.copyToByteArray=function(a,c,f,e){hi5.Arrays.arraycopy(d,f,a,c,e)};this.getString16LE=function(a,c){for(var f="",e=a;e<c;)var b=d[e++]|d[e++]<<8,f=f+String.fromCharCode(b);return f}}function pa(){if(!y){if(U)p=U,P(n.width,n.height);else{var a=hi5.tool.replaceQuery(l,"pwd","x");hi5.browser.binaryWS()&&
(a+="&binary=on");var c=window.opener;if(c){var e=null;try{e=c.__sparkUser}catch(d){}e&&(c=e.account,e=e.session,c&&(a+="&account="+c),e&&(a+="&session="+e))}a+="&pasteCap="+(hi5.browser.isChrome&&hi5.browser.isDesktop?3:0);p=new WebSocket(a,[]);p.binaryType="arraybuffer"}ca.ws=p;svGlobal.logger.info(l);p.onopen=qa;p.onmessage=function(a){a=a.data;if("string"!=typeof a){var c=new Uint8Array(a);null!=F&&F.add(new RecordingObj(c,0,a.byteLength));B.set(c,0,a.byteLength);B.handle()}else{var e=parseInt(a.substring(0,
2),16),c=a.substring(2);switch(e){case 26:a=JSON.parse(c);if(a.name){svGlobal.logger.info("msg="+c);if(b.onerror)b.onerror(a);c=__svi18n.errorCode["S"+a.name]||"";c+=a.message;b.showMessage(c)}else 0<svGlobal.log&&console.erro("No error code for message:"+c);break;case 27:0!=hi5.appcfg.drawLicense&&w.drawLicense(c);break;case 56:a=JSON.parse(c);sessionId=a.session;a.server=b.server;if(c=hi5.$("joinSelect"))c.value=a.joinMode;if(c=hi5.$("requestControl"))c.disabled=a.hasControl;var c=hi5.appcfg.page&&
hi5.appcfg.page.joinvnc||"joinvnc.html",c=location.protocol+"//"+location.host+"/"+c+"?id="+a.numericId,g=a.webAddress;g&&0<g.length&&(e=g.indexOf("://"),g=g.substring(e+3),e=g.indexOf("/"),0<e&&(g=g.substring(0,e)),g.toLowerCase()!=location.host.toLowerCase()&&(c+="&gateway="+g));a.joinLink=c;b.sessionInfo.appInfo=a;a.ver&&a.ver!=svGlobal.version&&console.log("Client:"+svGlobal.version+" server:"+a.ver);if(b.onsessionstart)b.onsessionstart(b.sessionInfo);break;case 59:a=hi5.Base64.dec(c,0);(a[0]|
a[1]<<8|a[2]<<16|a[3]<<24)&256||w.disableShadow();break;case 61:a=JSON.parse(c);switch(a.type){case 0:P(a.width,a.height);L=a.color/8|0;a.server&&(b.server=a.server,b.setTitle&&(document.title=n.displayName||b.server));playLength=a.length;w&&w.setAutoScale(!0);if(b.onopened)b.onopened(a);break;case 1:a=a.duration;if(b.onprogress)b.onprogress(a,playLength);break;case 2:2==a.status?(da(),y=!0):(c=0==a.status,x.pause(c),c||x.repaint(0,0,x.width,x.height),a.warn&&b.showMessage(c?__svi18n.info.sessionPaused:
__svi18n.info.sessionResumed))}break;case 62:ea(c);break;default:svGlobal.logger.warn("@TODO:"+a+"\n")}}};p.onclose=function(a){svGlobal.logger.warn("closed, code="+a.code+" reason="+a.reason);if(!y&&0==b.mode){(a=__svi18n.errorCode.connection)||(a="error connection");if(b.onerror)b.onerror({name:"connection",message:a});b.displayMsg&&hi5.notifications.notify({msg:a});0<svGlobal.log&&console.error(a)}M=y=!1;try{null!=F&&(F.exit(),F=null),w&&w.close()}catch(c){}window&&window.$vnc&&(window.$vnc=null);
if(b&&b.onclose)b.onclose()};p.onerror=ra}}function qa(a){svGlobal.logger.info("opened...");y=!0;p.send("87"+navigator.userAgent);if(b.onopen)b.onopen()}function ra(a){svGlobal.logger.warn(a)}function V(a){B.setHandler(null);if(p&&y){p.onmessage=null;try{p.send("85"),p.close()}catch(c){}}window&&window.$vnc&&(window.$vnc=null);null!=F&&(F.exit(),F=null)}function fa(){var a=new Uint8Array(1);a[0]=Q(n.share)?1:0;p.send(a.buffer);B.setHandler(new K(24,function(a){if(b.onloggedin)b.onloggedin();var e=
b.sessionInfo;e.width=H=a.getBE16();e.height=I=a.getBE16();e.bpp=a.getByte();e.depth=a.getByte();e.bigEndian=0!=a.getByte();e.trueColor=0!=a.getByte();a.skip(12);for(var d=a.getBE32(),f="",h=0;h<d;h++)f+=String.fromCharCode(a.getByte());e.name=f;console.log("server name:"+f);b.setTitle&&(document.title=f);P(H,I);a=[16,7,1,0,4294967056,4294967057,4294967064,4294967073,4294967040,4294967264];e=n.encoding;8==n.color&&"Tight"==e&&(e="ZRLE");switch(e){case "Tight":a[0]=7;a[1]=16;break;case "Raw":a[0]=
0,a[3]=16}a[8]+=parseInt(n.compression||6);a[9]+=parseInt(n.quality||5);e=a.length;d=new Uint8Array(4+4*e);d[0]=2;d[2]=e>>8&255;d[3]=e&255;for(f=0;f<e;f++)d[4+4*f]=a[f]>>24&255,d[5+4*f]=a[f]>>16&255,d[6+4*f]=a[f]>>8&255,d[7+4*f]=a[f]&255;p.send(d.buffer);a=parseInt(n.color);switch(a){case 32:ga(32,24,!1,!0,255,255,255,0,8,16);break;case 8:ga(8,8,!1,!0,7,7,3,0,3,6);break;default:console.log("invliad color depath:"+a)}L=a/8|0;W(0,0,H,I,!1);B.setHandler(ha);M=!0;void 0!=n.recording&&"on"==n.recording&&
(a=n,F=new RecordingManager,F.setHeader({name:a.server,width:a.width,height:a.height,color:a.server_bpp,namesuffix:".vncv",filetag:"VNCV",duration:0}))}))}function sa(a){a=a.getBE32();console.log("sec rst: "+a);switch(a){case 0:break;case 1:b.showMessage(__svi18n.vnc.authError);b.close();return;case 2:b.showMessage("Too many failed authentication");b.close();return;default:b.showMessage("Unknown auth error"+a);b.close();return}fa()}function ga(a,c,e,d,f,b,g,l,n,t){var k=new Uint8Array(20);k[0]=0;
k[4]=a;k[5]=c;k[6]=e?1:0;k[7]=d?1:0;k[8]=f>>8&255;k[9]=f&255;k[10]=b>>8&255;k[11]=b&255;k[12]=g>>8&255;k[13]=g&255;k[14]=l;k[15]=n;k[16]=t;p.send(k.buffer)}function W(a,c,e,d,f){var b=new Uint8Array(10);b[0]=3;b[1]=f?1:0;b[2]=a>>8&255;b[3]=a&255;b[4]=c>>8&255;b[5]=c&255;b[6]=e>>8&255;b[7]=e&255;b[8]=d>>8&255;b[9]=d&255;p.send(b.buffer)}function ia(){var a=new TINF;a.init(2==b.mode?120:0);var c=new ba(0),e=new Uint32Array(4096),d=new Uint32Array(128);this.getHistory=function(){return a.getHistory()};
this.setHistory=function(c){a.setHistory(c)};this.decode=function(b,h,g,l,p){var n=b.getBE32();b=b.getBytes(n);b=a.uncompress(b,0);var k=0,q=0;c.set(b.dest,0,b.destIndex);b=g;var n=h,J=0,E=0,k=0,q=!1,r=0,z=k=q=0,m=c.getByte;for(b=g;b<g+p;b+=64)for(J=Math.min(g+p-b,64),n=h;n<h+l;n+=64){E=Math.min(h+l-n,64);k=m();q=0!=(k&128);r=k&127;if(1==L)for(k=0;k<r;k++)d[k]=R[m()];else for(k=0;k<r;k++)d[k]=m()|m()<<8|m()<<16|4278190080;if(1==r)x.fillRect(n,b,E,J,d[0]);else{if(q)if(0==r)for(q=0,k=q+E*J;q<k;){var z=
1==L?R[m()]:m()|m()<<8|m()<<16|4278190080,u=1;do r=m(),u+=r;while(255==r);if(e.fill)e.fill(z,q,q+u),q+=u;else for(;0<u--;)e[q++]=z}else for(q=0,k=q+E*J;q<k;){z=m();u=1;if(0!=(z&128)){do r=m(),u+=r;while(255==r)}z&=127;z=d[z];if(e.fill)e.fill(z,q,q+u),q+=u;else for(;0<u--;)e[q++]=z}else if(q=E*J,0==r)if(1==L)for(k=0;k<q;k++)e[k]=R[m()];else for(k=0;k<q;k++)e[k]=m()|m()<<8|m()<<16|4278190080;else for(u=16<r?8:4<r?4:2<r?2:1,k=q=0;k<J;k++)for(var z=q+E,t=r=0;q<z;)0==t&&(r=m(),t=8),t-=u,e[q++]=d[r>>t&
(1<<u)-1&127];x.setRGBs(n,b,E,J,e,0,E)}}x.postPaint(h,g,l,p)}}function ja(){function a(a,c,b,d,e){this.draw=function(){G.fillStyle=e;G.fillRect(a,c,b,d)};this.type=0;this.ready=function(){return!0}}function c(a,c,b){this.draw=function(){G.putImageData(b,a,c)};this.type=1;this.ready=function(){return!0}}function e(a,c,b){this.draw=function(){G.drawImage(b,a,c)};this.type=2;this.ready=function(){return!!b.src&&b.complete};this.image=b}function d(){var a=g[h];a||(a=new TINF,a.init(2==b.mode?120:0),g[h]=
a);return a}function f(a){var c=a.getByte(),b=c&127;c&128&&(c=a.getByte(),b|=(c&127)<<7,c&128&&(b|=a.getByte()<<14));return b}var h=0,g={},l=[0],n=Array(256);n[0]=0;this.inUse=!1;var p=this,k=new function(){function a(){for(;0<c.length;){var b=c[0];if(!b.ready())break;b.draw();c.shift()}}var c=[];this.push=function(b){c.push(b);2==b.type?b.image.onload=a:a()}};this.decode=function(b,g,t,r,z){p.inUse=!0;var m=b.getByte();switch(m>>4){case 8:k.push(new a(g,t,r,z,"rgb("+b.getByte()+","+b.getByte()+","+
b.getByte()+")"));break;case 9:m=f(b);r=hi5.Base64.enc(b.getData(),m,b.getPosition());b.skip(m);z=new Image;k.push(new e(g,t,z));z.src="data:image/jpeg;base64,"+r;break;default:if(h=(m&48)>>4,m=m&64?b.getByte():0,1==m){for(var u=b.getByte,x=u()+1,v=2!=x?r*z:z*((r+7)/8|0),C=0,w=0,D=m=0;C<x;C++)n[C]=u()|u()<<8|u()<<16|4278190080;12>v?l=b.getBytes(v):(m=f(b),l=d().uncompress(b.getBytes(m),0).dest);b=l;u=G.createImageData(r,z);if("Uint8ClampedArray"in window){var A=new Uint32Array(u.data.buffer);if(2!=
x)for(C=0;C<v;C++)A[C]=n[b[C]];else for(m=0,C=(r+7)/8|0,v=w=x=0;v<z;v++){for(var x=v*C,y=0;y<(r/8|0);y++)for(w=b[x+y],D=7;0<=D;D--)A[m++]=n[w>>D&1];w=8-r%8;for(D=7;D>=w;D--)A[m++]=n[b[x+y]>>D&1]}}else if(A=u.data,m=0,2!=x)for(C=0;C<v;C++)w=n[b[C]],A[m++]=w&255,A[m++]=w>>8&255,A[m++]=w>>16&255,A[m++]=255;else for(var m=0,C=(r+7)/8|0,B=0,v=0;v<z;v++){x=v*C;for(y=0;y<(r/8|0);y++)for(w=b[x+y],D=7;0<=D;D--)B=n[w>>D&1],A[m++]=B&255,A[m++]=B>>8&255,A[m++]=B>>16&255,A[m++]=255;w=8-r%8;for(D=7;D>=w;D--)B=
n[b[x+y]>>D&1],A[m++]=B&255,A[m++]=B>>8&255,A[m++]=B>>16&255,A[m++]=255}k.push(new c(g,t,u))}else if(0==m){m=r*z*3;11<m&&(m=f(b));D=r*z;u=3*D;b=11<u?d().uncompress(b.getBytes(m),0).dest:b.getBytes(u);u=G.createImageData(r,z);A=u.data;for(C=r=m=0;C<D;C++)A[m++]=b[r++],A[m++]=b[r++],A[m++]=b[r++],A[m++]=255;k.push(new c(g,t,u))}else console.log("xx filter:"+m)}}}function ea(a){var c=parseInt(a.substring(0,1),16),e,d,f=a.substring(1),h=!1;e=b.sessionInfo.appInfo;switch(c){case 0:d=JSON.parse(f);da();
y=!0;h=d.width;e=d.height;if(h==H&&e==I)break;P(h,e);break;case 1:_reconnectOnResize=b.reconnectOnResize;b.reconnectOnResize=!1;d=JSON.parse(f);b.onsessionjoin&&(h=b.onsessionjoin(d));if(h)break;b.showMessage(__svi18n.info.joinsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 2:d=JSON.parse(f);0==d.joined&&(b.reconnectOnResize=_reconnectOnResize);b.onsessionexit&&(h=b.onsessionexit(d));if(h)break;b.showMessage(__svi18n.info.exitsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 3:d=
JSON.parse(f);e.joinMode!=d.mode&&(e.joinMode=d.mode,a=hi5.$("joinSelect"))&&(a.value=d.mode);if(e.hasControl)break;w.setReadOnly(!1);if(e=hi5.$("requestControl"))e.disabled=!0;b.ongivecontrol&&(h=b.ongivecontrol());if(h)break;b.showMessage(__svi18n.info.givecontrol);break;case 4:w.setReadOnly(!0);e.hasControl=!1;if(e=hi5.$("requestControl"))e.disabled=!1;b.ontakebackcontrol&&(h=b.ontakebackcontrol());if(h)break;b.showMessage(__svi18n.info.nocontrol);break;case 5:d=JSON.parse(f);b.onrequirecontrol&&
(h=b.onrequirecontrol(d));if(h)break;h=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);hi5.notifications.notify({title:h,msg:__svi18n.info.recontrol,cbYes:function(){b.giveControl(d.numericId);this.destroy()},cbNo:function(){b.refuseControl(d.numericId);this.destroy()}});break;case 10:if(1==a.length)p.send("8E8"+hi5.Base64.enc(S.getHistory()));else if(S.setHistory(hi5.Base64.dec(a.substring(1),0)),b.refresh(),M=!0,b.onloggedin)b.onloggedin();break;case 11:d=JSON.parse(f);b.onrequirejoin&&
(h=b.onrequirejoin(d));if(h)break;h=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);hi5.notifications.notify({title:h,msg:__svi18n.info.reqjoin,cbYes:function(){b.allowJoin(d.numericId,!0);this.destroy()},cbNo:function(){b.allowJoin(d.numericId,!1);this.destroy()}})}}function ta(a){if(!b.openLink)return!1;var c=a;a=a.toLowerCase();var e=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");e||(0==
a.indexOf("www.")?(e=!0,a="http://"+a):0==a.indexOf("ftp.")&&(e=!0,a="ftp://"+a));if(e){if(0<a.indexOf("\r")||0<a.indexOf("\n"))return!1;if(b.onurlredirection&&b.onurlredirection(e))return!0;w.processLink(c);return!0}return!1}function P(a,c){H=a;I=c;n.width=a;n.height=c;x.resize(a,c);w&&w.setSize(a,c);if(b.onresolutionchange)b.onresolutionchange(a,c)}function ua(a){if(M&&(a=a.getData("text/plain"))){var b=a.length,e=new Int8Array(8+b);e[0]=6;e[4]=b>>24&255;e[5]=b>>16&255;e[6]=b>>8&255;e[7]=b&255;
for(var d=0;d<b;d++)e[8+d]=a.charCodeAt(d);p.send(e.buffer)}}function da(){loggedin=y=!1;X=new ja;S=new ia}function Y(a,b,e,d){M&&(ka=a,(a?1<<b:0)!=v[1]||e!=(v[2]<<8|v[3])||d!=(v[4]<<8|v[5]))&&(v[1]=a?1<<b:0,v[2]=e>>8&255,v[3]=e&255,v[4]=d>>8&255,v[5]=d&255,p.send(v.buffer))}function Z(a,b){N[1]=a?1:0;N[4]=b>>24&255;N[5]=b>>16&255;N[6]=b>>8&255;N[7]=b&255;p.send(N.buffer)}function la(a,c){var e=va[c.toLowerCase()];e?b.writeScancode(a,e):(e=c.length,0!=e&&(1==e?b.writeKeyCode(a,c.toUpperCase().charCodeAt(0)):
a&&b.writeText(c)))}sessionStorage&&sessionStorage.clear();this.displayMsg=!0;this.reconnectTimes=0;this.setTitle=this.openLink=!0;this.mode=0;var U="object"==typeof l?l:null,ma="object"==typeof l||0<l.indexOf("/PLAY?");ma?(this.mode=1,U&&(l=""),l+="&touchpad=on"):0<l.indexOf("/JOIN?")&&(this.mode=2,this.reconnectOnResize=!1);var n=hi5.tool.queryToObj(l.substring(l.indexOf("?")+1));!n.width&&t&&(n.width=t,l+="&width="+t);!n.wHeight&&O&&(n.height=O,l+="&height="+O);!n.color&&T&&(n.color=T,l+="&color="+
T);n.color||(n.color=32);this.server=n.server;this.port=parseInt(n.port,10);this.sessionInfo={major:0,minor:0,width:0,height:0,bpp:0,bigEndian:!0,trueColor:!0};var w=null,y=!1,M=!1,F=null;window.$vnc=this;var B=new ba(4194304);this.__que=B;this.running=function(){return y};var b=this,p=null,L=4,H=1024,I=768,R=[-16777216,-16777180,-16777143,-16777107,-16777070,-16777034,-16776997,-16776961,-16768E3,-16767964,-16767927,-16767891,-16767854,-16767818,-16767781,-16767745,-16758528,-16758492,-16758455,
-16758419,-16758382,-16758346,-16758309,-16758273,-16749312,-16749276,-16749239,-16749203,-16749166,-16749130,-16749093,-16749057,-16739840,-16739804,-16739767,-16739731,-16739694,-16739658,-16739621,-16739585,-16730624,-16730588,-16730551,-16730515,-16730478,-16730442,-16730405,-16730369,-16721152,-16721116,-16721079,-16721043,-16721006,-16720970,-16720933,-16720897,-16711936,-16711900,-16711863,-16711827,-16711790,-16711754,-16711717,-16711681,-11206656,-11206620,-11206583,-11206547,-11206510,-11206474,
-11206437,-11206401,-11197440,-11197404,-11197367,-11197331,-11197294,-11197258,-11197221,-11197185,-11187968,-11187932,-11187895,-11187859,-11187822,-11187786,-11187749,-11187713,-11178752,-11178716,-11178679,-11178643,-11178606,-11178570,-11178533,-11178497,-11169280,-11169244,-11169207,-11169171,-11169134,-11169098,-11169061,-11169025,-11160064,-11160028,-11159991,-11159955,-11159918,-11159882,-11159845,-11159809,-11150592,-11150556,-11150519,-11150483,-11150446,-11150410,-11150373,-11150337,-11141376,
-11141340,-11141303,-11141267,-11141230,-11141194,-11141157,-11141121,-5636096,-5636060,-5636023,-5635987,-5635950,-5635914,-5635877,-5635841,-5626880,-5626844,-5626807,-5626771,-5626734,-5626698,-5626661,-5626625,-5617408,-5617372,-5617335,-5617299,-5617262,-5617226,-5617189,-5617153,-5608192,-5608156,-5608119,-5608083,-5608046,-5608010,-5607973,-5607937,-5598720,-5598684,-5598647,-5598611,-5598574,-5598538,-5598501,-5598465,-5589504,-5589468,-5589431,-5589395,-5589358,-5589322,-5589285,-5589249,
-5580032,-5579996,-5579959,-5579923,-5579886,-5579850,-5579813,-5579777,-5570816,-5570780,-5570743,-5570707,-5570670,-5570634,-5570597,-5570561,-65536,-65500,-65463,-65427,-65390,-65354,-65317,-65281,-56320,-56284,-56247,-56211,-56174,-56138,-56101,-56065,-46848,-46812,-46775,-46739,-46702,-46666,-46629,-46593,-37632,-37596,-37559,-37523,-37486,-37450,-37413,-37377,-28160,-28124,-28087,-28051,-28014,-27978,-27941,-27905,-18944,-18908,-18871,-18835,-18798,-18762,-18725,-18689,-9472,-9436,-9399,-9363,
-9326,-9290,-9253,-9217,-256,-220,-183,-147,-110,-74,-37,-1],x;x?x.resize(1024,768):x=new na(1024,768);var G=x.getContext(),ca=new function(){this.ws=null;this.setJoinMode=b.setJoinMode;this.requestControl=b.requestControl;this.writeKeyComb=b.writeKeyComb;this.getAppMode=function(){return b.mode};this.send=function(a){y&&this.ws.send(a)};this.sendInput=function(a){b.writeRawInput(a);if(b.onactivity)b.onactivity(a)};this.getAppInfo=function(){return b.sessionInfo.appInfo};this.onresize=function(a){};
this.onorientationchange=function(a){};this.getClipData=oa;this.onfocus=function(a){};this.fileCallback=[];this.getShareFiles=function(a,b){loggedin&&(this.ws.send("3A5"+a),this.fileCallback.push(b))};this.notifyFiles=function(a){for(var b=this.fileCallback,e=0,d=b.length;e<d;e++)b[e](a)};this.getFile=function(a){window.open(b.getFileUrl(a))};this.removeFile=function(a){uploadMgr&&uploadMgr.fileService.remove(a)};this.getFileLink=function(a){return aa()+"/DOWNLOAD?s="+sessionId+"&f="+a};this.getGateway=
function(){return l};this.reconnect=function(a,b,e){}};hi5.appcfg&&(t=hi5.appcfg,"undefined"!=typeof t.displayMsg&&(this.displayMsg=t.displayMsg),"undefined"!=typeof t.reconnectTimes&&(this.reconnectTimes=t.reconnectTimes),"undefined"!=typeof t.openLink&&(this.openLink=t.openLink),"undefined"!=typeof t.setTitle&&(this.setTitle=t.setTitle),"boolean"==typeof t.useWSS&&(l=(hi5.appcfg.useWSS?"wss":"ws")+l.substring(l.indexOf("://"))));this.getURL=function(){return l};var wa=parseInt(n.server_bpp||n.color||
24);this.getColor=function(){return wa};window.onerror=function(a,b,e){console.log("Uncatched error, msg: "+a+" url: "+b+" line: "+e)};this.setJoinMode=function(a){y&&p.send("8E1"+a)};this.refuseControl=function(a){y&&p.send("8E3"+a)};this.giveControl=function(a){y&&p.send("8E4"+a)};this.requestControl=function(){y&&p.send("8E2")};this.allowJoin=function(a,b){y&&p.send("8EA"+a+"\t"+(b?1:0))};this.play=function(){p.send("F3")};this.pause=function(){p.send("F2")};this.scan=function(a){p.send("F4"+(a?
"1":"0"))};this.seek=function(a){console.log("call for vnc");w&&y&&(p.send("F4"+(a?"1":"0")+"\t"+(a/w.getScale()|0)),x.pause(!0))};this.run=function(){setTimeout(pa,5)};this.hide=function(){w&&w.hide()};this.showMessage=function(a){b.displayMsg&&a&&hi5.notifications.notify({msg:a})};this.close=V;hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(V):window.addEventListener("unload",V,!1);t=new K(12,function(a){if(82!=a.getByte()||70!=a.getByte()||66!=a.getByte())b.showMessage(__svi18n.vnc.notvnc),
b.close();else{a.skip(1);b.sessionInfo.major=100*(a.getByte()-48)+10*(a.getByte()-48)+(a.getByte()-48);a.skip(1);b.sessionInfo.minor=100*(a.getByte()-48)+10*(a.getByte()-48)+(a.getByte()-48);console.log("RFB major: "+b.sessionInfo.major+" minor: "+b.sessionInfo.minor);a.skip(1);a=new Uint8Array(12);for(var c=0;12>c;c++)a[c]="RFB 003.003\n".charCodeAt(c);p.send(a.buffer);B.setHandler(new K(4,function(a){var c=a.getBE32();console.log("sec type:"+c);switch(c){case 1:fa();break;case 2:B.setHandler(new K(12,
function(){console.log("vnc auth");var b=new Int8Array(16);a.copyToByteArray(b,0,a.getPosition(),16);a.skip(16);var c=n.pwd||"";8<c.length&&(c=c.substring(0,8));for(var d=[0,0,0,0,0,0,0,0],l=0,t=c.length;l<t;l++)d[l]=c.charCodeAt(l);c=new DesCipher(d);c.encrypt(b,0,b,0);c.encrypt(b,8,b,8);p.send(b.buffer);B.setHandler(new K(4,sa))}));break;default:b.showMessage(__svi18n.vnc.securityError),b.close()}}))}});B.setHandler(t);this.refresh=function(){W(0,0,H,I,!1)};var ha=new K(1,function(a){var c=0,e=
0,d=0,f=0,h=0,g="",g=a.getByte();switch(g){case 0:a.skip(1);for(var g=a.getBE16(),l=0;l<g;l++)switch(c=a.getBE16(),e=a.getBE16(),d=a.getBE16(),f=a.getBE16(),h=a.getBE32()>>>0,h){case 4294967073:P(d,f);break;case 240:case 4294967056:0!=d*f&&a.skip(((d+7)/8|0)*f*2+6);break;case 4294967057:0!=d*f&&a.skip(d*f*L+((d+7)/8|0)*f);break;case 4294967064:break;case 0:if(0<d*f){var h=a,n=null,p=d*f,k=0,q=h.getPosition(),t=h.getData();switch(L){case 4:if(0==q%4){q+=3;for(k=0;k<p;k++)t[q]=255,q+=4;n=new Uint32Array(h.getData().buffer,
h.getPosition(),p)}else for(n=new Uint32Array(p),k=0;k<p;k++)n[k]=t[q++]|t[q++]<<8|t[q++]<<16|4278190080,q++;h.skip(4*p);break;case 1:n=new Uint32Array(p);for(k=0;k<p;k++)n[k]=R[t[q++]];h.skip(p)}x.setRGBs(c,e,d,f,n,0,d);x.postPaint(c,e,d,f)}break;case 1:h=a.getBE16();n=a.getBE16();X.inUse?G.putImageData(G.getImageData(h,n,d,f),c,e):(x.moveArea(h,n,d,f,c-h,e-n),x.repaint(c,e,d,f));break;case 7:X.decode(a,c,e,d,f);break;case 16:S.decode(a,c,e,d,f);break;default:console.log("Encoding "+h+" is not supported"),
b.close()}x.commitPaint();W(0,0,H,I,!0);break;case 1:console.log("xxx color map");break;case 2:break;case 3:a.skip(3);g=a.getBE32();if(0<g){a=a.getBytes(g);g=String.fromCharCode.apply(null,a);if(b.onservercopy&&b.onservercopy(g))break;ta(g)||w.copyToClip("text/plain;"+g)}break;case 48:g=a.getString16LE(0,a.getEnd());ea(g);a.skip(a.getEnd()-a.getPosition());break;default:console.log("XX PDU:"+g)}});2!=b.mode&&1!=b.mode||B.setHandler(ha);var X=new ja,S=new ia;this.addSurface=function(a){w=a;ma&&a.setPlayerMode();
x.setContext(w.context);G=x.getContext();a.setAutoScale(0<b.mode);a.setSize(H,I);a.setController(ca);a.setFastCopy(Q(n.fastCopy));a.setTouchpad(Q(n.touchpad));a.setClipboard(Q(n.mapClipboard));a.run(99997);a.onclipdata=ua};var v=new Uint8Array(6);v[0]=5;var ka=!1;this.mouseDown=function(a,b,e){Y(!0,e,a,b)};this.mouseMove=function(a,b){Y(ka,0,a,b)};this.mouseUp=function(a,b,e){Y(!1,e,a,b)};this.writeKeyCode=function(a,c){b.writeRawInput("8B"+(a?0:49152)+"\t"+c)};this.writeScancode=function(a,c){y&&
("number"==typeof a?(b.writeRawInput("840\t"+a),b.writeRawInput("8449152\t"+a)):b.writeRawInput("84"+(a?0:49152)+"\t"+c))};this.writeText=function(a){b.writeRawInput("86"+a)};var xa={57:32,201:65365,209:65366,207:65367,199:65360,203:65361,200:65362,205:65363,208:65364,183:65377,210:65379,211:65535,184:65514,219:65511,220:65512,1:65307,14:65288,15:65289,28:65293,29:65511,29:65507,42:65505,56:65513,59:65470,60:65471,61:65472,62:65473,63:65474,64:65475,65:65476,66:65477,67:65478,68:65479,87:65480,88:65481,
70:65300},N=new Uint8Array(8);N[0]=4;this.writeRawInput=function(a){if(M){var c=parseInt(a.substring(0,2),16);a=a.substring(2).split("\t");var e=0,d=!1;switch(c){case 128:b.mouseDown(parseInt(a[0]),parseInt(a[1]),parseInt(a[2]));return;case 129:b.mouseUp(parseInt(a[0]),parseInt(a[1]),parseInt(a[2]));return;case 130:b.mouseMove(parseInt(a[0]),parseInt(a[1]));return;case 131:e=0!=parseInt(a[2]);c=parseInt(a[0]);a=parseInt(a[1]);M&&(v[1]=e?16:8,v[2]=c>>8&255,v[3]=c&255,v[4]=a>>8&255,v[5]=a&255,p.send(v.buffer),
v[1]=2,p.send(v.buffer));return;case 132:e=xa[a[1]]||0;d=0==a[0];break;case 139:e=String.fromCharCode(parseInt(a[1])).toLowerCase().charCodeAt(0);d=0==a[0];break;case 134:c=0;for(d=a[0].length;c<d;c++)e=a[0].charCodeAt(c),Z(!0,e),Z(!1,e);return}0<e?Z(d,e):console.log("Unknowncode: "+a[1]+" type:"+c)}};var va={" ":57,space:57,pageup:201,pagedown:209,end:207,home:199,left:203,up:200,right:205,down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,
esc:1,backspace:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.writeKeyComb=function(a){a=a.split("+");var b=a.length;if(0!=b){for(var e=null,d=0;d<b;d++){var f=a[d];""==f&&""==e&&(f="Add");""!=f&&la(!0,f);e=f}for(d=b-1;0<=d;d--)f=a[d],""==f&&""==e&&(f="Add"),""!=f&&la(!1,f),e=f}}};
