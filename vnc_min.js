var svManager={getInstance:function(){var u=window.$vnc;if(u&&u.running&&u.running())return u;return null}};function connvertServer(u){var S=new Object;S.id=u.id;S.server=u.id;S.displayName=u.displayName||u.id;var O=u.vnc;if(O){for(var ea in O)S[ea]=O[ea];S.pwd=O.password||""}return S}
svGlobal.Vnc=function(u,S,O,ea){function M(a){return a=="on"||a=="true"}function Ma(a,b){function d(a,b,c,d,f,e){var k=a+f;var n=b+e;for(var h=0;h<d;h++)g[n+h].set(g[b+h].subarray(a,a+c),k)}function c(a,b,c,d,f,e){var k=a+f;var n=b+e;for(var h=d-1;h>=0;h--)g[n+h].set(g[b+h].subarray(a,a+c),k)}function f(a,b,c,d,f,e){var k=a+f;var h=b+e;var n=g;var t;var m;var r;var p;for(t=c-1;t>=0;t--){r=k+t;p=a+t;for(m=0;m<d;m++)n[h+m][r]=n[b+m][p]}}function e(a,b,c,d,f,k){var h=a+f;var n=b+k;var t=g;var m;var r;
var p;var x;for(m=0;m<c;m++){p=h+m;x=a+m;for(r=0;r<d;r++)t[n+r][p]=t[b+r][x]}}function h(a){if(a-T>m)if(t.width>0){n.repaint(t.x,t.y,t.width,t.height);t.width=0;T=a}p=requestAnimationFrame(h)}var g=[];var r=null;var t=new hi5.graphic.Rectangle(0,0,0,0);var x="Uint8ClampedArray"in window;this.width=a;this.height=b;var m=H.animation||62;var Y=false;var n=this;var Z=null;var T=0;var p=0;this.pause=function(a){Y=a};this.release=function(){cancelAnimationFrame(p);n=null;r=null;g=null;Z=null};this.isPaused=
function(){return Y};this.setContext=function(c){if(c==r)return;if(!r&&c&&!c.createImageData(1,1).data.buffer)x=false;r=c;if(r!=null)Z=r.createImageData(a,b)};this.getContext=function(){return r};this.resize=function(c,d){for(var f=0;f<d;f++)g[f]=new Uint32Array(c);n.width=a=c;n.height=b=d;if(r!=null)Z=r.createImageData(a,b)};n.resize(a,b);this.getBuffer=function(){return g};this.setRGB=function(a,b,c){g[b][a]=c|4278190080};this.getRGB=function(a,b){return g[b][a]};this.setRGBs=function(a,b,c,d,f,
e,k){var h=e;var n=0;var m=0;var t=a+c;var r=b+d;if(f.subarray)for(var p=b;p<r;p++,h+=k)g[p].set(f.subarray(h,h+c),a);else{var x;for(p=b;p<r;p++,h+=k){m=h;x=g[p];for(n=a;n<t;n++)x[n]=f[m++]}}};this.moveArea=function(a,b,g,h,n,m){if(m>0)c(a,b,g,h,n,m);else if(m<0)d(a,b,g,h,n,m);else if(n>0)f(a,b,g,h,n,m);else e(a,b,g,h,n,m)};this.getRGBs=function(a,b,c,d){var f=c*d;var e=_Uint32Array(f);e[0]=0;var k=g;var h=a+c;var n=b+d;var m=0;var t;for(var r=b;r<n;r++)for(t=a;t<h;t++)e[m++]=k[r][t];return e};this.repaint=
function(c,d,f,e){var k=Z.data;var h=0;var n=0;var m=0|0;var t=0;var p=0;var Y=0|0;var T=0|0;if(c<0){f+=c;c=0}if(d<0){e+=d;d=0}if(c+f>a)f=a-c;if(d+e>b)e=b-d;h=c+f;n=d+e;if(x){var l=new Uint32Array(k.buffer);for(p=d;p<n;p++){l.set(g[p].subarray(c,h),m);m+=a}}else{T=(a-f)*4|0;for(p=d;p<n;p++){for(t=c;t<h;t++){Y=g[p][t];k[m++]=Y&255;k[m++]=Y>>8&255;k[m++]=Y>>16&255;k[m++]=255}m+=T}}r.putImageData(Z,c,d,0,0,f,e)};this.postPaint=function(a,b,c,d){if(t.width>0)t.union(a,b,c,d);else{t.x=a;t.y=b;t.width=
c;t.height=d}};this.startAnimation=function(){p=requestAnimationFrame(h)};this.fillRect=function(a,b,c,d,f){var e=a+c;var k=b+d;var h;for(var n=b;n<k;n++)if(g[n].fill)g[n].fill(f,a,e);else{var m=g[n];for(h=a;h<e;h++)m[h]=f}}}function Na(a,b){if(y)y.resize(a,b);else y=new Ma(a,b);return y}function va(){var a=u.indexOf("://");var b=u.substring(a+3);a=b.indexOf("/");if(a>0)b=b.substring(0,a);return location.protocol+"//"+b}function Oa(a){if(!ja)return"";var b=hi5.browser.httpGet(va()+"/CLIP?s="+ja+"&t="+
Date.now(),false);setTimeout(function(){l.send("883")},999);return b}function Pa(){this.ws=null;this.capsLock=this.numLock=false;this.setJoinMode=e.setJoinMode;this.requestControl=e.requestControl;this.writeKeyComb=e.writeKeyComb;this.getAppMode=function(){return e.mode};this.send=function(a){if(!C)return;this.ws.send(a)};this.sendInput=function(a){e.writeRawInput(a);if(e.onactivity)e.onactivity(a)};this.getAppInfo=function(){return e.sessionInfo.appInfo};this.onresize=function(a){};this.onorientationchange=
function(a){};this.getClipData=Oa;this.onfocus=function(a){};this.fileCallback=[];this.getShareFiles=function(a,b){if(loggedin){this.ws.send("3A5"+a);this.fileCallback.push(b)}};this.notifyFiles=function(a){var b=this.fileCallback;var d=0;for(var c=b.length;d<c;d++)b[d](a)};this.getFile=function(a){window.open(e.getFileUrl(a))};this.removeFile=function(a){if(uploadMgr)uploadMgr.fileService.remove(a)};this.getFileLink=function(a){return va()+"/DOWNLOAD?s="+ja+"&f="+a};this.getGateway=function(){return u};
this.reconnect=function(a,b,d){}}function Qa(){return q.displayName||e.server}function wa(a){if(e.setTitle)document.title=a}function ca(a,b,d){this.need=a;this.handler=b;this.repeat=d||1}function xa(a){var b=0;var d=0;var c=new Uint8Array(a);var f=this;var e=new ca(0,null,0);this.release=function(){e=null;c=null;f=null};this.getHandler=function(){return e};this.getData=function(){return c};this.getPosition=function(){return b};this.setPosition=function(a){b=a};this.getEnd=function(){return d};this.set=
function(a,f,e){c=a;b=f;d=e};this.handle=function(){e.handler(f,e)};this.setHandler=function(a){if(a&&a.need<1)svGlobal.logger.warn("need < 1");e=a;if(a&&d-b>=a.need)a.handler(f,a)};this.getByte=function(){return c[b++]};this.peekByte=function(){return c[b]};this.getBE32=function(){return c[b++]<<24|c[b++]<<16|c[b++]<<8|c[b++]};this.getBE16=function(){return c[b++]<<8|c[b++]};this.skip=function(a){b+=a};this.skipBack=function(a){b-=a};this.getBytes=function(a,d){if(!d){var f=b;b+=a;return c.subarray(f,
b)}else for(var e=0;e<a;e++)d[e]=c[b++]};this.copyToByteArray=function(a,b,d,f){hi5.Arrays.arraycopy(c,d,a,b,f)};this.getString16LE=function(a,b){var d="";for(var f=a;f<b;){var e=c[f++]|c[f++]<<8;d+=String.fromCharCode(e)}return d}}function ya(){var a="";if(q&&M(q.connectif)&&q.symlink&&"sessionStorage"in window){a="SV_"+q.symlink;if(q.user)a+=q.user}return a}function Ra(){var a=ya();var b="";if(a){b=sessionStorage[a]||"";if(b)b="&preSymJoin="+b}return b}function Sa(){if(C)return;if(ma){l=ma;ha(q.width,
q.height)}else{var a=hi5.tool.replaceQuery(u,"pwd","x")+Ra();var b=hi5.browser.binaryWS();if(b)a+="&binary=on";var d=window.opener;if(d){var c=null;try{c=d.__sparkUser}catch(e){}if(c){var f=c.account;var k=c.session;if(f)a+="&account="+f;if(k)a+="&session="+k}}var h=hi5.browser.isChrome&&hi5.browser.isDesktop;a+="&pasteCap="+(h?3:0);l=new WebSocket(a,"vnc");l.binaryType="arraybuffer"}na.ws=l;svGlobal.logger.info(u);l.onopen=Ta;var g=new hi5.DataBuffer([],0,0);l.onmessage=function(a){var b=a.data;
var c=0;if(typeof b!="string"){var d=new Uint8Array(b);if(L!=null)L.add(new RecordingObj(d,0,b.byteLength));switch(d[0]){case 48:z.set(d,2,d-2);z.handle();break;case 56:g.attach(d,2,d.length-2);za(g.getUnicodeString(g.getEnd()-g.getPosition(),false));break;case 60:if(ka||la){g.attach(d,2,d.length-2);Ua(g)}break;case 62:g.attach(d,2,d.length-2);oa(g.getUnicodeString(g.getEnd()-g.getPosition(),false));break;case 146:g.attach(d,2,d.length-2);Va(g);break;default:svGlobal.logger.warn("invalid type:"+d[0])}}else{c=
parseInt(b.substring(0,2),16);var f=b.substring(2);switch(c){case 26:Wa(f);break;case 27:Xa(f);break;case 56:za(f);break;case 59:Ya(f);break;case 61:Za(f);break;case 62:oa(f);break;default:svGlobal.logger.warn("@TODO:"+b+"\n")}}};l.onclose=ia;l.onerror=$a}function Ua(a){var b=a.getByte();switch(b){case 32:ab(a)}}function ab(a){if(y.isPaused())return;var b=a.getLittleEndian16();var d=a.getLittleEndian16();var c=a.getLittleEndian16();var f=a.getLittleEndian32();var k=e.sessionInfo.appInfo.sessions[f];
if(w)w.moveCursor(d,c,true,k,f)}function Va(a){var b=a.getByte();switch(b){case 0:var d=new Uint8Array(2);d[0]=146;d[1]=1;l.send(d.buffer);break;case 1:if(E)E.check()}}function bb(a){L=new RecordingManager;var b=a.server;var d={name:b,width:a.width,height:a.height,color:a.server_bpp,namesuffix:".vncv",filetag:"VNCV",duration:0};L.setHeader(d)}function Xa(a){if(H.drawLicense!=false)w.drawLicense(a)}function Ya(a){var b=hi5.Base64.dec(a,0);var d=b[0]|b[1]<<8|b[2]<<16|b[3]<<24;if(!(d&256))w.disableShadow()}
function za(a){var b=JSON.parse(a);var d=b;ja=b.session;d.server=e.server;var c=hi5.$("joinSelect");if(c)c.value=d.joinMode;c=hi5.$("requestControl");if(c)c.disabled=d.hasControl;if(!b.joined&&!la){e.mode=0;z.setHandler(pa);V=new qa}var f=H.page&&H.page.joinvnc||"joinvnc.html";f=location.protocol+"//"+location.host+"/"+f+"?id="+b.numericId;var k=b.webAddress;if(k&&k.length>0){var h=k.indexOf("://");var g=k.substring(h+3);h=g.indexOf("/");if(h>0)g=g.substring(0,h);if(g.toLowerCase()!=location.host.toLowerCase())f+=
"&gateway="+g}d.joinLink=f;e.sessionInfo.appInfo=d;if(b.ver&&b.ver!=svGlobal.version)svGlobal.logger.info("Client:"+svGlobal.version+" server:"+b.ver);if(e.onsessionstart)e.onsessionstart(e.sessionInfo)}function Aa(a){if(!ka)a.setCursor({"result":"url(data:image/x-icon;base64,AAACAAEAICACAAAAAAAwAQAAFgAAACgAAAAgAAAAQAAAAAEAAQAAAAAAgAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAABQUFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAOAAAADgAAAA//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8f////H////x////8=) 0 0, none"});
else if(ra)a.setCursor({"system":"default","none":false,"result":"default"})}function Za(a){var b=JSON.parse(a);switch(b.type){case 0:ha(b.width,b.height);I=b.color/8|0;if("ignoreCursor"in b)ra=b.ignoreCursor;if("trackCursorLocally"in b){ka=b.trackCursorLocally;Aa(w)}var d=b.server;if(d){e.server=b.server;wa(Qa())}playLength=b.length;if(w)w.setAutoScale(true);if(e.onopened)e.onopened(b);break;case 1:var c=b.duration;if(e.onprogress)e.onprogress(c,playLength);break;case 2:if(b.status==2){Ba();C=true}else{var f=
b.status==0;y.pause(f);if(!f)y.repaint(0,0,y.width,y.height);if(b.warn)e.showMessage(f?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)}}}function nb(a){var b=__svi18n.errorCode[a];if(!b)b="error "+a;if(e.onerror)e.onerror({name:a,message:b});if(e.displayMsg)hi5.notifications.notify({"msg":b});if(svGlobal.log>0)console.error(b)}function Wa(a){var b=JSON.parse(a);if(!b.name){if(svGlobal.log>0)console.erro("No error code for message:"+a);return}svGlobal.logger.info("msg="+a);if(e.onerror)e.onerror(b);
var d=__svi18n.errorCode["S"+b.name]||"";d+=b.message;e.showMessage(d)}function Ta(a){svGlobal.logger.info("opened...");C=true;l.send("87"+navigator.userAgent);if(e.onopen)e.onopen()}function $a(a){svGlobal.logger.warn(a)}function ia(a){if(!e)return;svGlobal.logger.warn("closed ...");var b=ya();if(b&&e.sessionInfo.appInfo&&e.mode==0)sessionStorage[b]=e.sessionInfo.appInfo.session;if(z&&z.getHandler()&&z.getHandler().handler==Ca)e.onautherror&&e.onautherror();C=false;da=false;if(E){E.stop();E=null}if(e&&
e.onclose)e.onclose(Da);try{if(L!=null){L.exit();L=null}if(w){w.onclipdata=null;w.close();w=null}}catch(d){}u=null;Q=null;F=null;Ea=null;Fa=null;Ga=null;if(z){z.release();z=null}W=null;if(l){l.onopen=null;l.onmessage=null;l.onclose=null;l.onerror=null;l=null}if(X){X.release();X=null}if(V){V.release();V=null}F=null;A=null;pa=null;sa=null;na=null;w=null;if(y){y.release();y=null}if(e)e=null;if(window&&window.$vnc)window.$vnc=null;if(L!=null){L.exit();L=null}}function Ha(){var a=new Uint8Array(2);a[0]=
147;a[1]=M(q.share)?1:0;l.send(a.buffer);z.setHandler(new ca(24,function d(a){if(e.onloggedin)e.onloggedin();l.send("8D");var f=e.sessionInfo;f.width=U=a.getBE16();f.height=ba=a.getBE16();f.bpp=a.getByte();f.depth=a.getByte();f.bigEndian=a.getByte()!=0;f.trueColor=a.getByte()!=0;a.skip(12);var k=a.getBE32();var h="";for(var g=0;g<k;g++)h+=String.fromCharCode(a.getByte());f.name=h;svGlobal.logger.info("server name:"+h);wa(h);ha(U,ba);cb()}))}function Ca(a){var b=a.getBE32();svGlobal.logger.info("sec rst: "+
b);var d={code:b,message:""};switch(b){case 0:Ha();return;case 1:d.message=__svi18n.vnc.authError;break;case 2:d.message="Too many failed authentication";break;default:d.message="Unknown auth error"+b}z.setHandler(null);if(e.onautherror&&e.onautherror(d))return;e.showMessage(d.message);e.close()}function cb(){var a=[];var b=q.encoding;if(q.color==8&&b=="Tight")b="ZRLE";switch(b){case "Tight":a.push(7);a.push(16);break;case "Raw":a.push(0);a.push(16);break;default:a.push(16);a.push(7)}a.push(1);a.push(0);
if(ka){a.push(4294967057);a.push(4294967064)}a.push(4294967040+parseInt(q.compression||6));a.push(4294967264+parseInt(q.quality||5));var d=a.length;var c=new Uint8Array(5+d*4);c[0]=147;c[1]=2;c[3]=d>>8&255;c[4]=d&255;for(var f=0;f<d;f++){c[5+4*f]=a[f]>>24&255;c[6+4*f]=a[f]>>16&255;c[7+4*f]=a[f]>>8&255;c[8+4*f]=a[f]&255}l.send(c.buffer);db();da=true;if(q["recording"]!=undefined&&q["recording"]=="on")bb(q);eb()}function eb(a){if(H.pingInterval)e.startPing(H.pingInterval);if(e.onready)e.onready()}function Ia(a,
b,d,c,f,e,h,g,r,t){var x=new Uint8Array(21);x[0]=147;x[1]=0;x[5]=a;x[6]=b;x[7]=d?1:0;x[8]=c?1:0;x[9]=f>>8&255;x[10]=f&255;x[11]=e>>8&255;x[12]=e&255;x[13]=h>>8&255;x[14]=h&255;x[15]=g;x[16]=r;x[17]=t;l.send(x.buffer)}function db(){var a=parseInt(q.color);switch(a){case 32:Ia(32,24,false,true,255,255,255,0,8,16);break;case 8:Ia(8,8,false,true,7,7,3,0,3,6);break;default:svGlobal.logger.warn("invliad color depath:"+a)}I=a/8|0;ta(0,0,U,ba,false);z.setHandler(sa)}function ta(a,b,d,c,f){var e=new Uint8Array(11);
e[0]=147;e[1]=3;e[2]=f?1:0;e[3]=a>>8&255;e[4]=a&255;e[5]=b>>8&255;e[6]=b&255;e[7]=d>>8&255;e[8]=d&255;e[9]=c>>8&255;e[10]=c&255;l.send(e.buffer)}function ob(a){return"rgb("+(a&255)+","+(a>>8&255)+","+(a>>16&255)+")"}function pb(a,b,d){return"rgb("+a+","+b+","+d+")"}function qa(){var a=new TINF;a.init(e.mode==2?120:0);var b=new xa(0);var d=new Uint32Array(4096);var c=new Uint32Array(128);this.release=function(){d=null;c=null;a.release();a=null;b.release();b=null};this.getHistory=function(){return a.getHistory()};
this.setHistory=function(b){a.setHistory(b)};this.decode=function(f,e,h,g,r,t){var x=f.getBE32();var m=f.getBytes(x);var Y=a.uncompress(m,0);var n=0;var Z=0;b.set(Y.dest,0,Y.destIndex);var T=h;var p=e;var l=0;var q=0;var u=0;var v=false;var w=0;var A=c;var K=0;var C=0;var z=0;var J=b.getByte;var B=d;for(T=h;T<h+r;T+=64){l=Math.min(h+r-T,64);for(p=e;p<e+g;p+=64){q=Math.min(e+g-p,64);u=J();v=(u&128)!=0;w=u&127;if(I==1)for(n=0;n<w;n++)A[n]=fa[J()];else for(n=0;n<w;n++)A[n]=J()|J()<<8|J()<<16|4278190080;
if(w==1&&!t){y.fillRect(p,T,q,l,A[0]);continue}if(!v){Z=q*l;if(w==0)if(I==1)for(n=0;n<Z;n++)B[n]=fa[J()];else for(n=0;n<Z;n++)B[n]=J()|J()<<8|J()<<16|4278190080;else{var H=w>16?8:w>4?4:w>2?2:1;K=0;for(n=0;n<l;n++){var G=K+q;var D=0;for(var F=0;K<G;){if(F==0){D=J();F=8}F-=H;B[K++]=A[D>>F&(1<<H)-1&127]}}}}else if(w==0){K=0;for(C=K+q*l;K<C;){z=I==1?fa[J()]:J()|J()<<8|J()<<16|4278190080;var P=1;do{D=J();P+=D}while(D==255);if(B.fill){B.fill(z,K,K+P);K+=P}else for(;P-- >0;)B[K++]=z}}else{K=0;for(C=K+q*
l;K<C;){var E=J();P=1;if((E&128)!=0){do{D=J();P+=D}while(D==255)}E&=127;z=A[E];if(B.fill){B.fill(z,K,K+P);K+=P}else for(;P-- >0;)B[K++]=z}}if(!t)y.setRGBs(p,T,q,l,B,0,q)}}if(!t)y.postPaint(e,h,g,r)}}function Ja(){function a(a,b,c,d,f){this.draw=function(){W.fillStyle=f;W.fillRect(a,b,c,d)};this.type=0;this.ready=function(){return true}}function b(a,b,c){this.draw=function(){W.putImageData(c,a,b)};this.type=1;this.ready=function(){return true}}function d(a,b,c){this.draw=function(){W.drawImage(c,a,
b)};this.type=2;this.ready=function(){return!!c.src&&c.complete};this.image=c}function c(){function a(){for(;b.length>0;){var c=b[0];if(!c.ready())break;c.draw();b.shift()}}var b=[];this.push=function(c){b.push(c);if(c.type==2)c.image.onload=a;else a()}}function f(){var a=r[g];if(!a){a=new TINF;a.init(e.mode==2?120:0);r[g]=a}return a}function k(a){var b=a.getByte();var c=b&127;if(b&128){b=a.getByte();c|=(b&127)<<7;if(b&128)c|=a.getByte()<<14}return c}function h(a,b){if(b<12){t.data=a.getBytes(b);
t.length=b}else{var c=k(a);var d=f().uncompress(a.getBytes(c),0);t.data=d.dest;t.length=d.destIndex}}var g=0;var r={};var t={data:[0],length:0};var x=new Array(256);x[0]=0;this.inUse=false;var m=this;var l=new c;this.release=function(){l=null;m=null;x=null;t=null;r=null};this.drawImageData=function(a,c,d){l.push(new b(c,d,a))};this.decode=function(c,e,r,p,q,u){if(!m.inUse){m.inUse=true;if(y){y.release();y=null}}var w=c.getByte();switch(w>>4){case 8:if(u)c.skip(3);else l.push(new a(e,r,p,q,"rgb("+
c.getByte()+","+c.getByte()+","+c.getByte()+")"));break;case 9:var v=k(c);var A=hi5.Base64.enc(c.getData(),v,c.getPosition());c.skip(v);if(!u){var z=new Image;l.push(new d(e,r,z));z.src="data:image/jpeg;base64,"+A}break;default:g=(w&48)>>4;var C=w&64?c.getByte():0;if(C==1){var F=c.getByte;var H=F()+1;var J=H!=2?p*q:q*((p+7)/8|0);var B=0;var E=0;var G=0;for(var D=0;B<H;B++)x[B]=F()|F()<<8|F()<<16|4278190080;h(c,J);var I=t.data;var P=W.createImageData(p,q);if("Uint8ClampedArray"in window){var R=new Uint32Array(P.data.buffer);
if(H!=2)for(B=0;B<J;B++)R[B]=x[I[B]];else{G=0;var S=(p+7)/8|0;var L=0;var Q=0;for(var O=0;O<q;O++){L=O*S;for(var aa=0;aa<(p/8|0);aa++){E=I[L+aa];for(D=7;D>=0;D--)R[G++]=x[E>>D&1]}Q=8-p%8;for(D=7;D>=Q;D--)R[G++]=x[I[L+aa]>>D&1]}}}else{var N=P.data;G=0;if(H!=2)for(B=0;B<J;B++){E=x[I[B]];N[G++]=E&255;N[G++]=E>>8&255;N[G++]=E>>16&255;N[G++]=255}else{G=0;S=(p+7)/8|0;L=0;Q=0;var M=0;for(O=0;O<q;O++){L=O*S;for(aa=0;aa<(p/8|0);aa++){E=I[L+aa];for(D=7;D>=0;D--){M=x[E>>D&1];N[G++]=M&255;N[G++]=M>>8&255;N[G++]=
M>>16&255;N[G++]=255}}Q=8-p%8;for(D=7;D>=Q;D--){M=x[I[L+aa]>>D&1];N[G++]=M&255;N[G++]=M>>8&255;N[G++]=M>>16&255;N[G++]=255}}}}if(!u)l.push(new b(e,r,P))}else if(C==0){v=p*q*3;if(v>11)v=k(c);var V=p*q;var X=V*3;I=X>11?f().uncompress(c.getBytes(v),0).dest:c.getBytes(X);P=W.createImageData(p,q);N=P.data;G=0;var U=0;for(B=0;B<V;B++){N[G++]=I[U++];N[G++]=I[U++];N[G++]=I[U++];N[G++]=255}if(!u)l.push(new b(e,r,P))}else svGlobal.logger.info("xx filter:"+C)}}}function oa(a){var b=parseInt(a.substring(0,1),
16);var d;var c;var f=a.substring(1);var k=false;var h=e.sessionInfo.appInfo;switch(b){case 0:c=JSON.parse(f);Ba();C=true;var g=c.width;var r=c.height;if(g==U&&r==ba)break;ha(g,r);break;case 1:_reconnectOnResize=e.reconnectOnResize;e.reconnectOnResize=false;c=JSON.parse(f);h.sessions[c.numericId]=c.name||c.__ip;if(e.onsessionjoin)k=e.onsessionjoin(c);if(k)break;e.showMessage(__svi18n.info.joinsession.applyArgs([c.numericId,c.__ip,c.name]));break;case 2:c=JSON.parse(f);delete h.sessions[c.numericId];
if(c.joined==0)e.reconnectOnResize=_reconnectOnResize;if(e.onsessionexit)k=e.onsessionexit(c);if(k)break;e.showMessage(__svi18n.info.exitsession.applyArgs([c.numericId,c.__ip,c.name]));break;case 3:c=JSON.parse(f);if(h.joinMode!=c.mode){h.joinMode=c.mode;var t=hi5.$("joinSelect");if(t)t.value=c.mode}if(h.hasControl)return;w.setReadOnly(false,c.mode==2);d=hi5.$("requestControl");if(d)d.disabled=true;if(e.ongivecontrol)k=e.ongivecontrol();if(k)break;e.showMessage(__svi18n.info.givecontrol);break;case 4:c=
JSON.parse(f);w.setReadOnly(true,c.mode==2);h.hasControl=false;d=hi5.$("requestControl");if(d)d.disabled=false;if(e.ontakebackcontrol)k=e.ontakebackcontrol();if(k)break;e.showMessage(__svi18n.info.nocontrol);break;case 5:var x=function(){e.refuseControl(c.numericId);this.destroy()};var m=function(){e.giveControl(c.numericId);this.destroy()};c=JSON.parse(f);if(e.onrequirecontrol)k=e.onrequirecontrol(c);if(k)break;var q=__svi18n.info.title.applyArgs([c.name,c.numericId,c.__ip]);hi5.notifications.notify({"title":q,
"msg":__svi18n.info.recontrol,"cbYes":m,"cbNo":x});break;case 10:if(a.length==1)l.send("8E8"+hi5.Base64.enc(V.getHistory()));else{V.setHistory(hi5.Base64.dec(a.substring(1),0));e.refreshOutput();da=true;if(e.onloggedin)e.onloggedin()}if(E)E.check(15555);break;case 11:var n=function(){e.allowJoin(c.numericId,false);this.destroy()};var u=function(){e.allowJoin(c.numericId,true);this.destroy()};c=JSON.parse(f);if(e.onrequirejoin)k=e.onrequirejoin(c);if(k)break;q=__svi18n.info.title.applyArgs([c.name,
c.numericId,c.__ip]);hi5.notifications.notify({"title":q,"msg":__svi18n.info.reqjoin,"cbYes":u,"cbNo":n})}}function fb(a){if(!e.openLink)return false;var b=a;a=a.toLowerCase();var d=a.indexOf("http://")==0||a.indexOf("https://")==0||a.indexOf("ftp://")==0||a.indexOf("mailto:")==0||a.indexOf("tel:")==0||a.indexOf("callto:")==0;if(!d)if(a.indexOf("www.")==0){d=true;a="http://"+a}else if(a.indexOf("ftp.")==0){d=true;a="ftp://"+a}if(d){if(a.indexOf("\r")>0||a.indexOf("\n")>0)return false;if(e.onurlredirection&&
e.onurlredirection(d))return true;w.processLink(b);return true}return false}function gb(a,b,d,c,f,e,h,g,r){function t(){var a=0|0;if(b){var c=0;for(var d=b.length;c<d;c++)if(b[c]!=0)a+=c%f+(c/f|0)}return a}function x(a){if(a==507)return"text";else return""}this.cache_idx=a;this.rawData=b;this.none=!b;this.hotX=d;this.hotY=c;this.width=f;this.height=e;this.xorSize=g;this.andSize=r;this.result="";this.distance=0;this.bpp=h;this.system="";this.init=function(){if(this.distance)this.distance=t();if(!this.system)this.system=
x(this.distance)};var m="";if(!this.system&&b){var q=40;var n=f*e*4;var l=22+q+n+g+r;var u=new Uint8Array(l);var p=new hi5.DataBuffer(u,0,l);p.setLittleEndian16(0);p.setLittleEndian16(2);p.setLittleEndian16(1);p.setByte(f);p.setByte(e);p.setByte(0);p.setByte(0);p.setLittleEndian16(d);p.setLittleEndian16(c);p.setLittleEndian32(q+n+g+r);p.setLittleEndian32(22);p.setLittleEndian32(q);p.setLittleEndian32(f);p.setLittleEndian32(e*2);p.setLittleEndian16(1);p.setLittleEndian16(32);p.setLittleEndian32(0);
p.setLittleEndian32(g+r);p.setLittleEndian32(0);p.setLittleEndian32(0);p.setLittleEndian32(0);p.setLittleEndian32(0);var w;var v;for(w=e-1;w>=0;w--)for(v=0;v<f;v++){var y=b[f*w+v];p.setByte(y&255);p.setByte(y>>8&255);p.setByte(y>>16&255);p.setByte(y>>24&255)}if(hi5.browser.isIE);else m="data:image/x-icon;base64,"+hi5.Base64.enc(p.getData())}this.url=m}function hb(a,b,d,c,e){var k=(c+7)/8|0;var h=k*e;var g=c*e;var r=new Uint32Array(g);var t=a.getBytes(g*I);var q=a.getBytes(h);var m=0;var l;var n;var u;
var v=0;var p=0;for(n=0;n<e;n++){for(l=0;l<c/8;l++){m=q[n*k+l];for(u=7;u>=0;u--){if((m>>u&1)!=0)if(I==1);else v=4278190080|(t[p*4+2]&255)<<16|(t[p*4+1]&255)<<8|t[p*4]&255;else v=0;r[p++]=v}}for(u=7;u>=8-c%8;u--){if((q[n*k+l]>>u&1)!=0)if(I==1)v=0;else v=4278190080|(t[p*4+2]&255)<<16|(t[p*4+1]&255)<<8|t[p*4]&255;else v=0;r[p++]=v}}var y=new gb(0,r,b,d,c,e,4,g*4,g/8|0);w.setCursor(y)}function ib(a){var b=0;var d=0;var c=0;var f=0;var k=0;var h="";var g=a.getByte();var r=false;switch(g){case 0:a.skip(1);
var t=a.getBE16();for(var l=0;l<t;l++){b=a.getBE16();d=a.getBE16();c=a.getBE16();f=a.getBE16();k=a.getBE32()>>>0;switch(k){case 4294967073:ha(c,f);break;case 240:case 4294967056:if(c*f!=0)a.skip(((c+7)/8|0)*f*2+6);break;case 4294967057:if(c*f!=0)if(ra||r)a.skip(c*f*I+((c+7)/8|0)*f);else hb(a,b,d,c,f);break;case 4294967064:break;case 0:if(c*f>0)jb(a,b,d,c,f);break;case 1:var m=a.getBE16();var q=a.getBE16();if(!r)if(X.inUse)W.putImageData(W.getImageData(m,q,c,f),b,d);else{y.moveArea(m,q,c,f,b-m,d-q);
y.repaint(b,d,c,f)}break;case 7:X.decode(a,b,d,c,f,r);break;case 16:V.decode(a,b,d,c,f,r);break;default:svGlobal.logger.warn("Encoding "+k+" is not supported");e.close()}}ta(0,0,U,ba,true);return;case 1:svGlobal.logger.warn("xxx color map");break;case 2:break;case 3:a.skip(3);var n=a.getBE32();if(n>0){var u=a.getBytes(n);h=String.fromCharCode.apply(null,u);if(e.onservercopy&&e.onservercopy(h))return;if(!fb(h))w.copyToClip("text/plain;"+h)}break;case 48:h=a.getString16LE(0,a.getEnd());oa(h);a.skip(a.getEnd()-
a.getPosition());break;default:svGlobal.logger.warn("XX PDU:"+g)}}function jb(a,b,d,c,e){var k=null;var h=c*e;var g=0;var r=a.getPosition();var t=a.getData();var l;if(X.inUse){var m=W.createImageData(c,e);if(I==4){if("Uint8ClampedArray"in window){l=new Uint32Array(m.data.buffer);for(g=0;g<h;g++){l[g]=t[r++]<<16|t[r++]<<8|t[r++]|4278190080;r++}}else{l=m.data;for(var q=h*4;g<q;){l[g++]=t[r+2];l[g++]=t[r+1];l[g++]=t[r];l[g++]=255;r+=4}}a.skip(h*4)}else if(I==1){if("Uint8ClampedArray"in window){l=new Uint32Array(m.data.buffer);
for(g=0;g<h;g++)l[g]=fa[t[r++]]}else{l=m.data;q=h*4;for(var n=0;g<q;){n=fa[t[r++]];l[g++]=n&255;l[g++]=n>>8&255;l[g++]=n>>16&255;l[g++]=255}}a.skip(h)}X.drawImageData(m,b,d);return}switch(I){case 4:if(r%4==0){r+=3;for(g=0;g<h;g++){t[r]=255;r+=4}k=new Uint32Array(a.getData().buffer,a.getPosition(),h)}else{k=new Uint32Array(h);for(g=0;g<h;g++){k[g]=t[r++]|t[r++]<<8|t[r++]<<16|4278190080;r++}}a.skip(h*4);break;case 1:k=new Uint32Array(h);for(g=0;g<h;g++)k[g]=fa[t[r++]];a.skip(h)}y.setRGBs(b,d,c,e,k,
0,c);y.postPaint(b,d,c,e)}function qb(a,b,d,c,e){}function rb(a,b,d,c,e){var k=40;var h=a*b*4;var g=a*b/8|0;var l=g;var t=22+k+h+g+l;var q=new Array(t);q[0]=0;var m=new hi5.DataBuffer(q,0,t);m.setLittleEndian16(0);m.setLittleEndian16(2);m.setLittleEndian16(1);m.setByte(a);m.setByte(b);m.setByte(0);m.setByte(0);m.setLittleEndian16(d);m.setLittleEndian16(c);m.setLittleEndian32(k+h+g+l);m.setLittleEndian32(22);m.setLittleEndian32(k);m.setLittleEndian32(a);m.setLittleEndian32(b*2);m.setLittleEndian16(1);
m.setLittleEndian16(32);m.setLittleEndian32(0);m.setLittleEndian32(g+l);m.setLittleEndian32(0);m.setLittleEndian32(0);m.setLittleEndian32(0);m.setLittleEndian32(0);var u;var n;for(u=b-1;u>=0;u--)for(n=0;n<a;n++){var v=e[a*u+n];m.setByte(v&255);m.setByte(v>>8&255);m.setByte(v>>16&255);m.setByte(v>>24&255)}var w=a/8>>0;for(u=0;u<b;u+=1)for(n=0;n<w;n+=1)m.setByte(0);for(u=0;u<b;u+=1)for(n=0;n<w;n+=1)m.setByte(0);return{"data":"data:image/x-icon;base64,"+hi5.Base64.enc(m.getData()),"hotX":d,"hotY":c}}
function ha(a,b){U=a;ba=b;q.width=a;q.height=b;y.resize(a,b);if(w)w.setSize(a,b);if(e.onresolutionchange)e.onresolutionchange(a,b)}function kb(a){if(!da||!a)return;var b=a.getData("text/plain");if(b){var d=b.length;var c=new Int8Array(9+d);c[0]=147;c[1]=6;c[5]=d>>24&255;c[6]=d>>16&255;c[7]=d>>8&255;c[8]=d&255;for(var e=0;e<d;e++)c[9+e]=b.charCodeAt(e);l.send(c.buffer)}}function Ba(){C=false;loggedin=false;X=new Ja;V=new qa}function lb(a,b,d){if(!da)return;A[2]=a?16:8;A[3]=b>>8&255;A[4]=b&255;A[5]=
d>>8&255;A[6]=d&255;A[9]=A[3];A[10]=A[4];A[11]=A[5];A[12]=A[6];l.send(A.buffer)}function ua(a,b,d,c){if(!da)return;Ka=a;var e=a?1<<b:0;if(e==F[1]&&d==(F[2]<<8|F[3])&&c==(F[4]<<8|F[5]))return;F[2]=a?1<<b:0;F[3]=d>>8&255;F[4]=d&255;F[5]=c>>8&255;F[6]=c&255;l.send(F.buffer)}function ga(){if(!v.ctrlSent&&v.ctrlDown)R(true,65507);if(!v.altSent&&v.altDown)R(true,65513)}function R(a,b){Q[2]=a?1:0;Q[5]=b>>24&255;Q[6]=b>>16&255;Q[7]=b>>8&255;Q[8]=b&255;l.send(Q.buffer);v.preKey=b;switch(b){case 65505:case 65506:v.shiftDown=
a;break;case 65507:case 65508:v.ctrlDown=a;v.ctrlSent=true;break;case 65513:case 65514:v.altDown=a;v.altSent=true;if(a&&v.altNumpad){v.altNumpad=false;v.ignoreUnicode=true}}}function La(a,b){var d=Ea[b.toLowerCase()];if(d)e.writeScancode(a,d);else{var c=b.length;if(c==0)return;if(c==1)e.writeKeyCode(a,b.toUpperCase().charCodeAt(0));else if(a)e.writeText(b)}}this.displayMsg=true;this.reconnectTimes=0;this.openLink=true;this.setTitle=true;this.mode=0;var ma=typeof u=="object"?u:null;var la=typeof u==
"object"||u.indexOf("/PLAY?")>0;if(la){this.mode=1;if(ma)u="";u+="&touchpad=on"}else if(u.indexOf("/JOIN?")>0){this.mode=2;this.reconnectOnResize=false}var H=hi5.appcfg||{img:{},toolbar:{fadable:true}};var q=hi5.tool.queryToObj(u.substring(u.indexOf("?")+1));var E=null;var Da=false;var ja="";if(!q.width&&S){q.width=S;u+="&width="+S}if(!q.wHeight&&O){q.height=O;u+="&height="+O}if(!q.color&&ea){q.color=ea;u+="&color="+ea}if(!q.color)q.color=32;var ra=q.ignoreCursor==undefined||M(q.ignoreCursor);var ka=
q.trackCursorLocally==undefined||M(q.trackCursorLocally);this.server=q["server"];this.port=parseInt(q["port"],10);this.sessionInfo={major:0,minor:0,width:0,height:0,bpp:0,bigEndian:true,trueColor:true};var w=null;var C=false;var da=false;var L=null;window.$vnc=this;var z=new xa(4194304);this.running=function(){return C};var e=this;var l=null;var I=4;var U=1024;var ba=768;var fa=[-16777216,-16777180,-16777143,-16777107,-16777070,-16777034,-16776997,-16776961,-16768E3,-16767964,-16767927,-16767891,
-16767854,-16767818,-16767781,-16767745,-16758528,-16758492,-16758455,-16758419,-16758382,-16758346,-16758309,-16758273,-16749312,-16749276,-16749239,-16749203,-16749166,-16749130,-16749093,-16749057,-16739840,-16739804,-16739767,-16739731,-16739694,-16739658,-16739621,-16739585,-16730624,-16730588,-16730551,-16730515,-16730478,-16730442,-16730405,-16730369,-16721152,-16721116,-16721079,-16721043,-16721006,-16720970,-16720933,-16720897,-16711936,-16711900,-16711863,-16711827,-16711790,-16711754,-16711717,
-16711681,-11206656,-11206620,-11206583,-11206547,-11206510,-11206474,-11206437,-11206401,-11197440,-11197404,-11197367,-11197331,-11197294,-11197258,-11197221,-11197185,-11187968,-11187932,-11187895,-11187859,-11187822,-11187786,-11187749,-11187713,-11178752,-11178716,-11178679,-11178643,-11178606,-11178570,-11178533,-11178497,-11169280,-11169244,-11169207,-11169171,-11169134,-11169098,-11169061,-11169025,-11160064,-11160028,-11159991,-11159955,-11159918,-11159882,-11159845,-11159809,-11150592,-11150556,
-11150519,-11150483,-11150446,-11150410,-11150373,-11150337,-11141376,-11141340,-11141303,-11141267,-11141230,-11141194,-11141157,-11141121,-5636096,-5636060,-5636023,-5635987,-5635950,-5635914,-5635877,-5635841,-5626880,-5626844,-5626807,-5626771,-5626734,-5626698,-5626661,-5626625,-5617408,-5617372,-5617335,-5617299,-5617262,-5617226,-5617189,-5617153,-5608192,-5608156,-5608119,-5608083,-5608046,-5608010,-5607973,-5607937,-5598720,-5598684,-5598647,-5598611,-5598574,-5598538,-5598501,-5598465,-5589504,
-5589468,-5589431,-5589395,-5589358,-5589322,-5589285,-5589249,-5580032,-5579996,-5579959,-5579923,-5579886,-5579850,-5579813,-5579777,-5570816,-5570780,-5570743,-5570707,-5570670,-5570634,-5570597,-5570561,-65536,-65500,-65463,-65427,-65390,-65354,-65317,-65281,-56320,-56284,-56247,-56211,-56174,-56138,-56101,-56065,-46848,-46812,-46775,-46739,-46702,-46666,-46629,-46593,-37632,-37596,-37559,-37523,-37486,-37450,-37413,-37377,-28160,-28124,-28087,-28051,-28014,-27978,-27941,-27905,-18944,-18908,
-18871,-18835,-18798,-18762,-18725,-18689,-9472,-9436,-9399,-9363,-9326,-9290,-9253,-9217,-256,-220,-183,-147,-110,-74,-37,-1];var y=Na(1024,768);var W=y.getContext();this.writeKeyComb=function(a){var b=a.split("+");var d=b.length;if(d==0)return;var c=null;for(var e=0;e<d;e++){var k=b[e];if(k==""&&c=="")k="Add";if(k!="")La(true,k);c=k}for(e=d-1;e>=0;e--){k=b[e];if(k==""&&c=="")k="Add";if(k!="")La(false,k);c=k}};var na=new Pa;if(H.displayMsg!=undefined)this.displayMsg=H.displayMsg;if(H.reconnectTimes!=
undefined)this.reconnectTimes=H.reconnectTimes;if(H.openLink!=undefined)this.openLink=H.openLink;if(H.setTitle!=undefined)this.setTitle=H.setTitle;if(typeof H.useWSS=="boolean")u=(H.useWSS?"wss":"ws")+u.substring(u.indexOf("://"));this.getURL=function(){return u};var mb=parseInt(q.server_bpp||q.color||24);this.getColor=function(){return mb};this.sendPing=function(a){var b=a?2+a.length:2;var d=new Uint8Array(b);d[0]=146;d[1]=0;if(a)d.set(a,2);l.send(d.buffer)};this.startPing=function(a,b){b=b||0;if(!E)E=
new hi5.tool.ResponseMonitor(function(){e.sendPing()},function(){if(!C)return;if(e.onnoresponse)return e.onnoresponse()});E.setInterval(a,b);var d=new Uint8Array(4);d[0]=146;d[1]=2;d[2]=a;d[3]=b;l.send(d.buffer);e.sendPing()};this.stopPing=function(){if(E)E.stop()};this.setJoinMode=function(a){if(!C)return;l.send("8E1"+a)};this.refuseControl=function(a){if(!C)return;l.send("8E3"+a)};this.giveControl=function(a){if(!C)return;l.send("8E4"+a)};this.requestControl=function(){if(!C)return;l.send("8E2")};
this.allowJoin=function(a,b){if(!C)return;l.send("8EA"+a+"\t"+(b?1:0))};this.play=function(){l.send("F3")};this.pause=function(){l.send("F2")};this.scan=function(a){l.send("F4"+(a?"1":"0"))};this.seek=function(a){if(w&&C){l.send("F4"+(a?"1":"0")+"\t"+(a/w.getScale()|0));y.pause(true)}};this.run=function(){Sa();y.startAnimation()};this.hide=function(){if(!w)return;w.hide()};this.showMessage=function(a){if(!e.displayMsg||!a)return;hi5.notifications.notify({"msg":a})};this.close=function(){Da=true;if(l&&
C)try{for(;l&&l.readyState!=WebSocket.CLOSING&&l.readyState!=WebSocket.CLOSED;){l.send("85");l.close()}}finally{ia()}else ia()};if(!hi5.browser.isChromeApp)window.addEventListener("unload",ia,false);else chrome.runtime.onSuspend.addListener(ia);var pa=new ca(12,function b(d){var c=d.getByte()==82&&d.getByte()==70&&d.getByte()==66;if(!c){e.showMessage(__svi18n.vnc.notvnc);e.close();return}d.skip(1);e.sessionInfo.major=(d.getByte()-48)*100+(d.getByte()-48)*10+(d.getByte()-48);d.skip(1);e.sessionInfo.minor=
(d.getByte()-48)*100+(d.getByte()-48)*10+(d.getByte()-48);svGlobal.logger.info("RFB major: "+e.sessionInfo.major+" minor: "+e.sessionInfo.minor);d.skip(1);var f="\u0093RFB 003.003\n";var k=new Uint8Array(13);for(var h=0;h<13;h++)k[h]=f.charCodeAt(h);l.send(k.buffer);z.setHandler(new ca(4,function r(b){var c=b.getBE32();svGlobal.logger.info("sec type:"+c);switch(c){case 1:Ha();break;case 2:z.setHandler(new ca(12,function(){svGlobal.logger.info("vnc auth");var c=new Int8Array(17);c[0]=147;b.copyToByteArray(c,
1,b.getPosition(),16);b.skip(16);var d=q.pwd||"";if(d.length>8)d=d.substring(0,8);var e=[0,0,0,0,0,0,0,0];var f=0;for(var h=d.length;f<h;f++)e[f]=d.charCodeAt(f);var k=new DesCipher(e);k.encrypt(c,1,c,1);k.encrypt(c,9,c,9);l.send(c.buffer);z.setHandler(new ca(4,Ca))}));break;default:e.showMessage(__svi18n.vnc.securityError);e.close()}}))});z.setHandler(pa);this.refreshOutput=function(b,d,c,e){b=b||0;d=d||0;var k=c?c-b+1:U;var h=e?e-d+1:ba;ta(b,d,k,h,false)};var sa=new ca(1,ib);if(e.mode==2||e.mode==
1)z.setHandler(sa);var X=new Ja;var V=new qa;this.addSurface=function(b){w=b;if(la)b.setPlayerMode();y.setContext(w.context);W=y.getContext();b.setAutoScale(e.mode>0);b.setSize(U,ba);b.setController(na);b.setFastCopy(M(q["fastCopy"]));b.setTouchpad(M(q["touchpad"]));b.setClipboard(M(q["mapClipboard"]));b.run(99997);Aa(w);b.onclipdata=kb};var F=new Uint8Array(7);F[0]=147;F[1]=5;var Ka=false;var A=new Uint8Array(13);A[0]=147;A[1]=5;A[7]=5;A[8]=0;this.mouseDown=function(b,d,c){ua(true,c,b,d)};this.mouseMove=
function(b,d){ua(Ka,0,b,d)};this.mouseUp=function(b,d,c){ua(false,c,b,d)};this.writeKeyCode=function(b,d){e.writeRawInput("8B"+(b?0:49152)+"\t"+d)};this.writeScancode=function(b,d){if(!C)return;if(typeof b=="number"){e.writeRawInput("84"+"0\t"+b);e.writeRawInput("84"+"49152\t"+b);return}e.writeRawInput("84"+(b?0:49152)+"\t"+d)};this.writeText=function(b){e.writeRawInput("86"+b)};var Ga={57:32,201:65365,209:65366,207:65367,199:65360,203:65361,200:65362,205:65363,208:65364,183:65377,210:65379,211:65535,
184:65514,219:65515,220:65516,1:65307,14:65288,15:65289,28:65293,29:65507,42:65505,54:65506,56:65513,59:65470,60:65471,61:65472,62:65473,63:65474,64:65475,65:65476,66:65477,67:65478,68:65479,87:65480,88:65481,70:65300,157:65508};var Fa={96:65438,97:65436,98:65433,99:65435,100:65430,101:65437,102:65432,103:65429,104:65431,105:65434,110:65439};var v={altDown:false,altNumpad:false,ignoreUnicode:false,ctrlDown:false,shiftDown:false,preKey:0,ctrlSent:false,altSent:false,isAltGr:false,hasModifier:function(b){if(v.ctrlDown||
v.altDown)return true;if(!b&&v.preKey>65506&&v.preKey<65515)return true;return false},delayed:function(b,d){var c=d==65507||d==65508;var e=d==65513||d==65514;if(c||e)if(b){if(c){this.ctrlDown=true;this.ctrlSent=false;this.ignoreUnicode=true;return true}if(e)if(this.ctrlDown&&!this.ctrlSent){this.altDown=true;this.altSent=false;this.isAltGr=true;return true}}else if(this.isAltGr){this.ctrlSent=true;this.altSent=true;return true}else return false;return false}};var Q=new Uint8Array(9);Q[0]=147;Q[1]=
4;this.writeRawInput=function(b){if(!da)return;var d=parseInt(b.substring(0,2),16);var c=b.substring(2).split("\t");var f=0;var k=false;var h="";switch(d){case 128:ga();e.mouseDown(parseInt(c[0]),parseInt(c[1]),parseInt(c[2]));return;case 129:ga();e.mouseUp(parseInt(c[0]),parseInt(c[1]),parseInt(c[2]));return;case 130:ga();e.mouseMove(parseInt(c[0]),parseInt(c[1]));return;case 131:ga();lb(parseInt(c[2])!=0,parseInt(c[0]),parseInt(c[1]));return;case 132:f=Ga[c[1]]||0;k=c[0]==0;if(v.delayed(k,f))return;
if(k)ga();R(k,f);break;case 139:k=c[0]==0;f=parseInt(c[1]);if(v.isAltGr){if(f>176||M(q.preferUnicode)){v.ignoreUnicode=false;if(!k)v.isAltGr=false;return}else v.ignoreUnicode=true;if(k)R(k,65514);R(k,String.fromCharCode(f).toLowerCase().charCodeAt(0));if(!k){R(false,65514);R(false,65507);R(false,65513);v.isAltGr=false}return}if(v.altDown&&f>95&&f<106){f=Fa[c[1]];v.altNumpad=true}else{h=c.length>2&&c[2].length==1?c[2]:String.fromCharCode(f);f=v.shiftDown?h.toUpperCase().charCodeAt(0):h.toLowerCase().charCodeAt(0)}if(k)ga();
R(k,f);break;case 134:if(v.ignoreUnicode){v.ignoreUnicode=false;return}var g=0;for(var l=c[0].length;g<l;g++){f=c[0].charCodeAt(g);R(true,f);R(false,f)}}if(f<1)svGlobal.logger.info("Unknowncode: "+c[1]+" type:"+d)};var Ea={" ":57,"space":57,"pageup":201,"pagedown":209,"end":207,"home":199,"left":203,"up":200,"right":205,"down":208,"printscreen":183,"insert":210,"del":211,"delete":211,"altgr":184,"windows":219,"windowsright":220,"context":221,"esc":1,"backspace":14,"tab":15,"enter":28,"meta":29,"command":29,
"ctrl":29,"shift":42,"alt":56,"capslock":58,"f1":59,"f2":60,"f3":61,"f4":62,"f5":63,"f6":64,"f7":65,"f8":66,"f9":67,"f10":68,"f11":87,"f12":88,"numlock":69,"scrolllock":70,"add":78}};
